var a_=Object.defineProperty;var Em=e=>{throw TypeError(e)};var s_=(e,t,n)=>t in e?a_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var vc=(e,t,n)=>s_(e,typeof t!="symbol"?t+"":t,n),bc=(e,t,n)=>t.has(e)||Em("Cannot "+n);var ln=(e,t,n)=>(bc(e,t,"read from private field"),n?n.call(e):t.get(e)),so=(e,t,n)=>t.has(e)?Em("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),_c=(e,t,n,s)=>(bc(e,t,"write to private field"),s?s.call(e,n):t.set(e,n),n),Rn=(e,t,n)=>(bc(e,t,"access private method"),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();var r_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ng(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ag={exports:{}},Wl={},sg={exports:{}},Qe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Di=Symbol.for("react.element"),i_=Symbol.for("react.portal"),o_=Symbol.for("react.fragment"),l_=Symbol.for("react.strict_mode"),c_=Symbol.for("react.profiler"),u_=Symbol.for("react.provider"),d_=Symbol.for("react.context"),h_=Symbol.for("react.forward_ref"),m_=Symbol.for("react.suspense"),p_=Symbol.for("react.memo"),f_=Symbol.for("react.lazy"),Cm=Symbol.iterator;function g_(e){return e===null||typeof e!="object"?null:(e=Cm&&e[Cm]||e["@@iterator"],typeof e=="function"?e:null)}var rg={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ig=Object.assign,og={};function _r(e,t,n){this.props=e,this.context=t,this.refs=og,this.updater=n||rg}_r.prototype.isReactComponent={};_r.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};_r.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function lg(){}lg.prototype=_r.prototype;function Hd(e,t,n){this.props=e,this.context=t,this.refs=og,this.updater=n||rg}var Yd=Hd.prototype=new lg;Yd.constructor=Hd;ig(Yd,_r.prototype);Yd.isPureReactComponent=!0;var Am=Array.isArray,cg=Object.prototype.hasOwnProperty,Vd={current:null},ug={key:!0,ref:!0,__self:!0,__source:!0};function dg(e,t,n){var s,r={},i=null,o=null;if(t!=null)for(s in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(i=""+t.key),t)cg.call(t,s)&&!ug.hasOwnProperty(s)&&(r[s]=t[s]);var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];r.children=c}if(e&&e.defaultProps)for(s in l=e.defaultProps,l)r[s]===void 0&&(r[s]=l[s]);return{$$typeof:Di,type:e,key:i,ref:o,props:r,_owner:Vd.current}}function y_(e,t){return{$$typeof:Di,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Kd(e){return typeof e=="object"&&e!==null&&e.$$typeof===Di}function v_(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Im=/\/+/g;function xc(e,t){return typeof e=="object"&&e!==null&&e.key!=null?v_(""+e.key):t.toString(36)}function Uo(e,t,n,s,r){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Di:case i_:o=!0}}if(o)return o=e,r=r(o),e=s===""?"."+xc(o,0):s,Am(r)?(n="",e!=null&&(n=e.replace(Im,"$&/")+"/"),Uo(r,t,n,"",function(u){return u})):r!=null&&(Kd(r)&&(r=y_(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(Im,"$&/")+"/")+e)),t.push(r)),1;if(o=0,s=s===""?".":s+":",Am(e))for(var l=0;l<e.length;l++){i=e[l];var c=s+xc(i,l);o+=Uo(i,t,n,c,r)}else if(c=g_(e),typeof c=="function")for(e=c.call(e),l=0;!(i=e.next()).done;)i=i.value,c=s+xc(i,l++),o+=Uo(i,t,n,c,r);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function ro(e,t,n){if(e==null)return e;var s=[],r=0;return Uo(e,s,"","",function(i){return t.call(n,i,r++)}),s}function b_(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Vt={current:null},Wo={transition:null},__={ReactCurrentDispatcher:Vt,ReactCurrentBatchConfig:Wo,ReactCurrentOwner:Vd};function hg(){throw Error("act(...) is not supported in production builds of React.")}Qe.Children={map:ro,forEach:function(e,t,n){ro(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return ro(e,function(){t++}),t},toArray:function(e){return ro(e,function(t){return t})||[]},only:function(e){if(!Kd(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Qe.Component=_r;Qe.Fragment=o_;Qe.Profiler=c_;Qe.PureComponent=Hd;Qe.StrictMode=l_;Qe.Suspense=m_;Qe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=__;Qe.act=hg;Qe.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=ig({},e.props),r=e.key,i=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,o=Vd.current),t.key!==void 0&&(r=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)cg.call(t,c)&&!ug.hasOwnProperty(c)&&(s[c]=t[c]===void 0&&l!==void 0?l[c]:t[c])}var c=arguments.length-2;if(c===1)s.children=n;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];s.children=l}return{$$typeof:Di,type:e.type,key:r,ref:i,props:s,_owner:o}};Qe.createContext=function(e){return e={$$typeof:d_,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:u_,_context:e},e.Consumer=e};Qe.createElement=dg;Qe.createFactory=function(e){var t=dg.bind(null,e);return t.type=e,t};Qe.createRef=function(){return{current:null}};Qe.forwardRef=function(e){return{$$typeof:h_,render:e}};Qe.isValidElement=Kd;Qe.lazy=function(e){return{$$typeof:f_,_payload:{_status:-1,_result:e},_init:b_}};Qe.memo=function(e,t){return{$$typeof:p_,type:e,compare:t===void 0?null:t}};Qe.startTransition=function(e){var t=Wo.transition;Wo.transition={};try{e()}finally{Wo.transition=t}};Qe.unstable_act=hg;Qe.useCallback=function(e,t){return Vt.current.useCallback(e,t)};Qe.useContext=function(e){return Vt.current.useContext(e)};Qe.useDebugValue=function(){};Qe.useDeferredValue=function(e){return Vt.current.useDeferredValue(e)};Qe.useEffect=function(e,t){return Vt.current.useEffect(e,t)};Qe.useId=function(){return Vt.current.useId()};Qe.useImperativeHandle=function(e,t,n){return Vt.current.useImperativeHandle(e,t,n)};Qe.useInsertionEffect=function(e,t){return Vt.current.useInsertionEffect(e,t)};Qe.useLayoutEffect=function(e,t){return Vt.current.useLayoutEffect(e,t)};Qe.useMemo=function(e,t){return Vt.current.useMemo(e,t)};Qe.useReducer=function(e,t,n){return Vt.current.useReducer(e,t,n)};Qe.useRef=function(e){return Vt.current.useRef(e)};Qe.useState=function(e){return Vt.current.useState(e)};Qe.useSyncExternalStore=function(e,t,n){return Vt.current.useSyncExternalStore(e,t,n)};Qe.useTransition=function(){return Vt.current.useTransition()};Qe.version="18.3.1";sg.exports=Qe;var T=sg.exports;const v=ng(T);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var x_=T,w_=Symbol.for("react.element"),k_=Symbol.for("react.fragment"),N_=Object.prototype.hasOwnProperty,j_=x_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,S_={key:!0,ref:!0,__self:!0,__source:!0};function mg(e,t,n){var s,r={},i=null,o=null;n!==void 0&&(i=""+n),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(o=t.ref);for(s in t)N_.call(t,s)&&!S_.hasOwnProperty(s)&&(r[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)r[s]===void 0&&(r[s]=t[s]);return{$$typeof:w_,type:e,key:i,ref:o,props:r,_owner:j_.current}}Wl.Fragment=k_;Wl.jsx=mg;Wl.jsxs=mg;ag.exports=Wl;var a=ag.exports,yu={},pg={exports:{}},vn={},fg={exports:{}},gg={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(D,F){var q=D.length;D.push(F);e:for(;0<q;){var V=q-1>>>1,Q=D[V];if(0<r(Q,F))D[V]=F,D[q]=Q,q=V;else break e}}function n(D){return D.length===0?null:D[0]}function s(D){if(D.length===0)return null;var F=D[0],q=D.pop();if(q!==F){D[0]=q;e:for(var V=0,Q=D.length,te=Q>>>1;V<te;){var B=2*(V+1)-1,ae=D[B],le=B+1,he=D[le];if(0>r(ae,q))le<Q&&0>r(he,ae)?(D[V]=he,D[le]=q,V=le):(D[V]=ae,D[B]=q,V=B);else if(le<Q&&0>r(he,q))D[V]=he,D[le]=q,V=le;else break e}}return F}function r(D,F){var q=D.sortIndex-F.sortIndex;return q!==0?q:D.id-F.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();e.unstable_now=function(){return o.now()-l}}var c=[],u=[],d=1,h=null,m=3,y=!1,b=!1,_=!1,w=typeof setTimeout=="function"?setTimeout:null,f=typeof clearTimeout=="function"?clearTimeout:null,p=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function g(D){for(var F=n(u);F!==null;){if(F.callback===null)s(u);else if(F.startTime<=D)s(u),F.sortIndex=F.expirationTime,t(c,F);else break;F=n(u)}}function j(D){if(_=!1,g(D),!b)if(n(c)!==null)b=!0,$(A);else{var F=n(u);F!==null&&L(j,F.startTime-D)}}function A(D,F){b=!1,_&&(_=!1,f(k),k=-1),y=!0;var q=m;try{for(g(F),h=n(c);h!==null&&(!(h.expirationTime>F)||D&&!M());){var V=h.callback;if(typeof V=="function"){h.callback=null,m=h.priorityLevel;var Q=V(h.expirationTime<=F);F=e.unstable_now(),typeof Q=="function"?h.callback=Q:h===n(c)&&s(c),g(F)}else s(c);h=n(c)}if(h!==null)var te=!0;else{var B=n(u);B!==null&&L(j,B.startTime-F),te=!1}return te}finally{h=null,m=q,y=!1}}var R=!1,S=null,k=-1,N=5,E=-1;function M(){return!(e.unstable_now()-E<N)}function O(){if(S!==null){var D=e.unstable_now();E=D;var F=!0;try{F=S(!0,D)}finally{F?X():(R=!1,S=null)}}else R=!1}var X;if(typeof p=="function")X=function(){p(O)};else if(typeof MessageChannel<"u"){var re=new MessageChannel,I=re.port2;re.port1.onmessage=O,X=function(){I.postMessage(null)}}else X=function(){w(O,0)};function $(D){S=D,R||(R=!0,X())}function L(D,F){k=w(function(){D(e.unstable_now())},F)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(D){D.callback=null},e.unstable_continueExecution=function(){b||y||(b=!0,$(A))},e.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<D?Math.floor(1e3/D):5},e.unstable_getCurrentPriorityLevel=function(){return m},e.unstable_getFirstCallbackNode=function(){return n(c)},e.unstable_next=function(D){switch(m){case 1:case 2:case 3:var F=3;break;default:F=m}var q=m;m=F;try{return D()}finally{m=q}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(D,F){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var q=m;m=D;try{return F()}finally{m=q}},e.unstable_scheduleCallback=function(D,F,q){var V=e.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?V+q:V):q=V,D){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=q+Q,D={id:d++,callback:F,priorityLevel:D,startTime:q,expirationTime:Q,sortIndex:-1},q>V?(D.sortIndex=q,t(u,D),n(c)===null&&D===n(u)&&(_?(f(k),k=-1):_=!0,L(j,q-V))):(D.sortIndex=Q,t(c,D),b||y||(b=!0,$(A))),D},e.unstable_shouldYield=M,e.unstable_wrapCallback=function(D){var F=m;return function(){var q=m;m=F;try{return D.apply(this,arguments)}finally{m=q}}}})(gg);fg.exports=gg;var E_=fg.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var C_=T,gn=E_;function ge(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var yg=new Set,ui={};function Ss(e,t){mr(e,t),mr(e+"Capture",t)}function mr(e,t){for(ui[e]=t,e=0;e<t.length;e++)yg.add(t[e])}var xa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),vu=Object.prototype.hasOwnProperty,A_=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Pm={},Tm={};function I_(e){return vu.call(Tm,e)?!0:vu.call(Pm,e)?!1:A_.test(e)?Tm[e]=!0:(Pm[e]=!0,!1)}function P_(e,t,n,s){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function T_(e,t,n,s){if(t===null||typeof t>"u"||P_(e,t,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Kt(e,t,n,s,r,i,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var $t={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){$t[e]=new Kt(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];$t[t]=new Kt(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){$t[e]=new Kt(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){$t[e]=new Kt(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){$t[e]=new Kt(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){$t[e]=new Kt(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){$t[e]=new Kt(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){$t[e]=new Kt(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){$t[e]=new Kt(e,5,!1,e.toLowerCase(),null,!1,!1)});var Gd=/[\-:]([a-z])/g;function Jd(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Gd,Jd);$t[t]=new Kt(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Gd,Jd);$t[t]=new Kt(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Gd,Jd);$t[t]=new Kt(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){$t[e]=new Kt(e,1,!1,e.toLowerCase(),null,!1,!1)});$t.xlinkHref=new Kt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){$t[e]=new Kt(e,1,!1,e.toLowerCase(),null,!0,!0)});function Qd(e,t,n,s){var r=$t.hasOwnProperty(t)?$t[t]:null;(r!==null?r.type!==0:s||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(T_(t,n,r,s)&&(n=null),s||r===null?I_(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=n===null?r.type===3?!1:"":n:(t=r.attributeName,s=r.attributeNamespace,n===null?e.removeAttribute(t):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,s?e.setAttributeNS(s,t,n):e.setAttribute(t,n))))}var Sa=C_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,io=Symbol.for("react.element"),Ys=Symbol.for("react.portal"),Vs=Symbol.for("react.fragment"),Xd=Symbol.for("react.strict_mode"),bu=Symbol.for("react.profiler"),vg=Symbol.for("react.provider"),bg=Symbol.for("react.context"),Zd=Symbol.for("react.forward_ref"),_u=Symbol.for("react.suspense"),xu=Symbol.for("react.suspense_list"),eh=Symbol.for("react.memo"),Da=Symbol.for("react.lazy"),_g=Symbol.for("react.offscreen"),Rm=Symbol.iterator;function Ar(e){return e===null||typeof e!="object"?null:(e=Rm&&e[Rm]||e["@@iterator"],typeof e=="function"?e:null)}var yt=Object.assign,wc;function Wr(e){if(wc===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);wc=t&&t[1]||""}return`
`+wc+e}var kc=!1;function Nc(e,t){if(!e||kc)return"";kc=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var s=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){s=u}e.call(t.prototype)}else{try{throw Error()}catch(u){s=u}e()}}catch(u){if(u&&s&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),i=s.stack.split(`
`),o=r.length-1,l=i.length-1;1<=o&&0<=l&&r[o]!==i[l];)l--;for(;1<=o&&0<=l;o--,l--)if(r[o]!==i[l]){if(o!==1||l!==1)do if(o--,l--,0>l||r[o]!==i[l]){var c=`
`+r[o].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=o&&0<=l);break}}}finally{kc=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Wr(e):""}function R_(e){switch(e.tag){case 5:return Wr(e.type);case 16:return Wr("Lazy");case 13:return Wr("Suspense");case 19:return Wr("SuspenseList");case 0:case 2:case 15:return e=Nc(e.type,!1),e;case 11:return e=Nc(e.type.render,!1),e;case 1:return e=Nc(e.type,!0),e;default:return""}}function wu(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Vs:return"Fragment";case Ys:return"Portal";case bu:return"Profiler";case Xd:return"StrictMode";case _u:return"Suspense";case xu:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case bg:return(e.displayName||"Context")+".Consumer";case vg:return(e._context.displayName||"Context")+".Provider";case Zd:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case eh:return t=e.displayName||null,t!==null?t:wu(e.type)||"Memo";case Da:t=e._payload,e=e._init;try{return wu(e(t))}catch{}}return null}function D_(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return wu(t);case 8:return t===Xd?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Qa(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function xg(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function M_(e){var t=xg(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(o){s=""+o,i.call(this,o)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(o){s=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function oo(e){e._valueTracker||(e._valueTracker=M_(e))}function wg(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),s="";return e&&(s=xg(e)?e.checked?"true":"false":e.value),e=s,e!==n?(t.setValue(e),!0):!1}function rl(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function ku(e,t){var n=t.checked;return yt({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function Dm(e,t){var n=t.defaultValue==null?"":t.defaultValue,s=t.checked!=null?t.checked:t.defaultChecked;n=Qa(t.value!=null?t.value:n),e._wrapperState={initialChecked:s,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function kg(e,t){t=t.checked,t!=null&&Qd(e,"checked",t,!1)}function Nu(e,t){kg(e,t);var n=Qa(t.value),s=t.type;if(n!=null)s==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(s==="submit"||s==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?ju(e,t.type,n):t.hasOwnProperty("defaultValue")&&ju(e,t.type,Qa(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Mm(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!(s!=="submit"&&s!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function ju(e,t,n){(t!=="number"||rl(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var zr=Array.isArray;function rr(e,t,n,s){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&s&&(e[n].defaultSelected=!0)}else{for(n=""+Qa(n),t=null,r=0;r<e.length;r++){if(e[r].value===n){e[r].selected=!0,s&&(e[r].defaultSelected=!0);return}t!==null||e[r].disabled||(t=e[r])}t!==null&&(t.selected=!0)}}function Su(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(ge(91));return yt({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Lm(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(ge(92));if(zr(n)){if(1<n.length)throw Error(ge(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:Qa(n)}}function Ng(e,t){var n=Qa(t.value),s=Qa(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),s!=null&&(e.defaultValue=""+s)}function Om(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function jg(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Eu(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?jg(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var lo,Sg=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,s,r){MSApp.execUnsafeLocalFunction(function(){return e(t,n,s,r)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(lo=lo||document.createElement("div"),lo.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=lo.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function di(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Zr={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},L_=["Webkit","ms","Moz","O"];Object.keys(Zr).forEach(function(e){L_.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Zr[t]=Zr[e]})});function Eg(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Zr.hasOwnProperty(e)&&Zr[e]?(""+t).trim():t+"px"}function Cg(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var s=n.indexOf("--")===0,r=Eg(n,t[n],s);n==="float"&&(n="cssFloat"),s?e.setProperty(n,r):e[n]=r}}var O_=yt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Cu(e,t){if(t){if(O_[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(ge(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(ge(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(ge(61))}if(t.style!=null&&typeof t.style!="object")throw Error(ge(62))}}function Au(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Iu=null;function th(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Pu=null,ir=null,or=null;function $m(e){if(e=Oi(e)){if(typeof Pu!="function")throw Error(ge(280));var t=e.stateNode;t&&(t=Kl(t),Pu(e.stateNode,e.type,t))}}function Ag(e){ir?or?or.push(e):or=[e]:ir=e}function Ig(){if(ir){var e=ir,t=or;if(or=ir=null,$m(e),t)for(e=0;e<t.length;e++)$m(t[e])}}function Pg(e,t){return e(t)}function Tg(){}var jc=!1;function Rg(e,t,n){if(jc)return e(t,n);jc=!0;try{return Pg(e,t,n)}finally{jc=!1,(ir!==null||or!==null)&&(Tg(),Ig())}}function hi(e,t){var n=e.stateNode;if(n===null)return null;var s=Kl(n);if(s===null)return null;n=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(ge(231,t,typeof n));return n}var Tu=!1;if(xa)try{var Ir={};Object.defineProperty(Ir,"passive",{get:function(){Tu=!0}}),window.addEventListener("test",Ir,Ir),window.removeEventListener("test",Ir,Ir)}catch{Tu=!1}function $_(e,t,n,s,r,i,o,l,c){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(d){this.onError(d)}}var ei=!1,il=null,ol=!1,Ru=null,B_={onError:function(e){ei=!0,il=e}};function F_(e,t,n,s,r,i,o,l,c){ei=!1,il=null,$_.apply(B_,arguments)}function q_(e,t,n,s,r,i,o,l,c){if(F_.apply(this,arguments),ei){if(ei){var u=il;ei=!1,il=null}else throw Error(ge(198));ol||(ol=!0,Ru=u)}}function Es(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function Dg(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Bm(e){if(Es(e)!==e)throw Error(ge(188))}function U_(e){var t=e.alternate;if(!t){if(t=Es(e),t===null)throw Error(ge(188));return t!==e?null:e}for(var n=e,s=t;;){var r=n.return;if(r===null)break;var i=r.alternate;if(i===null){if(s=r.return,s!==null){n=s;continue}break}if(r.child===i.child){for(i=r.child;i;){if(i===n)return Bm(r),e;if(i===s)return Bm(r),t;i=i.sibling}throw Error(ge(188))}if(n.return!==s.return)n=r,s=i;else{for(var o=!1,l=r.child;l;){if(l===n){o=!0,n=r,s=i;break}if(l===s){o=!0,s=r,n=i;break}l=l.sibling}if(!o){for(l=i.child;l;){if(l===n){o=!0,n=i,s=r;break}if(l===s){o=!0,s=i,n=r;break}l=l.sibling}if(!o)throw Error(ge(189))}}if(n.alternate!==s)throw Error(ge(190))}if(n.tag!==3)throw Error(ge(188));return n.stateNode.current===n?e:t}function Mg(e){return e=U_(e),e!==null?Lg(e):null}function Lg(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Lg(e);if(t!==null)return t;e=e.sibling}return null}var Og=gn.unstable_scheduleCallback,Fm=gn.unstable_cancelCallback,W_=gn.unstable_shouldYield,z_=gn.unstable_requestPaint,kt=gn.unstable_now,H_=gn.unstable_getCurrentPriorityLevel,nh=gn.unstable_ImmediatePriority,$g=gn.unstable_UserBlockingPriority,ll=gn.unstable_NormalPriority,Y_=gn.unstable_LowPriority,Bg=gn.unstable_IdlePriority,zl=null,ta=null;function V_(e){if(ta&&typeof ta.onCommitFiberRoot=="function")try{ta.onCommitFiberRoot(zl,e,void 0,(e.current.flags&128)===128)}catch{}}var Un=Math.clz32?Math.clz32:J_,K_=Math.log,G_=Math.LN2;function J_(e){return e>>>=0,e===0?32:31-(K_(e)/G_|0)|0}var co=64,uo=4194304;function Hr(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function cl(e,t){var n=e.pendingLanes;if(n===0)return 0;var s=0,r=e.suspendedLanes,i=e.pingedLanes,o=n&268435455;if(o!==0){var l=o&~r;l!==0?s=Hr(l):(i&=o,i!==0&&(s=Hr(i)))}else o=n&~r,o!==0?s=Hr(o):i!==0&&(s=Hr(i));if(s===0)return 0;if(t!==0&&t!==s&&!(t&r)&&(r=s&-s,i=t&-t,r>=i||r===16&&(i&4194240)!==0))return t;if(s&4&&(s|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=s;0<t;)n=31-Un(t),r=1<<n,s|=e[n],t&=~r;return s}function Q_(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function X_(e,t){for(var n=e.suspendedLanes,s=e.pingedLanes,r=e.expirationTimes,i=e.pendingLanes;0<i;){var o=31-Un(i),l=1<<o,c=r[o];c===-1?(!(l&n)||l&s)&&(r[o]=Q_(l,t)):c<=t&&(e.expiredLanes|=l),i&=~l}}function Du(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Fg(){var e=co;return co<<=1,!(co&4194240)&&(co=64),e}function Sc(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Mi(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Un(t),e[t]=n}function Z_(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var s=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-Un(n),i=1<<r;t[r]=0,s[r]=-1,e[r]=-1,n&=~i}}function ah(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var s=31-Un(n),r=1<<s;r&t|e[s]&t&&(e[s]|=t),n&=~r}}var at=0;function qg(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Ug,sh,Wg,zg,Hg,Mu=!1,ho=[],Wa=null,za=null,Ha=null,mi=new Map,pi=new Map,Oa=[],ex="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function qm(e,t){switch(e){case"focusin":case"focusout":Wa=null;break;case"dragenter":case"dragleave":za=null;break;case"mouseover":case"mouseout":Ha=null;break;case"pointerover":case"pointerout":mi.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":pi.delete(t.pointerId)}}function Pr(e,t,n,s,r,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:s,nativeEvent:i,targetContainers:[r]},t!==null&&(t=Oi(t),t!==null&&sh(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,r!==null&&t.indexOf(r)===-1&&t.push(r),e)}function tx(e,t,n,s,r){switch(t){case"focusin":return Wa=Pr(Wa,e,t,n,s,r),!0;case"dragenter":return za=Pr(za,e,t,n,s,r),!0;case"mouseover":return Ha=Pr(Ha,e,t,n,s,r),!0;case"pointerover":var i=r.pointerId;return mi.set(i,Pr(mi.get(i)||null,e,t,n,s,r)),!0;case"gotpointercapture":return i=r.pointerId,pi.set(i,Pr(pi.get(i)||null,e,t,n,s,r)),!0}return!1}function Yg(e){var t=fs(e.target);if(t!==null){var n=Es(t);if(n!==null){if(t=n.tag,t===13){if(t=Dg(n),t!==null){e.blockedOn=t,Hg(e.priority,function(){Wg(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function zo(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Lu(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var s=new n.constructor(n.type,n);Iu=s,n.target.dispatchEvent(s),Iu=null}else return t=Oi(n),t!==null&&sh(t),e.blockedOn=n,!1;t.shift()}return!0}function Um(e,t,n){zo(e)&&n.delete(t)}function nx(){Mu=!1,Wa!==null&&zo(Wa)&&(Wa=null),za!==null&&zo(za)&&(za=null),Ha!==null&&zo(Ha)&&(Ha=null),mi.forEach(Um),pi.forEach(Um)}function Tr(e,t){e.blockedOn===t&&(e.blockedOn=null,Mu||(Mu=!0,gn.unstable_scheduleCallback(gn.unstable_NormalPriority,nx)))}function fi(e){function t(r){return Tr(r,e)}if(0<ho.length){Tr(ho[0],e);for(var n=1;n<ho.length;n++){var s=ho[n];s.blockedOn===e&&(s.blockedOn=null)}}for(Wa!==null&&Tr(Wa,e),za!==null&&Tr(za,e),Ha!==null&&Tr(Ha,e),mi.forEach(t),pi.forEach(t),n=0;n<Oa.length;n++)s=Oa[n],s.blockedOn===e&&(s.blockedOn=null);for(;0<Oa.length&&(n=Oa[0],n.blockedOn===null);)Yg(n),n.blockedOn===null&&Oa.shift()}var lr=Sa.ReactCurrentBatchConfig,ul=!0;function ax(e,t,n,s){var r=at,i=lr.transition;lr.transition=null;try{at=1,rh(e,t,n,s)}finally{at=r,lr.transition=i}}function sx(e,t,n,s){var r=at,i=lr.transition;lr.transition=null;try{at=4,rh(e,t,n,s)}finally{at=r,lr.transition=i}}function rh(e,t,n,s){if(ul){var r=Lu(e,t,n,s);if(r===null)Lc(e,t,s,dl,n),qm(e,s);else if(tx(r,e,t,n,s))s.stopPropagation();else if(qm(e,s),t&4&&-1<ex.indexOf(e)){for(;r!==null;){var i=Oi(r);if(i!==null&&Ug(i),i=Lu(e,t,n,s),i===null&&Lc(e,t,s,dl,n),i===r)break;r=i}r!==null&&s.stopPropagation()}else Lc(e,t,s,null,n)}}var dl=null;function Lu(e,t,n,s){if(dl=null,e=th(s),e=fs(e),e!==null)if(t=Es(e),t===null)e=null;else if(n=t.tag,n===13){if(e=Dg(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return dl=e,null}function Vg(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(H_()){case nh:return 1;case $g:return 4;case ll:case Y_:return 16;case Bg:return 536870912;default:return 16}default:return 16}}var qa=null,ih=null,Ho=null;function Kg(){if(Ho)return Ho;var e,t=ih,n=t.length,s,r="value"in qa?qa.value:qa.textContent,i=r.length;for(e=0;e<n&&t[e]===r[e];e++);var o=n-e;for(s=1;s<=o&&t[n-s]===r[i-s];s++);return Ho=r.slice(e,1<s?1-s:void 0)}function Yo(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function mo(){return!0}function Wm(){return!1}function bn(e){function t(n,s,r,i,o){this._reactName=n,this._targetInst=r,this.type=s,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(n=e[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?mo:Wm,this.isPropagationStopped=Wm,this}return yt(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=mo)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=mo)},persist:function(){},isPersistent:mo}),t}var xr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},oh=bn(xr),Li=yt({},xr,{view:0,detail:0}),rx=bn(Li),Ec,Cc,Rr,Hl=yt({},Li,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:lh,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Rr&&(Rr&&e.type==="mousemove"?(Ec=e.screenX-Rr.screenX,Cc=e.screenY-Rr.screenY):Cc=Ec=0,Rr=e),Ec)},movementY:function(e){return"movementY"in e?e.movementY:Cc}}),zm=bn(Hl),ix=yt({},Hl,{dataTransfer:0}),ox=bn(ix),lx=yt({},Li,{relatedTarget:0}),Ac=bn(lx),cx=yt({},xr,{animationName:0,elapsedTime:0,pseudoElement:0}),ux=bn(cx),dx=yt({},xr,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),hx=bn(dx),mx=yt({},xr,{data:0}),Hm=bn(mx),px={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},gx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function yx(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=gx[e])?!!t[e]:!1}function lh(){return yx}var vx=yt({},Li,{key:function(e){if(e.key){var t=px[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Yo(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?fx[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:lh,charCode:function(e){return e.type==="keypress"?Yo(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Yo(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),bx=bn(vx),_x=yt({},Hl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ym=bn(_x),xx=yt({},Li,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:lh}),wx=bn(xx),kx=yt({},xr,{propertyName:0,elapsedTime:0,pseudoElement:0}),Nx=bn(kx),jx=yt({},Hl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Sx=bn(jx),Ex=[9,13,27,32],ch=xa&&"CompositionEvent"in window,ti=null;xa&&"documentMode"in document&&(ti=document.documentMode);var Cx=xa&&"TextEvent"in window&&!ti,Gg=xa&&(!ch||ti&&8<ti&&11>=ti),Vm=" ",Km=!1;function Jg(e,t){switch(e){case"keyup":return Ex.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Qg(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Ks=!1;function Ax(e,t){switch(e){case"compositionend":return Qg(t);case"keypress":return t.which!==32?null:(Km=!0,Vm);case"textInput":return e=t.data,e===Vm&&Km?null:e;default:return null}}function Ix(e,t){if(Ks)return e==="compositionend"||!ch&&Jg(e,t)?(e=Kg(),Ho=ih=qa=null,Ks=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Gg&&t.locale!=="ko"?null:t.data;default:return null}}var Px={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gm(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Px[e.type]:t==="textarea"}function Xg(e,t,n,s){Ag(s),t=hl(t,"onChange"),0<t.length&&(n=new oh("onChange","change",null,n,s),e.push({event:n,listeners:t}))}var ni=null,gi=null;function Tx(e){cy(e,0)}function Yl(e){var t=Qs(e);if(wg(t))return e}function Rx(e,t){if(e==="change")return t}var Zg=!1;if(xa){var Ic;if(xa){var Pc="oninput"in document;if(!Pc){var Jm=document.createElement("div");Jm.setAttribute("oninput","return;"),Pc=typeof Jm.oninput=="function"}Ic=Pc}else Ic=!1;Zg=Ic&&(!document.documentMode||9<document.documentMode)}function Qm(){ni&&(ni.detachEvent("onpropertychange",ey),gi=ni=null)}function ey(e){if(e.propertyName==="value"&&Yl(gi)){var t=[];Xg(t,gi,e,th(e)),Rg(Tx,t)}}function Dx(e,t,n){e==="focusin"?(Qm(),ni=t,gi=n,ni.attachEvent("onpropertychange",ey)):e==="focusout"&&Qm()}function Mx(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Yl(gi)}function Lx(e,t){if(e==="click")return Yl(t)}function Ox(e,t){if(e==="input"||e==="change")return Yl(t)}function $x(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var zn=typeof Object.is=="function"?Object.is:$x;function yi(e,t){if(zn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var r=n[s];if(!vu.call(t,r)||!zn(e[r],t[r]))return!1}return!0}function Xm(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Zm(e,t){var n=Xm(e);e=0;for(var s;n;){if(n.nodeType===3){if(s=e+n.textContent.length,e<=t&&s>=t)return{node:n,offset:t-e};e=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Xm(n)}}function ty(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?ty(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function ny(){for(var e=window,t=rl();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=rl(e.document)}return t}function uh(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Bx(e){var t=ny(),n=e.focusedElem,s=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&ty(n.ownerDocument.documentElement,n)){if(s!==null&&uh(n)){if(t=s.start,e=s.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var r=n.textContent.length,i=Math.min(s.start,r);s=s.end===void 0?i:Math.min(s.end,r),!e.extend&&i>s&&(r=s,s=i,i=r),r=Zm(n,i);var o=Zm(n,s);r&&o&&(e.rangeCount!==1||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(r.node,r.offset),e.removeAllRanges(),i>s?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Fx=xa&&"documentMode"in document&&11>=document.documentMode,Gs=null,Ou=null,ai=null,$u=!1;function ep(e,t,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;$u||Gs==null||Gs!==rl(s)||(s=Gs,"selectionStart"in s&&uh(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),ai&&yi(ai,s)||(ai=s,s=hl(Ou,"onSelect"),0<s.length&&(t=new oh("onSelect","select",null,t,n),e.push({event:t,listeners:s}),t.target=Gs)))}function po(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Js={animationend:po("Animation","AnimationEnd"),animationiteration:po("Animation","AnimationIteration"),animationstart:po("Animation","AnimationStart"),transitionend:po("Transition","TransitionEnd")},Tc={},ay={};xa&&(ay=document.createElement("div").style,"AnimationEvent"in window||(delete Js.animationend.animation,delete Js.animationiteration.animation,delete Js.animationstart.animation),"TransitionEvent"in window||delete Js.transitionend.transition);function Vl(e){if(Tc[e])return Tc[e];if(!Js[e])return e;var t=Js[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in ay)return Tc[e]=t[n];return e}var sy=Vl("animationend"),ry=Vl("animationiteration"),iy=Vl("animationstart"),oy=Vl("transitionend"),ly=new Map,tp="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Za(e,t){ly.set(e,t),Ss(t,[e])}for(var Rc=0;Rc<tp.length;Rc++){var Dc=tp[Rc],qx=Dc.toLowerCase(),Ux=Dc[0].toUpperCase()+Dc.slice(1);Za(qx,"on"+Ux)}Za(sy,"onAnimationEnd");Za(ry,"onAnimationIteration");Za(iy,"onAnimationStart");Za("dblclick","onDoubleClick");Za("focusin","onFocus");Za("focusout","onBlur");Za(oy,"onTransitionEnd");mr("onMouseEnter",["mouseout","mouseover"]);mr("onMouseLeave",["mouseout","mouseover"]);mr("onPointerEnter",["pointerout","pointerover"]);mr("onPointerLeave",["pointerout","pointerover"]);Ss("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ss("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ss("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ss("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ss("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ss("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Yr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Wx=new Set("cancel close invalid load scroll toggle".split(" ").concat(Yr));function np(e,t,n){var s=e.type||"unknown-event";e.currentTarget=n,q_(s,t,void 0,e),e.currentTarget=null}function cy(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var s=e[n],r=s.event;s=s.listeners;e:{var i=void 0;if(t)for(var o=s.length-1;0<=o;o--){var l=s[o],c=l.instance,u=l.currentTarget;if(l=l.listener,c!==i&&r.isPropagationStopped())break e;np(r,l,u),i=c}else for(o=0;o<s.length;o++){if(l=s[o],c=l.instance,u=l.currentTarget,l=l.listener,c!==i&&r.isPropagationStopped())break e;np(r,l,u),i=c}}}if(ol)throw e=Ru,ol=!1,Ru=null,e}function lt(e,t){var n=t[Wu];n===void 0&&(n=t[Wu]=new Set);var s=e+"__bubble";n.has(s)||(uy(t,e,2,!1),n.add(s))}function Mc(e,t,n){var s=0;t&&(s|=4),uy(n,e,s,t)}var fo="_reactListening"+Math.random().toString(36).slice(2);function vi(e){if(!e[fo]){e[fo]=!0,yg.forEach(function(n){n!=="selectionchange"&&(Wx.has(n)||Mc(n,!1,e),Mc(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[fo]||(t[fo]=!0,Mc("selectionchange",!1,t))}}function uy(e,t,n,s){switch(Vg(t)){case 1:var r=ax;break;case 4:r=sx;break;default:r=rh}n=r.bind(null,t,n,e),r=void 0,!Tu||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(r=!0),s?r!==void 0?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):r!==void 0?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Lc(e,t,n,s,r){var i=s;if(!(t&1)&&!(t&2)&&s!==null)e:for(;;){if(s===null)return;var o=s.tag;if(o===3||o===4){var l=s.stateNode.containerInfo;if(l===r||l.nodeType===8&&l.parentNode===r)break;if(o===4)for(o=s.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;o=o.return}for(;l!==null;){if(o=fs(l),o===null)return;if(c=o.tag,c===5||c===6){s=i=o;continue e}l=l.parentNode}}s=s.return}Rg(function(){var u=i,d=th(n),h=[];e:{var m=ly.get(e);if(m!==void 0){var y=oh,b=e;switch(e){case"keypress":if(Yo(n)===0)break e;case"keydown":case"keyup":y=bx;break;case"focusin":b="focus",y=Ac;break;case"focusout":b="blur",y=Ac;break;case"beforeblur":case"afterblur":y=Ac;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=zm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=ox;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=wx;break;case sy:case ry:case iy:y=ux;break;case oy:y=Nx;break;case"scroll":y=rx;break;case"wheel":y=Sx;break;case"copy":case"cut":case"paste":y=hx;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=Ym}var _=(t&4)!==0,w=!_&&e==="scroll",f=_?m!==null?m+"Capture":null:m;_=[];for(var p=u,g;p!==null;){g=p;var j=g.stateNode;if(g.tag===5&&j!==null&&(g=j,f!==null&&(j=hi(p,f),j!=null&&_.push(bi(p,j,g)))),w)break;p=p.return}0<_.length&&(m=new y(m,b,null,n,d),h.push({event:m,listeners:_}))}}if(!(t&7)){e:{if(m=e==="mouseover"||e==="pointerover",y=e==="mouseout"||e==="pointerout",m&&n!==Iu&&(b=n.relatedTarget||n.fromElement)&&(fs(b)||b[wa]))break e;if((y||m)&&(m=d.window===d?d:(m=d.ownerDocument)?m.defaultView||m.parentWindow:window,y?(b=n.relatedTarget||n.toElement,y=u,b=b?fs(b):null,b!==null&&(w=Es(b),b!==w||b.tag!==5&&b.tag!==6)&&(b=null)):(y=null,b=u),y!==b)){if(_=zm,j="onMouseLeave",f="onMouseEnter",p="mouse",(e==="pointerout"||e==="pointerover")&&(_=Ym,j="onPointerLeave",f="onPointerEnter",p="pointer"),w=y==null?m:Qs(y),g=b==null?m:Qs(b),m=new _(j,p+"leave",y,n,d),m.target=w,m.relatedTarget=g,j=null,fs(d)===u&&(_=new _(f,p+"enter",b,n,d),_.target=g,_.relatedTarget=w,j=_),w=j,y&&b)t:{for(_=y,f=b,p=0,g=_;g;g=Ds(g))p++;for(g=0,j=f;j;j=Ds(j))g++;for(;0<p-g;)_=Ds(_),p--;for(;0<g-p;)f=Ds(f),g--;for(;p--;){if(_===f||f!==null&&_===f.alternate)break t;_=Ds(_),f=Ds(f)}_=null}else _=null;y!==null&&ap(h,m,y,_,!1),b!==null&&w!==null&&ap(h,w,b,_,!0)}}e:{if(m=u?Qs(u):window,y=m.nodeName&&m.nodeName.toLowerCase(),y==="select"||y==="input"&&m.type==="file")var A=Rx;else if(Gm(m))if(Zg)A=Ox;else{A=Mx;var R=Dx}else(y=m.nodeName)&&y.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(A=Lx);if(A&&(A=A(e,u))){Xg(h,A,n,d);break e}R&&R(e,m,u),e==="focusout"&&(R=m._wrapperState)&&R.controlled&&m.type==="number"&&ju(m,"number",m.value)}switch(R=u?Qs(u):window,e){case"focusin":(Gm(R)||R.contentEditable==="true")&&(Gs=R,Ou=u,ai=null);break;case"focusout":ai=Ou=Gs=null;break;case"mousedown":$u=!0;break;case"contextmenu":case"mouseup":case"dragend":$u=!1,ep(h,n,d);break;case"selectionchange":if(Fx)break;case"keydown":case"keyup":ep(h,n,d)}var S;if(ch)e:{switch(e){case"compositionstart":var k="onCompositionStart";break e;case"compositionend":k="onCompositionEnd";break e;case"compositionupdate":k="onCompositionUpdate";break e}k=void 0}else Ks?Jg(e,n)&&(k="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(k="onCompositionStart");k&&(Gg&&n.locale!=="ko"&&(Ks||k!=="onCompositionStart"?k==="onCompositionEnd"&&Ks&&(S=Kg()):(qa=d,ih="value"in qa?qa.value:qa.textContent,Ks=!0)),R=hl(u,k),0<R.length&&(k=new Hm(k,e,null,n,d),h.push({event:k,listeners:R}),S?k.data=S:(S=Qg(n),S!==null&&(k.data=S)))),(S=Cx?Ax(e,n):Ix(e,n))&&(u=hl(u,"onBeforeInput"),0<u.length&&(d=new Hm("onBeforeInput","beforeinput",null,n,d),h.push({event:d,listeners:u}),d.data=S))}cy(h,t)})}function bi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function hl(e,t){for(var n=t+"Capture",s=[];e!==null;){var r=e,i=r.stateNode;r.tag===5&&i!==null&&(r=i,i=hi(e,n),i!=null&&s.unshift(bi(e,i,r)),i=hi(e,t),i!=null&&s.push(bi(e,i,r))),e=e.return}return s}function Ds(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function ap(e,t,n,s,r){for(var i=t._reactName,o=[];n!==null&&n!==s;){var l=n,c=l.alternate,u=l.stateNode;if(c!==null&&c===s)break;l.tag===5&&u!==null&&(l=u,r?(c=hi(n,i),c!=null&&o.unshift(bi(n,c,l))):r||(c=hi(n,i),c!=null&&o.push(bi(n,c,l)))),n=n.return}o.length!==0&&e.push({event:t,listeners:o})}var zx=/\r\n?/g,Hx=/\u0000|\uFFFD/g;function sp(e){return(typeof e=="string"?e:""+e).replace(zx,`
`).replace(Hx,"")}function go(e,t,n){if(t=sp(t),sp(e)!==t&&n)throw Error(ge(425))}function ml(){}var Bu=null,Fu=null;function qu(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Uu=typeof setTimeout=="function"?setTimeout:void 0,Yx=typeof clearTimeout=="function"?clearTimeout:void 0,rp=typeof Promise=="function"?Promise:void 0,Vx=typeof queueMicrotask=="function"?queueMicrotask:typeof rp<"u"?function(e){return rp.resolve(null).then(e).catch(Kx)}:Uu;function Kx(e){setTimeout(function(){throw e})}function Oc(e,t){var n=t,s=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(s===0){e.removeChild(r),fi(t);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=r}while(n);fi(t)}function Ya(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function ip(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var wr=Math.random().toString(36).slice(2),ea="__reactFiber$"+wr,_i="__reactProps$"+wr,wa="__reactContainer$"+wr,Wu="__reactEvents$"+wr,Gx="__reactListeners$"+wr,Jx="__reactHandles$"+wr;function fs(e){var t=e[ea];if(t)return t;for(var n=e.parentNode;n;){if(t=n[wa]||n[ea]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=ip(e);e!==null;){if(n=e[ea])return n;e=ip(e)}return t}e=n,n=e.parentNode}return null}function Oi(e){return e=e[ea]||e[wa],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Qs(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(ge(33))}function Kl(e){return e[_i]||null}var zu=[],Xs=-1;function es(e){return{current:e}}function ct(e){0>Xs||(e.current=zu[Xs],zu[Xs]=null,Xs--)}function it(e,t){Xs++,zu[Xs]=e.current,e.current=t}var Xa={},zt=es(Xa),tn=es(!1),xs=Xa;function pr(e,t){var n=e.type.contextTypes;if(!n)return Xa;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var r={},i;for(i in n)r[i]=t[i];return s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=r),r}function nn(e){return e=e.childContextTypes,e!=null}function pl(){ct(tn),ct(zt)}function op(e,t,n){if(zt.current!==Xa)throw Error(ge(168));it(zt,t),it(tn,n)}function dy(e,t,n){var s=e.stateNode;if(t=t.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var r in s)if(!(r in t))throw Error(ge(108,D_(e)||"Unknown",r));return yt({},n,s)}function fl(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Xa,xs=zt.current,it(zt,e),it(tn,tn.current),!0}function lp(e,t,n){var s=e.stateNode;if(!s)throw Error(ge(169));n?(e=dy(e,t,xs),s.__reactInternalMemoizedMergedChildContext=e,ct(tn),ct(zt),it(zt,e)):ct(tn),it(tn,n)}var ha=null,Gl=!1,$c=!1;function hy(e){ha===null?ha=[e]:ha.push(e)}function Qx(e){Gl=!0,hy(e)}function ts(){if(!$c&&ha!==null){$c=!0;var e=0,t=at;try{var n=ha;for(at=1;e<n.length;e++){var s=n[e];do s=s(!0);while(s!==null)}ha=null,Gl=!1}catch(r){throw ha!==null&&(ha=ha.slice(e+1)),Og(nh,ts),r}finally{at=t,$c=!1}}return null}var Zs=[],er=0,gl=null,yl=0,kn=[],Nn=0,ws=null,fa=1,ga="";function ls(e,t){Zs[er++]=yl,Zs[er++]=gl,gl=e,yl=t}function my(e,t,n){kn[Nn++]=fa,kn[Nn++]=ga,kn[Nn++]=ws,ws=e;var s=fa;e=ga;var r=32-Un(s)-1;s&=~(1<<r),n+=1;var i=32-Un(t)+r;if(30<i){var o=r-r%5;i=(s&(1<<o)-1).toString(32),s>>=o,r-=o,fa=1<<32-Un(t)+r|n<<r|s,ga=i+e}else fa=1<<i|n<<r|s,ga=e}function dh(e){e.return!==null&&(ls(e,1),my(e,1,0))}function hh(e){for(;e===gl;)gl=Zs[--er],Zs[er]=null,yl=Zs[--er],Zs[er]=null;for(;e===ws;)ws=kn[--Nn],kn[Nn]=null,ga=kn[--Nn],kn[Nn]=null,fa=kn[--Nn],kn[Nn]=null}var fn=null,mn=null,dt=!1,qn=null;function py(e,t){var n=Sn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function cp(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,fn=e,mn=Ya(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,fn=e,mn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=ws!==null?{id:fa,overflow:ga}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=Sn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,fn=e,mn=null,!0):!1;default:return!1}}function Hu(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Yu(e){if(dt){var t=mn;if(t){var n=t;if(!cp(e,t)){if(Hu(e))throw Error(ge(418));t=Ya(n.nextSibling);var s=fn;t&&cp(e,t)?py(s,n):(e.flags=e.flags&-4097|2,dt=!1,fn=e)}}else{if(Hu(e))throw Error(ge(418));e.flags=e.flags&-4097|2,dt=!1,fn=e}}}function up(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;fn=e}function yo(e){if(e!==fn)return!1;if(!dt)return up(e),dt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!qu(e.type,e.memoizedProps)),t&&(t=mn)){if(Hu(e))throw fy(),Error(ge(418));for(;t;)py(e,t),t=Ya(t.nextSibling)}if(up(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(ge(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){mn=Ya(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}mn=null}}else mn=fn?Ya(e.stateNode.nextSibling):null;return!0}function fy(){for(var e=mn;e;)e=Ya(e.nextSibling)}function fr(){mn=fn=null,dt=!1}function mh(e){qn===null?qn=[e]:qn.push(e)}var Xx=Sa.ReactCurrentBatchConfig;function Dr(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ge(309));var s=n.stateNode}if(!s)throw Error(ge(147,e));var r=s,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(o){var l=r.refs;o===null?delete l[i]:l[i]=o},t._stringRef=i,t)}if(typeof e!="string")throw Error(ge(284));if(!n._owner)throw Error(ge(290,e))}return e}function vo(e,t){throw e=Object.prototype.toString.call(t),Error(ge(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function dp(e){var t=e._init;return t(e._payload)}function gy(e){function t(f,p){if(e){var g=f.deletions;g===null?(f.deletions=[p],f.flags|=16):g.push(p)}}function n(f,p){if(!e)return null;for(;p!==null;)t(f,p),p=p.sibling;return null}function s(f,p){for(f=new Map;p!==null;)p.key!==null?f.set(p.key,p):f.set(p.index,p),p=p.sibling;return f}function r(f,p){return f=Ja(f,p),f.index=0,f.sibling=null,f}function i(f,p,g){return f.index=g,e?(g=f.alternate,g!==null?(g=g.index,g<p?(f.flags|=2,p):g):(f.flags|=2,p)):(f.flags|=1048576,p)}function o(f){return e&&f.alternate===null&&(f.flags|=2),f}function l(f,p,g,j){return p===null||p.tag!==6?(p=Hc(g,f.mode,j),p.return=f,p):(p=r(p,g),p.return=f,p)}function c(f,p,g,j){var A=g.type;return A===Vs?d(f,p,g.props.children,j,g.key):p!==null&&(p.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===Da&&dp(A)===p.type)?(j=r(p,g.props),j.ref=Dr(f,p,g),j.return=f,j):(j=Zo(g.type,g.key,g.props,null,f.mode,j),j.ref=Dr(f,p,g),j.return=f,j)}function u(f,p,g,j){return p===null||p.tag!==4||p.stateNode.containerInfo!==g.containerInfo||p.stateNode.implementation!==g.implementation?(p=Yc(g,f.mode,j),p.return=f,p):(p=r(p,g.children||[]),p.return=f,p)}function d(f,p,g,j,A){return p===null||p.tag!==7?(p=_s(g,f.mode,j,A),p.return=f,p):(p=r(p,g),p.return=f,p)}function h(f,p,g){if(typeof p=="string"&&p!==""||typeof p=="number")return p=Hc(""+p,f.mode,g),p.return=f,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case io:return g=Zo(p.type,p.key,p.props,null,f.mode,g),g.ref=Dr(f,null,p),g.return=f,g;case Ys:return p=Yc(p,f.mode,g),p.return=f,p;case Da:var j=p._init;return h(f,j(p._payload),g)}if(zr(p)||Ar(p))return p=_s(p,f.mode,g,null),p.return=f,p;vo(f,p)}return null}function m(f,p,g,j){var A=p!==null?p.key:null;if(typeof g=="string"&&g!==""||typeof g=="number")return A!==null?null:l(f,p,""+g,j);if(typeof g=="object"&&g!==null){switch(g.$$typeof){case io:return g.key===A?c(f,p,g,j):null;case Ys:return g.key===A?u(f,p,g,j):null;case Da:return A=g._init,m(f,p,A(g._payload),j)}if(zr(g)||Ar(g))return A!==null?null:d(f,p,g,j,null);vo(f,g)}return null}function y(f,p,g,j,A){if(typeof j=="string"&&j!==""||typeof j=="number")return f=f.get(g)||null,l(p,f,""+j,A);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case io:return f=f.get(j.key===null?g:j.key)||null,c(p,f,j,A);case Ys:return f=f.get(j.key===null?g:j.key)||null,u(p,f,j,A);case Da:var R=j._init;return y(f,p,g,R(j._payload),A)}if(zr(j)||Ar(j))return f=f.get(g)||null,d(p,f,j,A,null);vo(p,j)}return null}function b(f,p,g,j){for(var A=null,R=null,S=p,k=p=0,N=null;S!==null&&k<g.length;k++){S.index>k?(N=S,S=null):N=S.sibling;var E=m(f,S,g[k],j);if(E===null){S===null&&(S=N);break}e&&S&&E.alternate===null&&t(f,S),p=i(E,p,k),R===null?A=E:R.sibling=E,R=E,S=N}if(k===g.length)return n(f,S),dt&&ls(f,k),A;if(S===null){for(;k<g.length;k++)S=h(f,g[k],j),S!==null&&(p=i(S,p,k),R===null?A=S:R.sibling=S,R=S);return dt&&ls(f,k),A}for(S=s(f,S);k<g.length;k++)N=y(S,f,k,g[k],j),N!==null&&(e&&N.alternate!==null&&S.delete(N.key===null?k:N.key),p=i(N,p,k),R===null?A=N:R.sibling=N,R=N);return e&&S.forEach(function(M){return t(f,M)}),dt&&ls(f,k),A}function _(f,p,g,j){var A=Ar(g);if(typeof A!="function")throw Error(ge(150));if(g=A.call(g),g==null)throw Error(ge(151));for(var R=A=null,S=p,k=p=0,N=null,E=g.next();S!==null&&!E.done;k++,E=g.next()){S.index>k?(N=S,S=null):N=S.sibling;var M=m(f,S,E.value,j);if(M===null){S===null&&(S=N);break}e&&S&&M.alternate===null&&t(f,S),p=i(M,p,k),R===null?A=M:R.sibling=M,R=M,S=N}if(E.done)return n(f,S),dt&&ls(f,k),A;if(S===null){for(;!E.done;k++,E=g.next())E=h(f,E.value,j),E!==null&&(p=i(E,p,k),R===null?A=E:R.sibling=E,R=E);return dt&&ls(f,k),A}for(S=s(f,S);!E.done;k++,E=g.next())E=y(S,f,k,E.value,j),E!==null&&(e&&E.alternate!==null&&S.delete(E.key===null?k:E.key),p=i(E,p,k),R===null?A=E:R.sibling=E,R=E);return e&&S.forEach(function(O){return t(f,O)}),dt&&ls(f,k),A}function w(f,p,g,j){if(typeof g=="object"&&g!==null&&g.type===Vs&&g.key===null&&(g=g.props.children),typeof g=="object"&&g!==null){switch(g.$$typeof){case io:e:{for(var A=g.key,R=p;R!==null;){if(R.key===A){if(A=g.type,A===Vs){if(R.tag===7){n(f,R.sibling),p=r(R,g.props.children),p.return=f,f=p;break e}}else if(R.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===Da&&dp(A)===R.type){n(f,R.sibling),p=r(R,g.props),p.ref=Dr(f,R,g),p.return=f,f=p;break e}n(f,R);break}else t(f,R);R=R.sibling}g.type===Vs?(p=_s(g.props.children,f.mode,j,g.key),p.return=f,f=p):(j=Zo(g.type,g.key,g.props,null,f.mode,j),j.ref=Dr(f,p,g),j.return=f,f=j)}return o(f);case Ys:e:{for(R=g.key;p!==null;){if(p.key===R)if(p.tag===4&&p.stateNode.containerInfo===g.containerInfo&&p.stateNode.implementation===g.implementation){n(f,p.sibling),p=r(p,g.children||[]),p.return=f,f=p;break e}else{n(f,p);break}else t(f,p);p=p.sibling}p=Yc(g,f.mode,j),p.return=f,f=p}return o(f);case Da:return R=g._init,w(f,p,R(g._payload),j)}if(zr(g))return b(f,p,g,j);if(Ar(g))return _(f,p,g,j);vo(f,g)}return typeof g=="string"&&g!==""||typeof g=="number"?(g=""+g,p!==null&&p.tag===6?(n(f,p.sibling),p=r(p,g),p.return=f,f=p):(n(f,p),p=Hc(g,f.mode,j),p.return=f,f=p),o(f)):n(f,p)}return w}var gr=gy(!0),yy=gy(!1),vl=es(null),bl=null,tr=null,ph=null;function fh(){ph=tr=bl=null}function gh(e){var t=vl.current;ct(vl),e._currentValue=t}function Vu(e,t,n){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===n)break;e=e.return}}function cr(e,t){bl=e,ph=tr=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(en=!0),e.firstContext=null)}function Cn(e){var t=e._currentValue;if(ph!==e)if(e={context:e,memoizedValue:t,next:null},tr===null){if(bl===null)throw Error(ge(308));tr=e,bl.dependencies={lanes:0,firstContext:e}}else tr=tr.next=e;return t}var gs=null;function yh(e){gs===null?gs=[e]:gs.push(e)}function vy(e,t,n,s){var r=t.interleaved;return r===null?(n.next=n,yh(t)):(n.next=r.next,r.next=n),t.interleaved=n,ka(e,s)}function ka(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var Ma=!1;function vh(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function by(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ya(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Va(e,t,n){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,Ze&2){var r=s.pending;return r===null?t.next=t:(t.next=r.next,r.next=t),s.pending=t,ka(e,n)}return r=s.interleaved,r===null?(t.next=t,yh(s)):(t.next=r.next,r.next=t),s.interleaved=t,ka(e,n)}function Vo(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,ah(e,n)}}function hp(e,t){var n=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var r=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?r=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?r=i=t:i=i.next=t}else r=i=t;n={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:i,shared:s.shared,effects:s.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function _l(e,t,n,s){var r=e.updateQueue;Ma=!1;var i=r.firstBaseUpdate,o=r.lastBaseUpdate,l=r.shared.pending;if(l!==null){r.shared.pending=null;var c=l,u=c.next;c.next=null,o===null?i=u:o.next=u,o=c;var d=e.alternate;d!==null&&(d=d.updateQueue,l=d.lastBaseUpdate,l!==o&&(l===null?d.firstBaseUpdate=u:l.next=u,d.lastBaseUpdate=c))}if(i!==null){var h=r.baseState;o=0,d=u=c=null,l=i;do{var m=l.lane,y=l.eventTime;if((s&m)===m){d!==null&&(d=d.next={eventTime:y,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var b=e,_=l;switch(m=t,y=n,_.tag){case 1:if(b=_.payload,typeof b=="function"){h=b.call(y,h,m);break e}h=b;break e;case 3:b.flags=b.flags&-65537|128;case 0:if(b=_.payload,m=typeof b=="function"?b.call(y,h,m):b,m==null)break e;h=yt({},h,m);break e;case 2:Ma=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,m=r.effects,m===null?r.effects=[l]:m.push(l))}else y={eventTime:y,lane:m,tag:l.tag,payload:l.payload,callback:l.callback,next:null},d===null?(u=d=y,c=h):d=d.next=y,o|=m;if(l=l.next,l===null){if(l=r.shared.pending,l===null)break;m=l,l=m.next,m.next=null,r.lastBaseUpdate=m,r.shared.pending=null}}while(!0);if(d===null&&(c=h),r.baseState=c,r.firstBaseUpdate=u,r.lastBaseUpdate=d,t=r.shared.interleaved,t!==null){r=t;do o|=r.lane,r=r.next;while(r!==t)}else i===null&&(r.shared.lanes=0);Ns|=o,e.lanes=o,e.memoizedState=h}}function mp(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var s=e[t],r=s.callback;if(r!==null){if(s.callback=null,s=n,typeof r!="function")throw Error(ge(191,r));r.call(s)}}}var $i={},na=es($i),xi=es($i),wi=es($i);function ys(e){if(e===$i)throw Error(ge(174));return e}function bh(e,t){switch(it(wi,t),it(xi,e),it(na,$i),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Eu(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Eu(t,e)}ct(na),it(na,t)}function yr(){ct(na),ct(xi),ct(wi)}function _y(e){ys(wi.current);var t=ys(na.current),n=Eu(t,e.type);t!==n&&(it(xi,e),it(na,n))}function _h(e){xi.current===e&&(ct(na),ct(xi))}var ft=es(0);function xl(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Bc=[];function xh(){for(var e=0;e<Bc.length;e++)Bc[e]._workInProgressVersionPrimary=null;Bc.length=0}var Ko=Sa.ReactCurrentDispatcher,Fc=Sa.ReactCurrentBatchConfig,ks=0,gt=null,Et=null,Pt=null,wl=!1,si=!1,ki=0,Zx=0;function Ft(){throw Error(ge(321))}function wh(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!zn(e[n],t[n]))return!1;return!0}function kh(e,t,n,s,r,i){if(ks=i,gt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Ko.current=e===null||e.memoizedState===null?a0:s0,e=n(s,r),si){i=0;do{if(si=!1,ki=0,25<=i)throw Error(ge(301));i+=1,Pt=Et=null,t.updateQueue=null,Ko.current=r0,e=n(s,r)}while(si)}if(Ko.current=kl,t=Et!==null&&Et.next!==null,ks=0,Pt=Et=gt=null,wl=!1,t)throw Error(ge(300));return e}function Nh(){var e=ki!==0;return ki=0,e}function Xn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pt===null?gt.memoizedState=Pt=e:Pt=Pt.next=e,Pt}function An(){if(Et===null){var e=gt.alternate;e=e!==null?e.memoizedState:null}else e=Et.next;var t=Pt===null?gt.memoizedState:Pt.next;if(t!==null)Pt=t,Et=e;else{if(e===null)throw Error(ge(310));Et=e,e={memoizedState:Et.memoizedState,baseState:Et.baseState,baseQueue:Et.baseQueue,queue:Et.queue,next:null},Pt===null?gt.memoizedState=Pt=e:Pt=Pt.next=e}return Pt}function Ni(e,t){return typeof t=="function"?t(e):t}function qc(e){var t=An(),n=t.queue;if(n===null)throw Error(ge(311));n.lastRenderedReducer=e;var s=Et,r=s.baseQueue,i=n.pending;if(i!==null){if(r!==null){var o=r.next;r.next=i.next,i.next=o}s.baseQueue=r=i,n.pending=null}if(r!==null){i=r.next,s=s.baseState;var l=o=null,c=null,u=i;do{var d=u.lane;if((ks&d)===d)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:e(s,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(l=c=h,o=s):c=c.next=h,gt.lanes|=d,Ns|=d}u=u.next}while(u!==null&&u!==i);c===null?o=s:c.next=l,zn(s,t.memoizedState)||(en=!0),t.memoizedState=s,t.baseState=o,t.baseQueue=c,n.lastRenderedState=s}if(e=n.interleaved,e!==null){r=e;do i=r.lane,gt.lanes|=i,Ns|=i,r=r.next;while(r!==e)}else r===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Uc(e){var t=An(),n=t.queue;if(n===null)throw Error(ge(311));n.lastRenderedReducer=e;var s=n.dispatch,r=n.pending,i=t.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do i=e(i,o.action),o=o.next;while(o!==r);zn(i,t.memoizedState)||(en=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),n.lastRenderedState=i}return[i,s]}function xy(){}function wy(e,t){var n=gt,s=An(),r=t(),i=!zn(s.memoizedState,r);if(i&&(s.memoizedState=r,en=!0),s=s.queue,jh(jy.bind(null,n,s,e),[e]),s.getSnapshot!==t||i||Pt!==null&&Pt.memoizedState.tag&1){if(n.flags|=2048,ji(9,Ny.bind(null,n,s,r,t),void 0,null),Tt===null)throw Error(ge(349));ks&30||ky(n,t,r)}return r}function ky(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=gt.updateQueue,t===null?(t={lastEffect:null,stores:null},gt.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function Ny(e,t,n,s){t.value=n,t.getSnapshot=s,Sy(t)&&Ey(e)}function jy(e,t,n){return n(function(){Sy(t)&&Ey(e)})}function Sy(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!zn(e,n)}catch{return!0}}function Ey(e){var t=ka(e,1);t!==null&&Wn(t,e,1,-1)}function pp(e){var t=Xn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ni,lastRenderedState:e},t.queue=e,e=e.dispatch=n0.bind(null,gt,e),[t.memoizedState,e]}function ji(e,t,n,s){return e={tag:e,create:t,destroy:n,deps:s,next:null},t=gt.updateQueue,t===null?(t={lastEffect:null,stores:null},gt.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(s=n.next,n.next=e,e.next=s,t.lastEffect=e)),e}function Cy(){return An().memoizedState}function Go(e,t,n,s){var r=Xn();gt.flags|=e,r.memoizedState=ji(1|t,n,void 0,s===void 0?null:s)}function Jl(e,t,n,s){var r=An();s=s===void 0?null:s;var i=void 0;if(Et!==null){var o=Et.memoizedState;if(i=o.destroy,s!==null&&wh(s,o.deps)){r.memoizedState=ji(t,n,i,s);return}}gt.flags|=e,r.memoizedState=ji(1|t,n,i,s)}function fp(e,t){return Go(8390656,8,e,t)}function jh(e,t){return Jl(2048,8,e,t)}function Ay(e,t){return Jl(4,2,e,t)}function Iy(e,t){return Jl(4,4,e,t)}function Py(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Ty(e,t,n){return n=n!=null?n.concat([e]):null,Jl(4,4,Py.bind(null,t,e),n)}function Sh(){}function Ry(e,t){var n=An();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&wh(t,s[1])?s[0]:(n.memoizedState=[e,t],e)}function Dy(e,t){var n=An();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&wh(t,s[1])?s[0]:(e=e(),n.memoizedState=[e,t],e)}function My(e,t,n){return ks&21?(zn(n,t)||(n=Fg(),gt.lanes|=n,Ns|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,en=!0),e.memoizedState=n)}function e0(e,t){var n=at;at=n!==0&&4>n?n:4,e(!0);var s=Fc.transition;Fc.transition={};try{e(!1),t()}finally{at=n,Fc.transition=s}}function Ly(){return An().memoizedState}function t0(e,t,n){var s=Ga(e);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},Oy(e))$y(t,n);else if(n=vy(e,t,n,s),n!==null){var r=Yt();Wn(n,e,s,r),By(n,t,s)}}function n0(e,t,n){var s=Ga(e),r={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(Oy(e))$y(t,r);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var o=t.lastRenderedState,l=i(o,n);if(r.hasEagerState=!0,r.eagerState=l,zn(l,o)){var c=t.interleaved;c===null?(r.next=r,yh(t)):(r.next=c.next,c.next=r),t.interleaved=r;return}}catch{}finally{}n=vy(e,t,r,s),n!==null&&(r=Yt(),Wn(n,e,s,r),By(n,t,s))}}function Oy(e){var t=e.alternate;return e===gt||t!==null&&t===gt}function $y(e,t){si=wl=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function By(e,t,n){if(n&4194240){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,ah(e,n)}}var kl={readContext:Cn,useCallback:Ft,useContext:Ft,useEffect:Ft,useImperativeHandle:Ft,useInsertionEffect:Ft,useLayoutEffect:Ft,useMemo:Ft,useReducer:Ft,useRef:Ft,useState:Ft,useDebugValue:Ft,useDeferredValue:Ft,useTransition:Ft,useMutableSource:Ft,useSyncExternalStore:Ft,useId:Ft,unstable_isNewReconciler:!1},a0={readContext:Cn,useCallback:function(e,t){return Xn().memoizedState=[e,t===void 0?null:t],e},useContext:Cn,useEffect:fp,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,Go(4194308,4,Py.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Go(4194308,4,e,t)},useInsertionEffect:function(e,t){return Go(4,2,e,t)},useMemo:function(e,t){var n=Xn();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var s=Xn();return t=n!==void 0?n(t):t,s.memoizedState=s.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},s.queue=e,e=e.dispatch=t0.bind(null,gt,e),[s.memoizedState,e]},useRef:function(e){var t=Xn();return e={current:e},t.memoizedState=e},useState:pp,useDebugValue:Sh,useDeferredValue:function(e){return Xn().memoizedState=e},useTransition:function(){var e=pp(!1),t=e[0];return e=e0.bind(null,e[1]),Xn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var s=gt,r=Xn();if(dt){if(n===void 0)throw Error(ge(407));n=n()}else{if(n=t(),Tt===null)throw Error(ge(349));ks&30||ky(s,t,n)}r.memoizedState=n;var i={value:n,getSnapshot:t};return r.queue=i,fp(jy.bind(null,s,i,e),[e]),s.flags|=2048,ji(9,Ny.bind(null,s,i,n,t),void 0,null),n},useId:function(){var e=Xn(),t=Tt.identifierPrefix;if(dt){var n=ga,s=fa;n=(s&~(1<<32-Un(s)-1)).toString(32)+n,t=":"+t+"R"+n,n=ki++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=Zx++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},s0={readContext:Cn,useCallback:Ry,useContext:Cn,useEffect:jh,useImperativeHandle:Ty,useInsertionEffect:Ay,useLayoutEffect:Iy,useMemo:Dy,useReducer:qc,useRef:Cy,useState:function(){return qc(Ni)},useDebugValue:Sh,useDeferredValue:function(e){var t=An();return My(t,Et.memoizedState,e)},useTransition:function(){var e=qc(Ni)[0],t=An().memoizedState;return[e,t]},useMutableSource:xy,useSyncExternalStore:wy,useId:Ly,unstable_isNewReconciler:!1},r0={readContext:Cn,useCallback:Ry,useContext:Cn,useEffect:jh,useImperativeHandle:Ty,useInsertionEffect:Ay,useLayoutEffect:Iy,useMemo:Dy,useReducer:Uc,useRef:Cy,useState:function(){return Uc(Ni)},useDebugValue:Sh,useDeferredValue:function(e){var t=An();return Et===null?t.memoizedState=e:My(t,Et.memoizedState,e)},useTransition:function(){var e=Uc(Ni)[0],t=An().memoizedState;return[e,t]},useMutableSource:xy,useSyncExternalStore:wy,useId:Ly,unstable_isNewReconciler:!1};function On(e,t){if(e&&e.defaultProps){t=yt({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Ku(e,t,n,s){t=e.memoizedState,n=n(s,t),n=n==null?t:yt({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Ql={isMounted:function(e){return(e=e._reactInternals)?Es(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var s=Yt(),r=Ga(e),i=ya(s,r);i.payload=t,n!=null&&(i.callback=n),t=Va(e,i,r),t!==null&&(Wn(t,e,r,s),Vo(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var s=Yt(),r=Ga(e),i=ya(s,r);i.tag=1,i.payload=t,n!=null&&(i.callback=n),t=Va(e,i,r),t!==null&&(Wn(t,e,r,s),Vo(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Yt(),s=Ga(e),r=ya(n,s);r.tag=2,t!=null&&(r.callback=t),t=Va(e,r,s),t!==null&&(Wn(t,e,s,n),Vo(t,e,s))}};function gp(e,t,n,s,r,i,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,i,o):t.prototype&&t.prototype.isPureReactComponent?!yi(n,s)||!yi(r,i):!0}function Fy(e,t,n){var s=!1,r=Xa,i=t.contextType;return typeof i=="object"&&i!==null?i=Cn(i):(r=nn(t)?xs:zt.current,s=t.contextTypes,i=(s=s!=null)?pr(e,r):Xa),t=new t(n,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Ql,e.stateNode=t,t._reactInternals=e,s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=i),t}function yp(e,t,n,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,s),t.state!==e&&Ql.enqueueReplaceState(t,t.state,null)}function Gu(e,t,n,s){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},vh(e);var i=t.contextType;typeof i=="object"&&i!==null?r.context=Cn(i):(i=nn(t)?xs:zt.current,r.context=pr(e,i)),r.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(Ku(e,t,i,n),r.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(t=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),t!==r.state&&Ql.enqueueReplaceState(r,r.state,null),_l(e,n,r,s),r.state=e.memoizedState),typeof r.componentDidMount=="function"&&(e.flags|=4194308)}function vr(e,t){try{var n="",s=t;do n+=R_(s),s=s.return;while(s);var r=n}catch(i){r=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:r,digest:null}}function Wc(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Ju(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var i0=typeof WeakMap=="function"?WeakMap:Map;function qy(e,t,n){n=ya(-1,n),n.tag=3,n.payload={element:null};var s=t.value;return n.callback=function(){jl||(jl=!0,id=s),Ju(e,t)},n}function Uy(e,t,n){n=ya(-1,n),n.tag=3;var s=e.type.getDerivedStateFromError;if(typeof s=="function"){var r=t.value;n.payload=function(){return s(r)},n.callback=function(){Ju(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Ju(e,t),typeof s!="function"&&(Ka===null?Ka=new Set([this]):Ka.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),n}function vp(e,t,n){var s=e.pingCache;if(s===null){s=e.pingCache=new i0;var r=new Set;s.set(t,r)}else r=s.get(t),r===void 0&&(r=new Set,s.set(t,r));r.has(n)||(r.add(n),e=_0.bind(null,e,t,n),t.then(e,e))}function bp(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function _p(e,t,n,s,r){return e.mode&1?(e.flags|=65536,e.lanes=r,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=ya(-1,1),t.tag=2,Va(n,t,1))),n.lanes|=1),e)}var o0=Sa.ReactCurrentOwner,en=!1;function Ht(e,t,n,s){t.child=e===null?yy(t,null,n,s):gr(t,e.child,n,s)}function xp(e,t,n,s,r){n=n.render;var i=t.ref;return cr(t,r),s=kh(e,t,n,s,i,r),n=Nh(),e!==null&&!en?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Na(e,t,r)):(dt&&n&&dh(t),t.flags|=1,Ht(e,t,s,r),t.child)}function wp(e,t,n,s,r){if(e===null){var i=n.type;return typeof i=="function"&&!Dh(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=i,Wy(e,t,i,s,r)):(e=Zo(n.type,null,s,t,t.mode,r),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&r)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:yi,n(o,s)&&e.ref===t.ref)return Na(e,t,r)}return t.flags|=1,e=Ja(i,s),e.ref=t.ref,e.return=t,t.child=e}function Wy(e,t,n,s,r){if(e!==null){var i=e.memoizedProps;if(yi(i,s)&&e.ref===t.ref)if(en=!1,t.pendingProps=s=i,(e.lanes&r)!==0)e.flags&131072&&(en=!0);else return t.lanes=e.lanes,Na(e,t,r)}return Qu(e,t,n,s,r)}function zy(e,t,n){var s=t.pendingProps,r=s.children,i=e!==null?e.memoizedState:null;if(s.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},it(ar,un),un|=n;else{if(!(n&1073741824))return e=i!==null?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,it(ar,un),un|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=i!==null?i.baseLanes:n,it(ar,un),un|=s}else i!==null?(s=i.baseLanes|n,t.memoizedState=null):s=n,it(ar,un),un|=s;return Ht(e,t,r,n),t.child}function Hy(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Qu(e,t,n,s,r){var i=nn(n)?xs:zt.current;return i=pr(t,i),cr(t,r),n=kh(e,t,n,s,i,r),s=Nh(),e!==null&&!en?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Na(e,t,r)):(dt&&s&&dh(t),t.flags|=1,Ht(e,t,n,r),t.child)}function kp(e,t,n,s,r){if(nn(n)){var i=!0;fl(t)}else i=!1;if(cr(t,r),t.stateNode===null)Jo(e,t),Fy(t,n,s),Gu(t,n,s,r),s=!0;else if(e===null){var o=t.stateNode,l=t.memoizedProps;o.props=l;var c=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=Cn(u):(u=nn(n)?xs:zt.current,u=pr(t,u));var d=n.getDerivedStateFromProps,h=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==s||c!==u)&&yp(t,o,s,u),Ma=!1;var m=t.memoizedState;o.state=m,_l(t,s,o,r),c=t.memoizedState,l!==s||m!==c||tn.current||Ma?(typeof d=="function"&&(Ku(t,n,d,s),c=t.memoizedState),(l=Ma||gp(t,n,l,s,m,c,u))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=c),o.props=s,o.state=c,o.context=u,s=l):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{o=t.stateNode,by(e,t),l=t.memoizedProps,u=t.type===t.elementType?l:On(t.type,l),o.props=u,h=t.pendingProps,m=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=Cn(c):(c=nn(n)?xs:zt.current,c=pr(t,c));var y=n.getDerivedStateFromProps;(d=typeof y=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==h||m!==c)&&yp(t,o,s,c),Ma=!1,m=t.memoizedState,o.state=m,_l(t,s,o,r);var b=t.memoizedState;l!==h||m!==b||tn.current||Ma?(typeof y=="function"&&(Ku(t,n,y,s),b=t.memoizedState),(u=Ma||gp(t,n,u,s,m,b,c)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(s,b,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(s,b,c)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=b),o.props=s,o.state=b,o.context=c,s=u):(typeof o.componentDidUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),s=!1)}return Xu(e,t,n,s,i,r)}function Xu(e,t,n,s,r,i){Hy(e,t);var o=(t.flags&128)!==0;if(!s&&!o)return r&&lp(t,n,!1),Na(e,t,i);s=t.stateNode,o0.current=t;var l=o&&typeof n.getDerivedStateFromError!="function"?null:s.render();return t.flags|=1,e!==null&&o?(t.child=gr(t,e.child,null,i),t.child=gr(t,null,l,i)):Ht(e,t,l,i),t.memoizedState=s.state,r&&lp(t,n,!0),t.child}function Yy(e){var t=e.stateNode;t.pendingContext?op(e,t.pendingContext,t.pendingContext!==t.context):t.context&&op(e,t.context,!1),bh(e,t.containerInfo)}function Np(e,t,n,s,r){return fr(),mh(r),t.flags|=256,Ht(e,t,n,s),t.child}var Zu={dehydrated:null,treeContext:null,retryLane:0};function ed(e){return{baseLanes:e,cachePool:null,transitions:null}}function Vy(e,t,n){var s=t.pendingProps,r=ft.current,i=!1,o=(t.flags&128)!==0,l;if((l=o)||(l=e!==null&&e.memoizedState===null?!1:(r&2)!==0),l?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(r|=1),it(ft,r&1),e===null)return Yu(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=s.children,e=s.fallback,i?(s=t.mode,i=t.child,o={mode:"hidden",children:o},!(s&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=ec(o,s,0,null),e=_s(e,s,n,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=ed(n),t.memoizedState=Zu,e):Eh(t,o));if(r=e.memoizedState,r!==null&&(l=r.dehydrated,l!==null))return l0(e,t,o,s,l,r,n);if(i){i=s.fallback,o=t.mode,r=e.child,l=r.sibling;var c={mode:"hidden",children:s.children};return!(o&1)&&t.child!==r?(s=t.child,s.childLanes=0,s.pendingProps=c,t.deletions=null):(s=Ja(r,c),s.subtreeFlags=r.subtreeFlags&14680064),l!==null?i=Ja(l,i):(i=_s(i,o,n,null),i.flags|=2),i.return=t,s.return=t,s.sibling=i,t.child=s,s=i,i=t.child,o=e.child.memoizedState,o=o===null?ed(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=e.childLanes&~n,t.memoizedState=Zu,s}return i=e.child,e=i.sibling,s=Ja(i,{mode:"visible",children:s.children}),!(t.mode&1)&&(s.lanes=n),s.return=t,s.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function Eh(e,t){return t=ec({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function bo(e,t,n,s){return s!==null&&mh(s),gr(t,e.child,null,n),e=Eh(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function l0(e,t,n,s,r,i,o){if(n)return t.flags&256?(t.flags&=-257,s=Wc(Error(ge(422))),bo(e,t,o,s)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=s.fallback,r=t.mode,s=ec({mode:"visible",children:s.children},r,0,null),i=_s(i,r,o,null),i.flags|=2,s.return=t,i.return=t,s.sibling=i,t.child=s,t.mode&1&&gr(t,e.child,null,o),t.child.memoizedState=ed(o),t.memoizedState=Zu,i);if(!(t.mode&1))return bo(e,t,o,null);if(r.data==="$!"){if(s=r.nextSibling&&r.nextSibling.dataset,s)var l=s.dgst;return s=l,i=Error(ge(419)),s=Wc(i,s,void 0),bo(e,t,o,s)}if(l=(o&e.childLanes)!==0,en||l){if(s=Tt,s!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(s.suspendedLanes|o)?0:r,r!==0&&r!==i.retryLane&&(i.retryLane=r,ka(e,r),Wn(s,e,r,-1))}return Rh(),s=Wc(Error(ge(421))),bo(e,t,o,s)}return r.data==="$?"?(t.flags|=128,t.child=e.child,t=x0.bind(null,e),r._reactRetry=t,null):(e=i.treeContext,mn=Ya(r.nextSibling),fn=t,dt=!0,qn=null,e!==null&&(kn[Nn++]=fa,kn[Nn++]=ga,kn[Nn++]=ws,fa=e.id,ga=e.overflow,ws=t),t=Eh(t,s.children),t.flags|=4096,t)}function jp(e,t,n){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),Vu(e.return,t,n)}function zc(e,t,n,s,r){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:r}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=s,i.tail=n,i.tailMode=r)}function Ky(e,t,n){var s=t.pendingProps,r=s.revealOrder,i=s.tail;if(Ht(e,t,s.children,n),s=ft.current,s&2)s=s&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&jp(e,n,t);else if(e.tag===19)jp(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(it(ft,s),!(t.mode&1))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;n!==null;)e=n.alternate,e!==null&&xl(e)===null&&(r=n),n=n.sibling;n=r,n===null?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),zc(t,!1,r,n,i);break;case"backwards":for(n=null,r=t.child,t.child=null;r!==null;){if(e=r.alternate,e!==null&&xl(e)===null){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}zc(t,!0,n,null,i);break;case"together":zc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Jo(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Na(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Ns|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(ge(153));if(t.child!==null){for(e=t.child,n=Ja(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=Ja(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function c0(e,t,n){switch(t.tag){case 3:Yy(t),fr();break;case 5:_y(t);break;case 1:nn(t.type)&&fl(t);break;case 4:bh(t,t.stateNode.containerInfo);break;case 10:var s=t.type._context,r=t.memoizedProps.value;it(vl,s._currentValue),s._currentValue=r;break;case 13:if(s=t.memoizedState,s!==null)return s.dehydrated!==null?(it(ft,ft.current&1),t.flags|=128,null):n&t.child.childLanes?Vy(e,t,n):(it(ft,ft.current&1),e=Na(e,t,n),e!==null?e.sibling:null);it(ft,ft.current&1);break;case 19:if(s=(n&t.childLanes)!==0,e.flags&128){if(s)return Ky(e,t,n);t.flags|=128}if(r=t.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),it(ft,ft.current),s)break;return null;case 22:case 23:return t.lanes=0,zy(e,t,n)}return Na(e,t,n)}var Gy,td,Jy,Qy;Gy=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};td=function(){};Jy=function(e,t,n,s){var r=e.memoizedProps;if(r!==s){e=t.stateNode,ys(na.current);var i=null;switch(n){case"input":r=ku(e,r),s=ku(e,s),i=[];break;case"select":r=yt({},r,{value:void 0}),s=yt({},s,{value:void 0}),i=[];break;case"textarea":r=Su(e,r),s=Su(e,s),i=[];break;default:typeof r.onClick!="function"&&typeof s.onClick=="function"&&(e.onclick=ml)}Cu(n,s);var o;n=null;for(u in r)if(!s.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var l=r[u];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(ui.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in s){var c=s[u];if(l=r!=null?r[u]:void 0,s.hasOwnProperty(u)&&c!==l&&(c!=null||l!=null))if(u==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(i||(i=[]),i.push(u,n)),n=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(ui.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&lt("scroll",e),i||l===c||(i=[])):(i=i||[]).push(u,c))}n&&(i=i||[]).push("style",n);var u=i;(t.updateQueue=u)&&(t.flags|=4)}};Qy=function(e,t,n,s){n!==s&&(t.flags|=4)};function Mr(e,t){if(!dt)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function qt(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,s=0;if(t)for(var r=e.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags&14680064,s|=r.flags&14680064,r.return=e,r=r.sibling;else for(r=e.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=s,e.childLanes=n,t}function u0(e,t,n){var s=t.pendingProps;switch(hh(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qt(t),null;case 1:return nn(t.type)&&pl(),qt(t),null;case 3:return s=t.stateNode,yr(),ct(tn),ct(zt),xh(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(yo(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,qn!==null&&(cd(qn),qn=null))),td(e,t),qt(t),null;case 5:_h(t);var r=ys(wi.current);if(n=t.type,e!==null&&t.stateNode!=null)Jy(e,t,n,s,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(t.stateNode===null)throw Error(ge(166));return qt(t),null}if(e=ys(na.current),yo(t)){s=t.stateNode,n=t.type;var i=t.memoizedProps;switch(s[ea]=t,s[_i]=i,e=(t.mode&1)!==0,n){case"dialog":lt("cancel",s),lt("close",s);break;case"iframe":case"object":case"embed":lt("load",s);break;case"video":case"audio":for(r=0;r<Yr.length;r++)lt(Yr[r],s);break;case"source":lt("error",s);break;case"img":case"image":case"link":lt("error",s),lt("load",s);break;case"details":lt("toggle",s);break;case"input":Dm(s,i),lt("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!i.multiple},lt("invalid",s);break;case"textarea":Lm(s,i),lt("invalid",s)}Cu(n,i),r=null;for(var o in i)if(i.hasOwnProperty(o)){var l=i[o];o==="children"?typeof l=="string"?s.textContent!==l&&(i.suppressHydrationWarning!==!0&&go(s.textContent,l,e),r=["children",l]):typeof l=="number"&&s.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&go(s.textContent,l,e),r=["children",""+l]):ui.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&lt("scroll",s)}switch(n){case"input":oo(s),Mm(s,i,!0);break;case"textarea":oo(s),Om(s);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(s.onclick=ml)}s=r,t.updateQueue=s,s!==null&&(t.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=jg(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof s.is=="string"?e=o.createElement(n,{is:s.is}):(e=o.createElement(n),n==="select"&&(o=e,s.multiple?o.multiple=!0:s.size&&(o.size=s.size))):e=o.createElementNS(e,n),e[ea]=t,e[_i]=s,Gy(e,t,!1,!1),t.stateNode=e;e:{switch(o=Au(n,s),n){case"dialog":lt("cancel",e),lt("close",e),r=s;break;case"iframe":case"object":case"embed":lt("load",e),r=s;break;case"video":case"audio":for(r=0;r<Yr.length;r++)lt(Yr[r],e);r=s;break;case"source":lt("error",e),r=s;break;case"img":case"image":case"link":lt("error",e),lt("load",e),r=s;break;case"details":lt("toggle",e),r=s;break;case"input":Dm(e,s),r=ku(e,s),lt("invalid",e);break;case"option":r=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},r=yt({},s,{value:void 0}),lt("invalid",e);break;case"textarea":Lm(e,s),r=Su(e,s),lt("invalid",e);break;default:r=s}Cu(n,r),l=r;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?Cg(e,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Sg(e,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&di(e,c):typeof c=="number"&&di(e,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(ui.hasOwnProperty(i)?c!=null&&i==="onScroll"&&lt("scroll",e):c!=null&&Qd(e,i,c,o))}switch(n){case"input":oo(e),Mm(e,s,!1);break;case"textarea":oo(e),Om(e);break;case"option":s.value!=null&&e.setAttribute("value",""+Qa(s.value));break;case"select":e.multiple=!!s.multiple,i=s.value,i!=null?rr(e,!!s.multiple,i,!1):s.defaultValue!=null&&rr(e,!!s.multiple,s.defaultValue,!0);break;default:typeof r.onClick=="function"&&(e.onclick=ml)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return qt(t),null;case 6:if(e&&t.stateNode!=null)Qy(e,t,e.memoizedProps,s);else{if(typeof s!="string"&&t.stateNode===null)throw Error(ge(166));if(n=ys(wi.current),ys(na.current),yo(t)){if(s=t.stateNode,n=t.memoizedProps,s[ea]=t,(i=s.nodeValue!==n)&&(e=fn,e!==null))switch(e.tag){case 3:go(s.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&go(s.nodeValue,n,(e.mode&1)!==0)}i&&(t.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[ea]=t,t.stateNode=s}return qt(t),null;case 13:if(ct(ft),s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(dt&&mn!==null&&t.mode&1&&!(t.flags&128))fy(),fr(),t.flags|=98560,i=!1;else if(i=yo(t),s!==null&&s.dehydrated!==null){if(e===null){if(!i)throw Error(ge(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(ge(317));i[ea]=t}else fr(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;qt(t),i=!1}else qn!==null&&(cd(qn),qn=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(s=s!==null,s!==(e!==null&&e.memoizedState!==null)&&s&&(t.child.flags|=8192,t.mode&1&&(e===null||ft.current&1?At===0&&(At=3):Rh())),t.updateQueue!==null&&(t.flags|=4),qt(t),null);case 4:return yr(),td(e,t),e===null&&vi(t.stateNode.containerInfo),qt(t),null;case 10:return gh(t.type._context),qt(t),null;case 17:return nn(t.type)&&pl(),qt(t),null;case 19:if(ct(ft),i=t.memoizedState,i===null)return qt(t),null;if(s=(t.flags&128)!==0,o=i.rendering,o===null)if(s)Mr(i,!1);else{if(At!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=xl(e),o!==null){for(t.flags|=128,Mr(i,!1),s=o.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=n,n=t.child;n!==null;)i=n,e=s,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,e=o.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return it(ft,ft.current&1|2),t.child}e=e.sibling}i.tail!==null&&kt()>br&&(t.flags|=128,s=!0,Mr(i,!1),t.lanes=4194304)}else{if(!s)if(e=xl(o),e!==null){if(t.flags|=128,s=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Mr(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!dt)return qt(t),null}else 2*kt()-i.renderingStartTime>br&&n!==1073741824&&(t.flags|=128,s=!0,Mr(i,!1),t.lanes=4194304);i.isBackwards?(o.sibling=t.child,t.child=o):(n=i.last,n!==null?n.sibling=o:t.child=o,i.last=o)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=kt(),t.sibling=null,n=ft.current,it(ft,s?n&1|2:n&1),t):(qt(t),null);case 22:case 23:return Th(),s=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==s&&(t.flags|=8192),s&&t.mode&1?un&1073741824&&(qt(t),t.subtreeFlags&6&&(t.flags|=8192)):qt(t),null;case 24:return null;case 25:return null}throw Error(ge(156,t.tag))}function d0(e,t){switch(hh(t),t.tag){case 1:return nn(t.type)&&pl(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return yr(),ct(tn),ct(zt),xh(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return _h(t),null;case 13:if(ct(ft),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(ge(340));fr()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return ct(ft),null;case 4:return yr(),null;case 10:return gh(t.type._context),null;case 22:case 23:return Th(),null;case 24:return null;default:return null}}var _o=!1,Ut=!1,h0=typeof WeakSet=="function"?WeakSet:Set,Ee=null;function nr(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){_t(e,t,s)}else n.current=null}function nd(e,t,n){try{n()}catch(s){_t(e,t,s)}}var Sp=!1;function m0(e,t){if(Bu=ul,e=ny(),uh(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var r=s.anchorOffset,i=s.focusNode;s=s.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,l=-1,c=-1,u=0,d=0,h=e,m=null;t:for(;;){for(var y;h!==n||r!==0&&h.nodeType!==3||(l=o+r),h!==i||s!==0&&h.nodeType!==3||(c=o+s),h.nodeType===3&&(o+=h.nodeValue.length),(y=h.firstChild)!==null;)m=h,h=y;for(;;){if(h===e)break t;if(m===n&&++u===r&&(l=o),m===i&&++d===s&&(c=o),(y=h.nextSibling)!==null)break;h=m,m=h.parentNode}h=y}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Fu={focusedElem:e,selectionRange:n},ul=!1,Ee=t;Ee!==null;)if(t=Ee,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Ee=e;else for(;Ee!==null;){t=Ee;try{var b=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(b!==null){var _=b.memoizedProps,w=b.memoizedState,f=t.stateNode,p=f.getSnapshotBeforeUpdate(t.elementType===t.type?_:On(t.type,_),w);f.__reactInternalSnapshotBeforeUpdate=p}break;case 3:var g=t.stateNode.containerInfo;g.nodeType===1?g.textContent="":g.nodeType===9&&g.documentElement&&g.removeChild(g.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ge(163))}}catch(j){_t(t,t.return,j)}if(e=t.sibling,e!==null){e.return=t.return,Ee=e;break}Ee=t.return}return b=Sp,Sp=!1,b}function ri(e,t,n){var s=t.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&e)===e){var i=r.destroy;r.destroy=void 0,i!==void 0&&nd(t,n,i)}r=r.next}while(r!==s)}}function Xl(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var s=n.create;n.destroy=s()}n=n.next}while(n!==t)}}function ad(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function Xy(e){var t=e.alternate;t!==null&&(e.alternate=null,Xy(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[ea],delete t[_i],delete t[Wu],delete t[Gx],delete t[Jx])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Zy(e){return e.tag===5||e.tag===3||e.tag===4}function Ep(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Zy(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function sd(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=ml));else if(s!==4&&(e=e.child,e!==null))for(sd(e,t,n),e=e.sibling;e!==null;)sd(e,t,n),e=e.sibling}function rd(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(s!==4&&(e=e.child,e!==null))for(rd(e,t,n),e=e.sibling;e!==null;)rd(e,t,n),e=e.sibling}var Lt=null,Bn=!1;function Pa(e,t,n){for(n=n.child;n!==null;)ev(e,t,n),n=n.sibling}function ev(e,t,n){if(ta&&typeof ta.onCommitFiberUnmount=="function")try{ta.onCommitFiberUnmount(zl,n)}catch{}switch(n.tag){case 5:Ut||nr(n,t);case 6:var s=Lt,r=Bn;Lt=null,Pa(e,t,n),Lt=s,Bn=r,Lt!==null&&(Bn?(e=Lt,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Lt.removeChild(n.stateNode));break;case 18:Lt!==null&&(Bn?(e=Lt,n=n.stateNode,e.nodeType===8?Oc(e.parentNode,n):e.nodeType===1&&Oc(e,n),fi(e)):Oc(Lt,n.stateNode));break;case 4:s=Lt,r=Bn,Lt=n.stateNode.containerInfo,Bn=!0,Pa(e,t,n),Lt=s,Bn=r;break;case 0:case 11:case 14:case 15:if(!Ut&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){r=s=s.next;do{var i=r,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&nd(n,t,o),r=r.next}while(r!==s)}Pa(e,t,n);break;case 1:if(!Ut&&(nr(n,t),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(l){_t(n,t,l)}Pa(e,t,n);break;case 21:Pa(e,t,n);break;case 22:n.mode&1?(Ut=(s=Ut)||n.memoizedState!==null,Pa(e,t,n),Ut=s):Pa(e,t,n);break;default:Pa(e,t,n)}}function Cp(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new h0),t.forEach(function(s){var r=w0.bind(null,e,s);n.has(s)||(n.add(s),s.then(r,r))})}}function Dn(e,t){var n=t.deletions;if(n!==null)for(var s=0;s<n.length;s++){var r=n[s];try{var i=e,o=t,l=o;e:for(;l!==null;){switch(l.tag){case 5:Lt=l.stateNode,Bn=!1;break e;case 3:Lt=l.stateNode.containerInfo,Bn=!0;break e;case 4:Lt=l.stateNode.containerInfo,Bn=!0;break e}l=l.return}if(Lt===null)throw Error(ge(160));ev(i,o,r),Lt=null,Bn=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(u){_t(r,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)tv(t,e),t=t.sibling}function tv(e,t){var n=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Dn(t,e),Gn(e),s&4){try{ri(3,e,e.return),Xl(3,e)}catch(_){_t(e,e.return,_)}try{ri(5,e,e.return)}catch(_){_t(e,e.return,_)}}break;case 1:Dn(t,e),Gn(e),s&512&&n!==null&&nr(n,n.return);break;case 5:if(Dn(t,e),Gn(e),s&512&&n!==null&&nr(n,n.return),e.flags&32){var r=e.stateNode;try{di(r,"")}catch(_){_t(e,e.return,_)}}if(s&4&&(r=e.stateNode,r!=null)){var i=e.memoizedProps,o=n!==null?n.memoizedProps:i,l=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&kg(r,i),Au(l,o);var u=Au(l,i);for(o=0;o<c.length;o+=2){var d=c[o],h=c[o+1];d==="style"?Cg(r,h):d==="dangerouslySetInnerHTML"?Sg(r,h):d==="children"?di(r,h):Qd(r,d,h,u)}switch(l){case"input":Nu(r,i);break;case"textarea":Ng(r,i);break;case"select":var m=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!i.multiple;var y=i.value;y!=null?rr(r,!!i.multiple,y,!1):m!==!!i.multiple&&(i.defaultValue!=null?rr(r,!!i.multiple,i.defaultValue,!0):rr(r,!!i.multiple,i.multiple?[]:"",!1))}r[_i]=i}catch(_){_t(e,e.return,_)}}break;case 6:if(Dn(t,e),Gn(e),s&4){if(e.stateNode===null)throw Error(ge(162));r=e.stateNode,i=e.memoizedProps;try{r.nodeValue=i}catch(_){_t(e,e.return,_)}}break;case 3:if(Dn(t,e),Gn(e),s&4&&n!==null&&n.memoizedState.isDehydrated)try{fi(t.containerInfo)}catch(_){_t(e,e.return,_)}break;case 4:Dn(t,e),Gn(e);break;case 13:Dn(t,e),Gn(e),r=e.child,r.flags&8192&&(i=r.memoizedState!==null,r.stateNode.isHidden=i,!i||r.alternate!==null&&r.alternate.memoizedState!==null||(Ih=kt())),s&4&&Cp(e);break;case 22:if(d=n!==null&&n.memoizedState!==null,e.mode&1?(Ut=(u=Ut)||d,Dn(t,e),Ut=u):Dn(t,e),Gn(e),s&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!d&&e.mode&1)for(Ee=e,d=e.child;d!==null;){for(h=Ee=d;Ee!==null;){switch(m=Ee,y=m.child,m.tag){case 0:case 11:case 14:case 15:ri(4,m,m.return);break;case 1:nr(m,m.return);var b=m.stateNode;if(typeof b.componentWillUnmount=="function"){s=m,n=m.return;try{t=s,b.props=t.memoizedProps,b.state=t.memoizedState,b.componentWillUnmount()}catch(_){_t(s,n,_)}}break;case 5:nr(m,m.return);break;case 22:if(m.memoizedState!==null){Ip(h);continue}}y!==null?(y.return=m,Ee=y):Ip(h)}d=d.sibling}e:for(d=null,h=e;;){if(h.tag===5){if(d===null){d=h;try{r=h.stateNode,u?(i=r.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=Eg("display",o))}catch(_){_t(e,e.return,_)}}}else if(h.tag===6){if(d===null)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(_){_t(e,e.return,_)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===e)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;h.sibling===null;){if(h.return===null||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Dn(t,e),Gn(e),s&4&&Cp(e);break;case 21:break;default:Dn(t,e),Gn(e)}}function Gn(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(Zy(n)){var s=n;break e}n=n.return}throw Error(ge(160))}switch(s.tag){case 5:var r=s.stateNode;s.flags&32&&(di(r,""),s.flags&=-33);var i=Ep(e);rd(e,i,r);break;case 3:case 4:var o=s.stateNode.containerInfo,l=Ep(e);sd(e,l,o);break;default:throw Error(ge(161))}}catch(c){_t(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function p0(e,t,n){Ee=e,nv(e)}function nv(e,t,n){for(var s=(e.mode&1)!==0;Ee!==null;){var r=Ee,i=r.child;if(r.tag===22&&s){var o=r.memoizedState!==null||_o;if(!o){var l=r.alternate,c=l!==null&&l.memoizedState!==null||Ut;l=_o;var u=Ut;if(_o=o,(Ut=c)&&!u)for(Ee=r;Ee!==null;)o=Ee,c=o.child,o.tag===22&&o.memoizedState!==null?Pp(r):c!==null?(c.return=o,Ee=c):Pp(r);for(;i!==null;)Ee=i,nv(i),i=i.sibling;Ee=r,_o=l,Ut=u}Ap(e)}else r.subtreeFlags&8772&&i!==null?(i.return=r,Ee=i):Ap(e)}}function Ap(e){for(;Ee!==null;){var t=Ee;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Ut||Xl(5,t);break;case 1:var s=t.stateNode;if(t.flags&4&&!Ut)if(n===null)s.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:On(t.type,n.memoizedProps);s.componentDidUpdate(r,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&mp(t,i,s);break;case 3:var o=t.updateQueue;if(o!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}mp(t,o,n)}break;case 5:var l=t.stateNode;if(n===null&&t.flags&4){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var d=u.memoizedState;if(d!==null){var h=d.dehydrated;h!==null&&fi(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ge(163))}Ut||t.flags&512&&ad(t)}catch(m){_t(t,t.return,m)}}if(t===e){Ee=null;break}if(n=t.sibling,n!==null){n.return=t.return,Ee=n;break}Ee=t.return}}function Ip(e){for(;Ee!==null;){var t=Ee;if(t===e){Ee=null;break}var n=t.sibling;if(n!==null){n.return=t.return,Ee=n;break}Ee=t.return}}function Pp(e){for(;Ee!==null;){var t=Ee;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Xl(4,t)}catch(c){_t(t,n,c)}break;case 1:var s=t.stateNode;if(typeof s.componentDidMount=="function"){var r=t.return;try{s.componentDidMount()}catch(c){_t(t,r,c)}}var i=t.return;try{ad(t)}catch(c){_t(t,i,c)}break;case 5:var o=t.return;try{ad(t)}catch(c){_t(t,o,c)}}}catch(c){_t(t,t.return,c)}if(t===e){Ee=null;break}var l=t.sibling;if(l!==null){l.return=t.return,Ee=l;break}Ee=t.return}}var f0=Math.ceil,Nl=Sa.ReactCurrentDispatcher,Ch=Sa.ReactCurrentOwner,En=Sa.ReactCurrentBatchConfig,Ze=0,Tt=null,jt=null,Ot=0,un=0,ar=es(0),At=0,Si=null,Ns=0,Zl=0,Ah=0,ii=null,Zt=null,Ih=0,br=1/0,ca=null,jl=!1,id=null,Ka=null,xo=!1,Ua=null,Sl=0,oi=0,od=null,Qo=-1,Xo=0;function Yt(){return Ze&6?kt():Qo!==-1?Qo:Qo=kt()}function Ga(e){return e.mode&1?Ze&2&&Ot!==0?Ot&-Ot:Xx.transition!==null?(Xo===0&&(Xo=Fg()),Xo):(e=at,e!==0||(e=window.event,e=e===void 0?16:Vg(e.type)),e):1}function Wn(e,t,n,s){if(50<oi)throw oi=0,od=null,Error(ge(185));Mi(e,n,s),(!(Ze&2)||e!==Tt)&&(e===Tt&&(!(Ze&2)&&(Zl|=n),At===4&&$a(e,Ot)),an(e,s),n===1&&Ze===0&&!(t.mode&1)&&(br=kt()+500,Gl&&ts()))}function an(e,t){var n=e.callbackNode;X_(e,t);var s=cl(e,e===Tt?Ot:0);if(s===0)n!==null&&Fm(n),e.callbackNode=null,e.callbackPriority=0;else if(t=s&-s,e.callbackPriority!==t){if(n!=null&&Fm(n),t===1)e.tag===0?Qx(Tp.bind(null,e)):hy(Tp.bind(null,e)),Vx(function(){!(Ze&6)&&ts()}),n=null;else{switch(qg(s)){case 1:n=nh;break;case 4:n=$g;break;case 16:n=ll;break;case 536870912:n=Bg;break;default:n=ll}n=uv(n,av.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function av(e,t){if(Qo=-1,Xo=0,Ze&6)throw Error(ge(327));var n=e.callbackNode;if(ur()&&e.callbackNode!==n)return null;var s=cl(e,e===Tt?Ot:0);if(s===0)return null;if(s&30||s&e.expiredLanes||t)t=El(e,s);else{t=s;var r=Ze;Ze|=2;var i=rv();(Tt!==e||Ot!==t)&&(ca=null,br=kt()+500,bs(e,t));do try{v0();break}catch(l){sv(e,l)}while(!0);fh(),Nl.current=i,Ze=r,jt!==null?t=0:(Tt=null,Ot=0,t=At)}if(t!==0){if(t===2&&(r=Du(e),r!==0&&(s=r,t=ld(e,r))),t===1)throw n=Si,bs(e,0),$a(e,s),an(e,kt()),n;if(t===6)$a(e,s);else{if(r=e.current.alternate,!(s&30)&&!g0(r)&&(t=El(e,s),t===2&&(i=Du(e),i!==0&&(s=i,t=ld(e,i))),t===1))throw n=Si,bs(e,0),$a(e,s),an(e,kt()),n;switch(e.finishedWork=r,e.finishedLanes=s,t){case 0:case 1:throw Error(ge(345));case 2:cs(e,Zt,ca);break;case 3:if($a(e,s),(s&130023424)===s&&(t=Ih+500-kt(),10<t)){if(cl(e,0)!==0)break;if(r=e.suspendedLanes,(r&s)!==s){Yt(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=Uu(cs.bind(null,e,Zt,ca),t);break}cs(e,Zt,ca);break;case 4:if($a(e,s),(s&4194240)===s)break;for(t=e.eventTimes,r=-1;0<s;){var o=31-Un(s);i=1<<o,o=t[o],o>r&&(r=o),s&=~i}if(s=r,s=kt()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*f0(s/1960))-s,10<s){e.timeoutHandle=Uu(cs.bind(null,e,Zt,ca),s);break}cs(e,Zt,ca);break;case 5:cs(e,Zt,ca);break;default:throw Error(ge(329))}}}return an(e,kt()),e.callbackNode===n?av.bind(null,e):null}function ld(e,t){var n=ii;return e.current.memoizedState.isDehydrated&&(bs(e,t).flags|=256),e=El(e,t),e!==2&&(t=Zt,Zt=n,t!==null&&cd(t)),e}function cd(e){Zt===null?Zt=e:Zt.push.apply(Zt,e)}function g0(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var r=n[s],i=r.getSnapshot;r=r.value;try{if(!zn(i(),r))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function $a(e,t){for(t&=~Ah,t&=~Zl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Un(t),s=1<<n;e[n]=-1,t&=~s}}function Tp(e){if(Ze&6)throw Error(ge(327));ur();var t=cl(e,0);if(!(t&1))return an(e,kt()),null;var n=El(e,t);if(e.tag!==0&&n===2){var s=Du(e);s!==0&&(t=s,n=ld(e,s))}if(n===1)throw n=Si,bs(e,0),$a(e,t),an(e,kt()),n;if(n===6)throw Error(ge(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,cs(e,Zt,ca),an(e,kt()),null}function Ph(e,t){var n=Ze;Ze|=1;try{return e(t)}finally{Ze=n,Ze===0&&(br=kt()+500,Gl&&ts())}}function js(e){Ua!==null&&Ua.tag===0&&!(Ze&6)&&ur();var t=Ze;Ze|=1;var n=En.transition,s=at;try{if(En.transition=null,at=1,e)return e()}finally{at=s,En.transition=n,Ze=t,!(Ze&6)&&ts()}}function Th(){un=ar.current,ct(ar)}function bs(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,Yx(n)),jt!==null)for(n=jt.return;n!==null;){var s=n;switch(hh(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&pl();break;case 3:yr(),ct(tn),ct(zt),xh();break;case 5:_h(s);break;case 4:yr();break;case 13:ct(ft);break;case 19:ct(ft);break;case 10:gh(s.type._context);break;case 22:case 23:Th()}n=n.return}if(Tt=e,jt=e=Ja(e.current,null),Ot=un=t,At=0,Si=null,Ah=Zl=Ns=0,Zt=ii=null,gs!==null){for(t=0;t<gs.length;t++)if(n=gs[t],s=n.interleaved,s!==null){n.interleaved=null;var r=s.next,i=n.pending;if(i!==null){var o=i.next;i.next=r,s.next=o}n.pending=s}gs=null}return e}function sv(e,t){do{var n=jt;try{if(fh(),Ko.current=kl,wl){for(var s=gt.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}wl=!1}if(ks=0,Pt=Et=gt=null,si=!1,ki=0,Ch.current=null,n===null||n.return===null){At=1,Si=t,jt=null;break}e:{var i=e,o=n.return,l=n,c=t;if(t=Ot,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,d=l,h=d.tag;if(!(d.mode&1)&&(h===0||h===11||h===15)){var m=d.alternate;m?(d.updateQueue=m.updateQueue,d.memoizedState=m.memoizedState,d.lanes=m.lanes):(d.updateQueue=null,d.memoizedState=null)}var y=bp(o);if(y!==null){y.flags&=-257,_p(y,o,l,i,t),y.mode&1&&vp(i,u,t),t=y,c=u;var b=t.updateQueue;if(b===null){var _=new Set;_.add(c),t.updateQueue=_}else b.add(c);break e}else{if(!(t&1)){vp(i,u,t),Rh();break e}c=Error(ge(426))}}else if(dt&&l.mode&1){var w=bp(o);if(w!==null){!(w.flags&65536)&&(w.flags|=256),_p(w,o,l,i,t),mh(vr(c,l));break e}}i=c=vr(c,l),At!==4&&(At=2),ii===null?ii=[i]:ii.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var f=qy(i,c,t);hp(i,f);break e;case 1:l=c;var p=i.type,g=i.stateNode;if(!(i.flags&128)&&(typeof p.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(Ka===null||!Ka.has(g)))){i.flags|=65536,t&=-t,i.lanes|=t;var j=Uy(i,l,t);hp(i,j);break e}}i=i.return}while(i!==null)}ov(n)}catch(A){t=A,jt===n&&n!==null&&(jt=n=n.return);continue}break}while(!0)}function rv(){var e=Nl.current;return Nl.current=kl,e===null?kl:e}function Rh(){(At===0||At===3||At===2)&&(At=4),Tt===null||!(Ns&268435455)&&!(Zl&268435455)||$a(Tt,Ot)}function El(e,t){var n=Ze;Ze|=2;var s=rv();(Tt!==e||Ot!==t)&&(ca=null,bs(e,t));do try{y0();break}catch(r){sv(e,r)}while(!0);if(fh(),Ze=n,Nl.current=s,jt!==null)throw Error(ge(261));return Tt=null,Ot=0,At}function y0(){for(;jt!==null;)iv(jt)}function v0(){for(;jt!==null&&!W_();)iv(jt)}function iv(e){var t=cv(e.alternate,e,un);e.memoizedProps=e.pendingProps,t===null?ov(e):jt=t,Ch.current=null}function ov(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=d0(n,t),n!==null){n.flags&=32767,jt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{At=6,jt=null;return}}else if(n=u0(n,t,un),n!==null){jt=n;return}if(t=t.sibling,t!==null){jt=t;return}jt=t=e}while(t!==null);At===0&&(At=5)}function cs(e,t,n){var s=at,r=En.transition;try{En.transition=null,at=1,b0(e,t,n,s)}finally{En.transition=r,at=s}return null}function b0(e,t,n,s){do ur();while(Ua!==null);if(Ze&6)throw Error(ge(327));n=e.finishedWork;var r=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(ge(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(Z_(e,i),e===Tt&&(jt=Tt=null,Ot=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||xo||(xo=!0,uv(ll,function(){return ur(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=En.transition,En.transition=null;var o=at;at=1;var l=Ze;Ze|=4,Ch.current=null,m0(e,n),tv(n,e),Bx(Fu),ul=!!Bu,Fu=Bu=null,e.current=n,p0(n),z_(),Ze=l,at=o,En.transition=i}else e.current=n;if(xo&&(xo=!1,Ua=e,Sl=r),i=e.pendingLanes,i===0&&(Ka=null),V_(n.stateNode),an(e,kt()),t!==null)for(s=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],s(r.value,{componentStack:r.stack,digest:r.digest});if(jl)throw jl=!1,e=id,id=null,e;return Sl&1&&e.tag!==0&&ur(),i=e.pendingLanes,i&1?e===od?oi++:(oi=0,od=e):oi=0,ts(),null}function ur(){if(Ua!==null){var e=qg(Sl),t=En.transition,n=at;try{if(En.transition=null,at=16>e?16:e,Ua===null)var s=!1;else{if(e=Ua,Ua=null,Sl=0,Ze&6)throw Error(ge(331));var r=Ze;for(Ze|=4,Ee=e.current;Ee!==null;){var i=Ee,o=i.child;if(Ee.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var u=l[c];for(Ee=u;Ee!==null;){var d=Ee;switch(d.tag){case 0:case 11:case 15:ri(8,d,i)}var h=d.child;if(h!==null)h.return=d,Ee=h;else for(;Ee!==null;){d=Ee;var m=d.sibling,y=d.return;if(Xy(d),d===u){Ee=null;break}if(m!==null){m.return=y,Ee=m;break}Ee=y}}}var b=i.alternate;if(b!==null){var _=b.child;if(_!==null){b.child=null;do{var w=_.sibling;_.sibling=null,_=w}while(_!==null)}}Ee=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,Ee=o;else e:for(;Ee!==null;){if(i=Ee,i.flags&2048)switch(i.tag){case 0:case 11:case 15:ri(9,i,i.return)}var f=i.sibling;if(f!==null){f.return=i.return,Ee=f;break e}Ee=i.return}}var p=e.current;for(Ee=p;Ee!==null;){o=Ee;var g=o.child;if(o.subtreeFlags&2064&&g!==null)g.return=o,Ee=g;else e:for(o=p;Ee!==null;){if(l=Ee,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Xl(9,l)}}catch(A){_t(l,l.return,A)}if(l===o){Ee=null;break e}var j=l.sibling;if(j!==null){j.return=l.return,Ee=j;break e}Ee=l.return}}if(Ze=r,ts(),ta&&typeof ta.onPostCommitFiberRoot=="function")try{ta.onPostCommitFiberRoot(zl,e)}catch{}s=!0}return s}finally{at=n,En.transition=t}}return!1}function Rp(e,t,n){t=vr(n,t),t=qy(e,t,1),e=Va(e,t,1),t=Yt(),e!==null&&(Mi(e,1,t),an(e,t))}function _t(e,t,n){if(e.tag===3)Rp(e,e,n);else for(;t!==null;){if(t.tag===3){Rp(t,e,n);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Ka===null||!Ka.has(s))){e=vr(n,e),e=Uy(t,e,1),t=Va(t,e,1),e=Yt(),t!==null&&(Mi(t,1,e),an(t,e));break}}t=t.return}}function _0(e,t,n){var s=e.pingCache;s!==null&&s.delete(t),t=Yt(),e.pingedLanes|=e.suspendedLanes&n,Tt===e&&(Ot&n)===n&&(At===4||At===3&&(Ot&130023424)===Ot&&500>kt()-Ih?bs(e,0):Ah|=n),an(e,t)}function lv(e,t){t===0&&(e.mode&1?(t=uo,uo<<=1,!(uo&130023424)&&(uo=4194304)):t=1);var n=Yt();e=ka(e,t),e!==null&&(Mi(e,t,n),an(e,n))}function x0(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),lv(e,n)}function w0(e,t){var n=0;switch(e.tag){case 13:var s=e.stateNode,r=e.memoizedState;r!==null&&(n=r.retryLane);break;case 19:s=e.stateNode;break;default:throw Error(ge(314))}s!==null&&s.delete(t),lv(e,n)}var cv;cv=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||tn.current)en=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return en=!1,c0(e,t,n);en=!!(e.flags&131072)}else en=!1,dt&&t.flags&1048576&&my(t,yl,t.index);switch(t.lanes=0,t.tag){case 2:var s=t.type;Jo(e,t),e=t.pendingProps;var r=pr(t,zt.current);cr(t,n),r=kh(null,t,s,e,r,n);var i=Nh();return t.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,nn(s)?(i=!0,fl(t)):i=!1,t.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,vh(t),r.updater=Ql,t.stateNode=r,r._reactInternals=t,Gu(t,s,e,n),t=Xu(null,t,s,!0,i,n)):(t.tag=0,dt&&i&&dh(t),Ht(null,t,r,n),t=t.child),t;case 16:s=t.elementType;e:{switch(Jo(e,t),e=t.pendingProps,r=s._init,s=r(s._payload),t.type=s,r=t.tag=N0(s),e=On(s,e),r){case 0:t=Qu(null,t,s,e,n);break e;case 1:t=kp(null,t,s,e,n);break e;case 11:t=xp(null,t,s,e,n);break e;case 14:t=wp(null,t,s,On(s.type,e),n);break e}throw Error(ge(306,s,""))}return t;case 0:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:On(s,r),Qu(e,t,s,r,n);case 1:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:On(s,r),kp(e,t,s,r,n);case 3:e:{if(Yy(t),e===null)throw Error(ge(387));s=t.pendingProps,i=t.memoizedState,r=i.element,by(e,t),_l(t,s,null,n);var o=t.memoizedState;if(s=o.element,i.isDehydrated)if(i={element:s,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){r=vr(Error(ge(423)),t),t=Np(e,t,s,n,r);break e}else if(s!==r){r=vr(Error(ge(424)),t),t=Np(e,t,s,n,r);break e}else for(mn=Ya(t.stateNode.containerInfo.firstChild),fn=t,dt=!0,qn=null,n=yy(t,null,s,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(fr(),s===r){t=Na(e,t,n);break e}Ht(e,t,s,n)}t=t.child}return t;case 5:return _y(t),e===null&&Yu(t),s=t.type,r=t.pendingProps,i=e!==null?e.memoizedProps:null,o=r.children,qu(s,r)?o=null:i!==null&&qu(s,i)&&(t.flags|=32),Hy(e,t),Ht(e,t,o,n),t.child;case 6:return e===null&&Yu(t),null;case 13:return Vy(e,t,n);case 4:return bh(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=gr(t,null,s,n):Ht(e,t,s,n),t.child;case 11:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:On(s,r),xp(e,t,s,r,n);case 7:return Ht(e,t,t.pendingProps,n),t.child;case 8:return Ht(e,t,t.pendingProps.children,n),t.child;case 12:return Ht(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(s=t.type._context,r=t.pendingProps,i=t.memoizedProps,o=r.value,it(vl,s._currentValue),s._currentValue=o,i!==null)if(zn(i.value,o)){if(i.children===r.children&&!tn.current){t=Na(e,t,n);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var l=i.dependencies;if(l!==null){o=i.child;for(var c=l.firstContext;c!==null;){if(c.context===s){if(i.tag===1){c=ya(-1,n&-n),c.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var d=u.pending;d===null?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),Vu(i.return,n,t),l.lanes|=n;break}c=c.next}}else if(i.tag===10)o=i.type===t.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(ge(341));o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),Vu(o,n,t),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===t){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}Ht(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,s=t.pendingProps.children,cr(t,n),r=Cn(r),s=s(r),t.flags|=1,Ht(e,t,s,n),t.child;case 14:return s=t.type,r=On(s,t.pendingProps),r=On(s.type,r),wp(e,t,s,r,n);case 15:return Wy(e,t,t.type,t.pendingProps,n);case 17:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:On(s,r),Jo(e,t),t.tag=1,nn(s)?(e=!0,fl(t)):e=!1,cr(t,n),Fy(t,s,r),Gu(t,s,r,n),Xu(null,t,s,!0,e,n);case 19:return Ky(e,t,n);case 22:return zy(e,t,n)}throw Error(ge(156,t.tag))};function uv(e,t){return Og(e,t)}function k0(e,t,n,s){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Sn(e,t,n,s){return new k0(e,t,n,s)}function Dh(e){return e=e.prototype,!(!e||!e.isReactComponent)}function N0(e){if(typeof e=="function")return Dh(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Zd)return 11;if(e===eh)return 14}return 2}function Ja(e,t){var n=e.alternate;return n===null?(n=Sn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Zo(e,t,n,s,r,i){var o=2;if(s=e,typeof e=="function")Dh(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case Vs:return _s(n.children,r,i,t);case Xd:o=8,r|=8;break;case bu:return e=Sn(12,n,t,r|2),e.elementType=bu,e.lanes=i,e;case _u:return e=Sn(13,n,t,r),e.elementType=_u,e.lanes=i,e;case xu:return e=Sn(19,n,t,r),e.elementType=xu,e.lanes=i,e;case _g:return ec(n,r,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case vg:o=10;break e;case bg:o=9;break e;case Zd:o=11;break e;case eh:o=14;break e;case Da:o=16,s=null;break e}throw Error(ge(130,e==null?e:typeof e,""))}return t=Sn(o,n,t,r),t.elementType=e,t.type=s,t.lanes=i,t}function _s(e,t,n,s){return e=Sn(7,e,s,t),e.lanes=n,e}function ec(e,t,n,s){return e=Sn(22,e,s,t),e.elementType=_g,e.lanes=n,e.stateNode={isHidden:!1},e}function Hc(e,t,n){return e=Sn(6,e,null,t),e.lanes=n,e}function Yc(e,t,n){return t=Sn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function j0(e,t,n,s,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Sc(0),this.expirationTimes=Sc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Sc(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Mh(e,t,n,s,r,i,o,l,c){return e=new j0(e,t,n,l,c),t===1?(t=1,i===!0&&(t|=8)):t=0,i=Sn(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},vh(i),e}function S0(e,t,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ys,key:s==null?null:""+s,children:e,containerInfo:t,implementation:n}}function dv(e){if(!e)return Xa;e=e._reactInternals;e:{if(Es(e)!==e||e.tag!==1)throw Error(ge(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(nn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(ge(171))}if(e.tag===1){var n=e.type;if(nn(n))return dy(e,n,t)}return t}function hv(e,t,n,s,r,i,o,l,c){return e=Mh(n,s,!0,e,r,i,o,l,c),e.context=dv(null),n=e.current,s=Yt(),r=Ga(n),i=ya(s,r),i.callback=t??null,Va(n,i,r),e.current.lanes=r,Mi(e,r,s),an(e,s),e}function tc(e,t,n,s){var r=t.current,i=Yt(),o=Ga(r);return n=dv(n),t.context===null?t.context=n:t.pendingContext=n,t=ya(i,o),t.payload={element:e},s=s===void 0?null:s,s!==null&&(t.callback=s),e=Va(r,t,o),e!==null&&(Wn(e,r,o,i),Vo(e,r,o)),o}function Cl(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Dp(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function Lh(e,t){Dp(e,t),(e=e.alternate)&&Dp(e,t)}function E0(){return null}var mv=typeof reportError=="function"?reportError:function(e){console.error(e)};function Oh(e){this._internalRoot=e}nc.prototype.render=Oh.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(ge(409));tc(e,t,null,null)};nc.prototype.unmount=Oh.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;js(function(){tc(null,e,null,null)}),t[wa]=null}};function nc(e){this._internalRoot=e}nc.prototype.unstable_scheduleHydration=function(e){if(e){var t=zg();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Oa.length&&t!==0&&t<Oa[n].priority;n++);Oa.splice(n,0,e),n===0&&Yg(e)}};function $h(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function ac(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Mp(){}function C0(e,t,n,s,r){if(r){if(typeof s=="function"){var i=s;s=function(){var u=Cl(o);i.call(u)}}var o=hv(t,s,e,0,null,!1,!1,"",Mp);return e._reactRootContainer=o,e[wa]=o.current,vi(e.nodeType===8?e.parentNode:e),js(),o}for(;r=e.lastChild;)e.removeChild(r);if(typeof s=="function"){var l=s;s=function(){var u=Cl(c);l.call(u)}}var c=Mh(e,0,!1,null,null,!1,!1,"",Mp);return e._reactRootContainer=c,e[wa]=c.current,vi(e.nodeType===8?e.parentNode:e),js(function(){tc(t,c,n,s)}),c}function sc(e,t,n,s,r){var i=n._reactRootContainer;if(i){var o=i;if(typeof r=="function"){var l=r;r=function(){var c=Cl(o);l.call(c)}}tc(t,o,e,r)}else o=C0(n,t,e,r,s);return Cl(o)}Ug=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Hr(t.pendingLanes);n!==0&&(ah(t,n|1),an(t,kt()),!(Ze&6)&&(br=kt()+500,ts()))}break;case 13:js(function(){var s=ka(e,1);if(s!==null){var r=Yt();Wn(s,e,1,r)}}),Lh(e,1)}};sh=function(e){if(e.tag===13){var t=ka(e,134217728);if(t!==null){var n=Yt();Wn(t,e,134217728,n)}Lh(e,134217728)}};Wg=function(e){if(e.tag===13){var t=Ga(e),n=ka(e,t);if(n!==null){var s=Yt();Wn(n,e,t,s)}Lh(e,t)}};zg=function(){return at};Hg=function(e,t){var n=at;try{return at=e,t()}finally{at=n}};Pu=function(e,t,n){switch(t){case"input":if(Nu(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var s=n[t];if(s!==e&&s.form===e.form){var r=Kl(s);if(!r)throw Error(ge(90));wg(s),Nu(s,r)}}}break;case"textarea":Ng(e,n);break;case"select":t=n.value,t!=null&&rr(e,!!n.multiple,t,!1)}};Pg=Ph;Tg=js;var A0={usingClientEntryPoint:!1,Events:[Oi,Qs,Kl,Ag,Ig,Ph]},Lr={findFiberByHostInstance:fs,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},I0={bundleType:Lr.bundleType,version:Lr.version,rendererPackageName:Lr.rendererPackageName,rendererConfig:Lr.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Sa.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Mg(e),e===null?null:e.stateNode},findFiberByHostInstance:Lr.findFiberByHostInstance||E0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wo.isDisabled&&wo.supportsFiber)try{zl=wo.inject(I0),ta=wo}catch{}}vn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=A0;vn.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!$h(t))throw Error(ge(200));return S0(e,t,null,n)};vn.createRoot=function(e,t){if(!$h(e))throw Error(ge(299));var n=!1,s="",r=mv;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(r=t.onRecoverableError)),t=Mh(e,1,!1,null,null,n,!1,s,r),e[wa]=t.current,vi(e.nodeType===8?e.parentNode:e),new Oh(t)};vn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(ge(188)):(e=Object.keys(e).join(","),Error(ge(268,e)));return e=Mg(t),e=e===null?null:e.stateNode,e};vn.flushSync=function(e){return js(e)};vn.hydrate=function(e,t,n){if(!ac(t))throw Error(ge(200));return sc(null,e,t,!0,n)};vn.hydrateRoot=function(e,t,n){if(!$h(e))throw Error(ge(405));var s=n!=null&&n.hydratedSources||null,r=!1,i="",o=mv;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),t=hv(t,null,e,1,n??null,r,!1,i,o),e[wa]=t.current,vi(e),s)for(e=0;e<s.length;e++)n=s[e],r=n._getVersion,r=r(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new nc(t)};vn.render=function(e,t,n){if(!ac(t))throw Error(ge(200));return sc(null,e,t,!1,n)};vn.unmountComponentAtNode=function(e){if(!ac(e))throw Error(ge(40));return e._reactRootContainer?(js(function(){sc(null,null,e,!1,function(){e._reactRootContainer=null,e[wa]=null})}),!0):!1};vn.unstable_batchedUpdates=Ph;vn.unstable_renderSubtreeIntoContainer=function(e,t,n,s){if(!ac(n))throw Error(ge(200));if(e==null||e._reactInternals===void 0)throw Error(ge(38));return sc(e,t,n,!1,s)};vn.version="18.3.1-next-f1338f8080-20240426";function pv(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(pv)}catch(e){console.error(e)}}pv(),pg.exports=vn;var fv=pg.exports,Lp=fv;yu.createRoot=Lp.createRoot,yu.hydrateRoot=Lp.hydrateRoot;/**
 * react-router v7.10.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Op="popstate";function P0(e={}){function t(s,r){let{pathname:i,search:o,hash:l}=s.location;return ud("",{pathname:i,search:o,hash:l},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function n(s,r){return typeof r=="string"?r:Ei(r)}return R0(t,n,null,e)}function ht(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function yn(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function T0(){return Math.random().toString(36).substring(2,10)}function $p(e,t){return{usr:e.state,key:e.key,idx:t}}function ud(e,t,n=null,s){return{pathname:typeof e=="string"?e:e.pathname,search:"",hash:"",...typeof t=="string"?kr(t):t,state:n,key:t&&t.key||s||T0()}}function Ei({pathname:e="/",search:t="",hash:n=""}){return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function kr(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substring(n),e=e.substring(0,n));let s=e.indexOf("?");s>=0&&(t.search=e.substring(s),e=e.substring(0,s)),e&&(t.pathname=e)}return t}function R0(e,t,n,s={}){let{window:r=document.defaultView,v5Compat:i=!1}=s,o=r.history,l="POP",c=null,u=d();u==null&&(u=0,o.replaceState({...o.state,idx:u},""));function d(){return(o.state||{idx:null}).idx}function h(){l="POP";let w=d(),f=w==null?null:w-u;u=w,c&&c({action:l,location:_.location,delta:f})}function m(w,f){l="PUSH";let p=ud(_.location,w,f);u=d()+1;let g=$p(p,u),j=_.createHref(p);try{o.pushState(g,"",j)}catch(A){if(A instanceof DOMException&&A.name==="DataCloneError")throw A;r.location.assign(j)}i&&c&&c({action:l,location:_.location,delta:1})}function y(w,f){l="REPLACE";let p=ud(_.location,w,f);u=d();let g=$p(p,u),j=_.createHref(p);o.replaceState(g,"",j),i&&c&&c({action:l,location:_.location,delta:0})}function b(w){return D0(w)}let _={get action(){return l},get location(){return e(r,o)},listen(w){if(c)throw new Error("A history only accepts one active listener");return r.addEventListener(Op,h),c=w,()=>{r.removeEventListener(Op,h),c=null}},createHref(w){return t(r,w)},createURL:b,encodeLocation(w){let f=b(w);return{pathname:f.pathname,search:f.search,hash:f.hash}},push:m,replace:y,go(w){return o.go(w)}};return _}function D0(e,t=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),ht(n,"No window.location.(origin|href) available to create URL");let s=typeof e=="string"?e:Ei(e);return s=s.replace(/ $/,"%20"),!t&&s.startsWith("//")&&(s=n+s),new URL(s,n)}function gv(e,t,n="/"){return M0(e,t,n,!1)}function M0(e,t,n,s){let r=typeof t=="string"?kr(t):t,i=ja(r.pathname||"/",n);if(i==null)return null;let o=yv(e);L0(o);let l=null;for(let c=0;l==null&&c<o.length;++c){let u=V0(i);l=H0(o[c],u,s)}return l}function yv(e,t=[],n=[],s="",r=!1){let i=(o,l,c=r,u)=>{let d={relativePath:u===void 0?o.path||"":u,caseSensitive:o.caseSensitive===!0,childrenIndex:l,route:o};if(d.relativePath.startsWith("/")){if(!d.relativePath.startsWith(s)&&c)return;ht(d.relativePath.startsWith(s),`Absolute route path "${d.relativePath}" nested under path "${s}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),d.relativePath=d.relativePath.slice(s.length)}let h=va([s,d.relativePath]),m=n.concat(d);o.children&&o.children.length>0&&(ht(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${h}".`),yv(o.children,t,m,h,c)),!(o.path==null&&!o.index)&&t.push({path:h,score:W0(h,o.index),routesMeta:m})};return e.forEach((o,l)=>{var c;if(o.path===""||!((c=o.path)!=null&&c.includes("?")))i(o,l);else for(let u of vv(o.path))i(o,l,!0,u)}),t}function vv(e){let t=e.split("/");if(t.length===0)return[];let[n,...s]=t,r=n.endsWith("?"),i=n.replace(/\?$/,"");if(s.length===0)return r?[i,""]:[i];let o=vv(s.join("/")),l=[];return l.push(...o.map(c=>c===""?i:[i,c].join("/"))),r&&l.push(...o),l.map(c=>e.startsWith("/")&&c===""?"/":c)}function L0(e){e.sort((t,n)=>t.score!==n.score?n.score-t.score:z0(t.routesMeta.map(s=>s.childrenIndex),n.routesMeta.map(s=>s.childrenIndex)))}var O0=/^:[\w-]+$/,$0=3,B0=2,F0=1,q0=10,U0=-2,Bp=e=>e==="*";function W0(e,t){let n=e.split("/"),s=n.length;return n.some(Bp)&&(s+=U0),t&&(s+=B0),n.filter(r=>!Bp(r)).reduce((r,i)=>r+(O0.test(i)?$0:i===""?F0:q0),s)}function z0(e,t){return e.length===t.length&&e.slice(0,-1).every((s,r)=>s===t[r])?e[e.length-1]-t[t.length-1]:0}function H0(e,t,n=!1){let{routesMeta:s}=e,r={},i="/",o=[];for(let l=0;l<s.length;++l){let c=s[l],u=l===s.length-1,d=i==="/"?t:t.slice(i.length)||"/",h=Al({path:c.relativePath,caseSensitive:c.caseSensitive,end:u},d),m=c.route;if(!h&&u&&n&&!s[s.length-1].route.index&&(h=Al({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},d)),!h)return null;Object.assign(r,h.params),o.push({params:r,pathname:va([i,h.pathname]),pathnameBase:X0(va([i,h.pathnameBase])),route:m}),h.pathnameBase!=="/"&&(i=va([i,h.pathnameBase]))}return o}function Al(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[n,s]=Y0(e.path,e.caseSensitive,e.end),r=t.match(n);if(!r)return null;let i=r[0],o=i.replace(/(.)\/+$/,"$1"),l=r.slice(1);return{params:s.reduce((u,{paramName:d,isOptional:h},m)=>{if(d==="*"){let b=l[m]||"";o=i.slice(0,i.length-b.length).replace(/(.)\/+$/,"$1")}const y=l[m];return h&&!y?u[d]=void 0:u[d]=(y||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:o,pattern:e}}function Y0(e,t=!1,n=!0){yn(e==="*"||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let s=[],r="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,c)=>(s.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return e.endsWith("*")?(s.push({paramName:"*"}),r+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":e!==""&&e!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,t?void 0:"i"),s]}function V0(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return yn(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),e}}function ja(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,s=e.charAt(n);return s&&s!=="/"?null:e.slice(n)||"/"}var K0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,G0=e=>K0.test(e);function J0(e,t="/"){let{pathname:n,search:s="",hash:r=""}=typeof e=="string"?kr(e):e,i;if(n)if(G0(n))i=n;else{if(n.includes("//")){let o=n;n=n.replace(/\/\/+/g,"/"),yn(!1,`Pathnames cannot have embedded double slashes - normalizing ${o} -> ${n}`)}n.startsWith("/")?i=Fp(n.substring(1),"/"):i=Fp(n,t)}else i=t;return{pathname:i,search:Z0(s),hash:ew(r)}}function Fp(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(r=>{r===".."?n.length>1&&n.pop():r!=="."&&n.push(r)}),n.length>1?n.join("/"):"/"}function Vc(e,t,n,s){return`Cannot include a '${e}' character in a manually specified \`to.${t}\` field [${JSON.stringify(s)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Q0(e){return e.filter((t,n)=>n===0||t.route.path&&t.route.path.length>0)}function Bh(e){let t=Q0(e);return t.map((n,s)=>s===t.length-1?n.pathname:n.pathnameBase)}function Fh(e,t,n,s=!1){let r;typeof e=="string"?r=kr(e):(r={...e},ht(!r.pathname||!r.pathname.includes("?"),Vc("?","pathname","search",r)),ht(!r.pathname||!r.pathname.includes("#"),Vc("#","pathname","hash",r)),ht(!r.search||!r.search.includes("#"),Vc("#","search","hash",r)));let i=e===""||r.pathname==="",o=i?"/":r.pathname,l;if(o==null)l=n;else{let h=t.length-1;if(!s&&o.startsWith("..")){let m=o.split("/");for(;m[0]==="..";)m.shift(),h-=1;r.pathname=m.join("/")}l=h>=0?t[h]:"/"}let c=J0(r,l),u=o&&o!=="/"&&o.endsWith("/"),d=(i||o===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(u||d)&&(c.pathname+="/"),c}var va=e=>e.join("/").replace(/\/\/+/g,"/"),X0=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),Z0=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,ew=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function tw(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}function nw(e){return e.map(t=>t.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var bv=["POST","PUT","PATCH","DELETE"];new Set(bv);var aw=["GET",...bv];new Set(aw);var Nr=T.createContext(null);Nr.displayName="DataRouter";var rc=T.createContext(null);rc.displayName="DataRouterState";T.createContext(!1);var _v=T.createContext({isTransitioning:!1});_v.displayName="ViewTransition";var sw=T.createContext(new Map);sw.displayName="Fetchers";var rw=T.createContext(null);rw.displayName="Await";var In=T.createContext(null);In.displayName="Navigation";var Bi=T.createContext(null);Bi.displayName="Location";var Pn=T.createContext({outlet:null,matches:[],isDataRoute:!1});Pn.displayName="Route";var qh=T.createContext(null);qh.displayName="RouteError";function iw(e,{relative:t}={}){ht(jr(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:s}=T.useContext(In),{hash:r,pathname:i,search:o}=Fi(e,{relative:t}),l=i;return n!=="/"&&(l=i==="/"?n:va([n,i])),s.createHref({pathname:l,search:o,hash:r})}function jr(){return T.useContext(Bi)!=null}function sa(){return ht(jr(),"useLocation() may be used only in the context of a <Router> component."),T.useContext(Bi).location}var xv="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function wv(e){T.useContext(In).static||T.useLayoutEffect(e)}function Ea(){let{isDataRoute:e}=T.useContext(Pn);return e?xw():ow()}function ow(){ht(jr(),"useNavigate() may be used only in the context of a <Router> component.");let e=T.useContext(Nr),{basename:t,navigator:n}=T.useContext(In),{matches:s}=T.useContext(Pn),{pathname:r}=sa(),i=JSON.stringify(Bh(s)),o=T.useRef(!1);return wv(()=>{o.current=!0}),T.useCallback((c,u={})=>{if(yn(o.current,xv),!o.current)return;if(typeof c=="number"){n.go(c);return}let d=Fh(c,JSON.parse(i),r,u.relative==="path");e==null&&t!=="/"&&(d.pathname=d.pathname==="/"?t:va([t,d.pathname])),(u.replace?n.replace:n.push)(d,u.state,u)},[t,n,i,r,e])}var lw=T.createContext(null);function cw(e){let t=T.useContext(Pn).outlet;return T.useMemo(()=>t&&T.createElement(lw.Provider,{value:e},t),[t,e])}function Tn(){let{matches:e}=T.useContext(Pn),t=e[e.length-1];return t?t.params:{}}function Fi(e,{relative:t}={}){let{matches:n}=T.useContext(Pn),{pathname:s}=sa(),r=JSON.stringify(Bh(n));return T.useMemo(()=>Fh(e,JSON.parse(r),s,t==="path"),[e,r,s,t])}function uw(e,t){return kv(e,t)}function kv(e,t,n,s,r){var p;ht(jr(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=T.useContext(In),{matches:o}=T.useContext(Pn),l=o[o.length-1],c=l?l.params:{},u=l?l.pathname:"/",d=l?l.pathnameBase:"/",h=l&&l.route;{let g=h&&h.path||"";Nv(u,!h||g.endsWith("*")||g.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${g}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${g}"> to <Route path="${g==="/"?"*":`${g}/*`}">.`)}let m=sa(),y;if(t){let g=typeof t=="string"?kr(t):t;ht(d==="/"||((p=g.pathname)==null?void 0:p.startsWith(d)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${d}" but pathname "${g.pathname}" was given in the \`location\` prop.`),y=g}else y=m;let b=y.pathname||"/",_=b;if(d!=="/"){let g=d.replace(/^\//,"").split("/");_="/"+b.replace(/^\//,"").split("/").slice(g.length).join("/")}let w=gv(e,{pathname:_});yn(h||w!=null,`No routes matched location "${y.pathname}${y.search}${y.hash}" `),yn(w==null||w[w.length-1].route.element!==void 0||w[w.length-1].route.Component!==void 0||w[w.length-1].route.lazy!==void 0,`Matched leaf route at location "${y.pathname}${y.search}${y.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let f=fw(w&&w.map(g=>Object.assign({},g,{params:Object.assign({},c,g.params),pathname:va([d,i.encodeLocation?i.encodeLocation(g.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:g.pathname]),pathnameBase:g.pathnameBase==="/"?d:va([d,i.encodeLocation?i.encodeLocation(g.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:g.pathnameBase])})),o,n,s,r);return t&&f?T.createElement(Bi.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...y},navigationType:"POP"}},f):f}function dw(){let e=_w(),t=tw(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,s="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:s},i={padding:"2px 4px",backgroundColor:s},o=null;return console.error("Error handled by React Router default ErrorBoundary:",e),o=T.createElement(T.Fragment,null,T.createElement("p",null," Hey developer "),T.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",T.createElement("code",{style:i},"ErrorBoundary")," or"," ",T.createElement("code",{style:i},"errorElement")," prop on your route.")),T.createElement(T.Fragment,null,T.createElement("h2",null,"Unexpected Application Error!"),T.createElement("h3",{style:{fontStyle:"italic"}},t),n?T.createElement("pre",{style:r},n):null,o)}var hw=T.createElement(dw,null),mw=class extends T.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){this.props.onError?this.props.onError(e,t):console.error("React Router caught the following error during render",e)}render(){return this.state.error!==void 0?T.createElement(Pn.Provider,{value:this.props.routeContext},T.createElement(qh.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function pw({routeContext:e,match:t,children:n}){let s=T.useContext(Nr);return s&&s.static&&s.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=t.route.id),T.createElement(Pn.Provider,{value:e},n)}function fw(e,t=[],n=null,s=null,r=null){if(e==null){if(!n)return null;if(n.errors)e=n.matches;else if(t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let i=e,o=n==null?void 0:n.errors;if(o!=null){let d=i.findIndex(h=>h.route.id&&(o==null?void 0:o[h.route.id])!==void 0);ht(d>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),i=i.slice(0,Math.min(i.length,d+1))}let l=!1,c=-1;if(n)for(let d=0;d<i.length;d++){let h=i[d];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(c=d),h.route.id){let{loaderData:m,errors:y}=n,b=h.route.loader&&!m.hasOwnProperty(h.route.id)&&(!y||y[h.route.id]===void 0);if(h.route.lazy||b){l=!0,c>=0?i=i.slice(0,c+1):i=[i[0]];break}}}let u=n&&s?(d,h)=>{var m,y;s(d,{location:n.location,params:((y=(m=n.matches)==null?void 0:m[0])==null?void 0:y.params)??{},unstable_pattern:nw(n.matches),errorInfo:h})}:void 0;return i.reduceRight((d,h,m)=>{let y,b=!1,_=null,w=null;n&&(y=o&&h.route.id?o[h.route.id]:void 0,_=h.route.errorElement||hw,l&&(c<0&&m===0?(Nv("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),b=!0,w=null):c===m&&(b=!0,w=h.route.hydrateFallbackElement||null)));let f=t.concat(i.slice(0,m+1)),p=()=>{let g;return y?g=_:b?g=w:h.route.Component?g=T.createElement(h.route.Component,null):h.route.element?g=h.route.element:g=d,T.createElement(pw,{match:h,routeContext:{outlet:d,matches:f,isDataRoute:n!=null},children:g})};return n&&(h.route.ErrorBoundary||h.route.errorElement||m===0)?T.createElement(mw,{location:n.location,revalidation:n.revalidation,component:_,error:y,children:p(),routeContext:{outlet:null,matches:f,isDataRoute:!0},onError:u}):p()},null)}function Uh(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function gw(e){let t=T.useContext(Nr);return ht(t,Uh(e)),t}function yw(e){let t=T.useContext(rc);return ht(t,Uh(e)),t}function vw(e){let t=T.useContext(Pn);return ht(t,Uh(e)),t}function Wh(e){let t=vw(e),n=t.matches[t.matches.length-1];return ht(n.route.id,`${e} can only be used on routes that contain a unique "id"`),n.route.id}function bw(){return Wh("useRouteId")}function _w(){var s;let e=T.useContext(qh),t=yw("useRouteError"),n=Wh("useRouteError");return e!==void 0?e:(s=t.errors)==null?void 0:s[n]}function xw(){let{router:e}=gw("useNavigate"),t=Wh("useNavigate"),n=T.useRef(!1);return wv(()=>{n.current=!0}),T.useCallback(async(r,i={})=>{yn(n.current,xv),n.current&&(typeof r=="number"?await e.navigate(r):await e.navigate(r,{fromRouteId:t,...i}))},[e,t])}var qp={};function Nv(e,t,n){!t&&!qp[e]&&(qp[e]=!0,yn(!1,n))}T.memo(ww);function ww({routes:e,future:t,state:n,unstable_onError:s}){return kv(e,void 0,n,s,t)}function dd({to:e,replace:t,state:n,relative:s}){ht(jr(),"<Navigate> may be used only in the context of a <Router> component.");let{static:r}=T.useContext(In);yn(!r,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:i}=T.useContext(Pn),{pathname:o}=sa(),l=Ea(),c=Fh(e,Bh(i),o,s==="path"),u=JSON.stringify(c);return T.useEffect(()=>{l(JSON.parse(u),{replace:t,state:n,relative:s})},[l,u,s,t,n]),null}function jv(e){return cw(e.context)}function Xe(e){ht(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function kw({basename:e="/",children:t=null,location:n,navigationType:s="POP",navigator:r,static:i=!1,unstable_useTransitions:o}){ht(!jr(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let l=e.replace(/^\/*/,"/"),c=T.useMemo(()=>({basename:l,navigator:r,static:i,unstable_useTransitions:o,future:{}}),[l,r,i,o]);typeof n=="string"&&(n=kr(n));let{pathname:u="/",search:d="",hash:h="",state:m=null,key:y="default"}=n,b=T.useMemo(()=>{let _=ja(u,l);return _==null?null:{location:{pathname:_,search:d,hash:h,state:m,key:y},navigationType:s}},[l,u,d,h,m,y,s]);return yn(b!=null,`<Router basename="${l}"> is not able to match the URL "${u}${d}${h}" because it does not start with the basename, so the <Router> won't render anything.`),b==null?null:T.createElement(In.Provider,{value:c},T.createElement(Bi.Provider,{children:t,value:b}))}function zh({children:e,location:t}){return uw(hd(e),t)}function hd(e,t=[]){let n=[];return T.Children.forEach(e,(s,r)=>{if(!T.isValidElement(s))return;let i=[...t,r];if(s.type===T.Fragment){n.push.apply(n,hd(s.props.children,i));return}ht(s.type===Xe,`[${typeof s.type=="string"?s.type:s.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ht(!s.props.index||!s.props.children,"An index route cannot have child routes.");let o={id:s.props.id||i.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,middleware:s.props.middleware,loader:s.props.loader,action:s.props.action,hydrateFallbackElement:s.props.hydrateFallbackElement,HydrateFallback:s.props.HydrateFallback,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.hasErrorBoundary===!0||s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(o.children=hd(s.props.children,i)),n.push(o)}),n}var el="get",tl="application/x-www-form-urlencoded";function ic(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement}function Nw(e){return ic(e)&&e.tagName.toLowerCase()==="button"}function jw(e){return ic(e)&&e.tagName.toLowerCase()==="form"}function Sw(e){return ic(e)&&e.tagName.toLowerCase()==="input"}function Ew(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Cw(e,t){return e.button===0&&(!t||t==="_self")&&!Ew(e)}function md(e=""){return new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,n)=>{let s=e[n];return t.concat(Array.isArray(s)?s.map(r=>[n,r]):[[n,s]])},[]))}function Aw(e,t){let n=md(e);return t&&t.forEach((s,r)=>{n.has(r)||t.getAll(r).forEach(i=>{n.append(r,i)})}),n}var ko=null;function Iw(){if(ko===null)try{new FormData(document.createElement("form"),0),ko=!1}catch{ko=!0}return ko}var Pw=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Kc(e){return e!=null&&!Pw.has(e)?(yn(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${tl}"`),null):e}function Tw(e,t){let n,s,r,i,o;if(jw(e)){let l=e.getAttribute("action");s=l?ja(l,t):null,n=e.getAttribute("method")||el,r=Kc(e.getAttribute("enctype"))||tl,i=new FormData(e)}else if(Nw(e)||Sw(e)&&(e.type==="submit"||e.type==="image")){let l=e.form;if(l==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let c=e.getAttribute("formaction")||l.getAttribute("action");if(s=c?ja(c,t):null,n=e.getAttribute("formmethod")||l.getAttribute("method")||el,r=Kc(e.getAttribute("formenctype"))||Kc(l.getAttribute("enctype"))||tl,i=new FormData(l,e),!Iw()){let{name:u,type:d,value:h}=e;if(d==="image"){let m=u?`${u}.`:"";i.append(`${m}x`,"0"),i.append(`${m}y`,"0")}else u&&i.append(u,h)}}else{if(ic(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=el,s=null,r=tl,o=e}return i&&r==="text/plain"&&(o=i,i=void 0),{action:s,method:n.toLowerCase(),encType:r,formData:i,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Hh(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Rw(e,t,n){let s=typeof e=="string"?new URL(e,typeof window>"u"?"server://singlefetch/":window.location.origin):e;return s.pathname==="/"?s.pathname=`_root.${n}`:t&&ja(s.pathname,t)==="/"?s.pathname=`${t.replace(/\/$/,"")}/_root.${n}`:s.pathname=`${s.pathname.replace(/\/$/,"")}.${n}`,s}async function Dw(e,t){if(e.id in t)return t[e.id];try{let n=await import(e.module);return t[e.id]=n,n}catch(n){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Mw(e){return e==null?!1:e.href==null?e.rel==="preload"&&typeof e.imageSrcSet=="string"&&typeof e.imageSizes=="string":typeof e.rel=="string"&&typeof e.href=="string"}async function Lw(e,t,n){let s=await Promise.all(e.map(async r=>{let i=t.routes[r.route.id];if(i){let o=await Dw(i,n);return o.links?o.links():[]}return[]}));return Fw(s.flat(1).filter(Mw).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function Up(e,t,n,s,r,i){let o=(c,u)=>n[u]?c.route.id!==n[u].route.id:!0,l=(c,u)=>{var d;return n[u].pathname!==c.pathname||((d=n[u].route.path)==null?void 0:d.endsWith("*"))&&n[u].params["*"]!==c.params["*"]};return i==="assets"?t.filter((c,u)=>o(c,u)||l(c,u)):i==="data"?t.filter((c,u)=>{var h;let d=s.routes[c.route.id];if(!d||!d.hasLoader)return!1;if(o(c,u)||l(c,u))return!0;if(c.route.shouldRevalidate){let m=c.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:((h=n[0])==null?void 0:h.params)||{},nextUrl:new URL(e,window.origin),nextParams:c.params,defaultShouldRevalidate:!0});if(typeof m=="boolean")return m}return!0}):[]}function Ow(e,t,{includeHydrateFallback:n}={}){return $w(e.map(s=>{let r=t.routes[s.route.id];if(!r)return[];let i=[r.module];return r.clientActionModule&&(i=i.concat(r.clientActionModule)),r.clientLoaderModule&&(i=i.concat(r.clientLoaderModule)),n&&r.hydrateFallbackModule&&(i=i.concat(r.hydrateFallbackModule)),r.imports&&(i=i.concat(r.imports)),i}).flat(1))}function $w(e){return[...new Set(e)]}function Bw(e){let t={},n=Object.keys(e).sort();for(let s of n)t[s]=e[s];return t}function Fw(e,t){let n=new Set;return new Set(t),e.reduce((s,r)=>{let i=JSON.stringify(Bw(r));return n.has(i)||(n.add(i),s.push({key:i,link:r})),s},[])}function Sv(){let e=T.useContext(Nr);return Hh(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function qw(){let e=T.useContext(rc);return Hh(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var Yh=T.createContext(void 0);Yh.displayName="FrameworkContext";function Ev(){let e=T.useContext(Yh);return Hh(e,"You must render this element inside a <HydratedRouter> element"),e}function Uw(e,t){let n=T.useContext(Yh),[s,r]=T.useState(!1),[i,o]=T.useState(!1),{onFocus:l,onBlur:c,onMouseEnter:u,onMouseLeave:d,onTouchStart:h}=t,m=T.useRef(null);T.useEffect(()=>{if(e==="render"&&o(!0),e==="viewport"){let _=f=>{f.forEach(p=>{o(p.isIntersecting)})},w=new IntersectionObserver(_,{threshold:.5});return m.current&&w.observe(m.current),()=>{w.disconnect()}}},[e]),T.useEffect(()=>{if(s){let _=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(_)}}},[s]);let y=()=>{r(!0)},b=()=>{r(!1),o(!1)};return n?e!=="intent"?[i,m,{}]:[i,m,{onFocus:Or(l,y),onBlur:Or(c,b),onMouseEnter:Or(u,y),onMouseLeave:Or(d,b),onTouchStart:Or(h,y)}]:[!1,m,{}]}function Or(e,t){return n=>{e&&e(n),n.defaultPrevented||t(n)}}function Ww({page:e,...t}){let{router:n}=Sv(),s=T.useMemo(()=>gv(n.routes,e,n.basename),[n.routes,e,n.basename]);return s?T.createElement(Hw,{page:e,matches:s,...t}):null}function zw(e){let{manifest:t,routeModules:n}=Ev(),[s,r]=T.useState([]);return T.useEffect(()=>{let i=!1;return Lw(e,t,n).then(o=>{i||r(o)}),()=>{i=!0}},[e,t,n]),s}function Hw({page:e,matches:t,...n}){let s=sa(),{manifest:r,routeModules:i}=Ev(),{basename:o}=Sv(),{loaderData:l,matches:c}=qw(),u=T.useMemo(()=>Up(e,t,c,r,s,"data"),[e,t,c,r,s]),d=T.useMemo(()=>Up(e,t,c,r,s,"assets"),[e,t,c,r,s]),h=T.useMemo(()=>{if(e===s.pathname+s.search+s.hash)return[];let b=new Set,_=!1;if(t.forEach(f=>{var g;let p=r.routes[f.route.id];!p||!p.hasLoader||(!u.some(j=>j.route.id===f.route.id)&&f.route.id in l&&((g=i[f.route.id])!=null&&g.shouldRevalidate)||p.hasClientLoader?_=!0:b.add(f.route.id))}),b.size===0)return[];let w=Rw(e,o,"data");return _&&b.size>0&&w.searchParams.set("_routes",t.filter(f=>b.has(f.route.id)).map(f=>f.route.id).join(",")),[w.pathname+w.search]},[o,l,s,r,u,t,e,i]),m=T.useMemo(()=>Ow(d,r),[d,r]),y=zw(d);return T.createElement(T.Fragment,null,h.map(b=>T.createElement("link",{key:b,rel:"prefetch",as:"fetch",href:b,...n})),m.map(b=>T.createElement("link",{key:b,rel:"modulepreload",href:b,...n})),y.map(({key:b,link:_})=>T.createElement("link",{key:b,nonce:n.nonce,..._})))}function Yw(...e){return t=>{e.forEach(n=>{typeof n=="function"?n(t):n!=null&&(n.current=t)})}}var Cv=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Cv&&(window.__reactRouterVersion="7.10.1")}catch{}function Vw({basename:e,children:t,unstable_useTransitions:n,window:s}){let r=T.useRef();r.current==null&&(r.current=P0({window:s,v5Compat:!0}));let i=r.current,[o,l]=T.useState({action:i.action,location:i.location}),c=T.useCallback(u=>{n===!1?l(u):T.startTransition(()=>l(u))},[n]);return T.useLayoutEffect(()=>i.listen(c),[i,c]),T.createElement(kw,{basename:e,children:t,location:o.location,navigationType:o.action,navigator:i,unstable_useTransitions:n===!0})}var Av=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Vh=T.forwardRef(function({onClick:t,discover:n="render",prefetch:s="none",relative:r,reloadDocument:i,replace:o,state:l,target:c,to:u,preventScrollReset:d,viewTransition:h,...m},y){let{basename:b,unstable_useTransitions:_}=T.useContext(In),w=typeof u=="string"&&Av.test(u),f,p=!1;if(typeof u=="string"&&w&&(f=u,Cv))try{let E=new URL(window.location.href),M=u.startsWith("//")?new URL(E.protocol+u):new URL(u),O=ja(M.pathname,b);M.origin===E.origin&&O!=null?u=O+M.search+M.hash:p=!0}catch{yn(!1,`<Link to="${u}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let g=iw(u,{relative:r}),[j,A,R]=Uw(s,m),S=Jw(u,{replace:o,state:l,target:c,preventScrollReset:d,relative:r,viewTransition:h,unstable_useTransitions:_});function k(E){t&&t(E),E.defaultPrevented||S(E)}let N=T.createElement("a",{...m,...R,href:f||g,onClick:p||i?t:k,ref:Yw(y,A),target:c,"data-discover":!w&&n==="render"?"true":void 0});return j&&!w?T.createElement(T.Fragment,null,N,T.createElement(Ww,{page:g})):N});Vh.displayName="Link";var bt=T.forwardRef(function({"aria-current":t="page",caseSensitive:n=!1,className:s="",end:r=!1,style:i,to:o,viewTransition:l,children:c,...u},d){let h=Fi(o,{relative:u.relative}),m=sa(),y=T.useContext(rc),{navigator:b,basename:_}=T.useContext(In),w=y!=null&&tk(h)&&l===!0,f=b.encodeLocation?b.encodeLocation(h).pathname:h.pathname,p=m.pathname,g=y&&y.navigation&&y.navigation.location?y.navigation.location.pathname:null;n||(p=p.toLowerCase(),g=g?g.toLowerCase():null,f=f.toLowerCase()),g&&_&&(g=ja(g,_)||g);const j=f!=="/"&&f.endsWith("/")?f.length-1:f.length;let A=p===f||!r&&p.startsWith(f)&&p.charAt(j)==="/",R=g!=null&&(g===f||!r&&g.startsWith(f)&&g.charAt(f.length)==="/"),S={isActive:A,isPending:R,isTransitioning:w},k=A?t:void 0,N;typeof s=="function"?N=s(S):N=[s,A?"active":null,R?"pending":null,w?"transitioning":null].filter(Boolean).join(" ");let E=typeof i=="function"?i(S):i;return T.createElement(Vh,{...u,"aria-current":k,className:N,ref:d,style:E,to:o,viewTransition:l},typeof c=="function"?c(S):c)});bt.displayName="NavLink";var Kw=T.forwardRef(({discover:e="render",fetcherKey:t,navigate:n,reloadDocument:s,replace:r,state:i,method:o=el,action:l,onSubmit:c,relative:u,preventScrollReset:d,viewTransition:h,...m},y)=>{let{unstable_useTransitions:b}=T.useContext(In),_=Zw(),w=ek(l,{relative:u}),f=o.toLowerCase()==="get"?"get":"post",p=typeof l=="string"&&Av.test(l),g=j=>{if(c&&c(j),j.defaultPrevented)return;j.preventDefault();let A=j.nativeEvent.submitter,R=(A==null?void 0:A.getAttribute("formmethod"))||o,S=()=>_(A||j.currentTarget,{fetcherKey:t,method:R,navigate:n,replace:r,state:i,relative:u,preventScrollReset:d,viewTransition:h});b&&n!==!1?T.startTransition(()=>S()):S()};return T.createElement("form",{ref:y,method:f,action:w,onSubmit:s?c:g,...m,"data-discover":!p&&e==="render"?"true":void 0})});Kw.displayName="Form";function Gw(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Iv(e){let t=T.useContext(Nr);return ht(t,Gw(e)),t}function Jw(e,{target:t,replace:n,state:s,preventScrollReset:r,relative:i,viewTransition:o,unstable_useTransitions:l}={}){let c=Ea(),u=sa(),d=Fi(e,{relative:i});return T.useCallback(h=>{if(Cw(h,t)){h.preventDefault();let m=n!==void 0?n:Ei(u)===Ei(d),y=()=>c(e,{replace:m,state:s,preventScrollReset:r,relative:i,viewTransition:o});l?T.startTransition(()=>y()):y()}},[u,c,d,n,s,t,e,r,i,o,l])}function Kh(e){yn(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let t=T.useRef(md(e)),n=T.useRef(!1),s=sa(),r=T.useMemo(()=>Aw(s.search,n.current?null:t.current),[s.search]),i=Ea(),o=T.useCallback((l,c)=>{const u=md(typeof l=="function"?l(new URLSearchParams(r)):l);n.current=!0,i("?"+u,c)},[i,r]);return[r,o]}var Qw=0,Xw=()=>`__${String(++Qw)}__`;function Zw(){let{router:e}=Iv("useSubmit"),{basename:t}=T.useContext(In),n=bw(),s=e.fetch,r=e.navigate;return T.useCallback(async(i,o={})=>{let{action:l,method:c,encType:u,formData:d,body:h}=Tw(i,t);if(o.navigate===!1){let m=o.fetcherKey||Xw();await s(m,n,o.action||l,{preventScrollReset:o.preventScrollReset,formData:d,body:h,formMethod:o.method||c,formEncType:o.encType||u,flushSync:o.flushSync})}else await r(o.action||l,{preventScrollReset:o.preventScrollReset,formData:d,body:h,formMethod:o.method||c,formEncType:o.encType||u,replace:o.replace,state:o.state,fromRouteId:n,flushSync:o.flushSync,viewTransition:o.viewTransition})},[s,r,t,n])}function ek(e,{relative:t}={}){let{basename:n}=T.useContext(In),s=T.useContext(Pn);ht(s,"useFormAction must be used inside a RouteContext");let[r]=s.matches.slice(-1),i={...Fi(e||".",{relative:t})},o=sa();if(e==null){i.search=o.search;let l=new URLSearchParams(i.search),c=l.getAll("index");if(c.some(d=>d==="")){l.delete("index"),c.filter(h=>h).forEach(h=>l.append("index",h));let d=l.toString();i.search=d?`?${d}`:""}}return(!e||e===".")&&r.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(i.pathname=i.pathname==="/"?n:va([n,i.pathname])),Ei(i)}function tk(e,{relative:t}={}){let n=T.useContext(_v);ht(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=Iv("useViewTransitionState"),r=Fi(e,{relative:t});if(!n.isTransitioning)return!1;let i=ja(n.currentLocation.pathname,s)||n.currentLocation.pathname,o=ja(n.nextLocation.pathname,s)||n.nextLocation.pathname;return Al(r.pathname,o)!=null||Al(r.pathname,i)!=null}function Xt(e,t){switch(e.type){case"number":case"bool":case"string":return e.value;case"ref":return nk(t.state,e.path);case"op":{const n=Wp(Xt(e.left,t)),s=Wp(Xt(e.right,t));switch(e.op){case"add":return n+s;case"sub":return n-s;case"mul":return n*s;case"div":return s===0?0:n/s;case"max":return Math.max(n,s);case"min":return Math.min(n,s)}return 0}case"cmp":{const n=Xt(e.left,t),s=Xt(e.right,t);switch(e.op){case">":return n>s;case"<":return n<s;case">=":return n>=s;case"<=":return n<=s;case"==":return n===s;case"!=":return n!==s}return!1}case"bool-op":{if(e.op==="not")return!(e.args[0]?No(Xt(e.args[0],t)):!1);if(e.op==="and"){for(const n of e.args)if(!No(Xt(n,t)))return!1;return!0}if(e.op==="or"){for(const n of e.args)if(No(Xt(n,t)))return!0;return!1}return!1}case"hasTag":return(t.tags||[]).includes(e.tag);case"if":{const n=No(Xt(e.condition,t));return Xt(n?e.then:e.else,t)}}}function nk(e,t){const n=t.split(".");let s=e;for(const r of n){if(s==null)return;s=s[r]}return s}function Wp(e){if(typeof e=="number")return e;if(typeof e=="string"){const t=Number(e);return Number.isFinite(t)?t:0}return typeof e=="boolean"&&e?1:0}function No(e){return typeof e=="boolean"?e:typeof e=="number"?e!==0:typeof e=="string"?e.length>0:!1}function Pv(e){const{baseState:t,modifiers:n,tags:s}=e,r={state:structuredClone(t),tags:s},i=[];for(const c of n){if(!c.conditionExpression){i.push(c);continue}Xt(c.conditionExpression,r)&&i.push(c)}const o=new Map;for(const c of i){const u=`${c.targetPath}::${c.stackingKey??""}`,d=o.get(u)??[];d.push(c),o.set(u,d)}const l=[];for(const[,c]of o){if(!c[0].stackingKey){l.push(...c);continue}let u,d=-1/0;for(const h of c){const m=Xt(h.valueExpression,r),y=typeof m=="number"?m:0,b=h.priority??0,_=y+b*.001;(!u||_>d)&&(u=h,d=_)}u&&l.push(u)}for(const c of l){const u=Xt(c.valueExpression,r);ak(r.state,c.targetPath,c.operation,u)}return r.state}function ak(e,t,n,s){const r=t.split("."),i=r.pop();if(!i)return;let o=e;for(const u of r)(o[u]==null||typeof o[u]!="object")&&(o[u]={}),o=o[u];const l=o[i],c=typeof s=="number"?s:0;switch(n){case"add":o[i]=jo(l)+c;break;case"mul":o[i]=jo(l)*c;break;case"set":o[i]=c;break;case"max":o[i]=Math.max(jo(l),c);break;case"min":o[i]=Math.min(jo(l),c);break}}function jo(e){if(typeof e=="number")return e;if(typeof e=="string"){const t=Number(e);return Number.isFinite(t)?t:0}return typeof e=="boolean"&&e?1:0}function oc(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(n[s[r]]=e[s[r]]);return n}function sk(e,t,n,s){function r(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function l(d){try{u(s.next(d))}catch(h){o(h)}}function c(d){try{u(s.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):r(d.value).then(l,c)}u((s=s.apply(e,t||[])).next())})}const rk=e=>e?(...t)=>e(...t):(...t)=>fetch(...t);class Gh extends Error{constructor(t,n="FunctionsError",s){super(t),this.name=n,this.context=s}}class ik extends Gh{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class zp extends Gh{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class Hp extends Gh{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var pd;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(pd||(pd={}));class ok{constructor(t,{headers:n={},customFetch:s,region:r=pd.Any}={}){this.url=t,this.headers=n,this.region=r,this.fetch=rk(s)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return sk(this,arguments,void 0,function*(n,s={}){var r;let i,o;try{const{headers:l,method:c,body:u,signal:d,timeout:h}=s;let m={},{region:y}=s;y||(y=this.region);const b=new URL(`${this.url}/${n}`);y&&y!=="any"&&(m["x-region"]=y,b.searchParams.set("forceFunctionRegion",y));let _;u&&(l&&!Object.prototype.hasOwnProperty.call(l,"Content-Type")||!l)?typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(m["Content-Type"]="application/octet-stream",_=u):typeof u=="string"?(m["Content-Type"]="text/plain",_=u):typeof FormData<"u"&&u instanceof FormData?_=u:(m["Content-Type"]="application/json",_=JSON.stringify(u)):_=u;let w=d;h&&(o=new AbortController,i=setTimeout(()=>o.abort(),h),d?(w=o.signal,d.addEventListener("abort",()=>o.abort())):w=o.signal);const f=yield this.fetch(b.toString(),{method:c||"POST",headers:Object.assign(Object.assign(Object.assign({},m),this.headers),l),body:_,signal:w}).catch(A=>{throw new ik(A)}),p=f.headers.get("x-relay-error");if(p&&p==="true")throw new zp(f);if(!f.ok)throw new Hp(f);let g=((r=f.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),j;return g==="application/json"?j=yield f.json():g==="application/octet-stream"||g==="application/pdf"?j=yield f.blob():g==="text/event-stream"?j=f:g==="multipart/form-data"?j=yield f.formData():j=yield f.text(),{data:j,error:null,response:f}}catch(l){return{data:null,error:l,response:l instanceof Hp||l instanceof zp?l.context:void 0}}finally{i&&clearTimeout(i)}})}}var lk=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}},ck=class{constructor(e){var t,n;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(n=e.isMaybeSingle)!==null&&n!==void 0?n:!1,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){var n=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const s=this.fetch;let r=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{let o=null,l=null,c=null,u=i.status,d=i.statusText;if(i.ok){var h,m;if(n.method!=="HEAD"){var y;const f=await i.text();f===""||(n.headers.get("Accept")==="text/csv"||n.headers.get("Accept")&&(!((y=n.headers.get("Accept"))===null||y===void 0)&&y.includes("application/vnd.pgrst.plan+text"))?l=f:l=JSON.parse(f))}const _=(h=n.headers.get("Prefer"))===null||h===void 0?void 0:h.match(/count=(exact|planned|estimated)/),w=(m=i.headers.get("content-range"))===null||m===void 0?void 0:m.split("/");_&&w&&w.length>1&&(c=parseInt(w[1])),n.isMaybeSingle&&n.method==="GET"&&Array.isArray(l)&&(l.length>1?(o={code:"PGRST116",details:`Results contain ${l.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},l=null,c=null,u=406,d="Not Acceptable"):l.length===1?l=l[0]:l=null)}else{var b;const _=await i.text();try{o=JSON.parse(_),Array.isArray(o)&&i.status===404&&(l=[],o=null,u=200,d="OK")}catch{i.status===404&&_===""?(u=204,d="No Content"):o={message:_}}if(o&&n.isMaybeSingle&&(!(o==null||(b=o.details)===null||b===void 0)&&b.includes("0 rows"))&&(o=null,u=200,d="OK"),o&&n.shouldThrowOnError)throw new lk(o)}return{error:o,data:l,count:c,status:u,statusText:d}});return this.shouldThrowOnError||(r=r.catch(i=>{var o;let l="";const c=i==null?void 0:i.cause;if(c){var u,d,h,m;const b=(u=c==null?void 0:c.message)!==null&&u!==void 0?u:"",_=(d=c==null?void 0:c.code)!==null&&d!==void 0?d:"";l=`${(h=i==null?void 0:i.name)!==null&&h!==void 0?h:"FetchError"}: ${i==null?void 0:i.message}`,l+=`

Caused by: ${(m=c==null?void 0:c.name)!==null&&m!==void 0?m:"Error"}: ${b}`,_&&(l+=` (${_})`),c!=null&&c.stack&&(l+=`
${c.stack}`)}else{var y;l=(y=i==null?void 0:i.stack)!==null&&y!==void 0?y:""}return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:l,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),r.then(e,t)}returns(){return this}overrideTypes(){return this}},uk=class extends ck{select(e){let t=!1;const n=(e??"*").split("").map(s=>/\s/.test(s)&&!t?"":(s==='"'&&(t=!t),s)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:n,foreignTable:s,referencedTable:r=s}={}){const i=r?`${r}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:n=t}={}){const s=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:n,referencedTable:s=n}={}){const r=typeof s>"u"?"offset":`${s}.offset`,i=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this.url.searchParams.set(i,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:n=!1,buffers:s=!1,wal:r=!1,format:i="text"}={}){var o;const l=[e?"analyze":null,t?"verbose":null,n?"settings":null,s?"buffers":null,r?"wal":null].filter(Boolean).join("|"),c=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${c}"; options=${l};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};const Yp=new RegExp("[,()]");var Ws=class extends uk{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}regexMatch(e,t){return this.url.searchParams.append(e,`match.${t}`),this}regexIMatch(e,t){return this.url.searchParams.append(e,`imatch.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}isDistinct(e,t){return this.url.searchParams.append(e,`isdistinct.${t}`),this}in(e,t){const n=Array.from(new Set(t)).map(s=>typeof s=="string"&&Yp.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${n})`),this}notIn(e,t){const n=Array.from(new Set(t)).map(s=>typeof s=="string"&&Yp.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`not.in.(${n})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:n,type:s}={}){let r="";s==="plain"?r="pl":s==="phrase"?r="ph":s==="websearch"&&(r="w");const i=n===void 0?"":`(${n})`;return this.url.searchParams.append(e,`${r}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([t,n])=>{this.url.searchParams.append(t,`eq.${n}`)}),this}not(e,t,n){return this.url.searchParams.append(e,`not.${t}.${n}`),this}or(e,{foreignTable:t,referencedTable:n=t}={}){const s=n?`${n}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,n){return this.url.searchParams.append(e,`${t}.${n}`),this}},dk=class{constructor(e,{headers:t={},schema:n,fetch:s}){this.url=e,this.headers=new Headers(t),this.schema=n,this.fetch=s}select(e,t){const{head:n=!1,count:s}=t??{},r=n?"HEAD":"GET";let i=!1;const o=(e??"*").split("").map(l=>/\s/.test(l)&&!i?"":(l==='"'&&(i=!i),l)).join("");return this.url.searchParams.set("select",o),s&&this.headers.append("Prefer",`count=${s}`),new Ws({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:n=!0}={}){var s;const r="POST";if(t&&this.headers.append("Prefer",`count=${t}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const i=e.reduce((o,l)=>o.concat(Object.keys(l)),[]);if(i.length>0){const o=[...new Set(i)].map(l=>`"${l}"`);this.url.searchParams.set("columns",o.join(","))}}return new Ws({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:n=!1,count:s,defaultToNull:r=!0}={}){var i;const o="POST";if(this.headers.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),s&&this.headers.append("Prefer",`count=${s}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const l=e.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(l.length>0){const c=[...new Set(l)].map(u=>`"${u}"`);this.url.searchParams.set("columns",c.join(","))}}return new Ws({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}update(e,{count:t}={}){var n;const s="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new Ws({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}delete({count:e}={}){var t;const n="DELETE";return e&&this.headers.append("Prefer",`count=${e}`),new Ws({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}},hk=class Tv{constructor(t,{headers:n={},schema:s,fetch:r}={}){this.url=t,this.headers=new Headers(n),this.schemaName=s,this.fetch=r}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new dk(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new Tv(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,n={},{head:s=!1,get:r=!1,count:i}={}){var o;let l;const c=new URL(`${this.url}/rpc/${t}`);let u;s||r?(l=s?"HEAD":"GET",Object.entries(n).filter(([h,m])=>m!==void 0).map(([h,m])=>[h,Array.isArray(m)?`{${m.join(",")}}`:`${m}`]).forEach(([h,m])=>{c.searchParams.append(h,m)})):(l="POST",u=n);const d=new Headers(this.headers);return i&&d.set("Prefer",`count=${i}`),new Ws({method:l,url:c,headers:d,schema:this.schemaName,body:u,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};class mk{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const n=process.versions;if(n&&n.node){const s=n.node,r=parseInt(s.replace(/^v/,"").split(".")[0]);return r>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let n=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(n+=`

Suggested solution: ${t.workaround}`),new Error(n)}static createWebSocket(t,n){const s=this.getWebSocketConstructor();return new s(t,n)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const pk="2.88.0",fk=`realtime-js/${pk}`,Rv="1.0.0",gk="2.0.0",Vp=Rv,fd=1e4,yk=1e3,vk=100;var La;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(La||(La={}));var St;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(St||(St={}));var Fn;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(Fn||(Fn={}));var gd;(function(e){e.websocket="websocket"})(gd||(gd={}));var hs;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(hs||(hs={}));class bk{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,n){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return n(this._binaryEncodeUserBroadcastPush(t));let s=[t.join_ref,t.ref,t.topic,t.event,t.payload];return n(JSON.stringify(s))}_binaryEncodeUserBroadcastPush(t){var n;return this._isArrayBuffer((n=t.payload)===null||n===void 0?void 0:n.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var n,s;const r=(s=(n=t.payload)===null||n===void 0?void 0:n.payload)!==null&&s!==void 0?s:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,r)}_encodeJsonUserBroadcastPush(t){var n,s;const r=(s=(n=t.payload)===null||n===void 0?void 0:n.payload)!==null&&s!==void 0?s:{},o=new TextEncoder().encode(JSON.stringify(r)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(t,n,s){var r,i;const o=t.topic,l=(r=t.ref)!==null&&r!==void 0?r:"",c=(i=t.join_ref)!==null&&i!==void 0?i:"",u=t.payload.event,d=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},h=Object.keys(d).length===0?"":JSON.stringify(d);if(c.length>255)throw new Error(`joinRef length ${c.length} exceeds maximum of 255`);if(l.length>255)throw new Error(`ref length ${l.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`userEvent length ${u.length} exceeds maximum of 255`);if(h.length>255)throw new Error(`metadata length ${h.length} exceeds maximum of 255`);const m=this.USER_BROADCAST_PUSH_META_LENGTH+c.length+l.length+o.length+u.length+h.length,y=new ArrayBuffer(this.HEADER_LENGTH+m);let b=new DataView(y),_=0;b.setUint8(_++,this.KINDS.userBroadcastPush),b.setUint8(_++,c.length),b.setUint8(_++,l.length),b.setUint8(_++,o.length),b.setUint8(_++,u.length),b.setUint8(_++,h.length),b.setUint8(_++,n),Array.from(c,f=>b.setUint8(_++,f.charCodeAt(0))),Array.from(l,f=>b.setUint8(_++,f.charCodeAt(0))),Array.from(o,f=>b.setUint8(_++,f.charCodeAt(0))),Array.from(u,f=>b.setUint8(_++,f.charCodeAt(0))),Array.from(h,f=>b.setUint8(_++,f.charCodeAt(0)));var w=new Uint8Array(y.byteLength+s.byteLength);return w.set(new Uint8Array(y),0),w.set(new Uint8Array(s),y.byteLength),w.buffer}decode(t,n){if(this._isArrayBuffer(t)){let s=this._binaryDecode(t);return n(s)}if(typeof t=="string"){const s=JSON.parse(t),[r,i,o,l,c]=s;return n({join_ref:r,ref:i,topic:o,event:l,payload:c})}return n({})}_binaryDecode(t){const n=new DataView(t),s=n.getUint8(0),r=new TextDecoder;switch(s){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(t,n,r)}}_decodeUserBroadcast(t,n,s){const r=n.getUint8(1),i=n.getUint8(2),o=n.getUint8(3),l=n.getUint8(4);let c=this.HEADER_LENGTH+4;const u=s.decode(t.slice(c,c+r));c=c+r;const d=s.decode(t.slice(c,c+i));c=c+i;const h=s.decode(t.slice(c,c+o));c=c+o;const m=t.slice(c,t.byteLength),y=l===this.JSON_ENCODING?JSON.parse(s.decode(m)):m,b={type:this.BROADCAST_EVENT,event:d,payload:y};return o>0&&(b.meta=JSON.parse(h)),{join_ref:null,ref:null,topic:u,event:this.BROADCAST_EVENT,payload:b}}_isArrayBuffer(t){var n;return t instanceof ArrayBuffer||((n=t==null?void 0:t.constructor)===null||n===void 0?void 0:n.name)==="ArrayBuffer"}_pick(t,n){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([s])=>n.includes(s)))}}class Dv{constructor(t,n){this.callback=t,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var rt;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(rt||(rt={}));const Kp=(e,t,n={})=>{var s;const r=(s=n.skipTypes)!==null&&s!==void 0?s:[];return t?Object.keys(t).reduce((i,o)=>(i[o]=_k(o,e,t,r),i),{}):{}},_k=(e,t,n,s)=>{const r=t.find(l=>l.name===e),i=r==null?void 0:r.type,o=n[e];return i&&!s.includes(i)?Mv(i,o):yd(o)},Mv=(e,t)=>{if(e.charAt(0)==="_"){const n=e.slice(1,e.length);return Nk(t,n)}switch(e){case rt.bool:return xk(t);case rt.float4:case rt.float8:case rt.int2:case rt.int4:case rt.int8:case rt.numeric:case rt.oid:return wk(t);case rt.json:case rt.jsonb:return kk(t);case rt.timestamp:return jk(t);case rt.abstime:case rt.date:case rt.daterange:case rt.int4range:case rt.int8range:case rt.money:case rt.reltime:case rt.text:case rt.time:case rt.timestamptz:case rt.timetz:case rt.tsrange:case rt.tstzrange:return yd(t);default:return yd(t)}},yd=e=>e,xk=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},wk=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},kk=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e},Nk=(e,t)=>{if(typeof e!="string")return e;const n=e.length-1,s=e[n];if(e[0]==="{"&&s==="}"){let i;const o=e.slice(1,n);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(l=>Mv(t,l))}return e},jk=e=>typeof e=="string"?e.replace(" ","T"):e,Lv=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class Gc{constructor(t,n,s={},r=fd){this.channel=t,this.event=n,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,n){var s;return this._hasReceived(t)&&n((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:t,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:n}){this.recHooks.filter(s=>s.status===t).forEach(s=>s.callback(n))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var Gp;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(Gp||(Gp={}));class li{constructor(t,n){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(n==null?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},r=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=li.syncState(this.state,r,i,o),this.pendingDiffs.forEach(c=>{this.state=li.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],l()}),this.channel._on(s.diff,{},r=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(r):(this.state=li.syncDiff(this.state,r,i,o),l())}),this.onJoin((r,i,o)=>{this.channel._trigger("presence",{event:"join",key:r,currentPresences:i,newPresences:o})}),this.onLeave((r,i,o)=>{this.channel._trigger("presence",{event:"leave",key:r,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,n,s,r){const i=this.cloneDeep(t),o=this.transformState(n),l={},c={};return this.map(i,(u,d)=>{o[u]||(c[u]=d)}),this.map(o,(u,d)=>{const h=i[u];if(h){const m=d.map(w=>w.presence_ref),y=h.map(w=>w.presence_ref),b=d.filter(w=>y.indexOf(w.presence_ref)<0),_=h.filter(w=>m.indexOf(w.presence_ref)<0);b.length>0&&(l[u]=b),_.length>0&&(c[u]=_)}else l[u]=d}),this.syncDiff(i,{joins:l,leaves:c},s,r)}static syncDiff(t,n,s,r){const{joins:i,leaves:o}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(i,(l,c)=>{var u;const d=(u=t[l])!==null&&u!==void 0?u:[];if(t[l]=this.cloneDeep(c),d.length>0){const h=t[l].map(y=>y.presence_ref),m=d.filter(y=>h.indexOf(y.presence_ref)<0);t[l].unshift(...m)}s(l,d,c)}),this.map(o,(l,c)=>{let u=t[l];if(!u)return;const d=c.map(h=>h.presence_ref);u=u.filter(h=>d.indexOf(h.presence_ref)<0),t[l]=u,r(l,u,c),u.length===0&&delete t[l]}),t}static map(t,n){return Object.getOwnPropertyNames(t).map(s=>n(s,t[s]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((n,s)=>{const r=t[s];return"metas"in r?n[s]=r.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):n[s]=r,n},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Jp;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(Jp||(Jp={}));var ci;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(ci||(ci={}));var ua;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(ua||(ua={}));class sr{constructor(t,n={config:{}},s){var r,i;if(this.topic=t,this.params=n,this.socket=s,this.bindings={},this.state=St.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new Gc(this,Fn.join,this.params,this.timeout),this.rejoinTimer=new Dv(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=St.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=St.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=St.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=St.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=St.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Fn.reply,{},(o,l)=>{this._trigger(this._replyEventName(l),o)}),this.presence=new li(this),this.broadcastEndpointURL=Lv(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(r=this.params.config)===null||r===void 0?void 0:r.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,n=this.timeout){var s,r,i;if(this.socket.isConnected()||this.socket.connect(),this.state==St.closed){const{config:{broadcast:o,presence:l,private:c}}=this.params,u=(r=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(y=>y.filter))!==null&&r!==void 0?r:[],d=!!this.bindings[ci.PRESENCE]&&this.bindings[ci.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,h={},m={broadcast:o,presence:Object.assign(Object.assign({},l),{enabled:d}),postgres_changes:u,private:c};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(y=>t==null?void 0:t(ua.CHANNEL_ERROR,y)),this._onClose(()=>t==null?void 0:t(ua.CLOSED)),this.updateJoinPayload(Object.assign({config:m},h)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:y})=>{var b;if(this.socket._isManualToken()||this.socket.setAuth(),y===void 0){t==null||t(ua.SUBSCRIBED);return}else{const _=this.bindings.postgres_changes,w=(b=_==null?void 0:_.length)!==null&&b!==void 0?b:0,f=[];for(let p=0;p<w;p++){const g=_[p],{filter:{event:j,schema:A,table:R,filter:S}}=g,k=y&&y[p];if(k&&k.event===j&&sr.isFilterValueEqual(k.schema,A)&&sr.isFilterValueEqual(k.table,R)&&sr.isFilterValueEqual(k.filter,S))f.push(Object.assign(Object.assign({},g),{id:k.id}));else{this.unsubscribe(),this.state=St.errored,t==null||t(ua.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=f,t&&t(ua.SUBSCRIBED);return}}).receive("error",y=>{this.state=St.errored,t==null||t(ua.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(y).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(ua.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,n={}){return await this.send({type:"presence",event:"track",payload:t},n.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,n,s){return this.state===St.joined&&t===ci.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,n,s)}async httpSend(t,n,s={}){var r;if(n==null)return Promise.reject("Payload is required for httpSend()");const i={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(i.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:i,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:n,private:this.private}]})},l=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(r=s.timeout)!==null&&r!==void 0?r:this.timeout);if(l.status===202)return{success:!0};let c=l.statusText;try{const u=await l.json();c=u.error||u.message||c}catch{}return Promise.reject(new Error(c))}async send(t,n={}){var s,r;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:o}=t,l={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(l.Authorization=`Bearer ${this.socket.accessTokenValue}`);const c={method:"POST",headers:l,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(s=n.timeout)!==null&&s!==void 0?s:this.timeout);return await((r=u.body)===null||r===void 0?void 0:r.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,l,c;const u=this._push(t.type,t,n.timeout||this.timeout);t.type==="broadcast"&&!(!((c=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=St.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Fn.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(r=>{s=new Gc(this,Fn.leave,{},t),s.receive("ok",()=>{n(),r("ok")}).receive("timeout",()=>{n(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s==null||s.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=St.closed,this.bindings={}}async _fetchWithTimeout(t,n,s){const r=new AbortController,i=setTimeout(()=>r.abort(),s),o=await this.socket.fetch(t,Object.assign(Object.assign({},n),{signal:r.signal}));return clearTimeout(i),o}_push(t,n,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new Gc(this,t,n,s);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>vk){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(t,n,s){return n}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,n,s){var r,i;const o=t.toLocaleLowerCase(),{close:l,error:c,leave:u,join:d}=Fn;if(s&&[l,c,u,d].indexOf(o)>=0&&s!==this._joinRef())return;let m=this._onMessage(o,n,s);if(n&&!m)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(r=this.bindings.postgres_changes)===null||r===void 0||r.filter(y=>{var b,_,w;return((b=y.filter)===null||b===void 0?void 0:b.event)==="*"||((w=(_=y.filter)===null||_===void 0?void 0:_.event)===null||w===void 0?void 0:w.toLocaleLowerCase())===o}).map(y=>y.callback(m,s)):(i=this.bindings[o])===null||i===void 0||i.filter(y=>{var b,_,w,f,p,g;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in y){const j=y.id,A=(b=y.filter)===null||b===void 0?void 0:b.event;return j&&((_=n.ids)===null||_===void 0?void 0:_.includes(j))&&(A==="*"||(A==null?void 0:A.toLocaleLowerCase())===((w=n.data)===null||w===void 0?void 0:w.type.toLocaleLowerCase()))}else{const j=(p=(f=y==null?void 0:y.filter)===null||f===void 0?void 0:f.event)===null||p===void 0?void 0:p.toLocaleLowerCase();return j==="*"||j===((g=n==null?void 0:n.event)===null||g===void 0?void 0:g.toLocaleLowerCase())}else return y.type.toLocaleLowerCase()===o}).map(y=>{if(typeof m=="object"&&"ids"in m){const b=m.data,{schema:_,table:w,commit_timestamp:f,type:p,errors:g}=b;m=Object.assign(Object.assign({},{schema:_,table:w,commit_timestamp:f,eventType:p,new:{},old:{},errors:g}),this._getPayloadRecords(b))}y.callback(m,s)})}_isClosed(){return this.state===St.closed}_isJoined(){return this.state===St.joined}_isJoining(){return this.state===St.joining}_isLeaving(){return this.state===St.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,n,s){const r=t.toLocaleLowerCase(),i={type:r,filter:n,callback:s};return this.bindings[r]?this.bindings[r].push(i):this.bindings[r]=[i],this}_off(t,n){const s=t.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(r=>{var i;return!(((i=r.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&sr.isEqual(r.filter,n))})),this}static isEqual(t,n){if(Object.keys(t).length!==Object.keys(n).length)return!1;for(const s in t)if(t[s]!==n[s])return!1;return!0}static isFilterValueEqual(t,n){return(t??void 0)===(n??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Fn.close,{},t)}_onError(t){this._on(Fn.error,{},n=>t(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=St.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const n={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(n.new=Kp(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(n.old=Kp(t.columns,t.old_record)),n}}const Jc=()=>{},So={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Sk=[1e3,2e3,5e3,1e4],Ek=1e4,Ck=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Ak{constructor(t,n){var s;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=fd,this.transport=null,this.heartbeatIntervalMs=So.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Jc,this.ref=0,this.reconnectTimer=null,this.vsn=Vp,this.logger=Jc,this.conn=null,this.sendBuffer=[],this.serializer=new bk,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=r=>r?(...i)=>r(...i):(...i)=>fetch(...i),!(!((s=n==null?void 0:n.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${t}/${gd.websocket}`,this.httpEndpoint=Lv(t),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n==null?void 0:n.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=mk.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const n=t.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,n??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const n=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const t=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,n,s){this.logger(t,n,s)}connectionState(){switch(this.conn&&this.conn.readyState){case La.connecting:return hs.Connecting;case La.open:return hs.Open;case La.closing:return hs.Closing;default:return hs.Closed}}isConnected(){return this.connectionState()===hs.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,n={config:{}}){const s=`realtime:${t}`,r=this.getChannels().find(i=>i.topic===s);if(r)return r;{const i=new sr(`realtime:${t}`,n,this);return this.channels.push(i),i}}push(t){const{topic:n,event:s,payload:r,ref:i}=t,o=()=>{this.encode(t,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${n} ${s} (${i})`,r),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(yk,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},So.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let n=this.channels.find(s=>s.topic===t&&(s._isJoined()||s._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${t}"`),n.unsubscribe())}_remove(t){this.channels=this.channels.filter(n=>n.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply")try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error")}catch(u){this.log("error","error in heartbeat callback",u)}n.ref&&n.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:s,event:r,payload:i,ref:o}=n,l=o?`(${o})`:"",c=i.status||"";this.log("receive",`${c} ${s} ${r} ${l}`.trim(),i),this.channels.filter(u=>u._isMember(s)).forEach(u=>u._trigger(r,i,o)),this._triggerStateCallbacks("message",n)})}_clearTimer(t){var n;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===La.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===La.open||this.conn.readyState===La.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(n=>{this.log("error","error waiting for auth on connect",n),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this._terminateWorker()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var n;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(Fn.error))}_appendParams(t,n){if(Object.keys(n).length===0)return t;const s=t.match(/\?/)?"&":"?",r=new URLSearchParams(n);return`${t}${s}${r}`}_workerObjectUrl(t){let n;if(t)n=t;else{const s=new Blob([Ck],{type:"application/javascript"});n=URL.createObjectURL(s)}return n}_setConnectionState(t,n=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(t=null){let n,s=!1;if(t)n=t,s=!0;else if(this.accessToken)try{n=await this.accessToken()}catch(r){this.log("error","Error fetching access token from callback",r),n=this.accessTokenValue}else n=this.accessTokenValue;s?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(r=>{const i={access_token:n,version:fk};n&&r.updateJoinPayload(i),r.joinedOnce&&r._isJoined()&&r._push(Fn.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(n=>{this.log("error",`Error setting auth in ${t}`,n)})}_triggerStateCallbacks(t,n){try{this.stateChangeCallbacks[t].forEach(s=>{try{s(n)}catch(r){this.log("error",`error in ${t} callback`,r)}})}catch(s){this.log("error",`error triggering ${t} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new Dv(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},So.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var n,s,r,i,o,l,c,u,d,h,m,y;switch(this.transport=(n=t==null?void 0:t.transport)!==null&&n!==void 0?n:null,this.timeout=(s=t==null?void 0:t.timeout)!==null&&s!==void 0?s:fd,this.heartbeatIntervalMs=(r=t==null?void 0:t.heartbeatIntervalMs)!==null&&r!==void 0?r:So.HEARTBEAT_INTERVAL,this.worker=(i=t==null?void 0:t.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=t==null?void 0:t.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(l=t==null?void 0:t.heartbeatCallback)!==null&&l!==void 0?l:Jc,this.vsn=(c=t==null?void 0:t.vsn)!==null&&c!==void 0?c:Vp,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(u=t==null?void 0:t.reconnectAfterMs)!==null&&u!==void 0?u:b=>Sk[b-1]||Ek,this.vsn){case Rv:this.encode=(d=t==null?void 0:t.encode)!==null&&d!==void 0?d:(b,_)=>_(JSON.stringify(b)),this.decode=(h=t==null?void 0:t.decode)!==null&&h!==void 0?h:(b,_)=>_(JSON.parse(b));break;case gk:this.encode=(m=t==null?void 0:t.encode)!==null&&m!==void 0?m:this.serializer.encode.bind(this.serializer),this.decode=(y=t==null?void 0:t.decode)!==null&&y!==void 0?y:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}var Ci=class extends Error{constructor(e,t){var n;super(e),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&((n=t.icebergType)==null?void 0:n.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function Ik(e,t,n){const s=new URL(t,e);if(n)for(const[r,i]of Object.entries(n))i!==void 0&&s.searchParams.set(r,i);return s.toString()}async function Pk(e){return!e||e.type==="none"?{}:e.type==="bearer"?{Authorization:`Bearer ${e.token}`}:e.type==="header"?{[e.name]:e.value}:e.type==="custom"?await e.getHeaders():{}}function Tk(e){const t=e.fetchImpl??globalThis.fetch;return{async request({method:n,path:s,query:r,body:i,headers:o}){const l=Ik(e.baseUrl,s,r),c=await Pk(e.auth),u=await t(l,{method:n,headers:{...i?{"Content-Type":"application/json"}:{},...c,...o},body:i?JSON.stringify(i):void 0}),d=await u.text(),h=(u.headers.get("content-type")||"").includes("application/json"),m=h&&d?JSON.parse(d):d;if(!u.ok){const y=h?m:void 0,b=y==null?void 0:y.error;throw new Ci((b==null?void 0:b.message)??`Request failed with status ${u.status}`,{status:u.status,icebergType:b==null?void 0:b.type,icebergCode:b==null?void 0:b.code,details:y})}return{status:u.status,headers:u.headers,data:m}}}}function Eo(e){return e.join("")}var Rk=class{constructor(e,t=""){this.client=e,this.prefix=t}async listNamespaces(e){const t=e?{parent:Eo(e.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(s=>({namespace:s}))}async createNamespace(e,t){const n={namespace:e.namespace,properties:t==null?void 0:t.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:n})).data}async dropNamespace(e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Eo(e.namespace)}`})}async loadNamespaceMetadata(e){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Eo(e.namespace)}`})).data.properties}}async namespaceExists(e){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Eo(e.namespace)}`}),!0}catch(t){if(t instanceof Ci&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(e,t){try{return await this.createNamespace(e,t)}catch(n){if(n instanceof Ci&&n.status===409)return;throw n}}};function Ms(e){return e.join("")}var Dk=class{constructor(e,t="",n){this.client=e,this.prefix=t,this.accessDelegation=n}async listTables(e){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ms(e.namespace)}/tables`})).data.identifiers}async createTable(e,t){const n={};return this.accessDelegation&&(n["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ms(e.namespace)}/tables`,body:t,headers:n})).data.metadata}async updateTable(e,t){const n=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ms(e.namespace)}/tables/${e.name}`,body:t});return{"metadata-location":n.data["metadata-location"],metadata:n.data.metadata}}async dropTable(e,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Ms(e.namespace)}/tables/${e.name}`,query:{purgeRequested:String((t==null?void 0:t.purge)??!1)}})}async loadTable(e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ms(e.namespace)}/tables/${e.name}`,headers:t})).data.metadata}async tableExists(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Ms(e.namespace)}/tables/${e.name}`,headers:t}),!0}catch(n){if(n instanceof Ci&&n.status===404)return!1;throw n}}async createTableIfNotExists(e,t){try{return await this.createTable(e,t)}catch(n){if(n instanceof Ci&&n.status===409)return await this.loadTable({namespace:e.namespace,name:t.name});throw n}}},Mk=class{constructor(e){var s;let t="v1";e.catalogName&&(t+=`/${e.catalogName}`);const n=e.baseUrl.endsWith("/")?e.baseUrl:`${e.baseUrl}/`;this.client=Tk({baseUrl:n,auth:e.auth,fetchImpl:e.fetch}),this.accessDelegation=(s=e.accessDelegation)==null?void 0:s.join(","),this.namespaceOps=new Rk(this.client,t),this.tableOps=new Dk(this.client,t,this.accessDelegation)}async listNamespaces(e){return this.namespaceOps.listNamespaces(e)}async createNamespace(e,t){return this.namespaceOps.createNamespace(e,t)}async dropNamespace(e){await this.namespaceOps.dropNamespace(e)}async loadNamespaceMetadata(e){return this.namespaceOps.loadNamespaceMetadata(e)}async listTables(e){return this.tableOps.listTables(e)}async createTable(e,t){return this.tableOps.createTable(e,t)}async updateTable(e,t){return this.tableOps.updateTable(e,t)}async dropTable(e,t){await this.tableOps.dropTable(e,t)}async loadTable(e){return this.tableOps.loadTable(e)}async namespaceExists(e){return this.namespaceOps.namespaceExists(e)}async tableExists(e){return this.tableOps.tableExists(e)}async createNamespaceIfNotExists(e,t){return this.namespaceOps.createNamespaceIfNotExists(e,t)}async createTableIfNotExists(e,t){return this.tableOps.createTableIfNotExists(e,t)}},lc=class extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}};function pt(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}var Lk=class extends lc{constructor(e,t,n){super(e),this.name="StorageApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},vd=class extends lc{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}};const Jh=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),Ok=()=>Response,bd=e=>{if(Array.isArray(e))return e.map(n=>bd(n));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([n,s])=>{const r=n.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));t[r]=bd(s)}),t},$k=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},Bk=e=>!e||typeof e!="string"||e.length===0||e.length>100||e.trim()!==e||e.includes("/")||e.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(e);function Ai(e){"@babel/helpers - typeof";return Ai=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ai(e)}function Fk(e,t){if(Ai(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(Ai(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function qk(e){var t=Fk(e,"string");return Ai(t)=="symbol"?t:t+""}function Uk(e,t,n){return(t=qk(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Qp(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function Oe(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Qp(Object(n),!0).forEach(function(s){Uk(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qp(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}const Qc=e=>{var t;return e.msg||e.message||e.error_description||(typeof e.error=="string"?e.error:(t=e.error)===null||t===void 0?void 0:t.message)||JSON.stringify(e)},Wk=async(e,t,n)=>{e instanceof await Ok()&&!(n!=null&&n.noResolveJson)?e.json().then(s=>{const r=e.status||500,i=(s==null?void 0:s.statusCode)||r+"";t(new Lk(Qc(s),r,i))}).catch(s=>{t(new vd(Qc(s),s))}):t(new vd(Qc(e),e))},zk=(e,t,n,s)=>{const r={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"||!s?r:($k(s)?(r.headers=Oe({"Content-Type":"application/json"},t==null?void 0:t.headers),r.body=JSON.stringify(s)):r.body=s,t!=null&&t.duplex&&(r.duplex=t.duplex),Oe(Oe({},r),n))};async function qi(e,t,n,s,r,i){return new Promise((o,l)=>{e(n,zk(t,s,r,i)).then(c=>{if(!c.ok)throw c;return s!=null&&s.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>Wk(c,l,s))})}async function Ii(e,t,n,s){return qi(e,"GET",t,n,s)}async function $n(e,t,n,s,r){return qi(e,"POST",t,s,r,n)}async function _d(e,t,n,s,r){return qi(e,"PUT",t,s,r,n)}async function Hk(e,t,n,s){return qi(e,"HEAD",t,Oe(Oe({},n),{},{noResolveJson:!0}),s)}async function Qh(e,t,n,s,r){return qi(e,"DELETE",t,s,r,n)}var Yk=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}async execute(){var e=this;try{return{data:(await e.downloadFn()).body,error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(pt(t))return{data:null,error:t};throw t}}};let Ov;Ov=Symbol.toStringTag;var Vk=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[Ov]="BlobDownloadBuilder",this.promise=null}asStream(){return new Yk(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var e=this;try{return{data:await(await e.downloadFn()).blob(),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(pt(t))return{data:null,error:t};throw t}}};const Kk={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Xp={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var Gk=class{constructor(e,t={},n,s){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=n,this.fetch=Jh(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(e,t,n,s){var r=this;try{let i;const o=Oe(Oe({},Xp),s);let l=Oe(Oe({},r.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&n instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",r.encodeMetadata(c)),i.append("",n)):typeof FormData<"u"&&n instanceof FormData?(i=n,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),c&&!i.has("metadata")&&i.append("metadata",r.encodeMetadata(c))):(i=n,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,c&&(l["x-metadata"]=r.toBase64(r.encodeMetadata(c))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!o.duplex&&(o.duplex="half")),s!=null&&s.headers&&(l=Oe(Oe({},l),s.headers));const u=r._removeEmptyFolders(t),d=r._getFinalPath(u),h=await(e=="PUT"?_d:$n)(r.fetch,`${r.url}/object/${d}`,i,Oe({headers:l},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:u,id:h.Id,fullPath:h.Key},error:null}}catch(i){if(r.shouldThrowOnError)throw i;if(pt(i))return{data:null,error:i};throw i}}async upload(e,t,n){return this.uploadOrUpdate("POST",e,t,n)}async uploadToSignedUrl(e,t,n,s){var r=this;const i=r._removeEmptyFolders(e),o=r._getFinalPath(i),l=new URL(r.url+`/object/upload/sign/${o}`);l.searchParams.set("token",t);try{let c;const u=Oe({upsert:Xp.upsert},s),d=Oe(Oe({},r.headers),{"x-upsert":String(u.upsert)});return typeof Blob<"u"&&n instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),c.append("",n)):typeof FormData<"u"&&n instanceof FormData?(c=n,c.append("cacheControl",u.cacheControl)):(c=n,d["cache-control"]=`max-age=${u.cacheControl}`,d["content-type"]=u.contentType),{data:{path:i,fullPath:(await _d(r.fetch,l.toString(),c,{headers:d})).Key},error:null}}catch(c){if(r.shouldThrowOnError)throw c;if(pt(c))return{data:null,error:c};throw c}}async createSignedUploadUrl(e,t){var n=this;try{let s=n._getFinalPath(e);const r=Oe({},n.headers);t!=null&&t.upsert&&(r["x-upsert"]="true");const i=await $n(n.fetch,`${n.url}/object/upload/sign/${s}`,{},{headers:r}),o=new URL(n.url+i.url),l=o.searchParams.get("token");if(!l)throw new lc("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:l},error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(pt(s))return{data:null,error:s};throw s}}async update(e,t,n){return this.uploadOrUpdate("PUT",e,t,n)}async move(e,t,n){var s=this;try{return{data:await $n(s.fetch,`${s.url}/object/move`,{bucketId:s.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:s.headers}),error:null}}catch(r){if(s.shouldThrowOnError)throw r;if(pt(r))return{data:null,error:r};throw r}}async copy(e,t,n){var s=this;try{return{data:{path:(await $n(s.fetch,`${s.url}/object/copy`,{bucketId:s.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:s.headers})).Key},error:null}}catch(r){if(s.shouldThrowOnError)throw r;if(pt(r))return{data:null,error:r};throw r}}async createSignedUrl(e,t,n){var s=this;try{let r=s._getFinalPath(e),i=await $n(s.fetch,`${s.url}/object/sign/${r}`,Oe({expiresIn:t},n!=null&&n.transform?{transform:n.transform}:{}),{headers:s.headers});const o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return i={signedUrl:encodeURI(`${s.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(r){if(s.shouldThrowOnError)throw r;if(pt(r))return{data:null,error:r};throw r}}async createSignedUrls(e,t,n){var s=this;try{const r=await $n(s.fetch,`${s.url}/object/sign/${s.bucketId}`,{expiresIn:t,paths:e},{headers:s.headers}),i=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:r.map(o=>Oe(Oe({},o),{},{signedUrl:o.signedURL?encodeURI(`${s.url}${o.signedURL}${i}`):null})),error:null}}catch(r){if(s.shouldThrowOnError)throw r;if(pt(r))return{data:null,error:r};throw r}}download(e,t){const n=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),r=s?`?${s}`:"",i=this._getFinalPath(e),o=()=>Ii(this.fetch,`${this.url}/${n}/${i}${r}`,{headers:this.headers,noResolveJson:!0});return new Vk(o,this.shouldThrowOnError)}async info(e){var t=this;const n=t._getFinalPath(e);try{return{data:bd(await Ii(t.fetch,`${t.url}/object/info/${n}`,{headers:t.headers})),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(pt(s))return{data:null,error:s};throw s}}async exists(e){var t=this;const n=t._getFinalPath(e);try{return await Hk(t.fetch,`${t.url}/object/${n}`,{headers:t.headers}),{data:!0,error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(pt(s)&&s instanceof vd){const r=s.originalError;if([400,404].includes(r==null?void 0:r.status))return{data:!1,error:s}}throw s}}getPublicUrl(e,t){const n=this._getFinalPath(e),s=[],r=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";r!==""&&s.push(r);const i=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",o=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});o!==""&&s.push(o);let l=s.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${n}${l}`)}}}async remove(e){var t=this;try{return{data:await Qh(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:e},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(pt(n))return{data:null,error:n};throw n}}async list(e,t,n){var s=this;try{const r=Oe(Oe(Oe({},Kk),t),{},{prefix:e||""});return{data:await $n(s.fetch,`${s.url}/object/list/${s.bucketId}`,r,{headers:s.headers},n),error:null}}catch(r){if(s.shouldThrowOnError)throw r;if(pt(r))return{data:null,error:r};throw r}}async listV2(e,t){var n=this;try{const s=Oe({},e);return{data:await $n(n.fetch,`${n.url}/object/list-v2/${n.bucketId}`,s,{headers:n.headers},t),error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(pt(s))return{data:null,error:s};throw s}}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};const $v="2.88.0",Bv={"X-Client-Info":`storage-js/${$v}`};var Jk=class{constructor(e,t={},n,s){this.shouldThrowOnError=!1;const r=new URL(e);s!=null&&s.useNewHostname&&/supabase\.(co|in|red)$/.test(r.hostname)&&!r.hostname.includes("storage.supabase.")&&(r.hostname=r.hostname.replace("supabase.","storage.supabase.")),this.url=r.href.replace(/\/$/,""),this.headers=Oe(Oe({},Bv),t),this.fetch=Jh(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(e){var t=this;try{const n=t.listBucketOptionsToQueryString(e);return{data:await Ii(t.fetch,`${t.url}/bucket${n}`,{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(pt(n))return{data:null,error:n};throw n}}async getBucket(e){var t=this;try{return{data:await Ii(t.fetch,`${t.url}/bucket/${e}`,{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(pt(n))return{data:null,error:n};throw n}}async createBucket(e,t={public:!1}){var n=this;try{return{data:await $n(n.fetch,`${n.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:n.headers}),error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(pt(s))return{data:null,error:s};throw s}}async updateBucket(e,t){var n=this;try{return{data:await _d(n.fetch,`${n.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:n.headers}),error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(pt(s))return{data:null,error:s};throw s}}async emptyBucket(e){var t=this;try{return{data:await $n(t.fetch,`${t.url}/bucket/${e}/empty`,{},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(pt(n))return{data:null,error:n};throw n}}async deleteBucket(e){var t=this;try{return{data:await Qh(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(pt(n))return{data:null,error:n};throw n}}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},Qk=class{constructor(e,t={},n){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Oe(Oe({},Bv),t),this.fetch=Jh(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){var t=this;try{return{data:await $n(t.fetch,`${t.url}/bucket`,{name:e},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(pt(n))return{data:null,error:n};throw n}}async listBuckets(e){var t=this;try{const n=new URLSearchParams;(e==null?void 0:e.limit)!==void 0&&n.set("limit",e.limit.toString()),(e==null?void 0:e.offset)!==void 0&&n.set("offset",e.offset.toString()),e!=null&&e.sortColumn&&n.set("sortColumn",e.sortColumn),e!=null&&e.sortOrder&&n.set("sortOrder",e.sortOrder),e!=null&&e.search&&n.set("search",e.search);const s=n.toString(),r=s?`${t.url}/bucket?${s}`:`${t.url}/bucket`;return{data:await Ii(t.fetch,r,{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(pt(n))return{data:null,error:n};throw n}}async deleteBucket(e){var t=this;try{return{data:await Qh(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(pt(n))return{data:null,error:n};throw n}}from(e){var t=this;if(!Bk(e))throw new lc("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const n=new Mk({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),s=this.shouldThrowOnError;return new Proxy(n,{get(r,i){const o=r[i];return typeof o!="function"?o:async(...l)=>{try{return{data:await o.apply(r,l),error:null}}catch(c){if(s)throw c;return{data:null,error:c}}}}})}};const Xh={"X-Client-Info":`storage-js/${$v}`,"Content-Type":"application/json"};var Fv=class extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function dn(e){return typeof e=="object"&&e!==null&&"__isStorageVectorsError"in e}var Xc=class extends Fv{constructor(e,t,n){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Xk=class extends Fv{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}};const Zh=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),Zk=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},Zp=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),eN=async(e,t,n)=>{if(e&&typeof e=="object"&&"status"in e&&"ok"in e&&typeof e.status=="number"&&!(n!=null&&n.noResolveJson)){const s=e.status||500,r=e;if(typeof r.json=="function")r.json().then(i=>{const o=(i==null?void 0:i.statusCode)||(i==null?void 0:i.code)||s+"";t(new Xc(Zp(i),s,o))}).catch(()=>{const i=s+"";t(new Xc(r.statusText||`HTTP ${s} error`,s,i))});else{const i=s+"";t(new Xc(r.statusText||`HTTP ${s} error`,s,i))}}else t(new Xk(Zp(e),e))},tN=(e,t,n,s)=>{const r={method:e,headers:(t==null?void 0:t.headers)||{}};return s?(Zk(s)?(r.headers=Oe({"Content-Type":"application/json"},t==null?void 0:t.headers),r.body=JSON.stringify(s)):r.body=s,Oe(Oe({},r),n)):r};async function nN(e,t,n,s,r,i){return new Promise((o,l)=>{e(n,tN(t,s,r,i)).then(c=>{if(!c.ok)throw c;if(s!=null&&s.noResolveJson)return c;const u=c.headers.get("content-type");return!u||!u.includes("application/json")?{}:c.json()}).then(c=>o(c)).catch(c=>eN(c,l,s))})}async function hn(e,t,n,s,r){return nN(e,"POST",t,s,r,n)}var aN=class{constructor(e,t={},n){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Oe(Oe({},Xh),t),this.fetch=Zh(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(e){var t=this;try{return{data:await hn(t.fetch,`${t.url}/CreateIndex`,e,{headers:t.headers})||{},error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(dn(n))return{data:null,error:n};throw n}}async getIndex(e,t){var n=this;try{return{data:await hn(n.fetch,`${n.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:n.headers}),error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(dn(s))return{data:null,error:s};throw s}}async listIndexes(e){var t=this;try{return{data:await hn(t.fetch,`${t.url}/ListIndexes`,e,{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(dn(n))return{data:null,error:n};throw n}}async deleteIndex(e,t){var n=this;try{return{data:await hn(n.fetch,`${n.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:n.headers})||{},error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(dn(s))return{data:null,error:s};throw s}}},sN=class{constructor(e,t={},n){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Oe(Oe({},Xh),t),this.fetch=Zh(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(e){var t=this;try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await hn(t.fetch,`${t.url}/PutVectors`,e,{headers:t.headers})||{},error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(dn(n))return{data:null,error:n};throw n}}async getVectors(e){var t=this;try{return{data:await hn(t.fetch,`${t.url}/GetVectors`,e,{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(dn(n))return{data:null,error:n};throw n}}async listVectors(e){var t=this;try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:await hn(t.fetch,`${t.url}/ListVectors`,e,{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(dn(n))return{data:null,error:n};throw n}}async queryVectors(e){var t=this;try{return{data:await hn(t.fetch,`${t.url}/QueryVectors`,e,{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(dn(n))return{data:null,error:n};throw n}}async deleteVectors(e){var t=this;try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await hn(t.fetch,`${t.url}/DeleteVectors`,e,{headers:t.headers})||{},error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(dn(n))return{data:null,error:n};throw n}}},rN=class{constructor(e,t={},n){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Oe(Oe({},Xh),t),this.fetch=Zh(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){var t=this;try{return{data:await hn(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{},error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(dn(n))return{data:null,error:n};throw n}}async getBucket(e){var t=this;try{return{data:await hn(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:e},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(dn(n))return{data:null,error:n};throw n}}async listBuckets(e={}){var t=this;try{return{data:await hn(t.fetch,`${t.url}/ListVectorBuckets`,e,{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(dn(n))return{data:null,error:n};throw n}}async deleteBucket(e){var t=this;try{return{data:await hn(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{},error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(dn(n))return{data:null,error:n};throw n}}},iN=class extends rN{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new oN(this.url,this.headers,e,this.fetch)}async createBucket(e){var t=()=>super.createBucket,n=this;return t().call(n,e)}async getBucket(e){var t=()=>super.getBucket,n=this;return t().call(n,e)}async listBuckets(e={}){var t=()=>super.listBuckets,n=this;return t().call(n,e)}async deleteBucket(e){var t=()=>super.deleteBucket,n=this;return t().call(n,e)}},oN=class extends aN{constructor(e,t,n,s){super(e,t,s),this.vectorBucketName=n}async createIndex(e){var t=()=>super.createIndex,n=this;return t().call(n,Oe(Oe({},e),{},{vectorBucketName:n.vectorBucketName}))}async listIndexes(e={}){var t=()=>super.listIndexes,n=this;return t().call(n,Oe(Oe({},e),{},{vectorBucketName:n.vectorBucketName}))}async getIndex(e){var t=()=>super.getIndex,n=this;return t().call(n,n.vectorBucketName,e)}async deleteIndex(e){var t=()=>super.deleteIndex,n=this;return t().call(n,n.vectorBucketName,e)}index(e){return new lN(this.url,this.headers,this.vectorBucketName,e,this.fetch)}},lN=class extends sN{constructor(e,t,n,s,r){super(e,t,r),this.vectorBucketName=n,this.indexName=s}async putVectors(e){var t=()=>super.putVectors,n=this;return t().call(n,Oe(Oe({},e),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async getVectors(e){var t=()=>super.getVectors,n=this;return t().call(n,Oe(Oe({},e),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async listVectors(e={}){var t=()=>super.listVectors,n=this;return t().call(n,Oe(Oe({},e),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async queryVectors(e){var t=()=>super.queryVectors,n=this;return t().call(n,Oe(Oe({},e),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async deleteVectors(e){var t=()=>super.deleteVectors,n=this;return t().call(n,Oe(Oe({},e),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}},cN=class extends Jk{constructor(e,t={},n,s){super(e,t,n,s)}from(e){return new Gk(this.url,this.headers,e,this.fetch)}get vectors(){return new iN(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Qk(this.url+"/iceberg",this.headers,this.fetch)}};const qv="2.88.0",zs=30*1e3,xd=3,Zc=xd*zs,uN="http://localhost:9999",dN="supabase.auth.token",hN={"X-Client-Info":`gotrue-js/${qv}`},wd="X-Supabase-Api-Version",Uv={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},mN=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,pN=10*60*1e3;class Pi extends Error{constructor(t,n,s){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=s}}function Re(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class fN extends Pi{constructor(t,n,s){super(t,n,s),this.name="AuthApiError",this.status=n,this.code=s}}function gN(e){return Re(e)&&e.name==="AuthApiError"}class ms extends Pi{constructor(t,n){super(t),this.name="AuthUnknownError",this.originalError=n}}class Ca extends Pi{constructor(t,n,s,r){super(t,s,r),this.name=n,this.status=s}}class cn extends Ca{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function yN(e){return Re(e)&&e.name==="AuthSessionMissingError"}class Ls extends Ca{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Co extends Ca{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class Ao extends Ca{constructor(t,n=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function vN(e){return Re(e)&&e.name==="AuthImplicitGrantRedirectError"}class ef extends Ca{constructor(t,n=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class bN extends Ca{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class kd extends Ca{constructor(t,n){super(t,"AuthRetryableFetchError",n,void 0)}}function eu(e){return Re(e)&&e.name==="AuthRetryableFetchError"}class tf extends Ca{constructor(t,n,s){super(t,"AuthWeakPasswordError",n,"weak_password"),this.reasons=s}}class Nd extends Ca{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Il="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),nf=` 	
\r=`.split(""),_N=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<nf.length;t+=1)e[nf[t].charCodeAt(0)]=-2;for(let t=0;t<Il.length;t+=1)e[Il[t].charCodeAt(0)]=t;return e})();function af(e,t,n){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const s=t.queue>>t.queuedBits-6&63;n(Il[s]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const s=t.queue>>t.queuedBits-6&63;n(Il[s]),t.queuedBits-=6}}function Wv(e,t,n){const s=_N[e];if(s>-1)for(t.queue=t.queue<<6|s,t.queuedBits+=6;t.queuedBits>=8;)n(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function sf(e){const t=[],n=o=>{t.push(String.fromCodePoint(o))},s={utf8seq:0,codepoint:0},r={queue:0,queuedBits:0},i=o=>{kN(o,s,n)};for(let o=0;o<e.length;o+=1)Wv(e.charCodeAt(o),r,i);return t.join("")}function xN(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function wN(e,t){for(let n=0;n<e.length;n+=1){let s=e.charCodeAt(n);if(s>55295&&s<=56319){const r=(s-55296)*1024&65535;s=(e.charCodeAt(n+1)-56320&65535|r)+65536,n+=1}xN(s,t)}}function kN(e,t,n){if(t.utf8seq===0){if(e<=127){n(e);return}for(let s=1;s<6;s+=1)if(!(e>>7-s&1)){t.utf8seq=s;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&n(t.codepoint)}}function dr(e){const t=[],n={queue:0,queuedBits:0},s=r=>{t.push(r)};for(let r=0;r<e.length;r+=1)Wv(e.charCodeAt(r),n,s);return new Uint8Array(t)}function NN(e){const t=[];return wN(e,n=>t.push(n)),new Uint8Array(t)}function vs(e){const t=[],n={queue:0,queuedBits:0},s=r=>{t.push(r)};return e.forEach(r=>af(r,n,s)),af(null,n,s),t.join("")}function jN(e){return Math.round(Date.now()/1e3)+e}function SN(){return Symbol("auth-callback")}const Mt=()=>typeof window<"u"&&typeof document<"u",as={tested:!1,writable:!1},zv=()=>{if(!Mt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(as.tested)return as.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),as.tested=!0,as.writable=!0}catch{as.tested=!0,as.writable=!1}return as.writable};function EN(e){const t={},n=new URL(e);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((r,i)=>{t[i]=r})}catch{}return n.searchParams.forEach((s,r)=>{t[r]=s}),t}const Hv=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),CN=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",Hs=async(e,t,n)=>{await e.setItem(t,JSON.stringify(n))},ss=async(e,t)=>{const n=await e.getItem(t);if(!n)return null;try{return JSON.parse(n)}catch{return n}},Dt=async(e,t)=>{await e.removeItem(t)};class cc{constructor(){this.promise=new cc.promiseConstructor((t,n)=>{this.resolve=t,this.reject=n})}}cc.promiseConstructor=Promise;function tu(e){const t=e.split(".");if(t.length!==3)throw new Nd("Invalid JWT structure");for(let s=0;s<t.length;s++)if(!mN.test(t[s]))throw new Nd("JWT not in base64url format");return{header:JSON.parse(sf(t[0])),payload:JSON.parse(sf(t[1])),signature:dr(t[2]),raw:{header:t[0],payload:t[1]}}}async function AN(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function IN(e,t){return new Promise((s,r)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await e(i);if(!t(i,null,o)){s(o);return}}catch(o){if(!t(i,o)){r(o);return}}})()})}function PN(e){return("0"+e.toString(16)).substr(-2)}function TN(){const t=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=n.length;let r="";for(let i=0;i<56;i++)r+=n.charAt(Math.floor(Math.random()*s));return r}return crypto.getRandomValues(t),Array.from(t,PN).join("")}async function RN(e){const n=new TextEncoder().encode(e),s=await crypto.subtle.digest("SHA-256",n),r=new Uint8Array(s);return Array.from(r).map(i=>String.fromCharCode(i)).join("")}async function DN(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const n=await RN(e);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Os(e,t,n=!1){const s=TN();let r=s;n&&(r+="/PASSWORD_RECOVERY"),await Hs(e,`${t}-code-verifier`,r);const i=await DN(s);return[i,s===i?"plain":"s256"]}const MN=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function LN(e){const t=e.headers.get(wd);if(!t||!t.match(MN))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function ON(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function $N(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const BN=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function $s(e){if(!BN.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function nu(){const e={};return new Proxy(e,{get:(t,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const s=n.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function FN(e,t){return new Proxy(e,{get:(n,s,r)=>{if(s==="__isInsecureUserWarningProxy")return!0;if(typeof s=="symbol"){const i=s.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,s,r)}return!t.value&&typeof s=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(n,s,r)}})}function rf(e){return JSON.parse(JSON.stringify(e))}const us=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),qN=[502,503,504];async function of(e){var t;if(!CN(e))throw new kd(us(e),0);if(qN.includes(e.status))throw new kd(us(e),e.status);let n;try{n=await e.json()}catch(i){throw new ms(us(i),i)}let s;const r=LN(e);if(r&&r.getTime()>=Uv["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?s=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(s=n.error_code),s){if(s==="weak_password")throw new tf(us(n),e.status,((t=n.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(s==="session_not_found")throw new cn}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new tf(us(n),e.status,n.weak_password.reasons);throw new fN(us(n),e.status||500,s)}const UN=(e,t,n,s)=>{const r={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),r.body=JSON.stringify(s),Object.assign(Object.assign({},r),n))};async function Le(e,t,n,s){var r;const i=Object.assign({},s==null?void 0:s.headers);i[wd]||(i[wd]=Uv["2024-01-01"].name),s!=null&&s.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const o=(r=s==null?void 0:s.query)!==null&&r!==void 0?r:{};s!=null&&s.redirectTo&&(o.redirect_to=s.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await WN(e,t,n+l,{headers:i,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(c):{data:Object.assign({},c),error:null}}async function WN(e,t,n,s,r,i){const o=UN(t,s,r,i);let l;try{l=await e(n,Object.assign({},o))}catch(c){throw console.error(c),new kd(us(c),0)}if(l.ok||await of(l),s!=null&&s.noResolveJson)return l;try{return await l.json()}catch(c){await of(c)}}function Mn(e){var t;let n=null;YN(e)&&(n=Object.assign({},e),e.expires_at||(n.expires_at=jN(e.expires_in)));const s=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:n,user:s},error:null}}function lf(e){const t=Mn(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((n,s)=>n&&typeof s=="string",!0)&&(t.data.weak_password=e.weak_password),t}function Ba(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function zN(e){return{data:e,error:null}}function HN(e){const{action_link:t,email_otp:n,hashed_token:s,redirect_to:r,verification_type:i}=e,o=oc(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:t,email_otp:n,hashed_token:s,redirect_to:r,verification_type:i},c=Object.assign({},o);return{data:{properties:l,user:c},error:null}}function cf(e){return e}function YN(e){return e.access_token&&e.refresh_token&&e.expires_in}const au=["global","local","others"];class VN{constructor({url:t="",headers:n={},fetch:s}){this.url=t,this.headers=n,this.fetch=Hv(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,n=au[0]){if(au.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${au.join(", ")}`);try{return await Le(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(s){if(Re(s))return{data:null,error:s};throw s}}async inviteUserByEmail(t,n={}){try{return await Le(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:Ba})}catch(s){if(Re(s))return{data:{user:null},error:s};throw s}}async generateLink(t){try{const{options:n}=t,s=oc(t,["options"]),r=Object.assign(Object.assign({},s),n);return"newEmail"in s&&(r.new_email=s==null?void 0:s.newEmail,delete r.newEmail),await Le(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:HN,redirectTo:n==null?void 0:n.redirectTo})}catch(n){if(Re(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(t){try{return await Le(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Ba})}catch(n){if(Re(n))return{data:{user:null},error:n};throw n}}async listUsers(t){var n,s,r,i,o,l,c;try{const u={nextPage:null,lastPage:0,total:0},d=await Le(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(n=t==null?void 0:t.page)===null||n===void 0?void 0:n.toString())!==null&&s!==void 0?s:"",per_page:(i=(r=t==null?void 0:t.perPage)===null||r===void 0?void 0:r.toString())!==null&&i!==void 0?i:""},xform:cf});if(d.error)throw d.error;const h=await d.json(),m=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,y=(c=(l=d.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return y.length>0&&(y.forEach(b=>{const _=parseInt(b.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(b.split(";")[1].split("=")[1]);u[`${w}Page`]=_}),u.total=parseInt(m)),{data:Object.assign(Object.assign({},h),u),error:null}}catch(u){if(Re(u))return{data:{users:[]},error:u};throw u}}async getUserById(t){$s(t);try{return await Le(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Ba})}catch(n){if(Re(n))return{data:{user:null},error:n};throw n}}async updateUserById(t,n){$s(t);try{return await Le(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:n,headers:this.headers,xform:Ba})}catch(s){if(Re(s))return{data:{user:null},error:s};throw s}}async deleteUser(t,n=!1){$s(t);try{return await Le(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:n},xform:Ba})}catch(s){if(Re(s))return{data:{user:null},error:s};throw s}}async _listFactors(t){$s(t.userId);try{const{data:n,error:s}=await Le(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:r=>({data:{factors:r},error:null})});return{data:n,error:s}}catch(n){if(Re(n))return{data:null,error:n};throw n}}async _deleteFactor(t){$s(t.userId),$s(t.id);try{return{data:await Le(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(n){if(Re(n))return{data:null,error:n};throw n}}async _listOAuthClients(t){var n,s,r,i,o,l,c;try{const u={nextPage:null,lastPage:0,total:0},d=await Le(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(n=t==null?void 0:t.page)===null||n===void 0?void 0:n.toString())!==null&&s!==void 0?s:"",per_page:(i=(r=t==null?void 0:t.perPage)===null||r===void 0?void 0:r.toString())!==null&&i!==void 0?i:""},xform:cf});if(d.error)throw d.error;const h=await d.json(),m=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,y=(c=(l=d.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return y.length>0&&(y.forEach(b=>{const _=parseInt(b.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(b.split(";")[1].split("=")[1]);u[`${w}Page`]=_}),u.total=parseInt(m)),{data:Object.assign(Object.assign({},h),u),error:null}}catch(u){if(Re(u))return{data:{clients:[]},error:u};throw u}}async _createOAuthClient(t){try{return await Le(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Re(n))return{data:null,error:n};throw n}}async _getOAuthClient(t){try{return await Le(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Re(n))return{data:null,error:n};throw n}}async _updateOAuthClient(t,n){try{return await Le(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:n,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(Re(s))return{data:null,error:s};throw s}}async _deleteOAuthClient(t){try{return await Le(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Re(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(t){try{return await Le(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Re(n))return{data:null,error:n};throw n}}}function uf(e={}){return{getItem:t=>e[t]||null,setItem:(t,n)=>{e[t]=n},removeItem:t=>{delete e[t]}}}const Bs={debug:!!(globalThis&&zv()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Yv extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class KN extends Yv{}async function GN(e,t,n){Bs.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const s=new globalThis.AbortController;return t>0&&setTimeout(()=>{s.abort(),Bs.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async r=>{if(r){Bs.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,r.name);try{return await n()}finally{Bs.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,r.name)}}else{if(t===0)throw Bs.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new KN(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Bs.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function JN(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Vv(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function QN(e){return parseInt(e,16)}function XN(e){const t=new TextEncoder().encode(e);return"0x"+Array.from(t,s=>s.toString(16).padStart(2,"0")).join("")}function ZN(e){var t;const{chainId:n,domain:s,expirationTime:r,issuedAt:i=new Date,nonce:o,notBefore:l,requestId:c,resources:u,scheme:d,uri:h,version:m}=e;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!h)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(m!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${m}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const y=Vv(e.address),b=d?`${d}://${s}`:s,_=e.statement?`${e.statement}
`:"",w=`${b} wants you to sign in with your Ethereum account:
${y}

${_}`;let f=`URI: ${h}
Version: ${m}
Chain ID: ${n}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(r&&(f+=`
Expiration Time: ${r.toISOString()}`),l&&(f+=`
Not Before: ${l.toISOString()}`),c&&(f+=`
Request ID: ${c}`),u){let p=`
Resources:`;for(const g of u){if(!g||typeof g!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${g}`);p+=`
- ${g}`}f+=p}return`${w}
${f}`}class Nt extends Error{constructor({message:t,code:n,cause:s,name:r}){var i;super(t,{cause:s}),this.__isWebAuthnError=!0,this.name=(i=r??(s instanceof Error?s.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=n}}class Pl extends Nt{constructor(t,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:t}),this.name="WebAuthnUnknownError",this.originalError=n}}function ej({error:e,options:t}){var n,s,r;const{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Nt({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new Nt({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new Nt({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((r=i.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new Nt({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new Nt({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new Nt({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return i.pubKeyCredParams.filter(l=>l.type==="public-key").length===0?new Nt({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new Nt({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const o=window.location.hostname;if(Kv(o)){if(i.rp.id!==o)return new Nt({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Nt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new Nt({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new Nt({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Nt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function tj({error:e,options:t}){const{publicKey:n}=t;if(!n)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Nt({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new Nt({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const s=window.location.hostname;if(Kv(s)){if(n.rpId!==s)return new Nt({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Nt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new Nt({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Nt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}class nj{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const aj=new nj;function sj(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:n,excludeCredentials:s}=e,r=oc(e,["challenge","user","excludeCredentials"]),i=dr(t).buffer,o=Object.assign(Object.assign({},n),{id:dr(n.id).buffer}),l=Object.assign(Object.assign({},r),{challenge:i,user:o});if(s&&s.length>0){l.excludeCredentials=new Array(s.length);for(let c=0;c<s.length;c++){const u=s[c];l.excludeCredentials[c]=Object.assign(Object.assign({},u),{id:dr(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return l}function rj(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:n}=e,s=oc(e,["challenge","allowCredentials"]),r=dr(t).buffer,i=Object.assign(Object.assign({},s),{challenge:r});if(n&&n.length>0){i.allowCredentials=new Array(n.length);for(let o=0;o<n.length;o++){const l=n[o];i.allowCredentials[o]=Object.assign(Object.assign({},l),{id:dr(l.id).buffer,type:l.type||"public-key",transports:l.transports})}}return i}function ij(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const n=e;return{id:e.id,rawId:e.id,response:{attestationObject:vs(new Uint8Array(e.response.attestationObject)),clientDataJSON:vs(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=n.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function oj(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const n=e,s=e.getClientExtensionResults(),r=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:vs(new Uint8Array(r.authenticatorData)),clientDataJSON:vs(new Uint8Array(r.clientDataJSON)),signature:vs(new Uint8Array(r.signature)),userHandle:r.userHandle?vs(new Uint8Array(r.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:(t=n.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function Kv(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function df(){var e,t;return!!(Mt()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.get)=="function")}async function lj(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Pl("Browser returned unexpected credential type",t)}:{data:null,error:new Pl("Empty credential response",t)}}catch(t){return{data:null,error:ej({error:t,options:e})}}}async function cj(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Pl("Browser returned unexpected credential type",t)}:{data:null,error:new Pl("Empty credential response",t)}}catch(t){return{data:null,error:tj({error:t,options:e})}}}const uj={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},dj={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Tl(...e){const t=r=>r!==null&&typeof r=="object"&&!Array.isArray(r),n=r=>r instanceof ArrayBuffer||ArrayBuffer.isView(r),s={};for(const r of e)if(r)for(const i in r){const o=r[i];if(o!==void 0)if(Array.isArray(o))s[i]=o;else if(n(o))s[i]=o;else if(t(o)){const l=s[i];t(l)?s[i]=Tl(l,o):s[i]=Tl(o)}else s[i]=o}return s}function hj(e,t){return Tl(uj,e,t||{})}function mj(e,t){return Tl(dj,e,t||{})}class pj{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:n,friendlyName:s,signal:r},i){try{const{data:o,error:l}=await this.client.mfa.challenge({factorId:t,webauthn:n});if(!o)return{data:null,error:l};const c=r??aj.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:u}=o.webauthn.credential_options.publicKey;u.name||(u.name=`${u.id}:${s}`),u.displayName||(u.displayName=u.name)}switch(o.webauthn.type){case"create":{const u=hj(o.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:d,error:h}=await lj({publicKey:u,signal:c});return d?{data:{factorId:t,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:d}},error:null}:{data:null,error:h}}case"request":{const u=mj(o.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:d,error:h}=await cj(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:u,signal:c}));return d?{data:{factorId:t,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:d}},error:null}:{data:null,error:h}}}}catch(o){return Re(o)?{data:null,error:o}:{data:null,error:new ms("Unexpected error in challenge",o)}}}async _verify({challengeId:t,factorId:n,webauthn:s}){return this.client.mfa.verify({factorId:n,challengeId:t,webauthn:s})}async _authenticate({factorId:t,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:r}={}},i){if(!n)return{data:null,error:new Pi("rpId is required for WebAuthn authentication")};try{if(!df())return{data:null,error:new ms("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this.challenge({factorId:t,webauthn:{rpId:n,rpOrigins:s},signal:r},{request:i});if(!o)return{data:null,error:l};const{webauthn:c}=o;return this._verify({factorId:t,challengeId:o.challengeId,webauthn:{type:c.type,rpId:n,rpOrigins:s,credential_response:c.credential_response}})}catch(o){return Re(o)?{data:null,error:o}:{data:null,error:new ms("Unexpected error in authenticate",o)}}}async _register({friendlyName:t,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:r}={}},i){if(!n)return{data:null,error:new Pi("rpId is required for WebAuthn registration")};try{if(!df())return{data:null,error:new ms("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this._enroll({friendlyName:t});if(!o)return await this.client.mfa.listFactors().then(d=>{var h;return(h=d.data)===null||h===void 0?void 0:h.all.find(m=>m.factor_type==="webauthn"&&m.friendly_name===t&&m.status!=="unverified")}).then(d=>d?this.client.mfa.unenroll({factorId:d==null?void 0:d.id}):void 0),{data:null,error:l};const{data:c,error:u}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:n,rpOrigins:s},signal:r},{create:i});return c?this._verify({factorId:o.id,challengeId:c.challengeId,webauthn:{rpId:n,rpOrigins:s,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:u}}catch(o){return Re(o)?{data:null,error:o}:{data:null,error:new ms("Unexpected error in register",o)}}}}JN();const fj={url:uN,storageKey:dN,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:hN,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function hf(e,t,n){return await n()}const Fs={};class Ti{get jwks(){var t,n;return(n=(t=Fs[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(t){Fs[this.storageKey]=Object.assign(Object.assign({},Fs[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,n;return(n=(t=Fs[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){Fs[this.storageKey]=Object.assign(Object.assign({},Fs[this.storageKey]),{cachedAt:t})}constructor(t){var n,s,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},fj),t);if(this.storageKey=i.storageKey,this.instanceID=(n=Ti.nextInstanceID[this.storageKey])!==null&&n!==void 0?n:0,Ti.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&Mt()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new VN({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Hv(i.fetch),this.lock=i.lock||hf,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,i.lock?this.lock=i.lock:this.persistSession&&Mt()&&(!((s=globalThis==null?void 0:globalThis.navigator)===null||s===void 0)&&s.locks)?this.lock=GN:this.lock=hf,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new pj(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:zv()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=uf(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=uf(this.memoryStorage)),Mt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${qv}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let n={},s="none";if(Mt()&&(n=EN(window.location.href),this._isImplicitGrantCallback(n)?s="implicit":await this._isPKCECallback(n)&&(s="pkce")),Mt()&&this.detectSessionInUrl&&s!=="none"){const{data:r,error:i}=await this._getSessionFromURL(n,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),vN(i)){const c=(t=i.details)===null||t===void 0?void 0:t.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:l}=r;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return Re(n)?this._returnResult({error:n}):this._returnResult({error:new ms("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var n,s,r;try{const i=await Le(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(n=t==null?void 0:t.options)===null||n===void 0?void 0:n.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(r=t==null?void 0:t.options)===null||r===void 0?void 0:r.captchaToken}},xform:Mn}),{data:o,error:l}=i;if(l||!o)return this._returnResult({data:{user:null,session:null},error:l});const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:u,session:c},error:null})}catch(i){if(Re(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(t){var n,s,r;try{let i;if("email"in t){const{email:d,password:h,options:m}=t;let y=null,b=null;this.flowType==="pkce"&&([y,b]=await Os(this.storage,this.storageKey)),i=await Le(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:m==null?void 0:m.emailRedirectTo,body:{email:d,password:h,data:(n=m==null?void 0:m.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken},code_challenge:y,code_challenge_method:b},xform:Mn})}else if("phone"in t){const{phone:d,password:h,options:m}=t;i=await Le(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:h,data:(s=m==null?void 0:m.data)!==null&&s!==void 0?s:{},channel:(r=m==null?void 0:m.channel)!==null&&r!==void 0?r:"sms",gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken}},xform:Mn})}else throw new Co("You must provide either an email or phone number and a password");const{data:o,error:l}=i;if(l||!o)return await Dt(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:l});const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:u,session:c},error:null})}catch(i){if(await Dt(this.storage,`${this.storageKey}-code-verifier`),Re(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(t){try{let n;if("email"in t){const{email:i,password:o,options:l}=t;n=await Le(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:lf})}else if("phone"in t){const{phone:i,password:o,options:l}=t;n=await Le(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:lf})}else throw new Co("You must provide either an email or phone number and a password");const{data:s,error:r}=n;if(r)return this._returnResult({data:{user:null,session:null},error:r});if(!s||!s.session||!s.user){const i=new Ls;return this._returnResult({data:{user:null,session:null},error:i})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:r})}catch(n){if(Re(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(t){var n,s,r,i;return await this._handleProviderSignIn(t.provider,{redirectTo:(n=t.options)===null||n===void 0?void 0:n.redirectTo,scopes:(s=t.options)===null||s===void 0?void 0:s.scopes,queryParams:(r=t.options)===null||r===void 0?void 0:r.queryParams,skipBrowserRedirect:(i=t.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:n}=t;switch(n){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(t){var n,s,r,i,o,l,c,u,d,h,m;let y,b;if("message"in t)y=t.message,b=t.signature;else{const{chain:_,wallet:w,statement:f,options:p}=t;let g;if(Mt())if(typeof w=="object")g=w;else{const N=window;if("ethereum"in N&&typeof N.ethereum=="object"&&"request"in N.ethereum&&typeof N.ethereum.request=="function")g=N.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!(p!=null&&p.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");g=w}const j=new URL((n=p==null?void 0:p.url)!==null&&n!==void 0?n:window.location.href),A=await g.request({method:"eth_requestAccounts"}).then(N=>N).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!A||A.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const R=Vv(A[0]);let S=(s=p==null?void 0:p.signInWithEthereum)===null||s===void 0?void 0:s.chainId;if(!S){const N=await g.request({method:"eth_chainId"});S=QN(N)}const k={domain:j.host,address:R,statement:f,uri:j.href,version:"1",chainId:S,nonce:(r=p==null?void 0:p.signInWithEthereum)===null||r===void 0?void 0:r.nonce,issuedAt:(o=(i=p==null?void 0:p.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(l=p==null?void 0:p.signInWithEthereum)===null||l===void 0?void 0:l.expirationTime,notBefore:(c=p==null?void 0:p.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(u=p==null?void 0:p.signInWithEthereum)===null||u===void 0?void 0:u.requestId,resources:(d=p==null?void 0:p.signInWithEthereum)===null||d===void 0?void 0:d.resources};y=ZN(k),b=await g.request({method:"personal_sign",params:[XN(y),R]})}try{const{data:_,error:w}=await Le(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:y,signature:b},!((h=t.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(m=t.options)===null||m===void 0?void 0:m.captchaToken}}:null),xform:Mn});if(w)throw w;if(!_||!_.session||!_.user){const f=new Ls;return this._returnResult({data:{user:null,session:null},error:f})}return _.session&&(await this._saveSession(_.session),await this._notifyAllSubscribers("SIGNED_IN",_.session)),this._returnResult({data:Object.assign({},_),error:w})}catch(_){if(Re(_))return this._returnResult({data:{user:null,session:null},error:_});throw _}}async signInWithSolana(t){var n,s,r,i,o,l,c,u,d,h,m,y;let b,_;if("message"in t)b=t.message,_=t.signature;else{const{chain:w,wallet:f,statement:p,options:g}=t;let j;if(Mt())if(typeof f=="object")j=f;else{const R=window;if("solana"in R&&typeof R.solana=="object"&&("signIn"in R.solana&&typeof R.solana.signIn=="function"||"signMessage"in R.solana&&typeof R.solana.signMessage=="function"))j=R.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof f!="object"||!(g!=null&&g.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");j=f}const A=new URL((n=g==null?void 0:g.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in j&&j.signIn){const R=await j.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},g==null?void 0:g.signInWithSolana),{version:"1",domain:A.host,uri:A.href}),p?{statement:p}:null));let S;if(Array.isArray(R)&&R[0]&&typeof R[0]=="object")S=R[0];else if(R&&typeof R=="object"&&"signedMessage"in R&&"signature"in R)S=R;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in S&&"signature"in S&&(typeof S.signedMessage=="string"||S.signedMessage instanceof Uint8Array)&&S.signature instanceof Uint8Array)b=typeof S.signedMessage=="string"?S.signedMessage:new TextDecoder().decode(S.signedMessage),_=S.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in j)||typeof j.signMessage!="function"||!("publicKey"in j)||typeof j!="object"||!j.publicKey||!("toBase58"in j.publicKey)||typeof j.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");b=[`${A.host} wants you to sign in with your Solana account:`,j.publicKey.toBase58(),...p?["",p,""]:[""],"Version: 1",`URI: ${A.href}`,`Issued At: ${(r=(s=g==null?void 0:g.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&r!==void 0?r:new Date().toISOString()}`,...!((i=g==null?void 0:g.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${g.signInWithSolana.notBefore}`]:[],...!((o=g==null?void 0:g.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${g.signInWithSolana.expirationTime}`]:[],...!((l=g==null?void 0:g.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${g.signInWithSolana.chainId}`]:[],...!((c=g==null?void 0:g.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${g.signInWithSolana.nonce}`]:[],...!((u=g==null?void 0:g.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${g.signInWithSolana.requestId}`]:[],...!((h=(d=g==null?void 0:g.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||h===void 0)&&h.length?["Resources",...g.signInWithSolana.resources.map(S=>`- ${S}`)]:[]].join(`
`);const R=await j.signMessage(new TextEncoder().encode(b),"utf8");if(!R||!(R instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");_=R}}try{const{data:w,error:f}=await Le(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:b,signature:vs(_)},!((m=t.options)===null||m===void 0)&&m.captchaToken?{gotrue_meta_security:{captcha_token:(y=t.options)===null||y===void 0?void 0:y.captchaToken}}:null),xform:Mn});if(f)throw f;if(!w||!w.session||!w.user){const p=new Ls;return this._returnResult({data:{user:null,session:null},error:p})}return w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),this._returnResult({data:Object.assign({},w),error:f})}catch(w){if(Re(w))return this._returnResult({data:{user:null,session:null},error:w});throw w}}async _exchangeCodeForSession(t){const n=await ss(this.storage,`${this.storageKey}-code-verifier`),[s,r]=(n??"").split("/");try{if(!s&&this.flowType==="pkce")throw new bN;const{data:i,error:o}=await Le(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:s},xform:Mn});if(await Dt(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!i||!i.session||!i.user){const l=new Ls;return this._returnResult({data:{user:null,session:null,redirectType:null},error:l})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:r??null}),error:o})}catch(i){if(await Dt(this.storage,`${this.storageKey}-code-verifier`),Re(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(t){try{const{options:n,provider:s,token:r,access_token:i,nonce:o}=t,l=await Le(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:Mn}),{data:c,error:u}=l;if(u)return this._returnResult({data:{user:null,session:null},error:u});if(!c||!c.session||!c.user){const d=new Ls;return this._returnResult({data:{user:null,session:null},error:d})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:c,error:u})}catch(n){if(Re(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(t){var n,s,r,i,o;try{if("email"in t){const{email:l,options:c}=t;let u=null,d=null;this.flowType==="pkce"&&([u,d]=await Os(this.storage,this.storageKey));const{error:h}=await Le(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(n=c==null?void 0:c.data)!==null&&n!==void 0?n:{},create_user:(s=c==null?void 0:c.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:c==null?void 0:c.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:h})}if("phone"in t){const{phone:l,options:c}=t,{data:u,error:d}=await Le(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(r=c==null?void 0:c.data)!==null&&r!==void 0?r:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:d})}throw new Co("You must provide either an email or phone number.")}catch(l){if(await Dt(this.storage,`${this.storageKey}-code-verifier`),Re(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async verifyOtp(t){var n,s;try{let r,i;"options"in t&&(r=(n=t.options)===null||n===void 0?void 0:n.redirectTo,i=(s=t.options)===null||s===void 0?void 0:s.captchaToken);const{data:o,error:l}=await Le(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:i}}),redirectTo:r,xform:Mn});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,u=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),this._returnResult({data:{user:u,session:c},error:null})}catch(r){if(Re(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithSSO(t){var n,s,r,i,o;try{let l=null,c=null;this.flowType==="pkce"&&([l,c]=await Os(this.storage,this.storageKey));const u=await Le(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(s=(n=t.options)===null||n===void 0?void 0:n.redirectTo)!==null&&s!==void 0?s:void 0}),!((r=t==null?void 0:t.options)===null||r===void 0)&&r.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:l,code_challenge_method:c}),headers:this.headers,xform:zN});return!((i=u.data)===null||i===void 0)&&i.url&&Mt()&&!(!((o=t.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(u.data.url),this._returnResult(u)}catch(l){if(await Dt(this.storage,`${this.storageKey}-code-verifier`),Re(l))return this._returnResult({data:null,error:l});throw l}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:n},error:s}=t;if(s)throw s;if(!n)throw new cn;const{error:r}=await Le(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:r})})}catch(t){if(Re(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const n=`${this.url}/resend`;if("email"in t){const{email:s,type:r,options:i}=t,{error:o}=await Le(this.fetch,"POST",n,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in t){const{phone:s,type:r,options:i}=t,{data:o,error:l}=await Le(this.fetch,"POST",n,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:l})}throw new Co("You must provide either an email or phone number and a type")}catch(n){if(Re(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(t,n){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await s,await n()))();return this.pendingInLock.push((async()=>{try{await r}catch{}})()),r}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=n();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const r=[...this.pendingInLock];await Promise.all(r),this.pendingInLock.splice(0,r.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await t(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const n=await ss(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?t=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const s=t.expires_at?t.expires_at*1e3-Date.now()<Zc:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",t.expires_at),!s){if(this.userStorage){const o=await ss(this.userStorage,this.storageKey+"-user");o!=null&&o.user?t.user=o.user:t.user=nu()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};t.user=FN(t.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:r,error:i}=await this._callRefreshToken(t.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:r},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const n=await this._acquireLock(-1,async()=>await this._getUser());return n.data.user&&(this.suppressGetSessionWarning=!0),n}async _getUser(t){try{return t?await Le(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Ba}):await this._useSession(async n=>{var s,r,i;const{data:o,error:l}=n;if(l)throw l;return!(!((s=o.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new cn}:await Le(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(r=o.session)===null||r===void 0?void 0:r.access_token)!==null&&i!==void 0?i:void 0,xform:Ba})})}catch(n){if(Re(n))return yN(n)&&(await this._removeSession(),await Dt(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(t,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,n))}async _updateUser(t,n={}){try{return await this._useSession(async s=>{const{data:r,error:i}=s;if(i)throw i;if(!r.session)throw new cn;const o=r.session;let l=null,c=null;this.flowType==="pkce"&&t.email!=null&&([l,c]=await Os(this.storage,this.storageKey));const{data:u,error:d}=await Le(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n==null?void 0:n.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:l,code_challenge_method:c}),jwt:o.access_token,xform:Ba});if(d)throw d;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(s){if(await Dt(this.storage,`${this.storageKey}-code-verifier`),Re(s))return this._returnResult({data:{user:null},error:s});throw s}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new cn;const n=Date.now()/1e3;let s=n,r=!0,i=null;const{payload:o}=tu(t.access_token);if(o.exp&&(s=o.exp,r=s<=n),r){const{data:l,error:c}=await this._callRefreshToken(t.refresh_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l)return{data:{user:null,session:null},error:null};i=l}else{const{data:l,error:c}=await this._getUser(t.access_token);if(c)throw c;i={access_token:t.access_token,refresh_token:t.refresh_token,user:l.user,token_type:"bearer",expires_in:s-n,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(n){if(Re(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async n=>{var s;if(!t){const{data:o,error:l}=n;if(l)throw l;t=(s=o.session)!==null&&s!==void 0?s:void 0}if(!(t!=null&&t.refresh_token))throw new cn;const{data:r,error:i}=await this._callRefreshToken(t.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):r?this._returnResult({data:{user:r.user,session:r},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(Re(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(t,n){try{if(!Mt())throw new Ao("No browser detected.");if(t.error||t.error_description||t.error_code)throw new Ao(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new ef("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ao("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new ef("No code detected.");const{data:p,error:g}=await this._exchangeCodeForSession(t.code);if(g)throw g;const j=new URL(window.location.href);return j.searchParams.delete("code"),window.history.replaceState(window.history.state,"",j.toString()),{data:{session:p.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:r,access_token:i,refresh_token:o,expires_in:l,expires_at:c,token_type:u}=t;if(!i||!l||!o||!u)throw new Ao("No session defined in URL");const d=Math.round(Date.now()/1e3),h=parseInt(l);let m=d+h;c&&(m=parseInt(c));const y=m-d;y*1e3<=zs&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${y}s, should have been closer to ${h}s`);const b=m-h;d-b>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",b,m,d):d-b<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",b,m,d);const{data:_,error:w}=await this._getUser(i);if(w)throw w;const f={provider_token:s,provider_refresh_token:r,access_token:i,expires_in:h,expires_at:m,refresh_token:o,token_type:u,user:_.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:f,redirectType:t.type},error:null})}catch(s){if(Re(s))return this._returnResult({data:{session:null,redirectType:null},error:s});throw s}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const n=await ss(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&n)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async n=>{var s;const{data:r,error:i}=n;if(i)return this._returnResult({error:i});const o=(s=r.session)===null||s===void 0?void 0:s.access_token;if(o){const{error:l}=await this.admin.signOut(o,t);if(l&&!(gN(l)&&(l.status===404||l.status===401||l.status===403)))return this._returnResult({error:l})}return t!=="others"&&(await this._removeSession(),await Dt(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const n=SN(),s={id:n,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:s}}}async _emitInitialSession(t){return await this._useSession(async n=>{var s,r;try{const{data:{session:i},error:o}=n;if(o)throw o;await((s=this.stateChangeEmitters.get(t))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",t,"session",i)}catch(i){await((r=this.stateChangeEmitters.get(t))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",i),console.error(i)}})}async resetPasswordForEmail(t,n={}){let s=null,r=null;this.flowType==="pkce"&&([s,r]=await Os(this.storage,this.storageKey,!0));try{return await Le(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(i){if(await Dt(this.storage,`${this.storageKey}-code-verifier`),Re(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var t;try{const{data:n,error:s}=await this.getUser();if(s)throw s;return this._returnResult({data:{identities:(t=n.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var n;try{const{data:s,error:r}=await this._useSession(async i=>{var o,l,c,u,d;const{data:h,error:m}=i;if(m)throw m;const y=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(o=t.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=t.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=t.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await Le(this.fetch,"GET",y,{headers:this.headers,jwt:(d=(u=h.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(r)throw r;return Mt()&&!(!((n=t.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),this._returnResult({data:{provider:t.provider,url:s==null?void 0:s.url},error:null})}catch(s){if(Re(s))return this._returnResult({data:{provider:t.provider,url:null},error:s});throw s}}async linkIdentityIdToken(t){return await this._useSession(async n=>{var s;try{const{error:r,data:{session:i}}=n;if(r)throw r;const{options:o,provider:l,token:c,access_token:u,nonce:d}=t,h=await Le(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=i==null?void 0:i.access_token)!==null&&s!==void 0?s:void 0,body:{provider:l,id_token:c,access_token:u,nonce:d,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Mn}),{data:m,error:y}=h;return y?this._returnResult({data:{user:null,session:null},error:y}):!m||!m.session||!m.user?this._returnResult({data:{user:null,session:null},error:new Ls}):(m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("USER_UPDATED",m.session)),this._returnResult({data:m,error:y}))}catch(r){if(await Dt(this.storage,`${this.storageKey}-code-verifier`),Re(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}})}async unlinkIdentity(t){try{return await this._useSession(async n=>{var s,r;const{data:i,error:o}=n;if(o)throw o;return await Le(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(r=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&r!==void 0?r:void 0})})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(t){const n=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(n,"begin");try{const s=Date.now();return await IN(async r=>(r>0&&await AN(200*Math.pow(2,r-1)),this._debug(n,"refreshing attempt",r),await Le(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Mn})),(r,i)=>{const o=200*Math.pow(2,r);return i&&eu(i)&&Date.now()+o-s<zs})}catch(s){if(this._debug(n,"error",s),Re(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}finally{this._debug(n,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,n){const s=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",n,"url",s),Mt()&&!n.skipBrowserRedirect&&window.location.assign(s),{data:{provider:t,url:s},error:null}}async _recoverAndRefresh(){var t,n;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const r=await ss(this.storage,this.storageKey);if(r&&this.userStorage){let o=await ss(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:r.user},await Hs(this.userStorage,this.storageKey+"-user",o)),r.user=(t=o==null?void 0:o.user)!==null&&t!==void 0?t:nu()}else if(r&&!r.user&&!r.user){const o=await ss(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(r.user=o.user,await Dt(this.storage,this.storageKey+"-user"),await Hs(this.storage,this.storageKey,r)):r.user=nu()}if(this._debug(s,"session from storage",r),!this._isValidSession(r)){this._debug(s,"session is not valid"),r!==null&&await this._removeSession();return}const i=((n=r.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<Zc;if(this._debug(s,`session has${i?"":" not"} expired with margin of ${Zc}s`),i){if(this.autoRefreshToken&&r.refresh_token){const{error:o}=await this._callRefreshToken(r.refresh_token);o&&(console.error(o),eu(o)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(r.user&&r.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:l}=await this._getUser(r.access_token);!l&&(o!=null&&o.user)?(r.user=o.user,await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(s,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(s,"error",r),console.error(r);return}finally{this._debug(s,"end")}}async _callRefreshToken(t){var n,s;if(!t)throw new cn;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new cc;const{data:i,error:o}=await this._refreshAccessToken(t);if(o)throw o;if(!i.session)throw new cn;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const l={data:i.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(i){if(this._debug(r,"error",i),Re(i)){const o={data:null,error:i};return eu(i)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(t,n,s=!0){const r=`#_notifyAllSubscribers(${t})`;this._debug(r,"begin",n,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:t,session:n});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(t,n)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let l=0;l<i.length;l+=1)console.error(i[l]);throw i[0]}}finally{this._debug(r,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await Dt(this.storage,`${this.storageKey}-code-verifier`);const n=Object.assign({},t),s=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&n.user&&await Hs(this.userStorage,this.storageKey+"-user",{user:n.user});const r=Object.assign({},n);delete r.user;const i=rf(r);await Hs(this.storage,this.storageKey,i)}else{const r=rf(n);await Hs(this.storage,this.storageKey,r)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Dt(this.storage,this.storageKey),await Dt(this.storage,this.storageKey+"-code-verifier"),await Dt(this.storage,this.storageKey+"-user"),this.userStorage&&await Dt(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&Mt()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),zs);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async n=>{const{data:{session:s}}=n;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const r=Math.floor((s.expires_at*1e3-t)/zs);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts ${zs}ms, refresh threshold is ${xd} ticks`),r<=xd&&await this._callRefreshToken(s.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof Yv)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Mt()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const n=`#_onVisibilityChanged(${t})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,n,s){const r=[`provider=${encodeURIComponent(n)}`];if(s!=null&&s.redirectTo&&r.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&r.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[i,o]=await Os(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});r.push(l.toString())}if(s!=null&&s.queryParams){const i=new URLSearchParams(s.queryParams);r.push(i.toString())}return s!=null&&s.skipBrowserRedirect&&r.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${t}?${r.join("&")}`}async _unenroll(t){try{return await this._useSession(async n=>{var s;const{data:r,error:i}=n;return i?this._returnResult({data:null,error:i}):await Le(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(s=r==null?void 0:r.session)===null||s===void 0?void 0:s.access_token})})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(t){try{return await this._useSession(async n=>{var s,r;const{data:i,error:o}=n;if(o)return this._returnResult({data:null,error:o});const l=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:c,error:u}=await Le(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return u?this._returnResult({data:null,error:u}):(t.factorType==="totp"&&c.type==="totp"&&(!((r=c==null?void 0:c.totp)===null||r===void 0)&&r.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),this._returnResult({data:c,error:null}))})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var s;const{data:r,error:i}=n;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?ij(t.webauthn.credential_response):oj(t.webauthn.credential_response)})}:{code:t.code}),{data:l,error:c}=await Le(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:o,headers:this.headers,jwt:(s=r==null?void 0:r.session)===null||s===void 0?void 0:s.access_token});return c?this._returnResult({data:null,error:c}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),this._returnResult({data:l,error:c}))})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var s;const{data:r,error:i}=n;if(i)return this._returnResult({data:null,error:i});const o=await Le(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(s=r==null?void 0:r.session)===null||s===void 0?void 0:s.access_token});if(o.error)return o;const{data:l}=o;if(l.type!=="webauthn")return{data:l,error:null};switch(l.webauthn.type){case"create":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:sj(l.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:rj(l.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(t){const{data:n,error:s}=await this._challenge({factorId:t.factorId});return s?this._returnResult({data:null,error:s}):await this._verify({factorId:t.factorId,challengeId:n.id,code:t.code})}async _listFactors(){var t;const{data:{user:n},error:s}=await this.getUser();if(s)return{data:null,error:s};const r={all:[],phone:[],totp:[],webauthn:[]};for(const i of(t=n==null?void 0:n.factors)!==null&&t!==void 0?t:[])r.all.push(i),i.status==="verified"&&r[i.factor_type].push(i);return{data:r,error:null}}async _getAuthenticatorAssuranceLevel(){var t,n;const{data:{session:s},error:r}=await this.getSession();if(r)return this._returnResult({data:null,error:r});if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=tu(s.access_token);let o=null;i.aal&&(o=i.aal);let l=o;((n=(t=s.user.factors)===null||t===void 0?void 0:t.filter(d=>d.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(l="aal2");const u=i.amr||[];return{data:{currentLevel:o,nextLevel:l,currentAuthenticationMethods:u},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async n=>{const{data:{session:s},error:r}=n;return r?this._returnResult({data:null,error:r}):s?await Le(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:s.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new cn})})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(t,n){try{return await this._useSession(async s=>{const{data:{session:r},error:i}=s;if(i)return this._returnResult({data:null,error:i});if(!r)return this._returnResult({data:null,error:new cn});const o=await Le(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:r.access_token,body:{action:"approve"},xform:l=>({data:l,error:null})});return o.data&&o.data.redirect_url&&Mt()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(s){if(Re(s))return this._returnResult({data:null,error:s});throw s}}async _denyAuthorization(t,n){try{return await this._useSession(async s=>{const{data:{session:r},error:i}=s;if(i)return this._returnResult({data:null,error:i});if(!r)return this._returnResult({data:null,error:new cn});const o=await Le(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:r.access_token,body:{action:"deny"},xform:l=>({data:l,error:null})});return o.data&&o.data.redirect_url&&Mt()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(s){if(Re(s))return this._returnResult({data:null,error:s});throw s}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:n},error:s}=t;return s?this._returnResult({data:null,error:s}):n?await Le(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,xform:r=>({data:r,error:null})}):this._returnResult({data:null,error:new cn})})}catch(t){if(Re(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async n=>{const{data:{session:s},error:r}=n;return r?this._returnResult({data:null,error:r}):s?(await Le(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new cn})})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}}async fetchJwk(t,n={keys:[]}){let s=n.keys.find(l=>l.kid===t);if(s)return s;const r=Date.now();if(s=this.jwks.keys.find(l=>l.kid===t),s&&this.jwks_cached_at+pN>r)return s;const{data:i,error:o}=await Le(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=r,s=i.keys.find(l=>l.kid===t),!s)?null:s}async getClaims(t,n={}){try{let s=t;if(!s){const{data:y,error:b}=await this.getSession();if(b||!y.session)return this._returnResult({data:null,error:b});s=y.session.access_token}const{header:r,payload:i,signature:o,raw:{header:l,payload:c}}=tu(s);n!=null&&n.allowExpired||ON(i.exp);const u=!r.alg||r.alg.startsWith("HS")||!r.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(r.kid,n!=null&&n.keys?{keys:n.keys}:n==null?void 0:n.jwks);if(!u){const{error:y}=await this.getUser(s);if(y)throw y;return{data:{claims:i,header:r,signature:o},error:null}}const d=$N(r.alg),h=await crypto.subtle.importKey("jwk",u,d,!0,["verify"]);if(!await crypto.subtle.verify(d,h,o,NN(`${l}.${c}`)))throw new Nd("Invalid JWT signature");return{data:{claims:i,header:r,signature:o},error:null}}catch(s){if(Re(s))return this._returnResult({data:null,error:s});throw s}}}Ti.nextInstanceID={};const gj=Ti,yj="2.88.0";let Vr="";typeof Deno<"u"?Vr="deno":typeof document<"u"?Vr="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Vr="react-native":Vr="node";const vj={"X-Client-Info":`supabase-js-${Vr}/${yj}`},bj={headers:vj},_j={schema:"public"},xj={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},wj={};function Ri(e){"@babel/helpers - typeof";return Ri=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ri(e)}function kj(e,t){if(Ri(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(Ri(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Nj(e){var t=kj(e,"string");return Ri(t)=="symbol"?t:t+""}function jj(e,t,n){return(t=Nj(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function vt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?mf(Object(n),!0).forEach(function(s){jj(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mf(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}const Sj=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),Ej=()=>Headers,Cj=(e,t,n)=>{const s=Sj(n),r=Ej();return async(i,o)=>{var l;const c=(l=await t())!==null&&l!==void 0?l:e;let u=new r(o==null?void 0:o.headers);return u.has("apikey")||u.set("apikey",e),u.has("Authorization")||u.set("Authorization",`Bearer ${c}`),s(i,vt(vt({},o),{},{headers:u}))}};function Aj(e){return e.endsWith("/")?e:e+"/"}function Ij(e,t){var n,s;const{db:r,auth:i,realtime:o,global:l}=e,{db:c,auth:u,realtime:d,global:h}=t,m={db:vt(vt({},c),r),auth:vt(vt({},u),i),realtime:vt(vt({},d),o),storage:{},global:vt(vt(vt({},h),l),{},{headers:vt(vt({},(n=h==null?void 0:h.headers)!==null&&n!==void 0?n:{}),(s=l==null?void 0:l.headers)!==null&&s!==void 0?s:{})}),accessToken:async()=>""};return e.accessToken?m.accessToken=e.accessToken:delete m.accessToken,m}function Pj(e){const t=e==null?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Aj(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var Tj=class extends gj{constructor(e){super(e)}},Rj=class{constructor(e,t,n){var s,r;this.supabaseUrl=e,this.supabaseKey=t;const i=Pj(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const o=`sb-${i.hostname.split(".")[0]}-auth-token`,l={db:_j,realtime:wj,auth:vt(vt({},xj),{},{storageKey:o}),global:bj},c=Ij(n??{},l);if(this.storageKey=(s=c.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(r=c.global.headers)!==null&&r!==void 0?r:{},c.accessToken)this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(d,h)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(h)} is not possible`)}});else{var u;this.auth=this._initSupabaseAuthClient((u=c.auth)!==null&&u!==void 0?u:{},this.headers,c.global.fetch)}this.fetch=Cj(t,this._getAccessToken.bind(this),c.global.fetch),this.realtime=this._initRealtimeClient(vt({headers:this.headers,accessToken:this._getAccessToken.bind(this)},c.realtime)),this.accessToken&&this.accessToken().then(d=>this.realtime.setAuth(d)).catch(d=>console.warn("Failed to set initial Realtime auth token:",d)),this.rest=new hk(new URL("rest/v1",i).href,{headers:this.headers,schema:c.db.schema,fetch:this.fetch}),this.storage=new cN(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),c.accessToken||this._listenForAuthEvents()}get functions(){return new ok(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e=this,t,n;if(e.accessToken)return await e.accessToken();const{data:s}=await e.auth.getSession();return(t=(n=s.session)===null||n===void 0?void 0:n.access_token)!==null&&t!==void 0?t:e.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,userStorage:r,storageKey:i,flowType:o,lock:l,debug:c,throwOnError:u},d,h){const m={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Tj({url:this.authUrl.href,headers:vt(vt({},m),d),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,userStorage:r,flowType:o,lock:l,debug:c,throwOnError:u,fetch:h,hasCustomAuthorizationHeader:Object.keys(this.headers).some(y=>y.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new Ak(this.realtimeUrl.href,vt(vt({},e),{},{params:vt(vt({},{apikey:this.supabaseKey}),e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",t==null?void 0:t.access_token)})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const Dj=(e,t,n)=>new Rj(e,t,n);function Mj(){if(typeof window<"u"||typeof process>"u")return!1;const e=process.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}Mj()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Lj={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:"sb_publishable_9AUU36J3CW2PWPdk3nqrtA_RwBAnQqk",VITE_SUPABASE_URL:"https://ebiskijxrorazuroljxt.supabase.co",VITE_WORKER_URL:"https://adurun-campaigns.larhackman.workers.dev"};let Io=null;function Oj(){const e=Lj??{},t=globalThis.__SUPABASE_ENV__??{};return{...e,...t}}function ze(){if(Io)return Io;const e=Oj(),t=e.VITE_SUPABASE_URL,n=e.VITE_SUPABASE_ANON_KEY;if(!t||!n)throw new Error("VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY must be set");return Io=Dj(t,n),Io}const $j={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:"sb_publishable_9AUU36J3CW2PWPdk3nqrtA_RwBAnQqk",VITE_SUPABASE_URL:"https://ebiskijxrorazuroljxt.supabase.co",VITE_WORKER_URL:"https://adurun-campaigns.larhackman.workers.dev"};class Te extends Error{constructor(t,n,s){super(n),this.name="ApiError",this.status=t,this.info=s}}const Bj=["VITE_SUPABASE_URL","VITE_SUPABASE_ANON_KEY"];function Fj(){const e=$j??{},t=globalThis.__SUPABASE_ENV__??{};return{...e,...t}}function Cs(){const e=Fj(),t=Bj.filter(n=>!e[n]);if(t.length)throw new Te(0,`Missing env vars: ${t.join(", ")}`)}function Jn(e,t){if(e.error)throw new Te(0,`${t}: ${e.error.message}`);return e.data}function qs(e){return{id:e.key,code:e.key,name:e.name,description:e.description??void 0}}function qj(e){return{id:e.key,code:e.key,parentId:e.race_key,name:e.name,description:e.description??void 0}}function Uj(e){return{id:e.key,name:e.name,description:e.description??void 0,expression:e.expression}}function Wj(e){return{id:e.id,sourceType:e.source_type,sourceKey:e.source_key,targetPath:e.target_path,operation:e.operation,stackingKey:e.stacking_key??void 0,priority:e.priority??void 0,valueExpression:e.value_expression,conditionExpression:e.condition_expression}}function zj(e){const t={};return e.forEach(n=>{t[n.race_key]={attributes:n.attributes??{},skills:n.skills??{},disciplines:n.disciplines??{},deityCapPerSpirit:n.deity_cap_per_spirit??void 0}}),t}function Hj(e,t,n){const s=Object.fromEntries(e.map(o=>[o.id,{score:0}])),r=Object.fromEntries(t.map(o=>[o.code??o.id,{score:0,racialBonus:0}])),i=Object.fromEntries(n.map(o=>[o.id,0]));return{attributes:s,skills:r,derived:i}}function Yj(e,t,n,s){const r=Hj(e,t,n),i=Pv({baseState:r,modifiers:s}),o={};return n.forEach(l=>{const c=Xt(l.expression,{state:i});o[l.id]=typeof c=="number"?c:0}),o}async function Vj(e){const{data:t,error:n}=await e.from("content_rulesets").select("id, key, name, description").limit(1).maybeSingle();if(n)throw new Te(0,`Failed to load ruleset: ${n.message}`);if(!t)throw new Te(0,"No ruleset found in Supabase content tables");return t}async function Kj(){Cs();const e=ze(),t=await Vj(e),n={column:"ruleset_id",value:t.id},[s,r,i,o,l,c,u,d,h,m]=await Promise.all([e.from("content_attributes").select("key, name, description").eq(n.column,n.value),e.from("content_skills").select("key, name, description, attribute_key").eq(n.column,n.value),e.from("content_races").select("key, name, description").eq(n.column,n.value),e.from("content_subraces").select("key, race_key, name, description").eq(n.column,n.value),e.from("content_feats").select("key, name, description, prereq_expression").eq(n.column,n.value),e.from("content_items").select("key, name, description, slot").eq(n.column,n.value),e.from("content_status_effects").select("key, name, description, default_duration_type").eq(n.column,n.value),e.from("content_derived_stats").select("key, name, description, expression").eq(n.column,n.value),e.from("content_modifiers").select("id, source_type, source_key, target_path, operation, stacking_key, priority, value_expression, condition_expression").eq(n.column,n.value),e.from("content_race_details").select("race_key, attributes, skills, disciplines, deity_cap_per_spirit").eq(n.column,n.value)]),y=Jn(s,"Failed to load attributes").map(qs),b=Jn(r,"Failed to load skills").map(S=>({...qs(S),attributeKey:S.attribute_key??void 0})),_=Jn(i,"Failed to load races").map(qs),w=Jn(o,"Failed to load subraces").map(qj),f=Jn(l,"Failed to load feats").map(qs),p=Jn(c,"Failed to load items").map(qs),g=Jn(u,"Failed to load status effects").map(qs),j=Jn(d,"Failed to load derived stats").map(Uj),A=Jn(h,"Failed to load modifiers").map(Wj),R=Jn(m,"Failed to load race details");return{ruleset:t.key,attributes:y,skills:b,races:_,subraces:w,feats:f,items:p,statusEffects:g,derivedStats:j,derivedStatValues:Yj(y,b,j,A),modifiers:A,raceDetails:zj(R)}}function uc(e){return{id:e.id,campaignId:e.campaign_id??void 0,userId:e.user_id??void 0,name:e.name,level:e.level,raceKey:e.race_key??void 0,subraceKey:e.subrace_key??void 0,notes:e.notes??void 0,attributePointsAvailable:e.attribute_points_available??void 0,skillPoints:e.skill_points,skillAllocations:e.skill_allocations??{},skillAllocationMinimums:e.skill_allocation_minimums??void 0,skillBonuses:e.skill_bonuses??void 0,backgrounds:e.backgrounds??void 0,attributes:e.attributes??void 0,fatePoints:e.fate_points??void 0,weaponNotes:e.weapon_notes??void 0,defenseNotes:e.defense_notes??void 0,gearNotes:e.gear_notes??void 0,createdAt:e.created_at??void 0,updatedAt:e.updated_at??void 0}}function Gv(e){const t={updated_at:new Date().toISOString()};return e.name!==void 0&&(t.name=e.name),e.level!==void 0&&(t.level=e.level),e.campaignId!==void 0&&(t.campaign_id=e.campaignId??null),e.userId!==void 0&&(t.user_id=e.userId??null),e.raceKey!==void 0&&(t.race_key=e.raceKey??null),e.subraceKey!==void 0&&(t.subrace_key=e.subraceKey??null),e.notes!==void 0&&(t.notes=e.notes??null),e.attributePointsAvailable!==void 0&&(t.attribute_points_available=e.attributePointsAvailable??null),e.skillPoints!==void 0&&(t.skill_points=e.skillPoints??0),e.skillAllocations!==void 0&&(t.skill_allocations=e.skillAllocations??{}),e.skillAllocationMinimums!==void 0&&(t.skill_allocation_minimums=e.skillAllocationMinimums??null),e.skillBonuses!==void 0&&(t.skill_bonuses=e.skillBonuses??null),e.backgrounds!==void 0&&(t.backgrounds=e.backgrounds??null),e.attributes!==void 0&&(t.attributes=e.attributes??null),e.fatePoints!==void 0&&(t.fate_points=e.fatePoints??null),e.weaponNotes!==void 0&&(t.weapon_notes=e.weaponNotes??null),e.defenseNotes!==void 0&&(t.defense_notes=e.defenseNotes??null),e.gearNotes!==void 0&&(t.gear_notes=e.gearNotes??null),t}async function Gj(){Cs();const e=ze(),{data:t,error:n}=await e.from("characters").select("*").order("created_at",{ascending:!0});if(n)throw new Te(0,`Failed to load characters: ${n.message}`);return(t??[]).map(uc)}async function Jj(e){Cs();const t=ze(),{data:n,error:s}=await t.from("characters").select("*").eq("campaign_id",e).order("created_at",{ascending:!0});if(s)throw new Te(0,`Failed to load campaign characters: ${s.message}`);return(n??[]).map(uc)}async function Qj(e){Cs();const t=ze();if(e.name===void 0||e.level===void 0)throw new Te(0,"name and level are required to create a character");const n={skillPoints:0,skillAllocations:{},...e},s=Gv(n),{data:r,error:i}=await t.from("characters").insert(s).select("*").single();if(i||!r)throw new Te(0,`Failed to create character: ${(i==null?void 0:i.message)??"unknown error"}`);return uc(r)}async function Xj(e,t){Cs();const n=ze(),s=Gv(t),{data:r,error:i}=await n.from("characters").update(s).eq("id",e).select("*").single();if(i||!r)throw new Te(0,`Failed to update character: ${(i==null?void 0:i.message)??"unknown error"}`);return uc(r)}async function Zj(e){Cs();const t=ze(),{error:n}=await t.from("characters").delete().eq("id",e);if(n)throw new Te(0,`Failed to delete character: ${n.message}`)}async function eS(){Cs();const e=ze(),{data:t,error:n}=await e.from("psionic_abilities").select("ability_tree, ability, tier, prerequisite, description, energy_cost");if(n)throw new Te(0,`Failed to load psionic abilities: ${n.message}`);return t??[]}const Ct={listCharacters:Gj,listCampaignCharacters:Jj,createCharacter:Qj,updateCharacter:Xj,deleteCharacter:Zj,getDefinitions:Kj,listPsionicAbilities:eS},Jv=v.createContext(void 0),tS=e=>{if(!e||typeof e!="object")return!1;const t=e;return typeof t.id=="string"&&typeof t.name=="string"},rs=(e,t)=>{if(!Array.isArray(e))throw new Error(`Expected ${t} to be an array`);return e.map((n,s)=>{if(!tS(n))throw new Error(`Invalid ${t} entry at index ${s}`);return{id:n.id,code:typeof n.code=="string"?n.code:void 0,parentId:typeof n.parentId=="string"?n.parentId:void 0,name:n.name,description:typeof n.description=="string"?n.description:void 0}})},nS=e=>{if(!e||typeof e!="object")return!1;const t=e;return typeof t.id=="string"&&typeof t.targetPath=="string"&&typeof t.operation=="string"&&typeof t.sourceType=="string"&&typeof t.sourceKey=="string"&&t.valueExpression!==void 0},aS=(e,t)=>{if(!Array.isArray(e))throw new Error(`Expected ${t} to be an array`);return e.map((n,s)=>{if(!nS(n))throw new Error(`Invalid ${t} entry at index ${s}`);return n})},sS=e=>{if(!e||typeof e!="object")return!1;const t=e;return typeof t.id=="string"&&typeof t.name=="string"&&!!t.expression&&typeof t.expression=="object"},rS=(e,t)=>{if(!Array.isArray(e))throw new Error(`Expected ${t} to be an array`);return e.map((n,s)=>{if(!sS(n))throw new Error(`Invalid ${t} entry at index ${s}`);return n})},iS=e=>{if(!e||typeof e!="object")throw new Error("Unexpected definitions response");const t=e;return{ruleset:typeof t.ruleset=="string"?t.ruleset:null,attributes:rs(t.attributes,"attributes"),skills:rs(t.skills,"skills"),races:rs(t.races,"races"),subraces:rs(t.subraces,"subraces"),feats:rs(t.feats,"feats"),items:rs(t.items,"items"),statusEffects:rs(t.statusEffects,"statusEffects"),derivedStats:rS(t.derivedStats,"derivedStats"),derivedStatValues:t.derivedStatValues&&typeof t.derivedStatValues=="object"?t.derivedStatValues:void 0,modifiers:aS(t.modifiers,"modifiers"),raceDetails:t.raceDetails&&typeof t.raceDetails=="object"?t.raceDetails:{}}},oS=({children:e})=>{const[t,n]=v.useState(null),[s,r]=v.useState(!0),[i,o]=v.useState(null),l=v.useCallback(async()=>{r(!0),o(null);try{const u=await Ct.getDefinitions(),d=iS(u);n(d)}catch(u){const d=u instanceof Error?u.message:"Failed to load definitions";o(d)}finally{r(!1)}},[]);v.useEffect(()=>{l()},[l]);const c=v.useMemo(()=>({data:t,loading:s,error:i,reload:l}),[t,s,i,l]);return a.jsx(Jv.Provider,{value:c,children:e})},As=()=>{const e=v.useContext(Jv);if(!e)throw new Error("useDefinitions must be used within a DefinitionsProvider");return e},Qv=v.createContext(void 0),jd="selected_character_id",lS=()=>{if(typeof window>"u")return null;const e=window.localStorage.getItem(jd);return e&&e.trim()?e:null},cS=({children:e})=>{const[t,n]=v.useState(()=>lS()),s=v.useCallback(i=>{n(i),!(typeof window>"u")&&(i?window.localStorage.setItem(jd,i):window.localStorage.removeItem(jd))},[]),r=v.useMemo(()=>({selectedId:t,setSelectedId:s}),[t,s]);return a.jsx(Qv.Provider,{value:r,children:e})},Is=()=>{const e=v.useContext(Qv);if(!e)throw new Error("useSelectedCharacter must be used within SelectedCharacterProvider");return e},uS=["PHYSICAL","MENTAL","SPIRITUAL","WILL"],dS={PHYSICAL:"Physical Skills",MENTAL:"Mental Skills",SPIRITUAL:"Spiritual Skills",WILL:"Will Skills"},em={ACADEMIC_RECALL:["MENTAL"],ANIMAL_HUSBANDRY:["PHYSICAL","SPIRITUAL"],ARTISTRY:["SPIRITUAL","WILL"],ATTUNE_WONDEROUS_ITEM:["SPIRITUAL"],BATTLE:["PHYSICAL"],CRAFT:["MENTAL","PHYSICAL"],CONCEAL:["PHYSICAL"],DEDUCE:["MENTAL","SPIRITUAL"],DECEIVE:["MENTAL","WILL"],DIVINE_INTERVENTION:["SPIRITUAL"],ENDURE:["WILL"],FEAT_OF_AGILITY:["PHYSICAL"],FEAT_OF_AUSTERITY:["WILL"],FEAT_OF_DEFIANCE:["WILL"],FEAT_OF_STRENGTH:["PHYSICAL"],FORAGE:["MENTAL","PHYSICAL"],GATHER_INTELLIGENCE:["MENTAL","WILL"],HEAL:["PHYSICAL","SPIRITUAL"],IDENTIFY:["MENTAL","SPIRITUAL"],INCITE_FATE:["SPIRITUAL","WILL"],INTIMIDATE:["PHYSICAL","WILL"],INTERPRET:["MENTAL","SPIRITUAL"],ILDAKAR_FACULTY:[],MARTIAL_PROWESS:[],NAVIGATE:["PHYSICAL","SPIRITUAL"],PARLEY:["SPIRITUAL","WILL"],PERFORM:["PHYSICAL","WILL"],PERSEVERE:["WILL"],PSIONIC_TECHNIQUE:["MENTAL"],RESIST_PSIONICS:["MENTAL"],RESIST_SUPERNATURAL:["SPIRITUAL"],RESIST_TOXINS:["PHYSICAL"],SEDUCE:["PHYSICAL","WILL"],SENSE_SUPERNATURAL:["SPIRITUAL"],SEARCH:["MENTAL"],TRACK:["MENTAL","PHYSICAL"],TRADE:["MENTAL","WILL"],TRANSLATE:["MENTAL"],WILL_DAKAR:["WILL"],WORSHIP:["SPIRITUAL"]},pf={PHYSICAL:"Physical Skills",MENTAL:"Mental Skills",SPIRITUAL:"Spiritual Skills",WILL:"Will Skills","PHYSICAL+MENTAL":"Subsistence Skills","PHYSICAL+SPIRITUAL":"Intuition Skills","PHYSICAL+WILL":"Presence Skills","MENTAL+WILL":"Cunning Skills","MENTAL+SPIRITUAL":"Sagacity Skills","SPIRITUAL+WILL":"Benediction Skills"},ff=["PHYSICAL","MENTAL","SPIRITUAL","WILL","PHYSICAL+MENTAL","PHYSICAL+SPIRITUAL","PHYSICAL+WILL","MENTAL+WILL","MENTAL+SPIRITUAL","SPIRITUAL+WILL"],wt=e=>e.code??e.id,aa=e=>(e.code??e.id??e.name??"").toUpperCase().replace(/[^A-Z0-9]+/g,"_").replace(/^_+|_+$/g,""),hS=e=>{const t=typeof e=="string"?e:aa(e);return em[t]??[]},ma=(e,t)=>{if(!t)return{};const n={};return t.forEach(s=>{const r=aa(s),o=(em[r]??[]).filter(c=>c in e);if(!o.length)return;const l=wt(s);n[l]=o.reduce((c,u)=>c+e[u]*10,0)}),n},Xv=e=>{const t=new Map(uS.map((n,s)=>[n,s]));return Array.from(new Set(e)).sort((n,s)=>(t.get(n)??99)-(t.get(s)??99))},mS=e=>e.length?Xv(e).join("+"):"uncategorized",pS=e=>{if(!e.length)return"Uncategorized";const t=Xv(e),n=t.join("+");return pf[n]?pf[n]:t.map(s=>dS[s]).join(" + ")},fS=e=>{const t=new Map;return e.forEach(s=>{var l;const r=hS(s),i=mS(r),o=pS(r);t.has(i)||t.set(i,{key:i,label:o,skills:[]}),(l=t.get(i))==null||l.skills.push(s)}),Array.from(t.keys()).sort((s,r)=>{const i=ff.indexOf(s),o=ff.indexOf(r);return i===-1&&o===-1?s.localeCompare(r):i===-1?1:o===-1?-1:i-o}).map(s=>t.get(s))},Zv=`Ability Tree,Ability,Tier,Prerequisite,Description,Energy Cost,Formula\r
Telepathy,Telepathy,1,,"Allows user to read surface level thoughts of adjacent creatures, send silent messages to creatures, alert yourself to unspecified presences adjacent to you, add your mental attribute to your resist psionics, and use manifold manifestation up to mental attribute psionic techniques in the Telepathy tree at once",5,Mental*5\r
Telepathy,Pry,2,Telepathy,Search an adjacent target's thoughts for specifics,10,\r
Telepathy,Interlink,3,Pry,Allow another creature you are linked with or communicating with to engage with your telepathy as well.,15,\r
Telepathy,Transfer,4,Interlink,send memories or thoughts of target to another creature,20,\r
Telepathy,Project (Pry),5,Transfer,send memories or thoughts to all creatures within an area equal to mental attribute x10 ft of you,25,\r
Telepathy,Read Memory,3,Pry,search through a creatures memory for information,15,\r
Telepathy,Read Link,4,Read Memory,read what links a creature has access to and what those links are,20,\r
Telepathy,Read Genome,5,Read Link,gain access to a creatures historical lineage,25,\r
Telepathy,Surface,3,Pry,read surface thoughts of a creature within mental attribute x10 ft of you,15,\r
Telepathy,Subsurface,4,Surface,read underlying thoughts of a creature within mental attribute x10 ft of you,20,\r
Telepathy,Deep Dive,5,Subsurface,discover all there is to know within a creature's mind within mental attribute x10 ft of you save for masked or otherwise magically or psionically secured information,25,\r
Telepathy,Sense Presence,2,Telepathy,automatically sense non-supernatural unmasked presences adjacent to you,10,\r
Telepathy,Focus Signal,3,Sense Presence,hone in on a specific type of non-supernatural presence,15,\r
Telepathy,Project Signal,4,Focus Signal,focus in on areas not adjacent to you within a range of 10 ft,20,\r
Telepathy,Locate Presence,5,Project Signal,ability to locate exact positions of presences within range also now applies to supernatural presences,25,\r
Telepathy,Sensitivity I,3,Sense Presence,overcome mask I,15,\r
Telepathy,Sensitivity II,4,Sensitivity I,overcome mask II,20,\r
Telepathy,Sensitivity III,5,Sensitivity II,overcome mask III,25,\r
Telepathy,Area I,3,Sense Presence,increase aura to mental attribute x5 ft,15,\r
Telepathy,Area II,4,Area I,increase aura to mental attribute x10 ft,20,\r
Telepathy,Area III,5,Area II,increase aura to mental attribute x25 ft,25,\r
Telepathy,Communicate,2,Telepathy,"Ability to send silent messages images, sounds, etc. to creatures within 15ft of you",10,\r
Telepathy,Project,3,Communicate,Increase aura to 30ft,15,\r
Telepathy,Forward Chain,4,Project,Speak to a creature through another creature you are currently communicating with,20,\r
Telepathy,Back Chain,5,Forward Chain,Allow creature you are communicating with to communicate with another creature you are already communicating with,25,\r
Telepathy,Range I,3,Communicate,Increase range of Communicate to 3 miles,15,\r
Telepathy,Range II,4,Range I,Increase range of Communicate to 30 miles,20,\r
Telepathy,Range III,5,Range II,Increase range of Communicate to 300 miles,25,\r
Telepathy,Number I,3,Communicate,Increase total creatures involved to 15 creatures.,15,\r
Telepathy,Number II,4,Number I,Increase total creatures involved to 30 creatures.,20,\r
Telepathy,Number III,5,Number II,Increase total creatures involved to 300 creatures.,25,\r
Telepathy,Interfere,2,Telepathy,reaction technique used to stop or interrupt a psion utilizing a technique forcing target to resist psionics or have that technique fail automatically,10,\r
Telepathy,Mask I,3,Interfere,ability to hide presence or usage of psionic abilities from other psions overcomes Tap I if target cannot resist psionics,15,\r
Telepathy,Mask II,4,Mask I,may overcome Tap II if target cannot resist psionics,20,\r
Telepathy,Mask III,5,Mask II,may overcome Tap III if target cannot resist psionics,25,\r
Telepathy,Jam I,3,Interfere,disrupts a psionic technique overcomes level 1-3 techniques if target cannot resist psionics,15,\r
Telepathy,Jam II,4,Jam I,overcomes level 4 techniques if target cannot resist psionics,20,\r
Telepathy,Jam III,5,Jam II,overcomes level 5 techniques if target cannot resist psionics,25,\r
Telepathy,Tap I,3,Interfere,ability to intercept communicate within mental attribute x1 miles overcomes mask I if target cannot resist psionics,15,\r
Telepathy,Tap II,4,Tap I,ability to intercept communicate within mental attribute x10 miles overcomes mask II if target cannot resist psionics,20,\r
Telepathy,Tap III,5,Tap II,"ability to intercept communicate within mental attribute x100 miles overcomes mask III if target cannot resist psionics\r
",25,\r
Telepathy,Interconnect,2,Telepathy,increases manifold manifestation by 2,10,\r
Telepathy,Combined Psionics I,3,Interconnect,may combine technique with efforts of a linked psion,15,\r
Telepathy,Combined Psionics II,4,Combined Psionics I,may combine technique with efforts of linked psions equal to mental attribute,20,\r
Telepathy,Combined Psionics III,5,Combined Psionics II,may combine technique with linked or unlinked psions equal to mental attribute x3,25,\r
Telepathy,Metapsionics I,3,Interconnect,Use mulitple psionic disciplines up to 0 at once,15,\r
Telepathy,Metapsionics II,4,Metapsionics I,Use mulitple psionic disciplines up to 0 at once,20,\r
Telepathy,Metapsionics III,5,Metapsionics II,Use mulitple psionic disciplines up to 0 at once,25,\r
Telepathy,Storage I,3,Interconnect,store a mental message or image in an inanimate object that is activated by touch,15,\r
Telepathy,Storage II,4,Storage I,Store memories techniques and links in inanimate object activated by touch on a timer,20,\r
Telepathy,Storage III,5,Storage II,store up to manifold manifestation limit techniques in inanimate object activated by touch timer or conditions,25,\r
Telekinesis,Telekinesis,1,,can make small or unstable inanimate objects vibrate or move a few inches mildly confuse the senses of creatures adjacent to you and reduce damage of ranged spell and weapon attacks against you by 1 as a passive,5,\r
Telekinesis,Levitation,2,Telekinesis,ability to lift mental attribute x5 lbs objects up to mental attribute x1 ft high and slowly move them up to mental attribute x10 ft around,10,\r
Telekinesis,Lift,3,Levitation,may lift up to mental attribute x25 lbs weight up to mental attribute x5 ft high,15,\r
Telekinesis,Push,4,Lift,push up to mental attribute x25 lbs up to mental attribute x5 ft away,20,\r
Telekinesis,Throw,5,Push,quickly throw up to mental attribute x100 lbs up to mental attribute x10 ft away,25,\r
Telekinesis,Hold Item,3,Levitation,makes an inanimate object weighing up to mental attribute x50 lbs stay still,15,\r
Telekinesis,Hold Unintelligent Creature,4,Hold Item,hold small or medium creature still if they cannot resist psionics,20,\r
Telekinesis,Hold Intelligent Creature,5,Hold Unintelligent Creature,"Hold large, huge, colossal, or titanic creature still if they cannot resist psionics",25,\r
Telekinesis,Gather,3,Levitation,may drag self to a creature within mental attribute x 5 ft,15,\r
Telekinesis,Pull,4,Gather,pull up to mental attribute x25 lbs up to mental attribute 5ft towards you,20,\r
Telekinesis,Vortex,5,Pull,pull all loose objects and creatures within area of mental attribute x10 ft into a central point up to a range of mental attribute x25 ft away,25,\r
Telekinesis,Psychokinesis,2,Telekinesis,increase or decrease a target's specific mental based skill by 10 for a roll,10,\r
Telekinesis,Scramble,3,Psychokinesis,reduce touched target mental by mental attribute (to minimum -3) if they cannot resist psionics for mental attribute hours,15,\r
Telekinesis,Ranged Scramble,4,Scramble,increase range up to mental attribute x5 ft,20,\r
Telekinesis,Area Scramble,5,Ranged Scramble,increase area to mental attribute x5 ft,25,\r
Telekinesis,Cross,3,Psychokinesis,swap 2 adjacent target's mental attribute for mental attribute minutes,15,\r
Telekinesis,Ranged Cross,4,Cross,swap now has range of mental attribute x25 ft,20,\r
Telekinesis,Area Cross,5,Ranged Cross,"Swap number of creatures mental attributes in an area of up to mental attribute x25 ft picking who gets which values, or combining multiple targets into 1 target's mental attribute with maximum of 6",25,\r
Telekinesis,Sleep,3,Psychokinesis,non-damaging reduce adjacent target to -5 exhaustion if they cannot resist psionics,15,\r
Telekinesis,Ranged Sleep,4,Sleep,increase range to mental attribute x10 ft,20,\r
Telekinesis,Area Sleep,5,Ranged Sleep,increase area to mental attribute x10 ft,25,\r
Telekinesis,Dynakinesis,2,Telekinesis,May haste or slow target by 1,10,\r
Telekinesis,Shield,3,Dynakinesis,damage reduction reaction against ranged attack or spell of mental attribute x2,15,\r
Telekinesis,Ranged Shield,4,Shield,ability to shield target up to mental attribute x10 ft away,20,\r
Telekinesis,Area Shield,5,Ranged Shield,shield within range of area up to mental attribute x5 ft,25,\r
Telekinesis,Field,3,Dynakinesis,area of mental attribute x5 ft triggered by movement of a creature into field deals mental damage equal to mental attribute x5 or triggers a stored technique,15,\r
Telekinesis,Timed Field,4,Field,field can now be set to activate after a set amount of time,20,\r
Telekinesis,Conditional Field,5,Timed Field,field can now be set to activate after specific conditions are met,25,\r
Telekinesis,Force,3,Dynakinesis,mental force attack of mental attribute x2 damage if adjacent target cannot resist psionics,15,\r
Telekinesis,Ranged Force,4,Force,force at mental attribute x10 ft range,20,\r
Telekinesis,Area Force,5,Ranged Force,force in area of mental attribute x10 ft,25,\r
Telekinesis,Psychometabolism,2,Telekinesis,increase target energy by mental attribute x character tier,10,\r
Telekinesis,Draw,3,Psychometabolism,"causes target up to mental attribute miles away to develop physical want/need eg hunger, thirst, sleep, for mental attribute minutes if they cannot resist psionics",15,\r
Telekinesis,Persistent Draw,4,Draw,increases to mental attribute moonfaces,20,\r
Telekinesis,Conditional Draw,5,Persistent Draw,triggered by specific conditions,25,\r
Telekinesis,Repel,3,Psychometabolism,causes target up to mental attribute miles away to develop a physical disgust or discomfort eg itching,15,\r
Telekinesis,Persistent Repel,4,Repel,increases to mental attribute moonfaces,20,\r
Telekinesis,Conditional Repel,5,Persistent Repel,triggered by specific conditions,25,\r
Telekinesis,Health,3,Psychometabolism,causes target up to mental attribute miles away to feel as if and exhibit symptoms for mental attribute minutes if they cannot resist psionics,15,\r
Telekinesis,Persistent Health,4,Health,increases to mental attribute moonfaces,20,\r
Telekinesis,Conditional Health,5,Persistent Health,triggered by specific conditions,25,\r
Telekinesis,Density,2,Telekinesis,concentrate,10,\r
Telekinesis,Congeal Gas,3,Density,concentrate gas to small ball in area up to mental attribute x5 ft,15,\r
Telekinesis,Congeal Dust,4,Congeal Gas,does so for dust,20,\r
Telekinesis,Congeal Liquid,5,Congeal Dust,does so for liquid,25,\r
Telekinesis,Disperse Gas,3,Density,may cause gas to expand and dilute up to mental attribute x5 ft from an area,15,\r
Telekinesis,Disperse Dust,4,Disperse Gas,does so for dust,20,\r
Telekinesis,Disperse Liquid,5,Disperse Dust,does so for liquids,25,\r
Telekinesis,Mix Gas,3,Density,mix gasses together in preferred measurements up to mental attribute x5 ft area,15,\r
Telekinesis,Mix Dust,4,Mix Gas,does so for dust,20,\r
Telekinesis,Mix Liquid,5,Mix Dust,does so for liquid,25,\r
Psychometry,Psychometry,1,,automatically know if there are items in container unless it has been magically/psionically secured,5,\r
Psychometry,Claircognizance,2,Psychometry,may enter into dreams of creatures up to mental attribute x5 ft away,10,\r
Psychometry,Clairsentience,3,Claircognizance,aura,15,\r
Psychometry,Clairempathy,4,Clairsentience,aura,20,\r
Psychometry,Attune Conversation,5,Clairempathy,listen to non-psionic conversation up to mental attribute x50 ft away,25,\r
Psychometry,Dowsing I,3,Claircognizance,find inanimate substance or material within mental attribute x5 ft of you,15,\r
Psychometry,Dowsing II,4,Dowsing I,find inanimate substance or material within mental attribute x100 ft of you,20,\r
Psychometry,Dowsing III,5,Dowsing II,find inanimate substance or material within mental attribute miles of you,25,\r
Psychometry,Unlock Dream,3,Claircognizance,search a creature's mind for a dream up to mental attribute phases ago,15,\r
Psychometry,Unlock Subconscious,4,Unlock Dream,overcomes subtract or tamper memory,20,\r
Psychometry,Manifest Mind,5,Unlock Subconscious,allows you to perfectly reconstruct a target's mind if you have successfully used a technique on said target before if target is alive or has been dead for less than a phase,25,\r
Psychometry,Clairvoyance,2,Psychometry,may still act even when surprised,10,\r
Psychometry,Retrocognition I,3,Clairvoyance,glimpse at what happened in an area up to mental attribute minutes ago,15,\r
Psychometry,Retrocognition II,4,Retrocognition I,glimpse at what happened in an area up to mental attribute phases ago,20,\r
Psychometry,Retrocognition III,5,Retrocognition II,glimpse at what happened in an area up to mental attribute centuries ago,25,\r
Psychometry,Precognition I,3,Clairvoyance,glimpse at what may happen up to mental attribute minutes in the future,15,\r
Psychometry,Prognition II,4,Precognition I,glimpse at what may happen up to to mental attribute cycles in the future,20,\r
Psychometry,Precognition III,5,Prognition II,glimpse at what may happen up to mental attribute years in the future,25,\r
Psychometry,Area of Sight,3,Clairvoyance,may see when blind or around obstacles,15,\r
Psychometry,Distal Projection,4,Area of Sight,see in an area up to mental attribute x5 ft up to mental attribute miles away,20,\r
Psychometry,Interplanar Projection,5,Distal Projection,see in an area up to mental attribute x5 ft on another plane,25,\r
Psychometry,Identify,2,Psychometry,automatically know what an item is when you touch it if it is not magically/psionically secured,10,\r
Psychometry,Origin,3,Identify,know where an item was crafted,15,\r
Psychometry,Age of Material,4,Origin,know when raw materials for an item were collected or made,20,\r
Psychometry,Origin of Material,5,Age of Material,know where raw materials for an item were gathered,25,\r
Psychometry,Material,3,Identify,know what the item is broadly composed of,15,\r
Psychometry,Integrity,4,Material,know the condition of an item automatically,20,\r
Psychometry,Purity,5,Integrity,know about precise compositions of an item,25,\r
Psychometry,Detect Poison,3,Identify,detect poisons in or on an item,15,\r
Psychometry,Detect Trap,4,Detect Poison,detect traps in or on an item,20,\r
Psychometry,Detect Arcane,5,Detect Trap,detect spells in or on an item,25,\r
Psychometry,Psychoscopy,2,Psychometry,glimpse brief history of area when entering,10,\r
Psychometry,Psychoportation,3,Psychoscopy,know the path an item took to get to where it currently is for up to mental attribute hours,15,\r
Psychometry,Retroscribation,4,Psychoportation,know who has written something by touch within mental attribute hours,20,\r
Psychometry,Xenoglossy,5,Retroscribation,automatically understand a message written in a foreign language or code by touch,25,\r
Psychometry,User,3,Psychoscopy,determine identity of item's last user/owner,15,\r
Psychometry,Prior Users,4,User,determine chain of prior identities up to mental attribute,20,\r
Psychometry,Determine Purpose,5,Prior Users,understand what prior user used item primarily for,25,\r
Psychometry,Maker,3,Psychoscopy,determine identity of primary crafter of item,15,\r
Psychometry,Method of Creation,4,Maker,identify methods of crafting,20,\r
Psychometry,Age of Item,5,Method of Creation,determine when item was crafted,25,\r
Psychometry,Track,2,Psychometry,Always know locations of items attuned to you,10,\r
Psychometry,Trail I,3,Track,determine path of last owner/user up to mental attribute minutes after departure from item,15,\r
Psychometry,Trail II,4,Trail I,increase to mental attribute hours,20,\r
Psychometry,Trail III,5,Trail II,increase to mental attribute phases,25,\r
Psychometry,Item I,3,Track,if you have used psychometry on a specific item before,15,\r
Psychometry,Item II,4,Item I,increase to mental attribute hours,20,\r
Psychometry,Item III,5,Item II,increase to mental attribute phases,25,\r
Psychometry,Aura I,3,Track,know when an item entered or departed a place up to mental attribute minutes ago,15,\r
Psychometry,Aura II,4,Aura I,know when an item entered or departed a place up to mental attribute cycles ago,20,\r
Psychometry,Aura III,5,Aura II,know when an item entered or departed a place up to mental attribute centuries ago,25,\r
Hypnosis,Hypnosis,1,,automatically gain the attention of a target within mental attribute x5 ft of you. If applicable target is not immediately hostile to you if it otherwise would be if it cannot successfully resist psionics,5,\r
Hypnosis,Pathokinesis,2,Hypnosis,increase or decrease a specific social based skill by 10 for mental attribute for a roll,10,\r
Hypnosis,Suggest,3,Pathokinesis,add mental attribute to persuade,15,\r
Hypnosis,Command,4,Suggest,increase to mental attribute x10,20,\r
Hypnosis,Aura,5,Command,may execute against all targets within mental attribute x10 ft of you,25,\r
Hypnosis,Dissuade,3,Pathokinesis,add mental attribute to intimidate,15,\r
Hypnosis,Forbid,4,Dissuade,increase to mental attribute x10,20,\r
Hypnosis,Aura,5,Forbid,may execute against all targets within mental attribute x10 ft of you,25,\r
Hypnosis,Force Emotion,3,Pathokinesis,insert a strong specific emotion into a target up to mental attribute x10 ft away,15,\r
Hypnosis,Timed Insertion,4,Force Emotion,may set to activate upon timer,20,\r
Hypnosis,Conditional Insertion,5,Timed Insertion,may set to activate upon specific conditions,25,\r
Hypnosis,Illusion,2,Hypnosis,create small false images,10,\r
Hypnosis,Amplify I,3,Illusion,increase intensity of target's perception or sense of an item/person/event,15,\r
Hypnosis,Amplify II,4,Amplify I,targets have -25% resist psionics with your illusions,20,\r
Hypnosis,Amplify III,5,Amplify II,targets have -50% resist psionics with your illusions,25,\r
Hypnosis,Dampen,3,Illusion,decrease intensity of targets perception or sense of an item/person/event,15,\r
Hypnosis,Nondetection,4,Dampen,targets have -50% to search when you are using psionics to conceal or deceive,20,\r
Hypnosis,Invisibility,5,Nondetection,remove your target's ability to sense a target in one way entirely if they cannot resist psionics,25,\r
Hypnosis,Alter Illusion,3,Illusion,change what a target perceives or senses so long as the illusion matches size and duration,15,\r
Hypnosis,Timed Insertion,4,Alter Illusion,may set an illusion to activate on specific timer,20,\r
Hypnosis,Conditional Insertion,5,Timed Insertion,may set an illusion to activate upon specific conditions,25,\r
Hypnosis,Possession,2,Hypnosis,may assume control of a creature with no mental score such as an insect for mental attribute hours,10,\r
Hypnosis,Unintelligent Animal,3,Possession,may assume control of a creature with -3 mental if it fails to resist psionics for mental attribute rounds,15,\r
Hypnosis,Intelligent Animal,4,Unintelligent Animal,May assume control of a creature with -2 mental or less if it fails to resist psionics for mental attribute rounds,20,\r
Hypnosis,Mortal,5,Intelligent Animal,May assume control of a creature if it fails to resist psionics for mental attribute rounds,25,\r
Hypnosis,Target I,3,Possession,Increase number of targets able to control at once to 3,15,\r
Hypnosis,Target II,4,Target I,Increase to 6 targets,20,\r
Hypnosis,Target III,5,Target II,Increase to 9 targets,25,\r
Hypnosis,Range I,3,Possession,increase range to 30 ft,15,\r
Hypnosis,Range II,4,Range I,Increase range to 300 ft,20,\r
Hypnosis,Range III,5,Range II,Increase range to 3 miles,25,\r
Hypnosis,Mnokinesis,2,Hypnosis,You gain Perfect Recall ancillary as a passive,10,\r
Hypnosis,Addition I,3,Mnokinesis,Add insignificant memory to a target,15,\r
Hypnosis,Addition II,4,Addition I,Add a significant memory,20,\r
Hypnosis,Addition III,5,Addition II,Add life-changing or crucial to identity memory,25,\r
Hypnosis,Subtraction I,3,Mnokinesis,Remove Insignificant memory from a target,15,\r
Hypnosis,Subtraction II,4,Subtraction I,Remove a Significant memory,20,\r
Hypnosis,Subtraction III,5,Subtraction II,Remove life-changing or crucial to identity memory,25,\r
Hypnosis,Alter Memory,3,Mnokinesis,Change details of a target's specific memory,15,\r
Hypnosis,Timed Restore,4,Alter Memory,Restore a target's memory upon a specific timer,20,\r
Hypnosis,Conditional Restore,5,Timed Restore,Restore a target's memory upon a specific condition,25,\r
Hypnosis,Override,2,Hypnosis,Give a target +1 action points x character tier for 1 round,10,\r
Hypnosis,Endurance,3,Override,Add mental attribute x3 to target's endure for specific roll,15,\r
Hypnosis,Defy Exhaustion,4,Endurance,Remove 1 level of exhaustion from a target,20,\r
Hypnosis,Defy Death,5,Defy Exhaustion,Add mental attribute x10 to target's feat of defiance on specific roll,25,\r
Hypnosis,Strength,3,Override,reaction,15,\r
Hypnosis,Speed,4,Strength,reaction,20,\r
Hypnosis,Agility,5,Speed,reaction,25,\r
Hypnosis,Morale,3,Override,+1 morale to target,15,\r
Hypnosis,Fear,4,Morale,-1 morale to target,20,\r
Hypnosis,Horror,5,Fear,- mental attribute morale to target. May choose to incapacitate target instead of flee if target's morale reaches -5,25,\r
\r
\r
\r
\r
`;var eb={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/(function(e,t){((n,s)=>{e.exports=s()})(r_,function n(){var s=typeof self<"u"?self:typeof window<"u"?window:s!==void 0?s:{},r,i=!s.document&&!!s.postMessage,o=s.IS_PAPA_WORKER||!1,l={},c=0,u={};function d(k){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(N){var E=A(N);E.chunkSize=parseInt(E.chunkSize),N.step||N.chunk||(E.chunkSize=null),this._handle=new _(E),(this._handle.streamer=this)._config=E}).call(this,k),this.parseChunk=function(N,E){var M=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<M){let X=this._config.newline;X||(O=this._config.quoteChar||'"',X=this._handle.guessLineEndings(N,O)),N=[...N.split(X).slice(M)].join(X)}this.isFirstChunk&&S(this._config.beforeFirstChunk)&&(O=this._config.beforeFirstChunk(N))!==void 0&&(N=O),this.isFirstChunk=!1,this._halted=!1;var M=this._partialLine+N,O=(this._partialLine="",this._handle.parse(M,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(N=O.meta.cursor,M=(this._finished||(this._partialLine=M.substring(N-this._baseIndex),this._baseIndex=N),O&&O.data&&(this._rowCount+=O.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),o)s.postMessage({results:O,workerId:u.WORKER_ID,finished:M});else if(S(this._config.chunk)&&!E){if(this._config.chunk(O,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=O=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(O.data),this._completeResults.errors=this._completeResults.errors.concat(O.errors),this._completeResults.meta=O.meta),this._completed||!M||!S(this._config.complete)||O&&O.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),M||O&&O.meta.paused||this._nextChunk(),O}this._halted=!0},this._sendError=function(N){S(this._config.error)?this._config.error(N):o&&this._config.error&&s.postMessage({workerId:u.WORKER_ID,error:N,finished:!1})}}function h(k){var N;(k=k||{}).chunkSize||(k.chunkSize=u.RemoteChunkSize),d.call(this,k),this._nextChunk=i?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(E){this._input=E,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(N=new XMLHttpRequest,this._config.withCredentials&&(N.withCredentials=this._config.withCredentials),i||(N.onload=R(this._chunkLoaded,this),N.onerror=R(this._chunkError,this)),N.open(this._config.downloadRequestBody?"POST":"GET",this._input,!i),this._config.downloadRequestHeaders){var E,M=this._config.downloadRequestHeaders;for(E in M)N.setRequestHeader(E,M[E])}var O;this._config.chunkSize&&(O=this._start+this._config.chunkSize-1,N.setRequestHeader("Range","bytes="+this._start+"-"+O));try{N.send(this._config.downloadRequestBody)}catch(X){this._chunkError(X.message)}i&&N.status===0&&this._chunkError()}},this._chunkLoaded=function(){N.readyState===4&&(N.status<200||400<=N.status?this._chunkError():(this._start+=this._config.chunkSize||N.responseText.length,this._finished=!this._config.chunkSize||this._start>=(E=>(E=E.getResponseHeader("Content-Range"))!==null?parseInt(E.substring(E.lastIndexOf("/")+1)):-1)(N),this.parseChunk(N.responseText)))},this._chunkError=function(E){E=N.statusText||E,this._sendError(new Error(E))}}function m(k){(k=k||{}).chunkSize||(k.chunkSize=u.LocalChunkSize),d.call(this,k);var N,E,M=typeof FileReader<"u";this.stream=function(O){this._input=O,E=O.slice||O.webkitSlice||O.mozSlice,M?((N=new FileReader).onload=R(this._chunkLoaded,this),N.onerror=R(this._chunkError,this)):N=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var O=this._input,X=(this._config.chunkSize&&(X=Math.min(this._start+this._config.chunkSize,this._input.size),O=E.call(O,this._start,X)),N.readAsText(O,this._config.encoding));M||this._chunkLoaded({target:{result:X}})},this._chunkLoaded=function(O){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(O.target.result)},this._chunkError=function(){this._sendError(N.error)}}function y(k){var N;d.call(this,k=k||{}),this.stream=function(E){return N=E,this._nextChunk()},this._nextChunk=function(){var E,M;if(!this._finished)return E=this._config.chunkSize,N=E?(M=N.substring(0,E),N.substring(E)):(M=N,""),this._finished=!N,this.parseChunk(M)}}function b(k){d.call(this,k=k||{});var N=[],E=!0,M=!1;this.pause=function(){d.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){d.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(O){this._input=O,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){M&&N.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),N.length?this.parseChunk(N.shift()):E=!0},this._streamData=R(function(O){try{N.push(typeof O=="string"?O:O.toString(this._config.encoding)),E&&(E=!1,this._checkIsFinished(),this.parseChunk(N.shift()))}catch(X){this._streamError(X)}},this),this._streamError=R(function(O){this._streamCleanUp(),this._sendError(O)},this),this._streamEnd=R(function(){this._streamCleanUp(),M=!0,this._streamData("")},this),this._streamCleanUp=R(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function _(k){var N,E,M,O,X=Math.pow(2,53),re=-X,I=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,$=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,L=this,D=0,F=0,q=!1,V=!1,Q=[],te={data:[],errors:[],meta:{}};function B(ue){return k.skipEmptyLines==="greedy"?ue.join("").trim()==="":ue.length===1&&ue[0].length===0}function ae(){if(te&&M&&(he("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+u.DefaultDelimiter+"'"),M=!1),k.skipEmptyLines&&(te.data=te.data.filter(function(Ce){return!B(Ce)})),le()){let Ce=function(Ke,Me){S(k.transformHeader)&&(Ke=k.transformHeader(Ke,Me)),Q.push(Ke)};var je=Ce;if(te)if(Array.isArray(te.data[0])){for(var ue=0;le()&&ue<te.data.length;ue++)te.data[ue].forEach(Ce);te.data.splice(0,1)}else te.data.forEach(Ce)}function xe(Ce,Ke){for(var Me=k.header?{}:[],oe=0;oe<Ce.length;oe++){var pe=oe,ve=Ce[oe],ve=((be,ke)=>(Ie=>(k.dynamicTypingFunction&&k.dynamicTyping[Ie]===void 0&&(k.dynamicTyping[Ie]=k.dynamicTypingFunction(Ie)),(k.dynamicTyping[Ie]||k.dynamicTyping)===!0))(be)?ke==="true"||ke==="TRUE"||ke!=="false"&&ke!=="FALSE"&&((Ie=>{if(I.test(Ie)&&(Ie=parseFloat(Ie),re<Ie&&Ie<X))return 1})(ke)?parseFloat(ke):$.test(ke)?new Date(ke):ke===""?null:ke):ke)(pe=k.header?oe>=Q.length?"__parsed_extra":Q[oe]:pe,ve=k.transform?k.transform(ve,pe):ve);pe==="__parsed_extra"?(Me[pe]=Me[pe]||[],Me[pe].push(ve)):Me[pe]=ve}return k.header&&(oe>Q.length?he("FieldMismatch","TooManyFields","Too many fields: expected "+Q.length+" fields but parsed "+oe,F+Ke):oe<Q.length&&he("FieldMismatch","TooFewFields","Too few fields: expected "+Q.length+" fields but parsed "+oe,F+Ke)),Me}var Ne;te&&(k.header||k.dynamicTyping||k.transform)&&(Ne=1,!te.data.length||Array.isArray(te.data[0])?(te.data=te.data.map(xe),Ne=te.data.length):te.data=xe(te.data,0),k.header&&te.meta&&(te.meta.fields=Q),F+=Ne)}function le(){return k.header&&Q.length===0}function he(ue,xe,Ne,je){ue={type:ue,code:xe,message:Ne},je!==void 0&&(ue.row=je),te.errors.push(ue)}S(k.step)&&(O=k.step,k.step=function(ue){te=ue,le()?ae():(ae(),te.data.length!==0&&(D+=ue.data.length,k.preview&&D>k.preview?E.abort():(te.data=te.data[0],O(te,L))))}),this.parse=function(ue,xe,Ne){var je=k.quoteChar||'"',je=(k.newline||(k.newline=this.guessLineEndings(ue,je)),M=!1,k.delimiter?S(k.delimiter)&&(k.delimiter=k.delimiter(ue),te.meta.delimiter=k.delimiter):((je=((Ce,Ke,Me,oe,pe)=>{var ve,be,ke,Ie;pe=pe||[",","	","|",";",u.RECORD_SEP,u.UNIT_SEP];for(var Be=0;Be<pe.length;Be++){for(var _e,He=pe[Be],De=0,ne=0,me=0,we=(ke=void 0,new f({comments:oe,delimiter:He,newline:Ke,preview:10}).parse(Ce)),Ye=0;Ye<we.data.length;Ye++)Me&&B(we.data[Ye])?me++:(_e=we.data[Ye].length,ne+=_e,ke===void 0?ke=_e:0<_e&&(De+=Math.abs(_e-ke),ke=_e));0<we.data.length&&(ne/=we.data.length-me),(be===void 0||De<=be)&&(Ie===void 0||Ie<ne)&&1.99<ne&&(be=De,ve=He,Ie=ne)}return{successful:!!(k.delimiter=ve),bestDelimiter:ve}})(ue,k.newline,k.skipEmptyLines,k.comments,k.delimitersToGuess)).successful?k.delimiter=je.bestDelimiter:(M=!0,k.delimiter=u.DefaultDelimiter),te.meta.delimiter=k.delimiter),A(k));return k.preview&&k.header&&je.preview++,N=ue,E=new f(je),te=E.parse(N,xe,Ne),ae(),q?{meta:{paused:!0}}:te||{meta:{paused:!1}}},this.paused=function(){return q},this.pause=function(){q=!0,E.abort(),N=S(k.chunk)?"":N.substring(E.getCharIndex())},this.resume=function(){L.streamer._halted?(q=!1,L.streamer.parseChunk(N,!0)):setTimeout(L.resume,3)},this.aborted=function(){return V},this.abort=function(){V=!0,E.abort(),te.meta.aborted=!0,S(k.complete)&&k.complete(te),N=""},this.guessLineEndings=function(Ce,je){Ce=Ce.substring(0,1048576);var je=new RegExp(w(je)+"([^]*?)"+w(je),"gm"),Ne=(Ce=Ce.replace(je,"")).split("\r"),je=Ce.split(`
`),Ce=1<je.length&&je[0].length<Ne[0].length;if(Ne.length===1||Ce)return`
`;for(var Ke=0,Me=0;Me<Ne.length;Me++)Ne[Me][0]===`
`&&Ke++;return Ke>=Ne.length/2?`\r
`:"\r"}}function w(k){return k.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function f(k){var N=(k=k||{}).delimiter,E=k.newline,M=k.comments,O=k.step,X=k.preview,re=k.fastMode,I=null,$=!1,L=k.quoteChar==null?'"':k.quoteChar,D=L;if(k.escapeChar!==void 0&&(D=k.escapeChar),(typeof N!="string"||-1<u.BAD_DELIMITERS.indexOf(N))&&(N=","),M===N)throw new Error("Comment character same as delimiter");M===!0?M="#":(typeof M!="string"||-1<u.BAD_DELIMITERS.indexOf(M))&&(M=!1),E!==`
`&&E!=="\r"&&E!==`\r
`&&(E=`
`);var F=0,q=!1;this.parse=function(V,Q,te){if(typeof V!="string")throw new Error("Input must be a string");var B=V.length,ae=N.length,le=E.length,he=M.length,ue=S(O),xe=[],Ne=[],je=[],Ce=F=0;if(!V)return De();if(re||re!==!1&&V.indexOf(L)===-1){for(var Ke=V.split(E),Me=0;Me<Ke.length;Me++){if(je=Ke[Me],F+=je.length,Me!==Ke.length-1)F+=E.length;else if(te)return De();if(!M||je.substring(0,he)!==M){if(ue){if(xe=[],Ie(je.split(N)),ne(),q)return De()}else Ie(je.split(N));if(X&&X<=Me)return xe=xe.slice(0,X),De(!0)}}return De()}for(var oe=V.indexOf(N,F),pe=V.indexOf(E,F),ve=new RegExp(w(D)+w(L),"g"),be=V.indexOf(L,F);;)if(V[F]===L)for(be=F,F++;;){if((be=V.indexOf(L,be+1))===-1)return te||Ne.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:xe.length,index:F}),_e();if(be===B-1)return _e(V.substring(F,be).replace(ve,L));if(L===D&&V[be+1]===D)be++;else if(L===D||be===0||V[be-1]!==D){oe!==-1&&oe<be+1&&(oe=V.indexOf(N,be+1));var ke=Be((pe=pe!==-1&&pe<be+1?V.indexOf(E,be+1):pe)===-1?oe:Math.min(oe,pe));if(V.substr(be+1+ke,ae)===N){je.push(V.substring(F,be).replace(ve,L)),V[F=be+1+ke+ae]!==L&&(be=V.indexOf(L,F)),oe=V.indexOf(N,F),pe=V.indexOf(E,F);break}if(ke=Be(pe),V.substring(be+1+ke,be+1+ke+le)===E){if(je.push(V.substring(F,be).replace(ve,L)),He(be+1+ke+le),oe=V.indexOf(N,F),be=V.indexOf(L,F),ue&&(ne(),q))return De();if(X&&xe.length>=X)return De(!0);break}Ne.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:xe.length,index:F}),be++}}else if(M&&je.length===0&&V.substring(F,F+he)===M){if(pe===-1)return De();F=pe+le,pe=V.indexOf(E,F),oe=V.indexOf(N,F)}else if(oe!==-1&&(oe<pe||pe===-1))je.push(V.substring(F,oe)),F=oe+ae,oe=V.indexOf(N,F);else{if(pe===-1)break;if(je.push(V.substring(F,pe)),He(pe+le),ue&&(ne(),q))return De();if(X&&xe.length>=X)return De(!0)}return _e();function Ie(me){xe.push(me),Ce=F}function Be(me){var we=0;return we=me!==-1&&(me=V.substring(be+1,me))&&me.trim()===""?me.length:we}function _e(me){return te||(me===void 0&&(me=V.substring(F)),je.push(me),F=B,Ie(je),ue&&ne()),De()}function He(me){F=me,Ie(je),je=[],pe=V.indexOf(E,F)}function De(me){if(k.header&&!Q&&xe.length&&!$){var we=xe[0],Ye=Object.create(null),Fe=new Set(we);let z=!1;for(let de=0;de<we.length;de++){let U=we[de];if(Ye[U=S(k.transformHeader)?k.transformHeader(U,de):U]){let P,H=Ye[U];for(;P=U+"_"+H,H++,Fe.has(P););Fe.add(P),we[de]=P,Ye[U]++,z=!0,(I=I===null?{}:I)[P]=U}else Ye[U]=1,we[de]=U;Fe.add(U)}z&&console.warn("Duplicate headers found and renamed."),$=!0}return{data:xe,errors:Ne,meta:{delimiter:N,linebreak:E,aborted:q,truncated:!!me,cursor:Ce+(Q||0),renamedHeaders:I}}}function ne(){O(De()),xe=[],Ne=[]}},this.abort=function(){q=!0},this.getCharIndex=function(){return F}}function p(k){var N=k.data,E=l[N.workerId],M=!1;if(N.error)E.userError(N.error,N.file);else if(N.results&&N.results.data){var O={abort:function(){M=!0,g(N.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:j,resume:j};if(S(E.userStep)){for(var X=0;X<N.results.data.length&&(E.userStep({data:N.results.data[X],errors:N.results.errors,meta:N.results.meta},O),!M);X++);delete N.results}else S(E.userChunk)&&(E.userChunk(N.results,O,N.file),delete N.results)}N.finished&&!M&&g(N.workerId,N.results)}function g(k,N){var E=l[k];S(E.userComplete)&&E.userComplete(N),E.terminate(),delete l[k]}function j(){throw new Error("Not implemented.")}function A(k){if(typeof k!="object"||k===null)return k;var N,E=Array.isArray(k)?[]:{};for(N in k)E[N]=A(k[N]);return E}function R(k,N){return function(){k.apply(N,arguments)}}function S(k){return typeof k=="function"}return u.parse=function(k,N){var E=(N=N||{}).dynamicTyping||!1;if(S(E)&&(N.dynamicTypingFunction=E,E={}),N.dynamicTyping=E,N.transform=!!S(N.transform)&&N.transform,!N.worker||!u.WORKERS_SUPPORTED)return E=null,u.NODE_STREAM_INPUT,typeof k=="string"?(k=(M=>M.charCodeAt(0)!==65279?M:M.slice(1))(k),E=new(N.download?h:y)(N)):k.readable===!0&&S(k.read)&&S(k.on)?E=new b(N):(s.File&&k instanceof File||k instanceof Object)&&(E=new m(N)),E.stream(k);(E=(()=>{var M;return!!u.WORKERS_SUPPORTED&&(M=(()=>{var O=s.URL||s.webkitURL||null,X=n.toString();return u.BLOB_URL||(u.BLOB_URL=O.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",X,")();"],{type:"text/javascript"})))})(),(M=new s.Worker(M)).onmessage=p,M.id=c++,l[M.id]=M)})()).userStep=N.step,E.userChunk=N.chunk,E.userComplete=N.complete,E.userError=N.error,N.step=S(N.step),N.chunk=S(N.chunk),N.complete=S(N.complete),N.error=S(N.error),delete N.worker,E.postMessage({input:k,config:N,workerId:E.id})},u.unparse=function(k,N){var E=!1,M=!0,O=",",X=`\r
`,re='"',I=re+re,$=!1,L=null,D=!1,F=((()=>{if(typeof N=="object"){if(typeof N.delimiter!="string"||u.BAD_DELIMITERS.filter(function(Q){return N.delimiter.indexOf(Q)!==-1}).length||(O=N.delimiter),typeof N.quotes!="boolean"&&typeof N.quotes!="function"&&!Array.isArray(N.quotes)||(E=N.quotes),typeof N.skipEmptyLines!="boolean"&&typeof N.skipEmptyLines!="string"||($=N.skipEmptyLines),typeof N.newline=="string"&&(X=N.newline),typeof N.quoteChar=="string"&&(re=N.quoteChar),typeof N.header=="boolean"&&(M=N.header),Array.isArray(N.columns)){if(N.columns.length===0)throw new Error("Option columns is empty");L=N.columns}N.escapeChar!==void 0&&(I=N.escapeChar+re),N.escapeFormulae instanceof RegExp?D=N.escapeFormulae:typeof N.escapeFormulae=="boolean"&&N.escapeFormulae&&(D=/^[=+\-@\t\r].*$/)}})(),new RegExp(w(re),"g"));if(typeof k=="string"&&(k=JSON.parse(k)),Array.isArray(k)){if(!k.length||Array.isArray(k[0]))return q(null,k,$);if(typeof k[0]=="object")return q(L||Object.keys(k[0]),k,$)}else if(typeof k=="object")return typeof k.data=="string"&&(k.data=JSON.parse(k.data)),Array.isArray(k.data)&&(k.fields||(k.fields=k.meta&&k.meta.fields||L),k.fields||(k.fields=Array.isArray(k.data[0])?k.fields:typeof k.data[0]=="object"?Object.keys(k.data[0]):[]),Array.isArray(k.data[0])||typeof k.data[0]=="object"||(k.data=[k.data])),q(k.fields||[],k.data||[],$);throw new Error("Unable to serialize unrecognized input");function q(Q,te,B){var ae="",le=(typeof Q=="string"&&(Q=JSON.parse(Q)),typeof te=="string"&&(te=JSON.parse(te)),Array.isArray(Q)&&0<Q.length),he=!Array.isArray(te[0]);if(le&&M){for(var ue=0;ue<Q.length;ue++)0<ue&&(ae+=O),ae+=V(Q[ue],ue);0<te.length&&(ae+=X)}for(var xe=0;xe<te.length;xe++){var Ne=(le?Q:te[xe]).length,je=!1,Ce=le?Object.keys(te[xe]).length===0:te[xe].length===0;if(B&&!le&&(je=B==="greedy"?te[xe].join("").trim()==="":te[xe].length===1&&te[xe][0].length===0),B==="greedy"&&le){for(var Ke=[],Me=0;Me<Ne;Me++){var oe=he?Q[Me]:Me;Ke.push(te[xe][oe])}je=Ke.join("").trim()===""}if(!je){for(var pe=0;pe<Ne;pe++){0<pe&&!Ce&&(ae+=O);var ve=le&&he?Q[pe]:pe;ae+=V(te[xe][ve],pe)}xe<te.length-1&&(!B||0<Ne&&!Ce)&&(ae+=X)}}return ae}function V(Q,te){var B,ae;return Q==null?"":Q.constructor===Date?JSON.stringify(Q).slice(1,25):(ae=!1,D&&typeof Q=="string"&&D.test(Q)&&(Q="'"+Q,ae=!0),B=Q.toString().replace(F,I),(ae=ae||E===!0||typeof E=="function"&&E(Q,te)||Array.isArray(E)&&E[te]||((le,he)=>{for(var ue=0;ue<he.length;ue++)if(-1<le.indexOf(he[ue]))return!0;return!1})(B,u.BAD_DELIMITERS)||-1<B.indexOf(O)||B.charAt(0)===" "||B.charAt(B.length-1)===" ")?re+B+re:B)}},u.RECORD_SEP="",u.UNIT_SEP="",u.BYTE_ORDER_MARK="\uFEFF",u.BAD_DELIMITERS=["\r",`
`,'"',u.BYTE_ORDER_MARK],u.WORKERS_SUPPORTED=!i&&!!s.Worker,u.NODE_STREAM_INPUT=1,u.LocalChunkSize=10485760,u.RemoteChunkSize=5242880,u.DefaultDelimiter=",",u.Parser=f,u.ParserHandle=_,u.NetworkStreamer=h,u.FileStreamer=m,u.StringStreamer=y,u.ReadableStreamStreamer=b,s.jQuery&&((r=s.jQuery).fn.parse=function(k){var N=k.config||{},E=[];return this.each(function(X){if(!(r(this).prop("tagName").toUpperCase()==="INPUT"&&r(this).attr("type").toLowerCase()==="file"&&s.FileReader)||!this.files||this.files.length===0)return!0;for(var re=0;re<this.files.length;re++)E.push({file:this.files[re],inputElem:this,instanceConfig:r.extend({},N)})}),M(),this;function M(){if(E.length===0)S(k.complete)&&k.complete();else{var X,re,I,$,L=E[0];if(S(k.before)){var D=k.before(L.file,L.inputElem);if(typeof D=="object"){if(D.action==="abort")return X="AbortError",re=L.file,I=L.inputElem,$=D.reason,void(S(k.error)&&k.error({name:X},re,I,$));if(D.action==="skip")return void O();typeof D.config=="object"&&(L.instanceConfig=r.extend(L.instanceConfig,D.config))}else if(D==="skip")return void O()}var F=L.instanceConfig.complete;L.instanceConfig.complete=function(q){S(F)&&F(q,L.file,L.inputElem),O()},u.parse(L.file,L.instanceConfig)}}function O(){E.splice(0,1),M()}}),o&&(s.onmessage=function(k){k=k.data,u.WORKER_ID===void 0&&k&&(u.WORKER_ID=k.workerId),typeof k.input=="string"?s.postMessage({workerId:u.WORKER_ID,results:u.parse(k.input,k.config),finished:!0}):(s.File&&k.input instanceof File||k.input instanceof Object)&&(k=u.parse(k.input,k.config))&&s.postMessage({workerId:u.WORKER_ID,results:k,finished:!0})}),(h.prototype=Object.create(d.prototype)).constructor=h,(m.prototype=Object.create(d.prototype)).constructor=m,(y.prototype=Object.create(y.prototype)).constructor=y,(b.prototype=Object.create(d.prototype)).constructor=b,u})})(eb);var gS=eb.exports;const tb=ng(gS),yS=0,vS=(e,t)=>{const n=e.trim();if(!n)return null;const s=n.replace(/\s+/g,"");if(!/^([0-9]+|[+*]|Mental)+$/i.test(s))return null;const r=s.split("+");let i=0;for(const o of r){if(!o)return null;const l=o.split("*");let c=1;for(const u of l){if(!u)return null;if(/^mental$/i.test(u))c*=t;else{const d=Number(u);if(!Number.isFinite(d))return null;c*=d}}i+=c}return i},bS=e=>e?e.split(/[,;]+/).map(t=>t.trim()).filter(Boolean):[],nb=e=>{var s;const t=new Map,n=[];for(const r of e){if(!r.name)continue;const i=r.tree,o=r.name,l=`${i}:${o}`,c=bS(r.prerequisite??void 0),u=t.get(l)??[],d=u.length+1,h=d===1?l:`${l}#${d}`,m=c.map(b=>{const _=`${i}:${b}`,w=t.get(_);return!w||w.length===0?_:w[w.length-1].id}),y={id:h,tree:i,name:o,tier:Number.isFinite(Number(r.tier))?Number(r.tier):0,prerequisiteNames:c,prerequisiteIds:m,description:r.description??"",energyCost:Number.isFinite(Number(r.energyCost))?Number(r.energyCost):0,formula:((s=r.formula)==null?void 0:s.trim())||void 0};n.push(y),u.push(y),t.set(l,u)}return n.sort((r,i)=>r.tree===i.tree?r.tier===i.tier?r.name.localeCompare(i.name):r.tier-i.tier:r.tree.localeCompare(i.tree))},ab=e=>{const t=tb.parse(e,{header:!0,skipEmptyLines:!0});t.errors.length&&console.warn("Errors while parsing psionics CSV",t.errors);const n=(t.data??[]).map(s=>({tree:s["Ability Tree"],name:s.Ability,tier:s.Tier,prerequisite:s.Prerequisite??null,description:s.Description??"",energyCost:s["Energy Cost"],formula:s.Formula??null}));return nb(n)},Sd=(e,t,n)=>!((n==null?void 0:n.allowTier1WithoutPrereq)??!0)&&e.tier===1&&e.prerequisiteIds.length===0?t.has(e.id):e.prerequisiteIds.every(r=>t.has(r)),Ed=(e,t)=>e.replace(/mental attribute\s*x\s*(\d+)/gi,(s,r)=>{const i=Number(r);return Number.isFinite(i)?String(t*i):String(t)}).replace(/mental attribute/gi,String(t)),tm="psionics_skill_tree_v1",sb={psychometrist:{psiBonus:1,granted:[{tree:"Psychometry",name:"Psychometry"}],options:[{tree:"Psychometry",name:"Claircognizance"},{tree:"Psychometry",name:"Clairvoyance"},{tree:"Psychometry",name:"Identify"},{tree:"Psychometry",name:"Psychoscopy"},{tree:"Psychometry",name:"Track"}],picksRequired:2},telekineticist:{psiBonus:1,granted:[{tree:"Telekinesis",name:"Telekinesis"}],options:[{tree:"Telekinesis",name:"Levitation"},{tree:"Telekinesis",name:"Psychokinesis"},{tree:"Telekinesis",name:"Dynakinesis"},{tree:"Telekinesis",name:"Psychometabolism"},{tree:"Telekinesis",name:"Density"}],picksRequired:2},telepath:{psiBonus:1,granted:[{tree:"Telepathy",name:"Telepathy"}],options:[{tree:"Telepathy",name:"Pry"},{tree:"Telepathy",name:"Sense Presence"},{tree:"Telepathy",name:"Communicate"},{tree:"Telepathy",name:"Interfere"},{tree:"Telepathy",name:"Interconnect"}],picksRequired:2},hypnotist:{psiBonus:1,granted:[{tree:"Hypnosis",name:"Hypnosis"}],options:[{tree:"Hypnosis",name:"Pathokinesis"},{tree:"Hypnosis",name:"Illusion"},{tree:"Hypnosis",name:"Possession"},{tree:"Hypnosis",name:"Mnokinesis"},{tree:"Hypnosis",name:"Override"}],picksRequired:2},dynakineticist:{psiBonus:1,granted:[{tree:"Telekinesis",name:"Telekinesis"},{tree:"Telekinesis",name:"Dynakinesis"}],options:[{tree:"Telekinesis",name:"Shield"},{tree:"Telekinesis",name:"Field"},{tree:"Telekinesis",name:"Force"}],picksRequired:1},illusionist:{psiBonus:1,granted:[{tree:"Hypnosis",name:"Hypnosis"},{tree:"Hypnosis",name:"Illusion"}],options:[{tree:"Hypnosis",name:"Amplify I"},{tree:"Hypnosis",name:"Dampen"},{tree:"Hypnosis",name:"Alter Illusion"}],picksRequired:1}},_S="ancillaries:selected",su=()=>({selected:[],metadata:{},flags:{}}),Sr=e=>`${_S}:${e??"unassigned"}`,ba=e=>{if(typeof window>"u")return su();const t=Sr(e);try{const n=window.localStorage.getItem(t);if(!n)return su();const s=JSON.parse(n);if(Array.isArray(s))return{selected:s,metadata:{},flags:{}};const r=Array.isArray(s.selected)?s.selected:[],i=s.metadata&&typeof s.metadata=="object"?s.metadata:{},o=s.flags&&typeof s.flags=="object"?s.flags:{};return{selected:r,metadata:i,flags:o}}catch(n){return console.warn("Unable to read ancillary selection",n),su()}},Cd=(e,t)=>{if(typeof window>"u")return;const n=Sr(e);try{window.localStorage.setItem(n,JSON.stringify(t))}catch(s){console.warn("Unable to persist ancillary selection",s)}},xS={default:"btn",primary:"btn btn--primary",secondary:"btn btn--secondary",ghost:"btn btn--ghost",danger:"btn btn--danger",success:"btn btn--success"},wS={sm:"btn--sm",md:"",lg:"btn--lg"},hr=v.forwardRef(({variant:e="default",size:t="md",icon:n=!1,loading:s=!1,disabled:r,className:i="",children:o,...l},c)=>{const u=[xS[e],wS[t],n?"btn--icon":"",i].filter(Boolean).join(" ");return a.jsx("button",{ref:c,className:u,disabled:r||s,...l,children:s?a.jsxs("span",{className:"btn__loading",children:[a.jsx("span",{className:"btn__spinner","aria-hidden":"true"}),a.jsx("span",{className:"sr-only",children:"Loading..."})]}):o})});hr.displayName="Button";const Kr=v.forwardRef(({variant:e="default",selected:t=!1,className:n="",children:s,...r},i)=>{const o=["card",e==="elevated"&&"card--elevated",e==="flush"&&"card--flush",e==="interactive"&&"card--interactive",t&&"card--selected",n].filter(Boolean).join(" ");return a.jsx("div",{ref:i,className:o,...r,children:s})});Kr.displayName="Card";const Po=({children:e,className:t="",...n})=>a.jsx("div",{className:`card__body ${t}`,...n,children:e}),kS=v.forwardRef(({error:e,className:t="",...n},s)=>{const r=["input",e&&"input--error",t].filter(Boolean).join(" ");return a.jsx("input",{ref:s,className:r,...n})});kS.displayName="Input";const Rl=v.forwardRef(({error:e,className:t="",children:n,...s},r)=>{const i=["select",e&&"select--error",t].filter(Boolean).join(" ");return a.jsx("select",{ref:r,className:i,...s,children:n})});Rl.displayName="Select";const nl=v.forwardRef(({error:e,className:t="",...n},s)=>{const r=["textarea",e&&"textarea--error",t].filter(Boolean).join(" ");return a.jsx("textarea",{ref:s,className:r,...n})});nl.displayName="Textarea";const NS=v.forwardRef(({label:e,className:t="",id:n,...s},r)=>{const i=n||`checkbox-${v.useId()}`;return a.jsxs("label",{className:`checkbox ${t}`,htmlFor:i,children:[a.jsx("input",{ref:r,type:"checkbox",className:"checkbox__input",id:i,...s}),e&&a.jsx("span",{className:"checkbox__label",children:e})]})});NS.displayName="Checkbox";const jS=v.forwardRef(({label:e,className:t="",id:n,...s},r)=>{const i=n||`radio-${v.useId()}`;return a.jsxs("label",{className:`radio ${t}`,htmlFor:i,children:[a.jsx("input",{ref:r,type:"radio",className:"radio__input",id:i,...s}),e&&a.jsx("span",{className:"radio__label",children:e})]})});jS.displayName="Radio";const ru=({label:e,hint:t,error:n,required:s,children:r,className:i=""})=>a.jsxs("div",{className:`field ${i}`,children:[e&&a.jsxs("label",{className:"field__label",children:[e,s&&a.jsx("span",{className:"field__required","aria-hidden":"true",children:" *"})]}),r,t&&!n&&a.jsx("span",{className:"field__hint",children:t}),n&&a.jsx("span",{className:"field__error",role:"alert",children:n})]}),SS=({value:e,onChange:t,min:n=-1/0,max:s=1/0,step:r=1,disabled:i=!1,className:o="",label:l})=>{const[c,u]=v.useState(String(e)),d=v.useRef(e),h=v.useRef(null),m=v.useRef(null);v.useEffect(()=>{d.current=e,u(String(e))},[e]);const y=v.useCallback(()=>{h.current&&(clearTimeout(h.current),h.current=null),m.current&&(clearInterval(m.current),m.current=null)},[]);v.useEffect(()=>y,[y]);const b=g=>{if(!Number.isFinite(g))return;const j=Math.min(Math.max(Math.floor(g),n),s);t(j)},_=g=>{b(d.current+g)},w=g=>{i||(y(),_(g),h.current=setTimeout(()=>{m.current=setInterval(()=>_(g),125)},350))},f=e>n,p=e<s;return a.jsxs("div",{className:`spin-button ${o}`,role:"group","aria-label":l,children:[a.jsx("button",{type:"button",className:"btn btn--icon btn--sm spin-button__decrement",onPointerDown:()=>w(-r),onPointerUp:y,onPointerLeave:y,onPointerCancel:y,disabled:i||!f,"aria-label":"Decrease",children:""}),a.jsx("input",{type:"text",inputMode:"numeric",className:"input spin-button__input",value:c,disabled:i,onChange:g=>{const j=g.target.value;if(u(j),j.trim()===""||j==="-")return;const A=parseInt(j,10);Number.isFinite(A)&&b(A)},onBlur:()=>u(String(e)),onWheel:g=>{g.preventDefault(),g.currentTarget.blur()}}),a.jsx("button",{type:"button",className:"btn btn--icon btn--sm spin-button__increment",onPointerDown:()=>w(r),onPointerUp:y,onPointerLeave:y,onPointerCancel:y,disabled:i||!p,"aria-label":"Increase",children:"+"})]})},ES={default:"stat-block",primary:"stat-block stat-block--primary",success:"stat-block stat-block--success",danger:"stat-block stat-block--danger",warning:"stat-block stat-block--warning"},To=({label:e,value:t,modifier:n,variant:s="default",action:r,className:i=""})=>a.jsxs("div",{className:`${ES[s]} ${i}`,children:[a.jsx("span",{className:"stat-block__label",children:e}),a.jsx("span",{className:"stat-block__value",children:t}),n&&a.jsx("span",{className:"stat-block__modifier",children:n}),r&&a.jsx("div",{className:"stat-block__action",children:r})]}),CS=({label:e,value:t,action:n,hint:s,variant:r="default",className:i=""})=>r==="stacked"?a.jsxs("div",{className:`attribute-pill attribute-pill--stacked ${i}`,children:[a.jsxs("div",{className:"attribute-pill__header",children:[a.jsx("span",{className:"attribute-pill__label",children:e}),a.jsx("strong",{className:"attribute-pill__value",children:t})]}),s&&a.jsx("span",{className:"attribute-pill__hint",children:s})]}):a.jsxs("div",{className:`attribute-pill ${i}`,children:[a.jsx("span",{className:"attribute-pill__label",children:e}),a.jsxs("div",{className:"attribute-pill__actions",children:[a.jsx("strong",{className:"attribute-pill__value",children:t}),n]})]}),AS={default:"badge",primary:"badge badge--primary",success:"badge badge--success",danger:"badge badge--danger",warning:"badge badge--warning",info:"badge badge--info",arcane:"badge badge--arcane",divine:"badge badge--divine",nature:"badge badge--nature",psionic:"badge badge--psionic"},IS=({variant:e="default",children:t,className:n=""})=>a.jsx("span",{className:`${AS[e]} ${n}`,children:t}),rb=v.createContext(null),ib=()=>{const e=v.useContext(rb);if(!e)throw new Error("Tabs components must be used within a Tabs provider");return e},PS=({value:e,onChange:t,children:n,className:s=""})=>{const r=v.useMemo(()=>({activeTab:e,setActiveTab:t}),[e,t]);return a.jsx(rb.Provider,{value:r,children:a.jsx("div",{className:`tabs-container ${s}`,children:n})})},TS=({children:e,className:t="","aria-label":n})=>a.jsx("div",{className:`tabs ${t}`,role:"tablist","aria-label":n,children:e}),RS=({value:e,children:t,disabled:n=!1,className:s=""})=>{const{activeTab:r,setActiveTab:i}=ib(),o=r===e;return a.jsx("button",{type:"button",role:"tab","aria-selected":o,"aria-controls":`panel-${e}`,id:`tab-${e}`,tabIndex:o?0:-1,className:`tabs__tab ${o?"tabs__tab--active":""} ${s}`,onClick:()=>i(e),disabled:n,children:t})},$r=({value:e,children:t,className:n=""})=>{const{activeTab:s}=ib();return s===e?a.jsx("div",{role:"tabpanel",id:`panel-${e}`,"aria-labelledby":`tab-${e}`,className:`tabs__panel ${n}`,tabIndex:0,children:t}):null},DS={sm:"modal--sm",md:"",lg:"modal--lg",xl:"modal--xl",fullscreen:"modal--fullscreen"},MS=({isOpen:e,onClose:t,children:n,size:s="md",closeOnOverlayClick:r=!0,closeOnEscape:i=!0,className:o=""})=>{const l=v.useRef(null),c=v.useRef(null);if(v.useEffect(()=>{if(!e||!i)return;const h=m=>{m.key==="Escape"&&t()};return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)},[e,i,t]),v.useEffect(()=>{var h;if(e)return c.current=document.activeElement,document.body.style.overflow="hidden",(h=l.current)==null||h.focus(),()=>{document.body.style.overflow="",c.current instanceof HTMLElement&&c.current.focus()}},[e]),!e)return null;const u=h=>{r&&h.target===h.currentTarget&&t()},d=a.jsx("div",{className:"overlay",onClick:u,role:"presentation",children:a.jsx("div",{ref:l,className:`modal ${DS[s]} ${o}`,role:"dialog","aria-modal":"true",tabIndex:-1,children:n})});return fv.createPortal(d,document.body)},LS=({title:e,onClose:t,children:n,className:s=""})=>a.jsx("div",{className:`modal__header ${s}`,children:n??a.jsxs(a.Fragment,{children:[e&&a.jsx("h3",{className:"modal__title",children:e}),t&&a.jsx("button",{type:"button",className:"modal__close",onClick:t,"aria-label":"Close modal",children:""})]})}),OS=({children:e,className:t=""})=>a.jsx("div",{className:`modal__body ${t}`,children:e}),$S=({children:e,className:t=""})=>a.jsx("div",{className:`modal__footer ${t}`,children:e}),BS=({isOpen:e,onConfirm:t,onCancel:n,title:s,message:r,confirmLabel:i="Confirm",cancelLabel:o="Cancel",variant:l="default",loading:c=!1})=>a.jsxs(MS,{isOpen:e,onClose:n,size:"sm",children:[a.jsx(LS,{title:s,onClose:n}),a.jsx(OS,{children:a.jsx("p",{className:"body",children:r})}),a.jsxs($S,{children:[a.jsx("button",{type:"button",className:"btn",onClick:n,disabled:c,children:o}),a.jsx("button",{type:"button",className:`btn ${l==="danger"?"btn--danger":"btn--primary"}`,onClick:t,disabled:c,children:c?"Loading...":i})]})]}),FS={xs:"stack--xs",sm:"stack--sm",md:"stack--md",lg:"stack--lg",xl:"stack--xl"},Qn=({gap:e="md",children:t,className:n="",...s})=>a.jsx("div",{className:`stack ${FS[e]} ${n}`,...s,children:t}),qS={xs:"cluster--xs",sm:"cluster--sm",md:"cluster--md",lg:"cluster--lg"},Ad=({gap:e="sm",align:t="center",justify:n="start",children:s,className:r="",style:i,...o})=>a.jsx("div",{className:`cluster ${qS[e]} ${r}`,style:{alignItems:t==="start"?"flex-start":t==="end"?"flex-end":t,justifyContent:n==="start"?"flex-start":n==="end"?"flex-end":n==="between"?"space-between":n==="around"?"space-around":n,...i},...o,children:s}),US={2:"grid--2",3:"grid--3",4:"grid--4","auto-sm":"grid--auto-sm","auto-md":"grid--auto-md","auto-lg":"grid--auto-lg"},iu=({columns:e="auto-md",gap:t="md",children:n,className:s="",style:r,...i})=>a.jsx("div",{className:`grid ${US[e]} ${s}`,style:{gap:`var(--space-${t==="xs"?"2":t==="sm"?"3":t==="md"?"4":"6"})`,...r},...i,children:n}),Br=100,WS=new Set(["advanced-psion","heroic-psion","epic-psion","legendary-psion","mythic-psion"]),ob=e=>!e||typeof e!="object"?!1:Object.values(e).every(t=>typeof t=="number"),zS=e=>e===void 0||ob(e),Gr=e=>{if(!e||typeof e!="object")return!1;const t=e;return typeof t.id=="string"&&typeof t.name=="string"&&typeof t.level=="number"&&typeof t.skillPoints=="number"&&ob(t.skillAllocations)&&zS(t.skillAllocationMinimums)},HS=e=>Array.isArray(e)&&e.every(Gr),Ro=e=>Object.values(e).reduce((t,n)=>t+n,0),lb=e=>e.toLowerCase().replace(/_/g," ").replace(/\b(\w)/g,t=>t.toUpperCase()),YS=["PHYSICAL","MENTAL","SPIRITUAL","WILL"],VS=e=>{const t={PHYSICAL:0,MENTAL:0,SPIRITUAL:0,WILL:0};return YS.forEach(n=>{typeof(e==null?void 0:e[n])=="number"&&(t[n]=e[n])}),t},KS=(e,t,n,s)=>{const r=ma(t,s),i=ma(n,s),o={...e??{}};return new Set([...Object.keys(r),...Object.keys(i)]).forEach(c=>{const u=r[c]??0,d=(o[c]??0)-u;o[c]=d+(i[c]??0)}),o},gf=["MARTIAL_PROWESS","ILDAKAR_FACULTY"],GS={"fledgling-martial":{ap:2,note:"Attacks & reactions"},"advanced-martial":{ap:2,note:"Movement, attacks, reactions"},"heroic-martial":{ap:2,note:"Movement, attacks, reactions"},"epic-martial":{ap:3,note:"Movement, attacks, reactions"},"legendary-martial":{ap:3,note:"Movement, attacks, reactions"},"mythic-martial":{ap:3,note:"Movement, attacks, reactions"}},JS=[{key:"PHYSICAL",label:"Physical"},{key:"MENTAL",label:"Mental"},{key:"SPIRITUAL",label:"Spiritual"},{key:"WILL",label:"Will"}],QS=e=>{if(!e)return 0;const t=e.match(/-?\d+(\.\d+)?/);return t?Number(t[0]):0},yf=({skill:e,showDivider:t=!0,allocations:n,allocationMinimums:s,skillBonuses:r,remaining:i,disableAllocation:o,onChangeAllocation:l})=>{const c=wt(e),u=n[c]??0,d=s[c]??0,h=r[c]??0,m=u+h,y=Math.max(d,u+Math.max(i,0));return a.jsxs("div",{className:`skill-row${t?" skill-row--divider":""}`,children:[a.jsx("div",{className:"skill-row__name",children:a.jsx("span",{className:"skill-row__name-text",children:lb(e.name)})}),a.jsx("div",{className:"skill-row__controls",children:a.jsx(SS,{value:u,onChange:b=>l(c,b),min:d,max:y,disabled:o,label:`${e.name} allocation`})}),a.jsxs("div",{className:"skill-row__total",children:[a.jsx("strong",{children:m}),h>0&&a.jsxs("span",{className:"skill-row__bonus",children:["(+",h,")"]})]})]})},XS=({character:e,skills:t,raceName:n,subraceName:s,remaining:r,skillPointPool:i,allocations:o,allocationMinimums:l,skillBonuses:c,onChangeAllocation:u,onLockAllocations:d,disableAllocation:h,lockDisabled:m,isLocking:y,attributePointsAvailable:b,onSpendAttributePoint:_,isUpdating:w,onSaveNotes:f})=>{const[p,g]=v.useState("Weapons"),j=v.useMemo(()=>t.filter(z=>!gf.includes(wt(z).toUpperCase())),[t]),A=v.useMemo(()=>fS(j),[j]),R=v.useMemo(()=>gf.map(z=>{const de=t.find(U=>wt(U).toUpperCase()===z);return de||{id:z,name:lb(z)}}),[t]),S=v.useMemo(()=>ab(Zv),[]),[k,N]=v.useState([]),[E,M]=v.useState(new Map),O=v.useMemo(()=>`${tm}:${e.id}`,[e.id]),[X,re]=v.useState(e.weaponNotes??""),[I,$]=v.useState(e.defenseNotes??""),[L,D]=v.useState(e.gearNotes??""),[F,q]=v.useState(()=>ba(e.id)),[V,Q]=v.useState([]),[te,B]=v.useState([]),[ae,le]=v.useState(null),[he,ue]=v.useState(""),[xe,Ne]=v.useState(""),je=v.useMemo(()=>`characters:equipment:${e.id}`,[e.id]),Ce=e.raceKey==="ANZ"?140:100,Ke=e.raceKey==="ANZ"?14:10,Me=F.selected.includes("energetic")?1+.1*e.level:1,oe=Math.round((Ce+Ke*(e.level-1))*Me),pe=e.fatePoints??0,ve=e.attributes??{},be=(ve==null?void 0:ve.PHYSICAL)??0,ke=Math.max(3,be),Ie=V.find(z=>z.id===he),Be=(Ie==null?void 0:Ie.damageReduction)??0,_e=te.find(z=>z.category===xe),De=QS(_e==null?void 0:_e.damage)+be,ne=v.useMemo(()=>F.selected.reduce((z,de)=>{const U=GS[de];return U?{ap:z.ap+U.ap,notes:new Set([...z.notes,U.note])}:z},{ap:0,notes:new Set}),[F.selected]);v.useEffect(()=>{q(ba(e.id));const z=Sr(e.id),de=U=>{U.key===z&&q(ba(e.id))};return typeof window<"u"&&window.addEventListener("storage",de),()=>{typeof window<"u"&&window.removeEventListener("storage",de)}},[e.id]),v.useEffect(()=>{re(e.weaponNotes??""),$(e.defenseNotes??""),D(e.gearNotes??"")},[e.defenseNotes,e.gearNotes,e.id,e.weaponNotes]),v.useEffect(()=>{if(typeof window>"u")return;const z=window.localStorage.getItem(je);if(z)try{const de=JSON.parse(z);typeof de.armorId=="number"&&ue(de.armorId),typeof de.weaponCategory=="string"&&Ne(de.weaponCategory)}catch(de){console.warn("Unable to read equipment selection",de)}},[je]);const me=v.useCallback(z=>{const de={armorId:z.armorId??he,weaponCategory:z.weaponCategory??xe};typeof window<"u"&&window.localStorage.setItem(je,JSON.stringify(de))},[je,he,xe]);v.useEffect(()=>{let z=!0;return le(null),typeof window>"u"?()=>{}:((async()=>{try{const U=ze(),[{data:P,error:H},{data:Z,error:ie}]=await Promise.all([U.from("armors").select("id, armor_name, armor_type, damage_reduction").order("armor_name",{ascending:!0}),U.from("weapon_abilities").select("id, category, damage").order("category",{ascending:!0})]);if(H)throw new Error(H.message);if(ie)throw new Error(ie.message);const ee=(P??[]).map(J=>({id:J.id,name:J.armor_name,armorType:J.armor_type??void 0,damageReduction:J.damage_reduction??0})),G=new Map;(Z??[]).forEach(J=>{J.category&&(G.has(J.category)||G.set(J.category,J.damage??null))});const Y=Array.from(G.entries()).map(([J,Ae])=>({category:J,damage:Ae}));if(!z)return;Q(ee),B(Y)}catch(U){if(!z)return;const P=U instanceof Error?U.message:"Failed to load equipment";le(P)}})(),()=>{z=!1})},[]),v.useEffect(()=>{if(typeof window>"u"){N([]),M(new Map);return}try{const z=window.localStorage.getItem(O);if(!z){N([]),M(new Map);return}const de=JSON.parse(z),U=de.ancillaryPicks??{},P=Object.values(U).flat(),H=new Set([...de.purchased??[],...de.backgroundPicks??[],...P]),Z=S.filter(ee=>H.has(ee.id)),ie=new Map;Object.entries(U).forEach(([ee,G])=>{WS.has(ee)&&G.forEach(Y=>ie.set(Y,1))}),N(Z),M(ie)}catch(z){console.warn("Unable to read psionics state",z),N([]),M(new Map)}},[S,O]);const we=v.useMemo(()=>{const z=new Map;return k.forEach(de=>{const U=z.get(de.tree)??[];U.push(de),z.set(de.tree,U)}),Array.from(z.entries()).map(([de,U])=>({tree:de,abilities:U.sort((P,H)=>P.tier===H.tier?P.name.localeCompare(H.name):P.tier-H.tier)}))},[k]),Ye=(z,de)=>{(e[z]??"")!==de&&f({[z]:de})},Fe=[{value:"Weapons",label:"Weapons"},{value:"Defense",label:"Defense"},{value:"Gear",label:"Gear"},{value:"Psionics",label:"Psionics"},{value:"Spells",label:"Spells"},{value:"Details",label:"Details"},{value:"Feats",label:"Feats"},{value:"Actions",label:"Actions"}];return a.jsxs(Qn,{gap:"lg",className:"character-sheet",children:[a.jsxs("section",{className:"character-summary","aria-label":"Character identity",children:[a.jsx("h2",{children:e.name}),a.jsxs("p",{className:"text-muted",children:["Level ",e.level," ",n||"Unknown",s?` (${s})`:"","  Speed ",ke]})]}),a.jsx(Kr,{children:a.jsx(Po,{children:a.jsxs(Qn,{gap:"sm",children:[a.jsxs(Ad,{justify:"between",align:"center",children:[a.jsx("span",{className:"caption",children:"Attribute Points Available"}),a.jsx("span",{className:`heading-4 ${b>0?"text-success":""}`,children:b})]}),a.jsx(iu,{columns:"auto-sm",gap:"sm",children:JS.map(z=>a.jsx(CS,{label:z.label,value:(ve==null?void 0:ve[z.key])??0,action:a.jsx(hr,{size:"sm",onClick:()=>_(z.key),disabled:b<=0||w,children:"+1"})},z.key))})]})})}),a.jsxs("div",{className:"character-sheet__layout",children:[a.jsxs(Qn,{gap:"md",className:"character-sheet__skills-column",children:[a.jsxs("div",{className:"combat-metrics",role:"group","aria-label":"Combat statistics",children:[a.jsx(To,{label:"DR",value:Be}),a.jsx(To,{label:"Damage",value:De}),a.jsx(To,{label:"Fate",value:pe}),a.jsx(To,{label:"Energy",value:oe})]}),a.jsxs(iu,{columns:2,gap:"sm",children:[a.jsxs("div",{className:"attribute-pill attribute-pill--stacked",children:[a.jsx("span",{className:"attribute-pill__label",children:"Weapon Category"}),a.jsxs(Rl,{value:xe,onChange:z=>{const de=z.target.value;Ne(de),me({weaponCategory:de})},disabled:te.length===0,children:[a.jsx("option",{value:"",children:"Unarmed/None"}),te.map(z=>a.jsx("option",{value:z.category,children:z.category},z.category))]})]}),a.jsxs("div",{className:"attribute-pill attribute-pill--stacked",children:[a.jsx("span",{className:"attribute-pill__label",children:"Armor Type"}),a.jsxs(Rl,{value:he===""?"":String(he),onChange:z=>{const de=z.target.value,U=de?Number(de):"";ue(U),me({armorId:U})},disabled:V.length===0,children:[a.jsx("option",{value:"",children:"No armor"}),V.map(z=>a.jsxs("option",{value:z.id,children:[z.name,z.armorType?` (${z.armorType})`:""]},z.id))]})]}),ne.ap>0&&a.jsxs("div",{className:"attribute-pill attribute-pill--stacked",children:[a.jsx("span",{className:"attribute-pill__label",children:"Martial Bonus AP"}),a.jsxs("span",{className:"attribute-pill__value",children:["+",ne.ap]}),ne.notes.size>0&&a.jsx("span",{className:"attribute-pill__hint",children:Array.from(ne.notes).join(", ")})]})]}),ae&&a.jsx("p",{className:"body-sm text-warning",children:ae}),a.jsxs("article",{className:"skills-card","aria-label":"Skill allocations",children:[a.jsxs("header",{className:"skills-card__header",children:[a.jsxs("div",{children:[a.jsx("h3",{children:"Skill Points"}),a.jsxs("div",{className:`heading-2 ${r<0?"text-danger":r>0?"text-success":""}`,children:[r," ",a.jsxs("span",{className:"caption text-muted",children:["remaining of ",i]})]})]}),a.jsx(hr,{variant:"secondary",onClick:d,disabled:m||y,loading:y,children:"Lock Allocations"})]}),r>0&&a.jsx("p",{className:"skills-card__warning text-warning",children:"Spend all skill points at level up and lock your allocations when finished."}),a.jsx("div",{className:"skills-card__list",children:t.length===0?a.jsx("p",{className:"body-sm text-muted",children:"No skills defined yet."}):a.jsxs(Qn,{gap:"sm",children:[R.map(z=>a.jsx(Kr,{className:"skill-group-card",children:a.jsx(Po,{children:a.jsx(yf,{skill:z,showDivider:!1,allocations:o,allocationMinimums:l,skillBonuses:c,remaining:r,disableAllocation:h,onChangeAllocation:u})})},wt(z))),A.map(z=>a.jsx(Kr,{className:"skill-group-card",children:a.jsx(Po,{children:a.jsxs(Qn,{gap:"xs",children:[a.jsx("h4",{className:"heading-4 skill-group-card__title",children:z.label}),a.jsx("div",{className:"skill-group-card__list",children:[...z.skills].sort((de,U)=>de.name.localeCompare(U.name)).map((de,U,P)=>a.jsx(yf,{skill:de,showDivider:U<P.length-1,allocations:o,allocationMinimums:l,skillBonuses:c,remaining:r,disableAllocation:h,onChangeAllocation:u},wt(de)))})]})})},z.key))]})})]})]}),a.jsx(Qn,{gap:"md",className:"character-sheet__tabs-column",children:a.jsxs(PS,{value:p,onChange:g,children:[a.jsx(TS,{"aria-label":"Character details",children:Fe.map(z=>a.jsx(RS,{value:z.value,children:z.label},z.value))}),a.jsx(Kr,{className:"tab-content-card",children:a.jsxs(Po,{children:[a.jsx($r,{value:"Weapons",children:a.jsx(ru,{label:"Weapons",hint:"Changes are saved on blur.",children:a.jsx(nl,{value:X,onChange:z=>re(z.target.value),onBlur:()=>Ye("weaponNotes",X),rows:8,disabled:w})})}),a.jsx($r,{value:"Defense",children:a.jsx(ru,{label:"Defense",hint:"Changes are saved on blur.",children:a.jsx(nl,{value:I,onChange:z=>$(z.target.value),onBlur:()=>Ye("defenseNotes",I),rows:8,disabled:w})})}),a.jsx($r,{value:"Gear",children:a.jsx(ru,{label:"Gear",hint:"Changes are saved on blur.",children:a.jsx(nl,{value:L,onChange:z=>D(z.target.value),onBlur:()=>Ye("gearNotes",L),rows:8,disabled:w})})}),a.jsx($r,{value:"Psionics",children:a.jsxs(Qn,{gap:"md",children:[a.jsx("p",{className:"body-sm text-muted",children:"Unlocked psionic abilities are stored per character. Edit unlocks on the Psionics page; summaries appear here."}),k.length===0?a.jsx("p",{className:"body-sm text-muted",children:"No psionic abilities unlocked yet."}):a.jsx(Qn,{gap:"md",children:we.map(({tree:z,abilities:de})=>a.jsxs(Qn,{gap:"sm",children:[a.jsx("h4",{className:"heading-4",children:z}),a.jsx(iu,{columns:"auto-md",gap:"sm",children:de.map(U=>a.jsxs("details",{className:"psionic-detail",children:[a.jsxs("summary",{className:"psionic-detail__summary",children:[a.jsx("span",{className:"psionic-detail__name",children:U.name}),a.jsxs(IS,{variant:"psionic",children:["Tier ",U.tier,"  Energy ",E.get(U.id)??U.energyCost]})]}),a.jsxs("div",{className:"psionic-detail__content",children:[a.jsx("p",{className:"body-sm",children:Ed(U.description,(ve==null?void 0:ve.MENTAL)??0)}),U.formula&&a.jsxs("p",{className:"caption text-muted",children:["Formula: ",Ed(U.formula,(ve==null?void 0:ve.MENTAL)??0)]})]})]},U.id))})]},z))})]})}),["Spells","Details","Feats","Actions"].map(z=>a.jsx($r,{value:z,children:a.jsx("p",{className:"body-sm text-muted",children:"This tab is a placeholder for future content."})},z))]})})]})})]})]})},cb=({campaignId:e})=>{var Ke,Me;const[t,n]=v.useState([]),[s,r]=v.useState(!0),[i,o]=v.useState(null),[l,c]=v.useState(null),[u,d]=v.useState(null),[h,m]=v.useState(null),[y,b]=v.useState(null),[_,w]=v.useState(null),[f,p]=v.useState(!1),{selectedId:g,setSelectedId:j}=Is(),A=Ea(),[R]=Kh(),S=((Ke=R.get("campaignId"))==null?void 0:Ke.trim())||void 0,k=e??S,N=k?`/player/character-creation?campaignId=${k}`:"/player/character-creation",{data:E,loading:M,error:O}=As();v.useEffect(()=>{let oe=!0;return r(!0),o(null),(k?Ct.listCampaignCharacters(k):Ct.listCharacters()).then(ve=>{if(oe){if(!HS(ve))throw new Error("Unexpected response when loading characters");n(ve)}}).catch(ve=>{if(!oe)return;const be=ve instanceof Error?ve.message:"Failed to load characters";o(be)}).finally(()=>{oe&&r(!1)}),()=>{oe=!1}},[k]),v.useEffect(()=>{if(!t.length){!s&&g&&j(null);return}(!g||!t.some(oe=>oe.id===g))&&j(t[0].id)},[t,s,g,j]);const X=async oe=>{if(t.find(ve=>ve.id===oe)){o(null),m(oe);try{await Ct.deleteCharacter(oe),n(ve=>{var Ie;const be=ve.filter(Be=>Be.id!==oe),ke=g===oe?((Ie=be[0])==null?void 0:Ie.id)??null:g;return j(ke??null),ke||A(N),be})}catch(ve){const be=ve instanceof Te?ve.message:"Failed to delete character";o(be)}finally{m(null),p(!1)}}},re=async(oe,pe="Failed to update character")=>{if(!g)return;const ve=t.find(be=>be.id===g);if(ve){o(null),w(g),n(be=>be.map(ke=>ke.id===g?{...ke,...oe}:ke));try{const be=await Ct.updateCharacter(g,oe);if(!Gr(be))throw new Error("Unexpected response when saving character changes");n(ke=>ke.map(Ie=>Ie.id===be.id?be:Ie))}catch(be){const ke=be instanceof Te?be.message:pe;o(ke),n(Ie=>Ie.map(Be=>Be.id===g?ve:Be))}finally{w(null)}}},I=async(oe,pe)=>{if(!g)return;const ve=t.find(Fe=>Fe.id===g);if(!ve)return;const be=ve.skillPoints??Br,ke=ve.skillAllocations??{},Ie=ve.skillAllocationMinimums??{},Be=ke[oe]??0,_e=Ie[oe]??0,He=Number.isFinite(pe)?Math.floor(pe):0,De=Math.max(_e,He),ne=be-Ro(ke)+Be,me=Math.min(De,Math.max(_e,ne));if(me===Be)return;const we={...ke,[oe]:me},Ye={...ve,skillAllocations:we};n(Fe=>Fe.map(z=>z.id===g?Ye:z)),c(g);try{const Fe=await Ct.updateCharacter(g,{skillAllocations:we});if(!Gr(Fe))throw new Error("Unexpected response when saving allocations");n(z=>z.map(de=>de.id===Fe.id?Fe:de))}catch(Fe){const z=Fe instanceof Te?Fe.message:"Failed to save skill allocation";o(z),n(de=>de.map(U=>U.id===g?ve:U))}finally{c(null)}},$=async()=>{if(!g)return;const oe=t.find(_e=>_e.id===g);if(!oe)return;if((oe.skillPoints??Br)-Ro(oe.skillAllocations??{})>0){o("Spend all skill points before leveling up.");return}const ve=oe.level+1,be=(oe.skillPoints??Br)+10,ke=ve>1&&(ve-1)%5===0,Ie=(oe.attributePointsAvailable??0)+(ke?1:0),Be={...oe,level:ve,skillPoints:be,attributePointsAvailable:Ie};o(null),b(g),n(_e=>_e.map(He=>He.id===g?Be:He));try{const _e=await Ct.updateCharacter(g,{level:ve,skillPoints:be,attributePointsAvailable:Ie});if(!Gr(_e))throw new Error("Unexpected response when updating level");n(He=>He.map(De=>De.id===_e.id?_e:De))}catch(_e){const He=_e instanceof Te?_e.message:"Failed to level up";o(He),n(De=>De.map(ne=>ne.id===g?oe:ne))}finally{b(null)}},L=async oe=>{if(!g)return;const pe=t.find(_e=>_e.id===g);if(!pe)return;const ve=pe.attributePointsAvailable??0;if(ve<=0)return;const be=VS(pe.attributes),ke={...be,[oe]:be[oe]+1},Be={attributes:{...pe.attributes??{},[oe]:ke[oe]},attributePointsAvailable:ve-1};E!=null&&E.skills&&(Be.skillBonuses=KS(pe.skillBonuses,be,ke,E.skills)),await re(Be,"Failed to spend attribute point")},D=async()=>{if(!g)return;const oe=t.find(_e=>_e.id===g);if(!oe)return;const pe=oe.skillPoints??Br,ve=oe.skillAllocations??{};if(pe-Ro(ve)!==0){o("Spend all skill points before locking allocations.");return}const ke=oe.skillAllocationMinimums??{},Ie={...ke};Object.entries(ve).forEach(([_e,He])=>{Ie[_e]=Math.max(ke[_e]??0,He)}),o(null),d(g);const Be={...oe,skillAllocationMinimums:Ie};n(_e=>_e.map(He=>He.id===g?Be:He));try{const _e=await Ct.updateCharacter(g,{skillAllocationMinimums:Ie});if(!Gr(_e))throw new Error("Unexpected response when locking skill allocations");n(He=>He.map(De=>De.id===_e.id?_e:De))}catch(_e){const He=_e instanceof Te?_e.message:"Failed to lock skill allocations";o(He),n(De=>De.map(ne=>ne.id===g?oe:ne))}finally{d(null)}},F=t.find(oe=>oe.id===g)||null,q=(F==null?void 0:F.skillAllocations)??{},V=(F==null?void 0:F.skillAllocationMinimums)??{},Q=(F==null?void 0:F.skillPoints)??Br,te=Ro(q),B=Q-te,ae=(F==null?void 0:F.skillBonuses)??{},le=(F==null?void 0:F.attributePointsAvailable)??0,he=F?_===F.id:!1,ue=s||M,xe=!F||ue||l===(F==null?void 0:F.id)||u===(F==null?void 0:F.id)||B!==0,Ne=oe=>re(oe,"Failed to save notes"),je=v.useMemo(()=>{const oe=new Map;return((E==null?void 0:E.races)??[]).forEach(pe=>oe.set(pe.id,pe.name)),oe},[E]),Ce=v.useMemo(()=>{const oe=new Map;return((E==null?void 0:E.subraces)??[]).forEach(pe=>oe.set(pe.id,{name:pe.name,parentId:pe.parentId})),oe},[E]);return a.jsxs("div",{className:"page characters-page",children:[a.jsx("main",{className:"page__content",children:a.jsxs(Qn,{gap:"lg",children:[a.jsxs("header",{className:"page__header",style:{textAlign:"center"},children:[a.jsx("h1",{className:"heading-1",children:"Chronicle of Heroes"}),(O||i)&&a.jsx("p",{className:"body text-danger",role:"alert",children:O||i})]}),a.jsx("nav",{className:"characters-toolbar","aria-label":"Character management",children:a.jsxs(Ad,{gap:"md",align:"center",justify:"center",children:[a.jsxs(Rl,{value:g??"",onChange:oe=>j(oe.target.value||null),disabled:ue||t.length===0,style:{minWidth:260},"aria-label":"Select character",children:[t.length===0&&a.jsx("option",{value:"",children:"No characters inscribed"}),t.map(oe=>a.jsx("option",{value:oe.id,children:oe.name},oe.id))]}),a.jsxs(Ad,{gap:"sm",children:[a.jsx(hr,{variant:"primary",onClick:()=>A(N),children:"Inscribe New"}),a.jsx(hr,{variant:"secondary",onClick:$,disabled:!g||ue||y===g||B>0,loading:y===g,children:"Advance Level"}),a.jsx(hr,{variant:"danger",onClick:()=>p(!0),disabled:!g||h===g||ue,children:"Erase"})]})]})}),ue&&a.jsx("p",{className:"body text-muted",style:{textAlign:"center"},children:"Unfurling the ancient scrolls..."}),!ue&&!F&&a.jsx("p",{className:"body text-muted",style:{textAlign:"center"},children:"Select a hero from the chronicles above to view their tale."}),!ue&&F&&E&&a.jsx(XS,{character:F,skills:E.skills,raceName:je.get(F.raceKey||""),subraceName:(Me=Ce.get(F.subraceKey||""))==null?void 0:Me.name,remaining:B,skillPointPool:Q,allocations:q,allocationMinimums:V,skillBonuses:ae,onChangeAllocation:I,onLockAllocations:D,disableAllocation:ue||l===F.id||u===F.id,lockDisabled:xe,isLocking:u===F.id,attributePointsAvailable:le,onSpendAttributePoint:L,isUpdating:ue||he,onSaveNotes:Ne})]})}),a.jsx(BS,{isOpen:f,onCancel:()=>p(!1),onConfirm:()=>g&&X(g),title:"Delete Character",message:`Are you sure you want to delete ${(F==null?void 0:F.name)??"this character"}? This cannot be undone.`,confirmLabel:"Delete",variant:"danger",loading:h===g})]})},ZS=[{stage:"Family",name:"Orphanage",details:"[+4 Feat of Defiance]"},{stage:"Family",name:"Farm",details:"[+4 Animal Husbandry]"},{stage:"Family",name:"Frontier",details:"[+4 Forage]"},{stage:"Family",name:"Ship",details:"[+4 Navigate]"},{stage:"Family",name:"Travelling Caravan",details:"[+4 Identify]"},{stage:"Family",name:"Guild Hall",details:"[+4 Trade]"},{stage:"Family",name:"Workshop",details:"[+4 Craft]"},{stage:"Family",name:"Cloth",details:"[+4 Divine Intervention]"},{stage:"Family",name:"Congregation",details:"[+4 Worship]"},{stage:"Family",name:"Streets",details:"[+4 Conceal]"},{stage:"Family",name:"Stage",details:"[+4 Perform]"},{stage:"Family",name:"Warehouse",details:"[+4 Interpret]"},{stage:"Family",name:"Battlefield",details:"[+4 Battle]"},{stage:"Family",name:"University",details:"[+4 Academic Recall]"},{stage:"Family",name:"Palace",details:"[+4 Deceive]"},{stage:"Childhood",name:"Kidnapped",details:"[+4 Persevere, -4 Interpret]"},{stage:"Childhood",name:"Apprenticed",details:"[+4 Craft, -4 Deceive]"},{stage:"Childhood",name:"Bullied",details:"[+4 Endure, -4 Parley]"},{stage:"Childhood",name:"Bad Habits",details:"[+4 Conceal, -4 Feat of Austerity]"},{stage:"Childhood",name:"Served Priest",details:"[+4 Worship, -4 deceive]"},{stage:"Childhood",name:"Pet",details:"[+4 Animal Husbandry, -4 Conceal]"},{stage:"Childhood",name:"Explored",details:"[+4 Navigate, -4 Interpret]"},{stage:"Childhood",name:"Fought",details:"[+4 Battle, -4 Parley]"},{stage:"Childhood",name:"Petty Crime",details:"[+4 Feat of Agility, -4 academic recall]"},{stage:"Childhood",name:"Worked",details:"[+4 Endure, -4 Deceive]"},{stage:"Childhood",name:"Easy Money",details:"[+4 Trade, -4 Divine Intervention]"},{stage:"Childhood",name:"Cursed",details:"[+4 Sense Supernatural, -4 Resist Supernatural]"},{stage:"Childhood",name:"Blessed",details:"[+4 Worship, -4 Incite Fate]"},{stage:"Childhood",name:"Revelatory Secret",details:"[+4 Interpret, -4 Deduce]"},{stage:"Adolescence",name:"Got Away With It",details:"[+8 Deceive, -4 Worship]"},{stage:"Adolescence",name:"Learned a Trade",details:"[+8 Craft, -4 Deceive]"},{stage:"Adolescence",name:"Fell in Love",details:"[+8 Feat of Defiance, -4 Seduce]"},{stage:"Adolescence",name:"Witnessed Battles",details:"[+8 Battle, -4 Academic Recall]"},{stage:"Adolescence",name:"Athlete",details:"[+8 Feat of Strength, -4 Academic Recall]"},{stage:"Adolescence",name:"Studied",details:"[+8 Academic Recall, -4 Seduce]"},{stage:"Adolescence",name:"Picked Up A Hobby",details:"[+8 Perform, -4 Academic Recall]"},{stage:"Adolescence",name:"Journeyed",details:"[+8 Translate, -4 Interpret]"},{stage:"Adolescence",name:"Contacted Supernatural",details:"[+8 Worship, -4 Incite Fate]"},{stage:"Adulthood",category:"Academic",name:"Historian",details:"[+30 Academic Recall, +17 Identify, +8 Translate]",startingWealth:"Moderate",startingEquipment:"10 historical tomes, 5 region maps, 3 city maps, 2 site maps, organization signifier",feature:"Your character has access to various private libraries and museums that allow you to study or temporarily borrow ancient books and relics."},{stage:"Adulthood",category:"Academic",name:"Scientist",details:"[+30 Academic Recall, +17 Interpret, +8 Craft]",startingWealth:"Moderate",startingEquipment:"10 natural sciences tomes, a magnifying glass, chemistry tools, and an organization signifier",feature:"Your character has access to private libraries and laboratories that allow you to study or create various curiosities, substances, and anomalies. Starting Wealth"},{stage:"Adulthood",category:"Academic",name:"Litigator",details:"[+30 Academic Recall, +17 Perform, +8 Interpret]",startingWealth:"Moderate",startingEquipment:"10 legal tomes, a set of fine clothes, organization signifier",feature:"Your character has access to higher-ups and records in courts."},{stage:"Adulthood",category:"Academic",name:"Philosopher",details:"[+30 Interpret, +17 Academic Recall, +8 Perform]",startingWealth:"Insignificant",startingEquipment:"2 friends, organization signifier",feature:"You have numerous adherents in many settlements and regions who may offer shelter or help."},{stage:"Adulthood",category:"Academic",name:"Doctor",details:"[+30 Heal, +17 Academic Recall, +8 Resist Toxins]",startingWealth:"Moderate",startingEquipment:"Medical tools, 10 medical tomes, 10 antidotes, 1 poison, organization signifier",feature:"Your character has access to hospitals and clinics, and their records. May perform surgeries."},{stage:"Adulthood",category:"Academic",name:"Rhetorician",details:"[+30 Perform, +17 Parley, +8 Interpret]",startingWealth:"Moderate",startingEquipment:"Set of fine clothes, organization signifier",feature:"When debating in public, large crowds gather around."},{stage:"Adulthood",category:"Agent",name:"Courtier",details:"[+30 Interpret, +17 Deceive, +8 Perform]",startingWealth:"Wealthy",startingEquipment:"Carriage, 2 horses, 2 bodyguards, 2 servants, writ, organization signifier, 3 sets of fine clothes, 1 poison, 1 antidote",feature:"You have private access to individuals who are higher-ups in politics."},{stage:"Adulthood",category:"Agent",name:"Spy",details:"[+30 Gather Intelligence, +17 Identify, +8 Conceal]",startingWealth:"Significant",startingEquipment:"Disguise tools, small weapon of choice, spyglass, lockpicking tools, horse, 3 forged organization signifiers, 3 forged writs, cloak, set of fine clothes",feature:"You belong to a network of spies and informants that you may access for information."},{stage:"Adulthood",category:"Agent",name:"Order Representative",details:"[+30 Identify, +17 Interpret, +8 Navigate]",startingWealth:"Significant",startingEquipment:"Horse or pack mule, weapon of choice, light armor, set of fine clothes, 1 potion, organization signifier",feature:"You belong to an organization that will lend you supplies if you are in significant peril."},{stage:"Adulthood",category:"Agent",name:"Assassin",details:"[+30 Identify, +17 Conceal, +8 Feat of Agility]",startingWealth:"Significant",startingEquipment:"Disguise tools, spyglass, poison tools, 3 poisons, 1 antidote, 2 small weapons of choice, 1 ranged weapon of choice, forged writ, forged organization signifier, cloak",feature:"You have access to secret safehouses in various cities and regions where law enforcement will not find you."},{stage:"Adulthood",category:"Agent",name:"Diplomat",details:"[+30 Parley, +17 Deceive, +8 Interpret]",startingWealth:"Wealthy",startingEquipment:"Carriage, 2 horses, 1 servant, 2 bodyguards, small or medium weapon of choice, writ, organization signifier, set of fine clothes",feature:"You have the ability to gain public access to political rulers and powerful leaders."},{stage:"Adulthood",category:"Agent",name:"Strategist",details:"[+30 Interpret, +17 Deduce, +8 Identify]",startingWealth:"Wealthy",startingEquipment:"Horse, 2 bodyguards, weapon of choice, era and race appropriate armor, organization signifier",feature:"You have the ability to gain public access to military leaders."},{stage:"Adulthood",category:"Artisan",name:"Smith",details:"[+30 Craft, +17 Feat of Strength, +8 Trade]",startingWealth:"Moderate",startingEquipment:"Smithing tools, a small blunt weapon",feature:"You can produce metal goods."},{stage:"Adulthood",category:"Artisan",name:"Carpenter",details:"[+30 Craft, +17 Feat of Strength, +8 Endure]",startingWealth:"Moderate",startingEquipment:"Carpentry tools, measuring tools",feature:"You can produce wood goods."},{stage:"Adulthood",category:"Artisan",name:"Tinkerer",details:"[+30 Craft, +17 Feat of Agility, +8 Conceal]",startingWealth:"Significant",startingEquipment:"Tinkering tools, 3 precious gems, magnifying glass",feature:"You can produce intricate goods."},{stage:"Adulthood",category:"Artisan",name:"Engineer",details:"[+30 Craft, +17 Academic Recall, +8 Identify]",startingWealth:"Moderate",startingEquipment:"Tool set of choice, measuring tools",feature:"You can design and construct large crafts and items."},{stage:"Adulthood",category:"Artisan",name:"Mason",details:"[+30 Craft, +17 Feat of Strength, +8 Identify]",startingWealth:"Moderate",startingEquipment:"Masonry tools, measuring tools",feature:"You can produce stone goods."},{stage:"Adulthood",category:"Artisan",name:"Lightkeeper",details:"[+30 Craft, +17 Academic Recall, +8 Resist Toxins]",startingWealth:"Wealthy",startingEquipment:"Chemistry tools, 10 lights of choice, packmule",feature:"You can produce lights and basic potions."},{stage:"Adulthood",category:"Celebrity",name:"Troubadour",details:"[+30 Perform, +17 Deceive, +8 Interpret]",startingWealth:"Insignificant",startingEquipment:"2 instruments of choice, a horse, 1 region map, 1 friend, weapon of choice, a set of fine clothes",feature:"You may entertain and network at high-end parties you are not affiliated with."},{stage:"Adulthood",category:"Celebrity",name:"War Hero",details:"[+30 Battle, +17 Feat of Defiance, +8 Endure]",startingWealth:"Moderate",startingEquipment:"2 weapons of choice, era and race appropriate armor, organization signifier",feature:"There are military organizations that will aid you if you are in peril."},{stage:"Adulthood",category:"Celebrity",name:"Folk Hero",details:"[+30 Feat of Defiance, +17 Persevere, +8 Endure]",startingWealth:"Insignificant",startingEquipment:"1 weapon of choice, packmule, 1 friend",feature:"Common people will offer you shelter and supplies as you travel."},{stage:"Adulthood",category:"Celebrity",name:"Saint",details:"[+30 Worship, +17 Resist Supernatural, +8 Parley]",startingWealth:"Pauper",startingEquipment:"Organization signifier, clergy robes, staff, 1 artifact, religious or ideological tome, 2 servants, 3 antidotes",feature:"Religious organizations will aid you if you are in peril. +30 Deity Relationship Points."},{stage:"Adulthood",category:"Celebrity",name:"Relative",details:"[+30 Parley, +17 Perform, +8 Deceive]",startingWealth:"Wealthy",startingEquipment:"Tent, horse, packmule, 1 servant, 1 bodyguard, set of fine clothes",feature:"You have a powerful relative who you can obtain money or aid from."},{stage:"Adulthood",category:"Celebrity",name:"Debutante/Suitor",details:"[+30 Seduce, +17 Interpret, +8 Perform]",startingWealth:"Wealthy",startingEquipment:"Carriage, 2 horses, 2 servants, 1 bodyguard, 3 sets of fine clothes",feature:"You have private and public access to higher echelons of society for the purpose of courting."},{stage:"Adulthood",category:"Cheat",name:"Con Artist",details:"[+30 Deceive, +17 Trade, +8 Identify]",startingWealth:"Moderate",startingEquipment:"Set of fine clothes, 3 joke items, 3 forged organization signifiers",feature:"There are many people who are convinced that your products are real."},{stage:"Adulthood",category:"Cheat",name:"Gambler",details:"[+30 Incite Fate, +17 Interpret, +8 Conceal]",startingWealth:"Insignificant",startingEquipment:"2 games of choice",feature:"You can find a place to gamble in any settlement, ship, or region. +1 Fate Point."},{stage:"Adulthood",category:"Cheat",name:"Snakeoil Seller",details:"[+30 Deceive, +17 Perform, +8 Craft]",startingWealth:"Moderate",startingEquipment:"10 fake potions, 10 fake antidotes, packmule",feature:"You can produce fake potions, poisons, and antidotes, etc."},{stage:"Adulthood",category:"Cheat",name:"Rake",details:"[+30 Seduce, +17 Deceive, +8 Small Blades]",startingWealth:"Moderate",startingEquipment:"Small or medium blade of choice, set of fine clothes, game or instrument of choice",feature:"You have lovers in various settlements and regions who will offer you food and shelter."},{stage:"Adulthood",category:"Cheat",name:"Poser",details:"[+30 Identify, +17 Deceive, +8 Perform]",startingWealth:"Insignificant",startingEquipment:"Disguise tools, 10 forged organization signifiers",feature:"There are numerous people who believe you are a part of several different organizations or represent powerful people."},{stage:"Adulthood",category:"Cheat",name:"Accuser",details:"[+30 Deceive, +17 Search, +8 Endure]",startingWealth:"Significant",startingEquipment:"1 legal tome",feature:"When you are injured, you may claim money from the local authorities and courts."},{stage:"Adulthood",category:"Clergy",name:"Priest",details:"[+30 Worship, +17 Divine Intervention, +8 Resist Supernatural]",startingWealth:"Pauper",startingEquipment:"Organization signifier, writ, religious or ideological tome, clergy robes, 1 servant",feature:"You may conduct services within your religion, and gain access to relevant places of worship. +30 Deity Relationship Points."},{stage:"Adulthood",category:"Clergy",name:"Monk",details:"[+30 Feat of Austerity, +17 Persevere, +8 Resist Supernatural]",startingWealth:"Pauper",startingEquipment:"Organization signifier, writ, religious or ideological tome, clergy robes",feature:"You have private access to monasteries of your order in various settlements and regions. +30 Deity Relationship Points."},{stage:"Adulthood",category:"Clergy",name:"Exorcist",details:"[+30 Divine Intervention, +17 Sense Supernatural, +8 Resist Supernatural]",startingWealth:"Pauper",startingEquipment:"Organization signifier, writ, religious or ideological tome, exorcism aids, clergy robes, 1 servant, 3 antidotes",feature:"You may conduct exorcisms in various settlements, ruins, and places of worship in order to exert your religions influence in the area. +30 Deity Relationship Points."},{stage:"Adulthood",category:"Clergy",name:"Missionary",details:"[+30 Perform, +17 Parley, +8 Resist Supernatural]",startingWealth:"Pauper",startingEquipment:"Organization signifier, religious or ideological tome, staff, horse, or clergy robes",feature:"Your religious organization will send aid or supplies if you are in peril. +30 Deity Relationship Points."},{stage:"Adulthood",category:"Clergy",name:"Paladin",details:"[+30 Battle, +17 Sense Supernatural, +8 Resist Supernatural]",startingWealth:"Insignificant",startingEquipment:"Organization signifier, writ, religious or ideological tome, horse, era and race-appropriate armor, 2 weapons of choice, clergy robes",feature:"Supernatural beings and cultists of opposing religions generally flee from you outside of combat. +30 Deity Relationship Points."},{stage:"Adulthood",category:"Clergy",name:"Cultist",details:"[+30 Conceal, +17 Deceive, +8 Worship]",startingWealth:"Insignificant",startingEquipment:"Organization signifier, religious or ideological tome, small weapon of choice, light armor, clergy robes, 1 friend, 1 poison",feature:"You have private access to safehouses among your cult that will aid you if you are able to carry out a goal of your deity. +30 Deity Relationship Points."},{stage:"Adulthood",category:"Creative",name:"Musician",details:"[+30 Perform, +17 Artistry, +8 Feat of Agility]",startingWealth:"Moderate",startingEquipment:"Instrument of choice, a set of fine clothes",feature:"You may perform music for a patron who will fund your endeavors."},{stage:"Adulthood",category:"Creative",name:"Painter",details:"[+30 Artistry, +17 Identify, +8 Feat of Agility]",startingWealth:"Moderate",startingEquipment:"Painting tools, 1 artpiece",feature:"You may paint for a patron who will fund your endeavors."},{stage:"Adulthood",category:"Creative",name:"Novelist",details:"[+30 Artistry, +17 Translate, +8 Gather Intelligence]",startingWealth:"Moderate",startingEquipment:"Unwritten book, 3 tomes of choice",feature:"You write anonymous letters or stories that make the rounds in a certain settlement or region."},{stage:"Adulthood",category:"Creative",name:"Poet",details:"[+30 Deduce, +17 Artistry, +8 Seduce]",startingWealth:"Moderate",startingEquipment:"3 tomes of Poetry",feature:"You may write poetry for a patron who will fund your endeavors."},{stage:"Adulthood",category:"Creative",name:"Sculptor",details:"[+30 Artistry, +17 Craft, +8 Feat of Agility]",startingWealth:"Moderate",startingEquipment:"Sculpting tools",feature:"You may sculpt for a patron who will fund your endeavors."},{stage:"Adulthood",category:"Creative",name:"Architect",details:"[+30 Navigate, +17 Identify, +8 Deduce]",startingWealth:"Significant",startingEquipment:"10 site maps, measuring tools, set of fine clothes",feature:"You generally have a decent understanding of a building or dungeons layout, even if youve never been there before."},{stage:"Adulthood",category:"Criminal",name:"Professional Thief",details:"[+30 Feat of Agility, +17 Conceal, +8 Gather Intelligence]",startingWealth:"Significant",startingEquipment:"2 small weapons of choice, light armor, lockpicking kit, 3 site maps, 3 forged organization signifiers, disguise tools",feature:"You are part of a thieves' guild that will aid you if you find places to rob."},{stage:"Adulthood",category:"Criminal",name:"Serial Killer",details:"[+30 Track, +17 Battle, +8 Intimidate]",startingWealth:"Pauper",startingEquipment:"Small weapon of choice, 1 poison. +1 Fate Point.",feature:"When you are trying to kill someone, you automatically succeed at tracking them in settlements."},{stage:"Adulthood",category:"Criminal",name:"Organized Crime Boss",details:"[+30 Intimidate, +17 Deceive, +8 Interpret]",startingWealth:"Wealthy",startingEquipment:"Weapon of choice, light armor, 1 artifact, 3 precious gems, 3 henchmen, set of fine clothes, organization signifier",feature:"You command an organized crime syndicate."},{stage:"Adulthood",category:"Criminal",name:"Raider/Pirate",details:"[+30 Battle, +17 Track, +8 Search]",startingWealth:"Insignificant",startingEquipment:"Weapon of choice, light armor, organization signifier",feature:"You are part of a pirate or bandit organization that will aid you if you find settlements or ships to pillage. +1 Fate Point."},{stage:"Adulthood",category:"Criminal",name:"Saboteur",details:"[+30 Gather Intelligence, +17 Search, +8 Craft]",startingWealth:"Insignificant",startingEquipment:"Tinderbox, trap kit, 3 forged organization signifiers, disguise tools",feature:"You are part of an organization or are hired by someone who will give supplies if you find important or infrastructural/military efforts to sabotage."},{stage:"Adulthood",category:"Criminal",name:"Anarchist/Revolutionary",details:"[+30 Feat of Defiance, +17 Battle, +8 Intimidate]",startingWealth:"Pauper",startingEquipment:"Religious or ideological tome, organization signifier, 1 friend",feature:"You have safehouses in a region that will offer aid if you have committed crimes in the area. +1 Fate Point."},{stage:"Adulthood",category:"Entertainer",name:"Bard",details:"[+30 Perform, +17 Deceive, +8 Seduce]",startingWealth:"Insignificant",startingEquipment:"2 Instruments of choice, 1 friend",feature:"You may perform at local inns, taverns, events for money."},{stage:"Adulthood",category:"Entertainer",name:"Tumbler",details:"[+30 Feat of Agility, +17 Perform, +8 Feat of Strength]",startingWealth:"Insignificant",startingEquipment:"Rope",feature:"You may perform at local inns, taverns, events for money."},{stage:"Adulthood",category:"Entertainer",name:"Magician",details:"[+30 Feat of Agility, +17 Will Dakar, +8 Incite Fate]",startingWealth:"Insignificant",startingEquipment:"Cloak, game of choice, 2 joke items, 1 servant",feature:"There are many people who believe your magic tricks are real. +1 Fate Point."},{stage:"Adulthood",category:"Entertainer",name:"Trickster",details:"[+30 Deceive, +17 Feat of Agility, +8 Conceal]",startingWealth:"Insignificant",startingEquipment:"Game of choice, string, 1 joke item",feature:"You may use perform in place of feat of agility and conceal."},{stage:"Adulthood",category:"Entertainer",name:"Puppeteer",details:"[+30 Perform, +17 Feat of Agility, +8 Craft]",startingWealth:"Insignificant",startingEquipment:"Puppets, string",feature:"You may use perform in place of feat of agility and conceal."},{stage:"Adulthood",category:"Entertainer",name:"Jester",details:"[+30 Parley, +17 Perform, +8 Feat of Agility]",startingWealth:"Moderate",startingEquipment:"3 joke items, 1 friend, set of fine clothes",feature:"You may make jokes at the expense of or belittle powerful figures without suffering organization consequences. +1 Fate Point."},{stage:"Adulthood",category:"Farmer",name:"Harvester",details:"[+30 Feat of Strength, +17 Forage, +8 Small Blades]",startingWealth:"Insignificant",startingEquipment:"Small blade or large bearded weapon of choice, farming tools",feature:"You can work for farmers or artisans for money."},{stage:"Adulthood",category:"Farmer",name:"Herder",details:"[+30 Animal Husbandry, +17 Track, +8 Long Ranged]",startingWealth:"Insignificant",startingEquipment:"Long ranged weapon of choice, whistle, 1 antidote, tinderbox",feature:"You can automatically find lost domestic animals."},{stage:"Adulthood",category:"Farmer",name:"Serf",details:"[+30 Endure, +17 Persevere, +8 Polearms]",startingWealth:"Insignificant",startingEquipment:"Tinderbox, farming tools",feature:"When you commit crimes, you can blend into crowds in order to conceal."},{stage:"Adulthood",category:"Farmer",name:"Animal Trainer",details:"[+30 Animal Husbandry, +17 Heal, +8 Flexible]",startingWealth:"Insignificant",startingEquipment:"1 horse, 6 trained dogs, 1 trained bird, or 1 exotic pet, 1 antidote",feature:"Animals tend to trust you far more quickly and easily than is typical."},{stage:"Adulthood",category:"Farmer",name:"Miller",details:"[+30 Feat of Strength, +17 Craft, +8 Trade]",startingWealth:"Moderate",startingEquipment:"",feature:"You own a mill that produces steady income."},{stage:"Adulthood",category:"Farmer",name:"Butcher",details:"[+30 Heal, +17 Small Blades, +8 Trade]",startingWealth:"Moderate",startingEquipment:"Butcher tools",feature:"Meat you hunted does not spoil or go to waste, and you obtain maximum meat from hunted animals."},{stage:"Adulthood",category:"Homeless",name:"Hermit",details:"[+30 Forage, +17 Search, +8 Feat of Defiance]",startingWealth:"Pauper",startingEquipment:"Tinderbox, hunting trap",feature:"You know of secret public hiding spots in the wilderness. +1 Fate Point."},{stage:"Adulthood",category:"Homeless",name:"Alley",details:"[+30 Conceal, +17 Unarmed, +8 Feat of Defiance]",startingWealth:"Pauper",startingEquipment:"1 friend, tinderbox",feature:"You know of secret public hiding spots in settlements. +1 Fate Point."},{stage:"Adulthood",category:"Homeless",name:"Poorhouse",details:"[+30 Interpret, +17 Interpret, +8 Parley]",startingWealth:"Pauper",startingEquipment:"",feature:"You have connections to informants in poor areas of settlements. +10 Deity Relationship Points. +1 Fate Point."},{stage:"Adulthood",category:"Homeless",name:"Petty Thief",details:"[+30 Feat of Agility, +17 Conceal, +8 Deceive]",startingWealth:"Pauper",startingEquipment:"1 precious gem, lockpicking tools, 1 friend",feature:"You have connections to petty criminals in settlements. +1 Fate Point."},{stage:"Adulthood",category:"Homeless",name:"Sewer",details:"[+30 Resist Toxins, +17 Persevere, +8 Endure]",startingWealth:"Pauper",startingEquipment:"",feature:"You know the layouts of sewers in settlements. +1 Fate Point."},{stage:"Adulthood",category:"Homeless",name:"Squatter",details:"[+30 Search, +17 Forage, +8 Conceal]",startingWealth:"Pauper",startingEquipment:"Tinderbox",feature:"You know of abandoned buildings in settlements. +1 Fate Point."},{stage:"Adulthood",category:"Hunter",name:"Forester",details:"[+30 Forage, +17 Track, +8 Navigate]",startingWealth:"Insignificant",startingEquipment:"Ranged weapon of choice, forested region map, appropriate scavenging tools, 3 hunting traps, tinderbox, 1 poison, 1 antidote",feature:"You are unable to become lost in forested areas."},{stage:"Adulthood",category:"Hunter",name:"Fisher",details:"[+30 Forage, +17 Incite Fate, +8 Trade]",startingWealth:"Insignificant",startingEquipment:"Fishing tools, bait",feature:"You are always successful at and catch maximum weight fish when fishing."},{stage:"Adulthood",category:"Hunter",name:"Plains",details:"[+30 Navigate, +17 Forage, +8 Track]",startingWealth:"Insignificant",startingEquipment:"Horse or bird, spyglass, ranged weapon of choice, tinderbox, plains region map",feature:"You are unable to become lost in plains areas."},{stage:"Adulthood",category:"Hunter",name:"Ratcatcher",details:"[+30 Track, +17 Search, +8 Resist Toxins]",startingWealth:"Insignificant",startingEquipment:"3 hunting traps, 3 poisons, poison tools",feature:"You automatically find pests and small animals."},{stage:"Adulthood",category:"Hunter",name:"Monster Hunter",details:"[+30 Battle, +17 Sense Supernatural, +8 Track]",startingWealth:"Significant",startingEquipment:"1 artifact, 1 potion, weapon of choice, era and race appropriate armor, 1 antidote",feature:"Your criticals are automatically 1 tier higher when fighting against creatures larger than yourself."},{stage:"Adulthood",category:"Hunter",name:"Bounty Hunter",details:"[+30 Battle, +17 Track, +8 Gather Intelligence]",startingWealth:"Significant",startingEquipment:"Bounty, site map, weapon of choice, light armor, horse, tinderbox",feature:"You may always choose to deal nonlethal damage instead of lethal damage, regardless of how the damage is dealt."},{stage:"Adulthood",category:"Ildakar",name:"Thermomancer",details:"[+30 Will Dakar, +17 Academic Recall, +8 Search]",startingWealth:"Wealthy",startingEquipment:"3 precious gems, 1 potion, 1 spell scroll, 1 friend or exotic pet, magical robe or hat, staff or wand, organization signifier, writ",feature:"Ildakar Faculties Unlocked: Thermomancy. This faculty costs you -20% energy and action points to use."},{stage:"Adulthood",category:"Ildakar",name:"Vivomancer",details:"[+30 Will Dakar, +17 Heal, +8 Resist Toxins]",startingWealth:"Wealthy",startingEquipment:"3 precious gems, 1 potion, 1 spell scroll, 1 friend or exotic pet, magical robe or hat, staff or wand, organization signifier, writ",feature:"Ildakar Faculties Unlocked: Vivomancy. This faculty costs you -20% energy and action points to use."},{stage:"Adulthood",category:"Ildakar",name:"Photomancer",details:"[+30 Will Dakar, +17 Conceal, +8 Interpret]",startingWealth:"Wealthy",startingEquipment:"3 precious gems, 1 potion, 1 spell scroll, 1 friend or exotic pet, magical robe or hat, staff or wand, organization signifier, writ",feature:"Ildakar Faculties Unlocked: Photomancy. This faculty costs you -20% energy and action points to use."},{stage:"Adulthood",category:"Ildakar",name:"Pneumancer",details:"[+30 Will Dakar, +17 Navigate, +8 Academic Recall]",startingWealth:"Wealthy",startingEquipment:"3 precious gems, 1 potion, 1 spell scroll, 1 friend or exotic pet, magical robe or hat, staff or wand, organization signifier, writ",feature:"Ildakar Faculties Unlocked: Pneumancy. This faculty costs you -20% energy and action points to use."},{stage:"Adulthood",category:"Ildakar",name:"Electromancer",details:"[+30 Will Dakar, +17 Endure, +8 Feat of Agility]",startingWealth:"Wealthy",startingEquipment:"3 precious gems, 1 potion, 1 spell scroll, 1 friend or exotic pet, magical robe or hat, staff or wand, organization signifier, writ",feature:"Ildakar Faculties Unlocked: Electromancy. This faculty costs you -20% energy and action points to use."},{stage:"Adulthood",category:"Ildakar",name:"Graviturgist",details:"[+30 Will Dakar, +17 Academic Recall, +8 Feat of Agility]",startingWealth:"Wealthy",startingEquipment:"3 precious gems, 1 potion, 1 spell scroll, 1 friend or exotic pet, magical robe or hat, staff or wand, organization signifier, writ",feature:"Ildakar Faculties Unlocked: Graviturgy. This faculty costs you -20% energy and action points to use."},{stage:"Adulthood",category:"Laborer",name:"Dock Worker",details:"[+30 Feat of Strength, +17 Small Bearded, +8 Forage]",startingWealth:"Insignificant",startingEquipment:"Rope",feature:"You may perform labor for pay in coastal areas."},{stage:"Adulthood",category:"Laborer",name:"Processor",details:"[+30 Craft, +17 Endure, +8 Feat of Agility]",startingWealth:"Insignificant",startingEquipment:"",feature:"You may perform labor for pay for farmers and artisans, and you can create textile goods."},{stage:"Adulthood",category:"Laborer",name:"Warehouse Worker",details:"[+30 Feat of Strength, +17 Endure, +8 Unarmed]",startingWealth:"Insignificant",startingEquipment:"",feature:"You may perform labor for pay in settlements."},{stage:"Adulthood",category:"Laborer",name:"Builder",details:"[+30 Feat of Strength, +17 Small Blunt, +8 Endure]",startingWealth:"Insignificant",startingEquipment:"Appropriate builder tools, small blunt weapon",feature:"You may construct buildings and structures."},{stage:"Adulthood",category:"Laborer",name:"Plowhand",details:"[+30 Feat of Strength, +17 Animal Husbandry, +8 Endure]",startingWealth:"Insignificant",startingEquipment:"Farming tools, tinderbox",feature:"You may perform labor for pay for farmers."},{stage:"Adulthood",category:"Laborer",name:"Raker",details:"[+30 Resist Toxins, +17 Search, +8 Navigate]",startingWealth:"Moderate",startingEquipment:"Cloak, settlement map, tinderbox",feature:"You may perform labor for pay in sewers."},{stage:"Adulthood",category:"Merchant",name:"Guild Master",details:"[+30 Trade, +17 Perform, +8 Interpret]",startingWealth:"Wealthy",startingEquipment:"1 horse, 1 pack mule, 2 servants, 2 bodyguards, organization signifier, 3 sets of fine clothes",feature:"You command a mercantile or trade guild."},{stage:"Adulthood",category:"Merchant",name:"Black Market Dealer",details:"[+30 Conceal, +17 Trade, +8 Deceive]",startingWealth:"Significant",startingEquipment:"1 artifact, 1 potion, 1 spell scroll, 1 bodyguard, forged organization signifier",feature:"You have private access to black markets in settlements and regions."},{stage:"Adulthood",category:"Merchant",name:"Innkeeper",details:"[+30 Interpret, +17 Parley, +8 Trade]",startingWealth:"Significant",startingEquipment:"1 servant, 1 bodyguard",feature:"You own an inn that provides steady income."},{stage:"Adulthood",category:"Merchant",name:"Peddler",details:"[+30 Trade, +17 Identify, +8 Navigate]",startingWealth:"Moderate",startingEquipment:"Carriage, 2 horses, region map, tinderbox",feature:"You know the overland routes between all settlements."},{stage:"Adulthood",category:"Merchant",name:"Bookkeeper",details:"[+30 Search, +17 Translate, +8 Academic Recall]",startingWealth:"Moderate",startingEquipment:"10 tomes of subject choice, 1 spell scroll",feature:"You have private access to various organizations records and private offices."},{stage:"Adulthood",category:"Merchant",name:"Hawker",details:"[+30 Perform, +17 Trade, +8 Perform]",startingWealth:"Moderate",startingEquipment:"Tent",feature:"You may perform labor for pay in markets."},{stage:"Adulthood",category:"Noble",name:"Knight",details:"[+30 Battle, +17 Endure, +8 Parley]",startingWealth:"Significant",startingEquipment:"Era and race appropriate armor, 2 weapons of choice, horse, religious or ideological tome, squire, organization signifier, set of fine clothes, writ",feature:"You may perform quests for a higher noble than yourself to gain titles and land."},{stage:"Adulthood",category:"Noble",name:"Baron",details:"[+30 Perform, +17 Battle, +8 Parley]",startingWealth:"Wealthy",startingEquipment:"Era and race appropriate armor, weapon of choice, tent, horse, packmule, 2 servants, 2 bodyguards, organization signifier, 3 sets of fine clothes, writ",feature:"You command a barony and serve a higher noble than yourself to gain titles and land."},{stage:"Adulthood",category:"Noble",name:"Landed Gentry",details:"[+30 Parley, +17 Perform, +8 Seduce]",startingWealth:"Wealthy",startingEquipment:"Small or medium weapon of choice, tent, packmule, 1 servant, organization signifier, 3 sets of fine clothes, writ",feature:"You command an estate."},{stage:"Adulthood",category:"Noble",name:"Squire",details:"[+30 Persevere, +17 Feat of Defiance, +8 Endure]",startingWealth:"Insignificant",startingEquipment:"Light armor, weapon of choice, religious or ideological tome, organization signifier, set of fine clothes, tinderbox",feature:"You serve under a knight or party member to gain titles and land (knighthood). +1 Fate Point."},{stage:"Adulthood",category:"Noble",name:"Thuil",details:"[+30 Incite Fate, +17 Deduce, +8 Resist Supernatural]",startingWealth:"Wealthy",startingEquipment:"organization signifier",feature:"You have access to narrative ancillaries relating to Fireborn. You can see during Har'Rheunen without Ozoar. +30 Deity Relationship Points. +1 Fate Point."},{stage:"Adulthood",category:"Noble",name:"Inheritor",details:"[+30 Parley, +17 Deceive, +8 Perform]",startingWealth:"Wealthy",startingEquipment:"Packmule, 1 servant, organization signifier, 3 sets of fine clothes",feature:"You are related to someone very powerful or rich who you will eventually take over for during some part of the campaign."},{stage:"Adulthood",category:"Psion",name:"Psychometrist",details:"[+30 Psionic Technique, +17 Resist Psionics, +8 Track]",startingWealth:"Significant",startingEquipment:"None",feature:"Psionic Technique Tree, Unlocked: Psychometry, and 2 of the following: Claircognizance, Clairvoyance, Identify, Psychoscopy, or Track, and 1 additional psi-point. Automatic Psionic unlocks and +1 Psi Point."},{stage:"Adulthood",category:"Psion",name:"Telekineticist",details:"[+30 Psionic Technique, +17 Resist Psionics, +8 Feat of Strength]",startingWealth:"Significant",startingEquipment:"None",feature:"Psionic Technique Tree, Unlocked: Telekinesis, and 2 of the following: Levitation, Psychokinesis, Dynakinesis, Psychometabolism, or Density, and 1 additional psi-point. Automatic Psionic unlocks and +1 Psi Point."},{stage:"Adulthood",category:"Psion",name:"Telepath",details:"[+30 Psionic Technique, +17 Resist Psionics, +8 Identify]",startingWealth:"Significant",startingEquipment:"None",feature:"Psionic Technique Tree, Unlocked: Telepathy, and 2 of the following: Pry, Sense Presence, Communicate, Interfere, or Interconnect, and 1 additional psi-point. Automatic Psionic unlocks and +1 Psi Point."},{stage:"Adulthood",category:"Psion",name:"Hypnotist",details:"[+30 Psionic Technique, +17 Resist Psionics, +8 Perform]",startingWealth:"Significant",startingEquipment:"None",feature:"Psionic Technique Tree, Unlocked: Hypnosis, and 2 of the following: Pathokinesis, Illusion, Possession, Mnokinesis, or Override, and 1 additional psi-point. Automatic Psionic unlocks and +1 Psi Point."},{stage:"Adulthood",category:"Psion",name:"Dynakineticist",details:"[+30 Psionic Technique, +17 Resist Psionics, +8 Interpret]",startingWealth:"Significant",startingEquipment:"None",feature:"Psionic Technique Tree, Unlocked: Telekinesis, Dynakinesis, and 1 of the following: Shield, Field, or Force. Automatic Psionic unlocks and +1 Psi Point."},{stage:"Adulthood",category:"Psion",name:"Illusionist",details:"[+30 Psionic Technique, +17 Resist Psionics, +8 Deceive]",startingWealth:"Significant",startingEquipment:"None",feature:"Psionic Technique Tree, Unlocked: Hypnosis, Illusion, and one of the following: Amplify I, Dampen, or Alter Illusion. Automatic Psionic unlocks and +1 Psi Point."},{stage:"Adulthood",category:"Sailor",name:"Rigger",details:"[+30 Feat of Agility, +17 Feat of Strength, +8 Feat of Defiance]",startingWealth:"Insignificant",startingEquipment:"Small or medium weapon of choice, game of choice, rope"},{stage:"Adulthood",category:"Sailor",name:"Boatswain",details:"[+30 Craft, +17 Forage, +8 Search]",startingWealth:"Insignificant",startingEquipment:"Carpentry tools, textile tools, rope making tools, measuring tools",feature:"Climbing does not cost extra action or energy. +1 Fate Point."},{stage:"Adulthood",category:"Sailor",name:"Captain",details:"[+30 intimidate, +17 Battle, +8 Parley]",startingWealth:"Significant",startingEquipment:"Spyglass, exotic pet, small or medium weapon of choice, 1 artifact, game of choice, 1 friend, set of fine clothes, organization signifier",feature:"You may perform labor for pay aboard ships. +1 Fate Point."},{stage:"Adulthood",category:"Sailor",name:"Navy",details:"[+30 Battle, +17 Endure, +8 Parley]",startingWealth:"Moderate",startingEquipment:"Weapon of choice, light armor, writ, organization signifier",feature:"You command a crewed ship. +1 Fate Point."},{stage:"Adulthood",category:"Sailor",name:"Navigator",details:"[+30 Navigate, +17 Incite Fate, +8 Search]",startingWealth:"Insignificant",startingEquipment:"Navigation tools, 10 region maps",feature:"You cannot become lost at sea. +1 Fate Point."},{stage:"Adulthood",category:"Sailor",name:"Quartermaster",details:"[+30 Identify, +17 Trade, +8 Heal]",startingWealth:"Moderate",startingEquipment:"Tool set of choice, rope, medical kit, tinderbox, cooking utensils",feature:"Crews and military units will perform favors for you in exchange for goods. +1 Fate Point."},{stage:"Adulthood",category:"Wanderer",name:"Rheunen Walker",details:"[+30 Navigate, +17 Forage, +8 Battle]",startingWealth:"Wealthy",startingEquipment:"Weapon of choice, cloak, 10 region maps, 1 potion, organization signifier, writ, tinderbox",feature:"You know of a secret passage in every region. You can see during Har'Rheunen without Ozoar."},{stage:"Adulthood",category:"Wanderer",name:"Explorer",details:"[+30 Navigate, +17 Search, +8 Identify]",startingWealth:"Moderate",startingEquipment:"Navigation tools, pack mule, exotic pet, rope, 10 region maps, tinderbox",feature:"You know of a secret passage in every region."},{stage:"Adulthood",category:"Wanderer",name:"Archaeologist",details:"[+30 Search, +17 Academic Recall, +8 Navigate]",startingWealth:"Moderate",startingEquipment:"Archaeologist tools, pack mule, artifact, rope, 10 site maps",feature:"You know of a hidden ruin in every region."},{stage:"Adulthood",category:"Wanderer",name:"Vagabond",details:"[+30 Endure, +17 Persevere, +8 Battle]",startingWealth:"Pauper",startingEquipment:"None",feature:"You have a friend who can give aid and shelter in every region."},{stage:"Adulthood",category:"Wanderer",name:"Exile",details:"[+30 Intimidate, +17 Battle, +8 Forage]",startingWealth:"Pauper",startingEquipment:"None",feature:"You have a particular people or organization you can perfectly replicate and that cannot be seen through (disguise-wise etc) by magic or other means. +1 Fate Point."},{stage:"Adulthood",category:"Wanderer",name:"Pilgrim",details:"[+30 Deduce, +17 Incite Fate, +8 Feat of Austerity]",startingWealth:"Pauper",startingEquipment:"Religious or ideological tome, staff, tinderbox",feature:"You may visit places of worship to vastly increase your relationship with a deity(s)."},{stage:"Adulthood",category:"Warrior",name:"Soldier",details:"[+30 Battle, +17 Persevere, +8 Feat of Strength]",startingWealth:"Moderate",startingEquipment:"Weapon of choice, shield, era and race appropriate armor, organization signifier",feature:"You are part of an army that you report to and will give aid and supplies if you are performing relevant tasks."},{stage:"Adulthood",category:"Warrior",name:"Guard",details:"[+30 Interpret, +17 identify, +8 Battle]",startingWealth:"Insignificant",startingEquipment:"Small, medium, or ranged weapon of choice, shield, era and race appropriate armor, organization signifier",feature:"Criminal elements will generally flee from you outside of combat."},{stage:"Adulthood",category:"Warrior",name:"Barbarian",details:"[+30 Endure, +17 Battle, +8 Feat of Strength]",startingWealth:"Pauper",startingEquipment:"Weapon of choice, light armor of choice, tinderbox, organization signifier",feature:"You may use intimidate in place of perform and parley."},{stage:"Adulthood",category:"Warrior",name:"Gladiator",details:"[+30 Perform, +17 endure, +8 Intimidate]",startingWealth:"Moderate",startingEquipment:"Weapon of choice, light armor of choice",feature:"You may use perform in place of battle. +1 Fate Point."},{stage:"Adulthood",category:"Warrior",name:"Officer",details:"[+30 Intimidate, +17 Parley, +8 Battle]",startingWealth:"Significant",startingEquipment:"Weapon of choice, era and race-appropriate armor, horse, writ, organization signifier",feature:"You command a military unit and serve in a military to obtain a higher rank."},{stage:"Adulthood",category:"Warrior",name:"Scout",details:"[+30 Gather Intelligence, +17 Search, +8 Conceal]",startingWealth:"Moderate",startingEquipment:"Small or ranged weapon of choice, horse, spyglass, region map, organization signifier, tinderbox",feature:"You have private access to military leaders and military informants relating to the movements of armies and raiders/pirates."},{stage:"Flaws",name:"Addicted",details:"You have an itch that cannot be scratched. A vice of yours or a substance you use controls your thoughts and emotions more than you do."},{stage:"Flaws",name:"Aggressive",details:"Fight first and ask questions later! You find it difficult to resist battle, and often, it seems like the best or only solution to a problem."},{stage:"Flaws",name:"Arrogant",details:"You are better than everyone else because of your status or talents. Those who belittle or slight you had better watch out."},{stage:"Flaws",name:"Broken",details:"Tough living ground you down. The life youve lived thus far has given you a serious physical or mental condition."},{stage:"Flaws",name:"Cloistered",details:"You dont remember the last time you saw someone else. Your lifestyle has led you to be an awkward loner when out of your element."},{stage:"Flaws",name:"Cold",details:"Keep your friends close and your enemies closer. In your life, youve learned to trust your mind more than your heart."},{stage:"Flaws",name:"Corrupt",details:"Its good to be the King! When in a position of power or authority, you cannot resist abusing or taking advantage of it to enrich yourself."},{stage:"Flaws",name:"Craven",details:"Life is too short. You avoid pain, danger, and confrontation whenever possible."},{stage:"Flaws",name:"Cruel",details:"If they wanted you to stop, theyd have asked. You go far and beyond whats necessary when it comes to fights, disputes, and vengeance."},{stage:"Flaws",name:"Eccentric",details:"Nobody gets you, and thats fine. Youre a strange person whom people find difficult to engage with, whether because of your demeanor or your interests."},{stage:"Flaws",name:"Extravagant",details:"You like nice things, and thats just because you have high standards. You have lived a life of luxury and plenty that has led to your inability to cope with a substandard lifestyle."},{stage:"Flaws",name:"Greedy",details:"Enough is never enough! You always want more, whether its money, sex, status, or respect."},{stage:"Flaws",name:"Guilty",details:"What have you done? Youve lived a life where youve had to do some nasty things, and they still haunt you."},{stage:"Flaws",name:"Impatient",details:"What are you waiting for? Time is of the essence, and you cannot stand it when people waste it."},{stage:"Flaws",name:"Impulsive",details:"Why not? If you want to do something, you have a tough time stopping yourself."},{stage:"Flaws",name:"Incurious",details:"Who cares? You keep your nose to the grindstone, and any attempt to sway you from your path is just an inane distraction."},{stage:"Flaws",name:"Indecisive",details:"Left or right? Any time you have to make a decision, its a tough decision, and you always overthink it."},{stage:"Flaws",name:"Jealous",details:"You are green with envy. Any time someone has more than you or is better at something youre good at, you cannot stand it."},{stage:"Flaws",name:"Lazy",details:"Why bother? You avoid work and hard things at all costs."},{stage:"Flaws",name:"Oblivious",details:"Nothing ever happens. You have a terrible sense of self-awareness and situational awareness."},{stage:"Flaws",name:"Out of Touch",details:"The little people are back. Your lifestyle has either led to you being so far removed from people due to wealth and fame, or so far away that you dont understand normal people."},{stage:"Flaws",name:"Overzealous",details:"Youre very enthusiastic, and thats good! You believe in a cause, ideology, or organization so much, its caused you to hate your enemies with an unquenchable burning passion."},{stage:"Flaws",name:"Paranoid",details:"Theyre watching you! Youve made so many enemies throughout your life, theyre bound to come for you, and for all you know, they may be around the next corner."},{stage:"Flaws",name:"Perfectionist",details:"Practice makes perfect! You cannot settle for subpar work, and as such, take way too long to do things, and oftentimes throw out your work altogether to restart."},{stage:"Flaws",name:"Power Hungry",details:"Adrun is ripe for the taking! You aspire to gain power, influence, and might at all costs."},{stage:"Flaws",name:"Procrastinator",details:"You can do it later. You always put things off until the consequences of ignoring them cannot be ignored."},{stage:"Flaws",name:"Simple",details:"Whatre they even talking about? Things ought not be complicated, and so if it is, you refuse to or cannot understand complex issues or situations."},{stage:"Flaws",name:"Stubborn",details:"When youre right, youre right. Nobody else knows what theyre talking about, and you have to prove that to them."},{stage:"Flaws",name:"Unhealthy",details:"You hurt all over. Your lifestyle has led to a generally warped body, mind, social life, or spirit, and you refuse to do anything about it."},{stage:"Flaws",name:"Unwise",details:"You can just read about it. You are so wrapped up in your intellect or ideology, youve become unable to cope with the worldly."},{stage:"Flaws",name:"Weak-Willed",details:"You go with the flow. Anytime you are confronted with something difficult, you fold under the pressure."},{stage:"Inciting Incident",name:"Exiled",details:"[+5 Forage]"},{stage:"Inciting Incident",name:"Debts",details:"[+5 Trade]"},{stage:"Inciting Incident",name:"Rumors",details:"[+5 Gather Intelligence]"},{stage:"Inciting Incident",name:"Destroyed Home",details:"[+5 Persevere]"},{stage:"Inciting Incident",name:"Revenge",details:"[+5 Track]"},{stage:"Inciting Incident",name:"Following Dreams",details:"[+5 Incite Fate]"},{stage:"Inciting Incident",name:"Accomplished Feat",details:"[+5 Endure]"},{stage:"Inciting Incident",name:"Vision",details:"[+5 Deduce]"}],ub=["PHYSICAL","MENTAL","SPIRITUAL","WILL"],ou=3,Do=-1,Mo=3,Ta={Family:1,Childhood:1,Adolescence:1,Adulthood:2,Flaws:2,"Inciting Incident":1},eE=e=>{const t=e.match(/([+]+)?\s*(\d+)\s*fate\s*point/i);return t?parseInt(t[2],10):0},tE=e=>{const t={};return ub.forEach(n=>{t[n]=e[n]}),t},nE=(e,t,n,s)=>{var h;if(!e)return{};const i={skills:Object.fromEntries((e.skills??[]).map(m=>[wt(m),{score:0,racialBonus:0}]))},o=e.modifiers.filter(m=>m.sourceType==="race"?m.sourceKey===t:m.sourceType==="subrace"?m.sourceKey===n:!1),l={},c=new Set,u=Pv({baseState:i,modifiers:o});for(const m of e.skills??[]){const y=wt(m),b=(h=u.skills)==null?void 0:h[y];l[y]=typeof(b==null?void 0:b.racialBonus)=="number"?b.racialBonus:0,typeof(b==null?void 0:b.racialBonus)=="number"&&c.add(y)}const d=m=>{if(!m)return;const y=s[m];y!=null&&y.skills&&Object.entries(y.skills).forEach(([b,_])=>{typeof _=="number"&&(c.has(b)||(l[b]=(l[b]??0)+_))})};return d(t),d(n),l},aE=(e,t)=>{if(!(t!=null&&t.length))return{};const n={},s=new Map;t.forEach(i=>{const o=aa(i);s.set(o,wt(i))});const r=i=>i.replace(/[\[\]]/g,"").split(/[,;]/).map(l=>l.trim()).map(l=>{const c=l.match(/([+-]?\d+)\s+(.+)/);if(!c)return null;const u=parseInt(c[1],10),d=c[2].trim(),h=aa({name:d}),m=s.get(h);return!m||Number.isNaN(u)?null:{code:m,value:u}}).filter(Boolean);return e.forEach(i=>{r(i.details??"").forEach(({code:l,value:c})=>{n[l]=(n[l]??0)+c})}),n},lu=new Set(["MARTIAL_PROWESS","ILDAKAR_FACULTY"]),sE=()=>{var de;const e=Ea(),[t]=Kh(),n=((de=t.get("campaignId"))==null?void 0:de.trim())||void 0,s=n?`/player/campaigns/${n}/characters`:"/player/characters",{setSelectedId:r}=Is(),{data:i,loading:o,error:l}=As(),c=(i==null?void 0:i.raceDetails)??{},[u,d]=v.useState([]),[h,m]=v.useState(null),[y,b]=v.useState(!0),[_,w]=v.useState({Family:"",Childhood:"",Adolescence:"",Adulthood:"",Flaws:"","Inciting Incident":""}),[f,p]=v.useState(""),[g,j]=v.useState(""),[A,R]=v.useState(""),[S,k]=v.useState(""),[N,E]=v.useState(null),[M,O]=v.useState({adulthood:[],flaws:[]}),[X,re]=v.useState({PHYSICAL:0,MENTAL:0,SPIRITUAL:0,WILL:0}),[I,$]=v.useState(!1),[L,D]=v.useState(null),F=v.useMemo(()=>ab(Zv),[]),q=v.useMemo(()=>new Map(F.map(U=>[`${U.tree}:${U.name}`,U])),[F]),V=v.useMemo(()=>new Map(F.map(U=>[U.id,U])),[F]);v.useEffect(()=>{b(!0),m(null);try{const U=ZS.map(P=>({stage:P.stage,name:P.name,details:P.details??"",category:P.category,startingWealth:P.startingWealth,startingEquipment:P.startingEquipment,feature:P.feature,fateBonus:eE(P.details??"")}));d(U.filter(P=>!!(P.stage&&P.name)))}catch(U){const P=U instanceof Error?U.message:"Failed to load backgrounds";m(P)}finally{b(!1)}},[]);const Q=v.useMemo(()=>Array.from(new Set(u.filter(U=>U.stage==="Adulthood"&&U.category).map(U=>U.category))).sort(),[u]),te=v.useMemo(()=>((i==null?void 0:i.subraces)??[]).filter(U=>!A||(U.parentId?U.parentId===A:!0)),[i,A]),B=v.useMemo(()=>A?c[A]:void 0,[c,A]),ae=v.useMemo(()=>S?c[S]:void 0,[c,S]),le=v.useMemo(()=>{const U={martialProwess:0,ildakarFaculty:0,psiPoints:0,deityCapPerSpirit:0};return[B,ae].forEach(P=>{if(!P)return;const H=P.disciplines??{};U.martialProwess+=H.martialProwess??0,U.ildakarFaculty+=H.ildakarFaculty??0,U.psiPoints+=H.psiPoints??0,U.deityCapPerSpirit+=H.deityCapPerSpirit??P.deityCapPerSpirit??0}),U},[B,ae]),he=(U,P)=>{O(H=>({...H,[U]:P||void 0}))},ue=(U,P,H)=>{O(Z=>{const ie=new Set(Z[U]??[]);if(ie.has(P))ie.delete(P);else{if(ie.size>=H)return Z;ie.add(P)}return{...Z,[U]:Array.from(ie)}})},xe=(U,P)=>{re(H=>{const Z={...H,[U]:Math.min(Mo,Math.max(Do,H[U]+P))};return Object.values(Z).reduce((ee,G)=>ee+G,0)>ou?H:Z})},Ne=(U,P)=>{const H=M.adulthood??[],Z=new Set;let ie=0;const ee=[];return H.forEach(G=>{const Y=G.trim().toLowerCase(),J=sb[Y];if(!J)return;ie+=J.psiBonus,J.granted.forEach($e=>{const Ue=q.get(`${$e.tree}:${$e.name}`);Ue&&Z.add(Ue.id)});const Ae=J.options.map($e=>{const Ue=q.get(`${$e.tree}:${$e.name}`);return Ue?{id:Ue.id,tree:$e.tree,name:$e.name}:null}).filter(Boolean);Ae.length>0&&ee.push({backgroundName:G,required:J.picksRequired,options:Ae,selectedIds:[]})}),ee.length===0?null:{characterId:U,characterName:P,psiBonus:ie,baseAbilityIds:Array.from(Z),choices:ee}},je=(U,P)=>{E(H=>{if(!H)return H;const Z=H.choices.map((ie,ee)=>{if(ee!==U)return ie;const G=new Set(ie.selectedIds);if(G.has(P))G.delete(P);else{if(G.size>=ie.required)return ie;G.add(P)}return{...ie,selectedIds:Array.from(G)}});return{...H,choices:Z}})},Ce=(N==null?void 0:N.choices.every(U=>U.selectedIds.length===U.required))??!1,Ke=()=>{if(!N)return;if(typeof window>"u"){E(null),e(s);return}const U=`${tm}:${N.characterId}`,P=N.choices.flatMap(G=>G.selectedIds);let H={};try{const G=window.localStorage.getItem(U);G&&(H=JSON.parse(G))}catch(G){console.warn("Unable to parse existing psionics state",G)}const Z=new Set(H.purchased??[]),ie=new Set([...H.backgroundPicks??[],...P]);N.baseAbilityIds.forEach(G=>ie.add(G)),ie.forEach(G=>Z.delete(G));const ee={purchased:Array.from(Z),backgroundPicks:Array.from(ie)};try{window.localStorage.setItem(U,JSON.stringify(ee))}catch(G){console.warn("Unable to persist psionics state",G)}E(null),e(s)},Me=()=>{E(null),e(s)},oe=Object.values(X).reduce((U,P)=>U+P,0),pe=ou-oe,ve=v.useMemo(()=>{const U=new Map;u.forEach(Z=>U.set(`${Z.stage}:${Z.name}`,Z));const P=[],H=(Z,ie)=>{if(!ie)return;const ee=U.get(`${Z}:${ie}`);ee&&P.push(ee)};return H("Family",M.family),H("Childhood",M.childhood),H("Adolescence",M.adolescence),(M.adulthood??[]).forEach(Z=>H("Adulthood",Z)),(M.flaws??[]).forEach(Z=>H("Flaws",Z)),H("Inciting Incident",M.incitingIncident),P},[u,M]),be=v.useMemo(()=>ma(X,i==null?void 0:i.skills),[X,i]),ke=v.useMemo(()=>nE(i,A,S,c),[i,c,A,S]),Ie=v.useMemo(()=>({...ke}),[ke]),Be=v.useMemo(()=>aE(ve,i==null?void 0:i.skills),[i==null?void 0:i.skills,ve]),_e=v.useMemo(()=>{const U={...Ie};return Object.entries(Be).forEach(([P,H])=>{lu.has(P)||(U[P]=(U[P]??0)+H)}),Object.entries(be).forEach(([P,H])=>{lu.has(P)||(U[P]=(U[P]??0)+H)}),U},[be,Be,Ie]),He=v.useMemo(()=>[...(i==null?void 0:i.skills)??[]].filter(U=>!lu.has(wt(U))).sort((U,P)=>U.name.localeCompare(P.name)),[i]),De=ve.reduce((U,P)=>U+P.fateBonus,0),ne=3+De,me=v.useMemo(()=>{const U=[];return Object.keys(Ta).forEach(P=>{const H=Ta[P],Z=P==="Adulthood"?(M.adulthood??[]).length:P==="Flaws"?(M.flaws??[]).length:M[P==="Inciting Incident"?"incitingIncident":P.toLowerCase()]?1:0;Z!==H&&U.push(`${P} (${Z}/${H})`)}),U},[M]),we=g.trim().length>0&&!y&&!o&&me.length===0&&pe===0,Ye=async()=>{if(!(!we||I)){$(!0),D(null);try{const U={family:M.family,childhood:M.childhood,adolescence:M.adolescence,adulthood:M.adulthood,flaws:M.flaws,incitingIncident:M.incitingIncident},P=await Ct.createCharacter({name:g.trim(),level:1,campaignId:n,raceKey:A||void 0,subraceKey:S||void 0,attributePointsAvailable:0,skillPoints:100,skillAllocations:{},backgrounds:U,attributes:tE(X),skillBonuses:_e,fatePoints:ne});r(P.id);const H=Ne(P.id,P.name);H?E(H):e(s)}catch(U){const P=U instanceof Error?U.message:"Failed to create character";D(P)}finally{$(!1)}}},Fe=(U,P,H)=>{const Z=u.filter(J=>J.stage===U),ie=U==="Adulthood"||U==="Flaws",ee=M[P],G=(_[U]??"").toLowerCase().trim(),Y=Z.filter(J=>{const Ae=[J.name,J.details,J.category,J.startingEquipment,J.startingWealth,J.feature].filter(Boolean).join(" ").toLowerCase(),$e=!G||Ae.includes(G),Ue=U!=="Adulthood"||!f||J.category===f;return $e&&Ue});return a.jsxs("div",{className:"character-creation__card character-creation__section",children:[a.jsx("div",{className:"character-creation__section-header",children:a.jsxs("div",{children:[a.jsx("div",{className:"character-creation__section-title caption muted",children:U}),a.jsxs("div",{className:"character-creation__section-subtitle h3",children:["Choose ",H," (",ie?`${(ee==null?void 0:ee.length)??0}`:ee?1:0,"/",H,")"]})]})}),a.jsxs("div",{className:"character-creation__control-row",children:[a.jsx("input",{value:_[U]??"",onChange:J=>w(Ae=>({...Ae,[U]:J.target.value})),placeholder:`Search ${U.toLowerCase()}...`,className:"character-creation__input character-creation__input--grow"}),U==="Adulthood"&&a.jsxs("select",{value:f,onChange:J=>p(J.target.value),className:"character-creation__select character-creation__select--compact",children:[a.jsx("option",{value:"",children:"All categories"}),Q.map(J=>a.jsx("option",{value:J,children:J},J))]})]}),Y.length===0&&a.jsx("div",{className:"character-creation__muted",children:"No options found."}),a.jsx("div",{className:"character-creation__options",children:Y.map(J=>{const Ae=ie?ee==null?void 0:ee.includes(J.name):ee===J.name;return a.jsxs("label",{className:`character-creation__option${Ae?" character-creation__option--selected":""}`,children:[a.jsx("input",{type:ie?"checkbox":"radio",name:U,checked:Ae,onChange:()=>ie?ue(P,J.name,H):he(P,J.name),className:"character-creation__option-input"}),a.jsxs("div",{className:"character-creation__option-body",children:[a.jsxs("div",{className:"character-creation__option-header",children:[a.jsxs("div",{children:[a.jsx("div",{className:"character-creation__option-title",children:J.name}),U==="Adulthood"&&J.category&&a.jsx("div",{className:"character-creation__tag",children:J.category})]}),J.fateBonus>0&&a.jsxs("div",{className:"character-creation__bonus character-creation__bonus--positive",children:["+",J.fateBonus," Fate Point(s)"]})]}),a.jsx("div",{className:"character-creation__option-details",children:J.details}),U==="Adulthood"&&a.jsxs("div",{className:"character-creation__option-meta",children:[a.jsxs("div",{children:[a.jsx("strong",{children:"Starting Wealth: "}),J.startingWealth||"Not specified"]}),a.jsxs("div",{children:[a.jsx("strong",{children:"Starting Equipment: "}),J.startingEquipment||"Not specified"]}),a.jsxs("div",{children:[a.jsx("strong",{children:"Feature: "}),J.feature||"Not specified"]})]})]})]},`${U}-${J.name}`)})})]})},z=U=>{const P=X[U];return a.jsxs("div",{className:"character-creation__attribute-row",children:[a.jsx("div",{className:"character-creation__attribute-label",children:U}),a.jsxs("div",{className:"character-creation__attribute-controls",children:[a.jsx("button",{onClick:()=>xe(U,-1),disabled:P<=Do,className:"character-creation__mini-button",children:"-"}),a.jsx("div",{className:"character-creation__attribute-value",children:P}),a.jsx("button",{onClick:()=>xe(U,1),disabled:P>=Mo||pe<=0,className:"character-creation__mini-button",children:"+"})]}),a.jsx("div",{className:"character-creation__muted",children:"Affects linked skills by 10 per point"})]},U)};return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"character-creation",children:[a.jsx("h2",{className:"character-creation__title h2",children:"Character Creation"}),(l||h||L)&&a.jsx("p",{className:"character-creation__error",children:l||h||L}),a.jsxs("div",{className:"character-creation__layout",children:[a.jsxs("aside",{className:"character-creation__card character-creation__sidebar",children:[a.jsxs("div",{children:[a.jsx("div",{className:"character-creation__label",children:"Name"}),a.jsx("input",{value:g,onChange:U=>j(U.target.value),placeholder:"Character name",disabled:I,className:"character-creation__input"})]}),a.jsxs("div",{children:[a.jsx("div",{className:"character-creation__label",children:"Race"}),a.jsxs("select",{value:A,onChange:U=>{R(U.target.value),k("")},disabled:o||I,className:"character-creation__select",children:[a.jsx("option",{value:"",children:"Select race"}),((i==null?void 0:i.races)??[]).map(U=>a.jsx("option",{value:U.id,children:U.name},U.id))]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"character-creation__label",children:"Subrace"}),a.jsxs("select",{value:S,onChange:U=>k(U.target.value),disabled:o||I,className:"character-creation__select",children:[a.jsx("option",{value:"",children:"Select subrace"}),te.map(U=>a.jsx("option",{value:U.id,children:U.name},U.id))]})]}),(B||ae)&&a.jsxs("div",{className:"character-creation__card character-creation__card--subtle",children:[a.jsx("div",{className:"character-creation__label character-creation__label--tight",children:"Discipline Bonuses"}),a.jsxs("div",{className:"character-creation__discipline-grid",children:[a.jsxs("div",{children:[a.jsx("div",{className:"character-creation__muted",children:"Martial Prowess"}),a.jsx("div",{className:"character-creation__value",children:le.martialProwess})]}),a.jsxs("div",{children:[a.jsx("div",{className:"character-creation__muted",children:"Ildakar Faculty"}),a.jsx("div",{className:"character-creation__value",children:le.ildakarFaculty})]}),a.jsxs("div",{children:[a.jsx("div",{className:"character-creation__muted",children:"Psi-Points"}),a.jsx("div",{className:"character-creation__value",children:le.psiPoints})]}),a.jsxs("div",{children:[a.jsx("div",{className:"character-creation__muted",children:"Deity Cap / Spiritual"}),a.jsx("div",{className:"character-creation__value",children:le.deityCapPerSpirit})]})]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"character-creation__label",children:"Attribute Points"}),a.jsxs("div",{className:`character-creation__status${pe===0?" character-creation__status--good":" character-creation__status--warn"}`,children:[pe," remaining (min ",Do,", max ",Mo,")"]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"character-creation__label",children:"Fate Points"}),a.jsxs("div",{className:"character-creation__value",children:["Base 3"," ",De>0?`+ ${De} from backgrounds = ${ne}`:`= ${ne}`]})]}),a.jsx("button",{onClick:Ye,disabled:!we||I,className:"character-creation__button character-creation__button--primary",children:I?"Creating...":"Create Character"}),me.length>0&&a.jsxs("div",{className:"character-creation__warning",children:["Select required options: ",me.join(", ")]})]}),a.jsxs("div",{className:"character-creation__content",children:[a.jsxs("div",{className:"character-creation__grid",children:[Fe("Family","family",Ta.Family),Fe("Childhood","childhood",Ta.Childhood),Fe("Adolescence","adolescence",Ta.Adolescence),Fe("Adulthood","adulthood",Ta.Adulthood),Fe("Flaws","flaws",Ta.Flaws),Fe("Inciting Incident","incitingIncident",Ta["Inciting Incident"])]}),a.jsxs("div",{className:"character-creation__card character-creation__section",children:[a.jsxs("div",{className:"character-creation__section-header",children:[a.jsxs("div",{children:[a.jsx("div",{className:"character-creation__section-title caption muted",children:"Attributes"}),a.jsxs("div",{className:"character-creation__section-subtitle h3",children:["Distribute ",ou," points (min ",Do,", max ",Mo,")"]})]}),a.jsxs("div",{className:`character-creation__status${pe===0?" character-creation__status--good":" character-creation__status--warn"}`,children:["Remaining: ",pe]})]}),ub.map(z)]}),a.jsxs("div",{className:"character-creation__card character-creation__section",children:[a.jsx("div",{className:"character-creation__section-title caption muted",children:"Skill Adjustments"}),a.jsx("div",{className:"character-creation__skill-list",children:He.map(U=>({skill:U,bonus:_e[wt(U)]??0})).map(({skill:U,bonus:P})=>a.jsxs("div",{className:"character-creation__skill-row",children:[a.jsx("div",{className:"character-creation__skill-name",children:U.name}),a.jsxs("div",{className:`character-creation__bonus${P>=0?" character-creation__bonus--positive":" character-creation__bonus--negative"} character-creation__skill-bonus`,children:[P>=0?"+":"",P]})]},U.id))})]})]})]})]}),N&&a.jsx("div",{className:"character-creation__modal-overlay",children:a.jsxs("div",{className:"character-creation__modal",children:[a.jsx("div",{className:"character-creation__modal-header",children:a.jsxs("div",{children:[a.jsx("div",{className:"character-creation__muted",children:"Psionic unlocks"}),a.jsx("h3",{className:"character-creation__modal-title h2",children:"Select Psionic Abilities"}),a.jsxs("p",{className:"character-creation__modal-subtitle subtitle muted",children:[N.characterName," qualifies for additional psionic techniques. Choose the required options now or keep the defaults to pick later."]})]})}),N.baseAbilityIds.length>0&&a.jsxs("div",{className:"character-creation__card character-creation__card--subtle character-creation__modal-auto",children:[a.jsx("strong",{children:"Automatically granted:"}),a.jsx("ul",{className:"character-creation__list",children:N.baseAbilityIds.map(U=>{const P=V.get(U);return a.jsx("li",{className:"character-creation__modal-list-item",children:P?`${P.name} (${P.tree})`:U},U)})})]}),a.jsx("div",{className:"character-creation__modal-grid",children:N.choices.map((U,P)=>a.jsxs("div",{className:"character-creation__card character-creation__card--subtle",children:[a.jsxs("div",{className:"character-creation__modal-choice-header",children:[a.jsxs("div",{children:[a.jsx("div",{className:"character-creation__muted",children:"Background"}),a.jsx("div",{className:"character-creation__value",children:U.backgroundName})]}),a.jsxs("div",{className:"character-creation__muted",children:["Choose ",U.selectedIds.length,"/",U.required]})]}),a.jsx("div",{className:"character-creation__modal-options",children:U.options.map(H=>{const Z=V.get(H.id),ie=U.selectedIds.includes(H.id),ee=!ie&&U.selectedIds.length>=U.required;return a.jsxs("label",{className:`character-creation__option character-creation__option--psionic${ie?" character-creation__option--selected":""}`,style:{cursor:ee?"not-allowed":"pointer"},children:[a.jsx("input",{type:"checkbox",checked:ie,disabled:ee,onChange:()=>je(P,H.id),className:"character-creation__option-input"}),a.jsxs("div",{children:[a.jsx("div",{className:"character-creation__option-title",children:(Z==null?void 0:Z.name)??H.name}),a.jsx("div",{className:"character-creation__muted",children:(Z==null?void 0:Z.tree)??H.tree}),(Z==null?void 0:Z.description)&&a.jsx("div",{className:"character-creation__option-description",children:Z.description.length>180?`${Z.description.slice(0,180)}...`:Z.description})]})]},H.id)})})]},`${U.backgroundName}-${P}`))}),a.jsxs("div",{className:"character-creation__modal-actions",children:[a.jsx("button",{onClick:Me,className:"character-creation__button",children:"Decide later"}),a.jsx("button",{onClick:Ke,disabled:!Ce,className:"character-creation__button character-creation__button--primary",children:"Save psionic picks"})]})]})})]})},rE=[{name:"Thairin Inin",id:"thairin-inin",entries:[{id:"thairin",name:"Thairin",description:"May use two-handed weapons and shields simultaneously.",mechanical:!1},{id:"silverrun",name:"Silverrun",description:"You add character tier x physical modifier to weapon damage.[Mechanical]",mechanical:!0},{id:"suwasi",name:"Suwasi",description:"Your armors and shields do not cost passive energy.[Mechanical]",mechanical:!0}]},{name:"Grazin Inin",id:"grazin-inin",entries:[{id:"whale-clan",name:"Whale Clan",description:"Swimming only takes 1 energy/AP.",mechanical:!1},{id:"owl-clan",name:"Owl Clan",description:"Advantage when in mental contested rolls.",mechanical:!1},{id:"raven-clan",name:"Raven Clan",description:"Add physical modifier x character tier to energy gained through spells/potions. used to heal",mechanical:!1},{id:"wolf-clan",name:"Wolf Clan",description:"You always ignore 1 cold wound.[Mechanical]",mechanical:!0},{id:"bear-clan",name:"Bear Clan",description:"You gain +20% to armor damage reductions.[Mechanical]",mechanical:!0},{id:"fox-clan",name:"Fox Clan",description:"You may use Deceive in place of another skill character tier times per moon face.",mechanical:!1}]},{name:"Bryonin Inin",id:"bryonin-inin",entries:[{id:"bryonin",name:"Bryonin",description:"You see through non-magical disguises after a few minutes spent speaking/interacting with a mortal.",mechanical:!1}]},{name:"Jiinin Inin",id:"jiinin-inin",entries:[{id:"yaich",name:"Yaich",description:"Add physical modifier to initiative rolls.[Mechanical]",mechanical:!0},{id:"shun",name:"Shun",description:"Add +10 martial prowess at character-tier increases.[Mechanical]",mechanical:!0},{id:"rodonin",name:"Rodonin",description:"You always go first in initiative while in darkness.",mechanical:!1}]},{name:"Rivanonin Inin",id:"rivanonin-inin",entries:[{id:"rivanonin",name:"Rivanonin",description:"You gain +1 link point per level per link partner.",mechanical:!1},{id:"ecthvasin",name:"Ecthvasin",description:"Your Ildakar spell aspects are increased by 20%.[Mechanical]",mechanical:!0},{id:"kaindorin",name:"Kaindorin",description:"You may spend a link point after a failed link once per moon face per link partner to attempt again.",mechanical:!1}]},{name:"Melfarionin Inin",id:"melfarionin-inin",entries:[{id:"melfarionin",name:"Melfarionin",description:"May use message with adjacent link partners for free.",mechanical:!1}]},{name:"Thuilin Inin",id:"thuilin-inin",entries:[{id:"thuilin",name:"Thuilin",description:"You may use feat of agility to defend against ranged weapon/spell attacks instead of battle.",mechanical:!1},{id:"ganzenonin",name:"Ganzenonin",description:"You gain +30 Martial Prowess at character tier increases.[Mechanical]",mechanical:!0}]},{name:"Letelin Inin",id:"letelin-inin",entries:[{id:"letelin",name:"Letelin",description:"You recover all spent ammunition after every encounter.",mechanical:!1},{id:"georothin",name:"Georothin",description:"You are immune to poison.",mechanical:!1}]},{name:"Anz",id:"anz",entries:[{id:"rammish",name:"Rammish",description:"+20% to resisting abilities/effects of a specific enemy type. [Mechanical]",mechanical:!0},{id:"prolux",name:"Prolux",description:"Unless brought to 0 energy after sustaining damage, may spend 3 action points as a reaction to regain 2x character tier energy.",mechanical:!1},{id:"onlu",name:"Onlu",description:"You automatically regain 2x character tier energy per round.[Mechanical]",mechanical:!0},{id:"saion",name:"Saion",description:"When conscious again after being unconscious, you may add your feat of strength skills raw value to energy at the cost of a level of exhaustion.[Mechanical]",mechanical:!0},{id:"epir",name:"Epir",description:"Your unarmed attacks multiply by your physical modifier for damage.[Mechanical]",mechanical:!0}]},{name:"Phiilin",id:"phiilin",entries:[{id:"elari",name:"Elari",description:"You may use Will Dakar for Battle or Battle for Will Dakar.",mechanical:!1},{id:"laigoni",name:"Laigoni",description:"You may move for free once per round.",mechanical:!1},{id:"rodoni",name:"Rodoni",description:"You gain +20% damage reduction from all sources.[Mechanical]",mechanical:!0}]},{name:"Cerevu",id:"cerevu",entries:[{id:"darii",name:"Darii",description:"You gain +20% battle against a specific type of creature.",mechanical:!1},{id:"cerii",name:"Cerii",description:"Your tools don't take up inventory slots.",mechanical:!1}]},{name:"Venii",id:"venii",entries:[{id:"agunic",name:"Agunic",description:"You can link with non-mortal creature types.",mechanical:!1},{id:"unfaic",name:"Unfaic",description:"You can climb sheer surfaces and on ceilings without tools or checks.",mechanical:!1}]},{name:"Freinin",id:"freinin",entries:[{id:"human",name:"Human",description:"You gain +10% energy, +10 martial prowess, and +1 spiritual mod deity relationship point cap at character tier increases.[Mechanical]",mechanical:!0}]}],iE=[{id:"advanced-angelic-vessel",name:"Advanced Angelic Vessel",requirements:["-Fledgling Angelic Vessel Ancillary","+3 Spiritual"],description:"You may use Divine Intervention in place of Battle and Heal. You no longer need to breathe. You may use 3 Deity Relationship cost Divine Interventions without expending deity relationship points Spiritual attribute times per moonface.",mechanical:!1},{id:"advanced-fireborn",name:"Advanced Fireborn",requirements:["-Fledgling Fireborn Ancillary","+2 Spiritual","+1 Will"],description:"You can light unequipped items on fire with touch. Your critical attacks cause burning status on your foes. You can use a long-range attack that deals spiritual attribute in fire damage against targets equal to spiritual attribute x10 ft away at the cost of your melee attack in action points and energy.",mechanical:!1},{id:"advanced-grappler",name:"Advanced Grappler",requirements:["-Grappler Ancillary"],description:"When you initiate grapples, the grapple tracker automatically starts at Heavily Maintained. When you are in a grapple, your foe loses passive energy 2x your physical attribute per round.",mechanical:!1},{id:"advanced-psychic",name:"Advanced Psychic",requirements:["-Fledgling Psychic Ancillary","+75 Will Dakar","+75 Psionic Technique","-At least 1 2-Point Psionic Technique unlocked"],description:"You may use Psionic Technique in place of Will Dakar for tier 2 Ildakar spells.",mechanical:!1},{id:"advanced-spell-blade",name:"Advanced Spell Blade",requirements:["-Fledgling Spell Blade Ancillary","+3 Physical","+75 Battle and +75 Psionic Technique, Will Dakar, or Divine Intervention","-All martial prowess abilities unlocked in a category"],description:"You add your physical attribute to your channeled spells after you attack, using the same process as the fledgling spell blade ancillary.",mechanical:!1},{id:"advanced-spell-sculptor",name:"Advanced Spell Sculptor",requirements:["-Spell Sculptor Ancillary","+150 Will Dakar and Feat of Agility"],description:"You may now choose where to place the environmental consequence effects of your Ildakar Spells as opposed to the typical ring effect for the given faculty. The range of this relocation must use the same range as the spells primary effect.",mechanical:!1},{id:"alchemist",name:"Alchemist",requirements:["-Alchemist Apprentice Ancillary","+100 Craft"],description:"You can Craft Advanced Potions. Crafting Basic Potions takes 20% less time and resources.",mechanical:!1},{id:"alchemist-apprentice",name:"Alchemist Apprentice",requirements:["+50 Craft","+50 Academic Recall"],description:"You can Craft Basic Potions.",mechanical:!1},{id:"ancestral-flame",name:"Ancestral Flame",requirements:["-Cerevu Race","-Membership in a Cerii or Darii Clan","-Possession of a Clan Lantern Relic"],description:"Add your Relationship Score (positive or negative) with your Clan to your Feat of Defiance rolls so long as you have your lantern lit. If your lantern is snuffed or runs out of fuel, you lose 25 Points with your Clan.",mechanical:!1},{id:"astronaut",name:"Astronaut",requirements:["-Ildakar Understudy Ancillary","-Cosmomancy Faculty unlocked","+100 Navigate"],description:"You may navigate in extraterrestrial areas.",mechanical:!1},{id:"bilge-baron",name:"Bilge Baron",requirements:["-Rat Ancillary","+2 Spiritual"],description:"You take half necrosis damage and add your spiritual attribute x8 to persevere against undead.",mechanical:!1},{id:"black-cloth",name:"Black Cloth",requirements:["+2 Spiritual","+50 Worship and Divine Intervention","-Aligned","-Clergy Background"],description:"You may specify Divine Interventions that cost 1 and 3 Deity Relationships without using Texts or Verses, and these DIs only cost 1 Deity Relationship point.",mechanical:!1},{id:"black-paladin",name:"Black Paladin",requirements:["+2 Physical","+2 Spiritual","+50 Sense Supernatural","+50 Resist Supernatural","-Aligned","-Clergy or Noble Background"],description:"Divine Interventions from Rasadan deal double damage to demons and undead.",mechanical:!1},{id:"blue-cloth",name:"Blue Cloth",requirements:["-Green Cloth Ancillary","+4 Spiritual","+100 Worship and Divine Intervention"],description:"You may specify Divine Interventions that cost 15 Deity Relationship without using Texts or Verses, and these DIs only cost 7 Deity Relationship Points.",mechanical:!1},{id:"blue-paladin",name:"Blue Paladin",requirements:["-Green Paladin Ancillary","+3 Physical","+100 Sense Supernatural and +100 Resist Supernatural"],description:"You may expend Deity Relationship points with Rasadan for Zeras Divine Interventions. Add your physical attribute to the magical heals you cast.",mechanical:!1},{id:"bone-warrior",name:"Bone Warrior",requirements:["-Duumist Ancillary","+2 Physical","-All unarmed martial prowess abilities unlocked"],description:"An exoskeleton connected to your skeletal structure grows from your skin. Your unarmed strikes cause supernatural creatures to lose 1 AP for spiritual attribute rounds. They also cause targets to lose spiritual attribute Will Dakar, Psionic Technique, and Divine Intervention. In addition, your exoskeleton is as strong as steel, taking on the defensive properties of steel plate armor. With 3 Physical, titanium plate armor, with 4, giantstone plate armor, 5, star steel plate armor, and 6, aquiline plate armor. You may perform hard armor martial prowess abilities even when unarmored.",mechanical:!1},{id:"champion-of-duum",name:"Champion of Duum",requirements:["-Paladin of Duum Ancillary","+4 Physical and Spiritual"],description:"The Dark God Duum torments you, causing your critical strikes to disempower artifacts. Magical creatures take spiritual attribute damage when they attack you and per round as a passive when within spiritual attribute x20 ft of you.",mechanical:!1},{id:"brutal-ildakar",name:"Brutal Ildakar",requirements:["+4 Physical","+100 Feat of Strength","-At least one Ildakar Faculty unlocked"],description:"May use Feat of Strength in place of Will Dakar. You may cast an Ildakar spell requiring +1 Physical in exchange for 1 exhaustion once per moonface.",mechanical:!1},{id:"cavalryman",name:"Cavalryman",requirements:["+50 Battle","+50 Animal Handling","-Warrior or Noble Background","-One martial prowess ability unlocked"],description:"When you attack atop your mount after your mount moves, add the amount moved to your attack damage, whether melee or ranged. Your mount deals the amount of movement used in damage if it runs a creature over, and the creature cannot successfully defend.",mechanical:!1},{id:"cloak-and-dagger",name:"Cloak and Dagger",requirements:["+50 Battle","+50 Conceal","-At least 1 Small Blades MP ability and 1 Cloak MP ability unlocked"],description:"Once per round, you may roll conceal against your target instead of battle, and upon success, you score a wicked critical on a hit.",mechanical:!1},{id:"contortionist",name:"Contortionist",requirements:["+50 Feat of Agility"],description:"You can fit through openings that are one size smaller than your actual size. You can automatically escape from nonmagical bindings and shackles if given a few minutes. If you are grappled, the grapple tracker automatically starts at Slightly Escaped.",mechanical:!1},{id:"crafter",name:"Crafter",requirements:["+50 Craft"],description:"You know how to use 2 more toolsets. With every character tier advancement, you learn how to use an additional toolset.",mechanical:!1},{id:"cunning-ildakar",name:"Cunning Ildakar",requirements:["+4 Mental","+100 Academic Recall","-At least one Ildakar Faculty unlocked"],description:"May use Academic Recall in place of Will Dakar. You may cast an Ildakar spell requiring +1 Mental in exchange for 1 exhaustion once per moonface.",mechanical:!1},{id:"demigod",name:"Demigod",requirements:["-Pontifex Maximus Ancillary","+4 Physical, Mental, or Will"],description:"1, 3, 7, 15, and 25 cost Divine Interventions with your Deity now cost energy instead of Deity Relationship points.",mechanical:!1},{id:"divine-aura",name:"Divine Aura",requirements:["+5 Spiritual","-Full game history with a Deity","-Clergy background"],description:"If the Deity is aligned, unaligned creatures must succeed on a persevere check when they perceive you or flee, and if the Deity is unaligned, aligned creatures must do so instead. Attacks and spells used against you cause the attacker to take damage equal to your spiritual attribute. If the deity is of the sect below, they take this damage type: Light: Holy Spiritual Knowledge: Mental Ice: Cold Fire: Fire Nature: Poison Redeemed Dark: Necrosis Unaligned: Unholy Spiritual",mechanical:!1},{id:"divine-health",name:"Divine Health",requirements:["+4 Spiritual","+100 Divine Intervention or Worship, or +60 in Both"],description:"May use Divine Intervention in place of Resist Toxins and Endure.",mechanical:!1},{id:"diviner",name:"Diviner",requirements:["-Diviner Apprentice Ancillary","+2 Spiritual","+75 Worship and Divine Intervention"],description:"Based on your specific deitys sect, you gain: Light: Spiritual attribute coverage against Holy Spiritual damage Knowledge: Spiritual attribute coverage against Mental damage Fire: Spiritual attribute coverage against Burn damage Ice: Spiritual attribute coverage against Cold damage Nature: Spiritual attribute coverage against Necrosis damage Dark: Spiritual attribute coverage against Unholy Spiritual damage damage",mechanical:!1},{id:"druid",name:"Druid",requirements:["+3 Spiritual","+50 Worship","-Grazin Race","-Clergy Background"],description:"Must dedicate to only the Ice Sect. Your deities all gain an additional Spiritual attribute Deity Relationship Points passive generation regardless of biome.",mechanical:!1},{id:"duumist",name:"Duumist",requirements:["-Permanent singular dedication to Duum","-Clergy or Criminal background","+1 Spiritual and Physical","-At least 3 Unarmed Martial Prowess abilities unlocked"],description:"You may create spiritual attribute 5ft by 5 ft antimagic fields where you stand per hour, each lasting 1 hour.",mechanical:!1},{id:"enchanter",name:"Enchanter",requirements:["-Apprentice Enchanter Ancillary","+75 Will Dakar and +75 Craft"],description:"You may specify 1 major effect or all minor effects when you craft magic items. Your enchantments cause less radiation, and you can cast at +1 duration.",mechanical:!1},{id:"enchanter-apprentice",name:"Enchanter Apprentice",requirements:["-Artificy Ildakar Faculty Unlocked","+50 Will Dakar and +50 Craft"],description:"You may specify 1 minor effect when you craft magic items.",mechanical:!1},{id:"epic-angelic-vessel",name:"Epic Angelic Vessel",requirements:["-Heroic Angelic Vessel Ancillary","+4 Spiritual"],description:"You may use Divine Intervention in place of Will Skills. You no longer need to sleep. You may use 15 Deity Relationship cost Divine Interventions without expending deity relationship points Spiritual attribute times per moonface.",mechanical:!1},{id:"epic-fireborn",name:"Epic Fireborn",requirements:["-Heroic Fireborn Ancillary","+4 Spiritual","+1 Will","Instead of teal blue, your flames can now manifest as gold, purple, blue, red, green, or black. Choose one of the following:"],description:"Gold: All prior Fireborn abilities may now be used to heal instead. All evil creatures take additional damage equal to spiritual attribute. Purple: All prior Fireborn abilities may now be used to deal mental damage instead. All creatures with at least -1 Mental now take additional damage equal to spiritual attribute. Blue: All prior Fireborn abilities may now be used to deal cold elemental and freeze instead of burn. All fire-based creatures and elementals now take additional damage equal to spiritual attribute. Red: All prior Fireborn abilities now deal +1 damage. All cold and water-based creatures and elementals take additional damage equal to spiritual attribute. Green: All prior Fireborn abilities may now be used to deal poison damage and poison instead of burn. All beasts and sentient plants take additional damage equal to spiritual attribute. Black: All prior Fireborn abilities may now be used to deal necrosis damage and necrotize instead of burn. Undead take additional damage equal to spiritual attribute. You may now attempt to become a Thuil. You may only take this ancillary once.",mechanical:!1},{id:"epic-psychic",name:"Epic Psychic",requirements:["-Heroic Psychic Ancillary","+125 Will Dakar","+125 Psionic Technique","-At least 1 4-Point Psionic Technique unlocked","-At least 3 Basic Ildakar Faculties and 2 Advanced Ildakar Faculties unlocked"],description:"You may use Psionic Technique in place of Will Dakar for tier 4 Ildakar spells.",mechanical:!1},{id:"epic-spell-blade",name:"Epic Spell Blade",requirements:["-Heroic Spell Blade Ancillary","+4 Physical","+125 Battle and +125 Psionic Technique, Will Dakar, or Divine Intervention","-Double the points to unlock all martial prowess abilities in a category"],description:"For your chosen spellcasting style, AP used for one martial prowess per round counts towards channelling spells.",mechanical:!1},{id:"fateweavers-chosen",name:"Fateweavers Chosen",requirements:["+50 Incite Fate"],description:"The Fateweavers Folly appears to you once per character tier without expenditure of Fate Points. You gain +1 Fate whenever you level up. You may only take this ancillary once.",mechanical:!1},{id:"fledgling-angelic-vessel",name:"Fledgling Angelic Vessel",requirements:["-Permanent singular dedication to one aligned Deity"],description:"You gain double the passive accrual of the Deity Relationship and double the amount for performing your Deitys desired worship actions. You may use 1 Deity Relationship cost Divine Interventions without expending deity relationship points Spiritual attribute times per moonface. You may only take this ancillary once.",mechanical:!1},{id:"fledgling-fireborn",name:"Fledgling Fireborn",requirements:["-Thuilin or Ganzenonin Race","-Palace Family or Thuil Adulthood Background","+1 Spiritual"],description:"Melee attacks against you deal Spiritual attribute in fire damage against the attacker. Your melee attacks deal an additional Spiritual attribute in fire damage.",mechanical:!1},{id:"fledgling-psychic",name:"Fledgling Psychic",requirements:["+50 Will Dakar","+50 Psionic Technique","-At least 1 Psionic Technique unlocked","-At least 1 Ildakar Faculty unlocked"],description:"You may use Psionic Technique in place of Will Dakar for tier 1 Ildakar spells.",mechanical:!1},{id:"fledgling-spell-blade",name:"Fledgling Spell Blade",requirements:["+2 Physical","+2 Mental, Will, or Spiritual","+50 Battle and +50 Psionic Technique, Will Dakar, or Divine Intervention","-Dedication to at least one Deity or at least one Psionic Technique unlocked or at least one Ildakar Faculty unlocked","-At least one martial prowess ability unlocked"],description:"Choose from one of the following: Psionic Technique, Will Dakar, or Divine Intervention. You may channel one of these magics, dedicating the relevant resources of said spell, relieving yourself of concentration until you next rest. The spell will automatically go off when you successfully hit a creature with a martial prowess ability.",mechanical:!1},{id:"fools-luck",name:"Fools Luck",requirements:["+50 Incite Fate","-1 Mental"],description:"You may use Incite Fate in place of Feat of Defiance checks.",mechanical:!1},{id:"grappler",name:"Grappler",requirements:["+1 Physical","-At least 2 Unarmed Martial Prowess abilities unlocked"],description:"When you initiate grapples, the grapple tracker automatically starts at Slightly Maintained. When you are in a grapple, your foe loses passive energy x your physical attribute per round.",mechanical:!1},{id:"green-cloth",name:"Green Cloth",requirements:["-Black Cloth Ancillary","+4 Spiritual","+75 Worship and Divine Intervention"],description:"You may specify Divine Interventions that cost 7 Deity Relationship without using Texts or Verses, and these DIs only cost 3 Deity Relationship Points.",mechanical:!1},{id:"green-paladin",name:"Green Paladin",requirements:["-Black Paladin Ancillary","+3 Spiritual","+75 Sense Supernatural and Resist Supernatural"],description:"You may expend Deity Relationship points with Rasadan for Hommas Turn Evil, Ishmadts Purify, and Nanduls Turn Undead Divine Interventions. Add your spiritual attribute to your weapon attacks.",mechanical:!1},{id:"hell-lock",name:"Hell-Lock",requirements:["-Hexlock Ancillary","+3 Spiritual"],description:"You cannot be frightened or charmed by demons or undead. Unaligned creatures, demons, and undead within spiritual attribute x10 ft must resist supernatural with a target of spiritual attribute x25 or be paralyzed and prone for spiritual attribute rounds. You can do this spiritual attribute times per moon face. In addition, you may summon random unbound demons from Duums Hellscape as he sees fit to send. Successful spells you cast against magic-users and those using magic equipment must Resist Supernatural with a target of spiritual attribute x25 for spiritual attribute rounds.",mechanical:!1},{id:"heroic-angelic-vessel",name:"Heroic Angelic Vessel",requirements:["-Advanced Angelic Vessel Ancillary","+3 Spiritual"],description:"You may use Divine Intervention in place of Physical skills. You no longer need to eat or drink. You may use 7 Deity Relationship cost Divine Interventions without expending deity relationship points Spiritual attribute times per moonface.",mechanical:!1},{id:"heroic-fireborn",name:"Heroic Fireborn",requirements:["-Advanced Fireborn Ancillary","+3 Spiritual","+1 Will","You gain flight. You can fly spiritual attribute x5 ft up and can move 3 at the cost of 1 action point and energy. Creatures you fly over take spiritual attribute fire damage and gain the burning status."],description:"",mechanical:!1},{id:"heroic-psychic",name:"Heroic Psychic",requirements:["-Advanced Psychic Ancillary","+100 Will Dakar","+100 Psionic Technique","-At least 1 3-Point Psionic Technique unlocked","-At least 1 Advanced Ildakar Faculty unlocked"],description:"You may use Psionic Technique in place of Will Dakar for tier 3 Ildakar spells.",mechanical:!1},{id:"heroic-spell-blade",name:"Heroic Spell Blade",requirements:["-Advanced Spell Blade Ancillary","+3 Mental, Will, or Spiritual","+100 Battle and Psionic Technique, Will Dakar, or Divine Intervention","-More points than are required to unlock all MP abilities in a category"],description:"Energy used for martial prowess abilities counts towards channelling spells of the chosen spellcasting type, once per round.",mechanical:!1},{id:"hex-lock",name:"Hex-Lock",requirements:["-Bone Warrior Ancillary","+2 Spiritual"],description:"You may use Divine Intervention for Presence Skills. Successful presence skills cause creatures to become charmed for spiritual attribute minutes. Unaligned creatures and demons resist with disadvantage. Aligned and angelic resist with advantage. In addition, your martial prowess abilities cause creatures to take an additional spiritual attribute unholy spiritual damage, as well as penalties of spiritual attribute x3 to psionic technique, divine intervention, and will dakar.",mechanical:!1},{id:"high-diviner",name:"High Diviner",requirements:["-Diviner Ancillary","+3 Spiritual","+100 Worship and Divine Intervention"],description:"Based on your specific deitys sect, you gain: Light: Spiritual attribute aura of Holy Spiritual damage Knowledge: Spiritual attribute aura of Mental damage Fire: Spiritual attribute aura of Burn damage Ice: Spiritual attribute aura of Cold damage Nature: Spiritual attribute aura of Healing for allies Dark: Spiritual attribute aura of Unholy Spiritual damage damage",mechanical:!1},{id:"infamous",name:"Infamous",requirements:["-Membership in at least 1 Organization","-10 Reputation in at least 1 organization","-Arrogant, Corrupt, Guilty, or Cruel, or Overzealous Flaw"],description:"You start with -25 reputation in any organization you interact with, but gain +100 in organizations you are a member of.",mechanical:!1},{id:"iron-gut",name:"Iron Gut",requirements:["+50 Resist Toxins"],description:"You may take an additional Physical attribute potions per moonface without penalties.",mechanical:!1},{id:"legendary-angelic-vessel",name:"Legendary Angelic Vessel",requirements:["-Epic Angelic Vessel Ancillary","+5 Spiritual"],description:"You may use Divine Intervention in place of Mental Skills. You are immune to necrosis wounds and damage, as well as disease and poison. You may use 25 Deity Relationship cost Divine Interventions without expending deity relationship points Spiritual attribute times per phase.",mechanical:!1},{id:"legendary-fireborn",name:"Legendary Fireborn",requirements:["-Epic Fireborn Ancillary","+5 Spiritual","+2 Will","You produce an aura that is spiritual attribute x5 ft. This aura burns all creatures you are not linked to or have not linked to for spiritual attribute and applies burning status to them, whether they are allies, bystanders, or foes. You may now fly spiritual attribute x100 ft high and may move 6 for 1 action point and energy. Long-distance travel time is reduced by 50%."],description:"You must now succeed with Feat of Austerity with a difficulty equal to your spiritual attribute x10 whenever you perceive a Fireborn you have not met since you acquired this ancillary, or are driven into a frenzy to battle said Fireborn.",mechanical:!1},{id:"legendary-psychic",name:"Legendary Psychic",requirements:["-Epic Psychic Ancillary","+150 Will Dakar","+150 Psionic Technique","-At least 1 5-Point Psionic Technique unlocked","-At least 4 Basic Ildakar Faculties and 3 Advanced Ildakar Faculties unlocked"],description:"You may use Psionic Technique in place of Will Dakar for tier 5 Ildakar spells.",mechanical:!1},{id:"legendary-spell-blade",name:"Legendary Spell Blade",requirements:["-Epic Spell Blade Ancillary","+4 Mental, Will, or Spiritual","+150 Battle and +150 Psionic Technique, Will Dakar, or Divine Intervention","-At least two martial prowess categories with all abilities unlocked"],description:"Energy for Martial Prowess abilities count towards channelling spells of your chosen spellcasting type.",mechanical:!1},{id:"levied-footsoldier",name:"Levied Footsoldier",requirements:["+50 Battle","+1 Physical","-Warrior or Farmer background"],description:"When attacked by a charging foe or mounted foe, add the distance in feet they moved to your defense. If you surpass the rider's defense, you may dismount them, and they fall prone.",mechanical:!1},{id:"locust-lord",name:"Locust Lord",requirements:["-Plague Prince Ancillary","+5 Spiritual"],description:"15 and 25 cost Grall DIs can be specified without texts or verses. 15-cost Grall DIs now cost 7 Deity Relationship points, and 25-cost Grall DIs cost 15. All undead must make resist supernatural rolls of spiritual attribute x20 when they first perceive you or become loyal to you. You cannot suffer necrosis wounds and are immune to necrosis damage.",mechanical:!1},{id:"mage-slayer",name:"Mage Slayer",requirements:["+75 Resist Supernatural","+75 Resist Psionics","+75 Will Dakar","+75 Endure"],description:"Your attacks and offensive spells cause magic-users to take Physical attribute penalties to Divine Intervention, Will Dakar, or Psionic Technique.",mechanical:!1},{id:"master-alchemist",name:"Master Alchemist",requirements:["-Alchemist Ancillary","+150 Craft","-A potion each person in your party regularly uses, including yourself"],description:"You can Craft Complex Potions. Crafting Basic and Advanced Potions takes 50% less time and resources.",mechanical:!1},{id:"master-craftsman",name:"Master Craftsman",requirements:["-Prodigal Craftsman or Crafter Ancillary","+150 Craft","-A piece of equipment that each of your party members, including yourself, uses regularly","-Member of a crafting or trade-related Organization"],description:"You can produce +5 Fine Items. Crafting takes 50% less time and resources.",mechanical:!1},{id:"master-enchanter",name:"Master Enchanter",requirements:["-Enchanter Ancillary","+125 Will Dakar and +125 Craft"],description:"You may specify all magic effects when you craft magic items. Your enchantments cause no radiation, and you can cast at full duration.",mechanical:!1},{id:"master-lightkeeper",name:"Master Lightkeeper",requirements:["-Crafter Background","+120 Craft","+50 Academic Recall"],description:"You can craft basic and advanced potions, and use Lightkeeper tools to do so.",mechanical:!1},{id:"myrmidon",name:"Myrmidon",requirements:["+50 Battle","+50 Endure or Feat of Strength","-Warrior background","-At least 1 Shield and 1 Polearm, large blunt, large bearded, or large bladed martial prowess abilities unlocked"],description:"May use two-handed melee weapons in conjunction with a shield.",mechanical:!1},{id:"mythic-angelic-vessel",name:"Mythic Angelic Vessel",requirements:["-Legendary Angelic Vessel Ancillary","+6 Spiritual"],description:"You may use Divine Intervention in place of all Skills. You may travel between planes without penalties. You may use 40 Deity Relationship cost Divine Interventions without expending deity relationship points Spiritual attribute times per cycle.",mechanical:!1},{id:"mythic-fireborn",name:"Mythic Fireborn",requirements:["-Legendary Fireborn Ancillary","+6 Spiritual","+3 Will","Minion foes are instantly vaporized in an aura around you that is spiritual attribute x10 ft. You may move 12 for 1 action point and energy. Liquids within 10 ft of you are instantly vaporized, and flammable objects or explosives ignite. Long-distance travel time is reduced by 99%. All unlinked creatures must succeed on a Persevere check equal to your spiritual attribute x25 when they perceive you or lose 1 morale. You now appear as a humanoid flame at all times, and this cannot be undone. You apply burning status to anyone you touch, including allies."],description:"",mechanical:!1},{id:"mythic-psychic",name:"Mythic Psychic",requirements:["-Legendary Psychic Ancillary","+175 Will Dakar","+200 Psionic Technique","-An entire Psionic Technique branch unlocked","-All basic Ildakar Faculties unlocked"],description:"You may use Psionic Technique in place of Will Dakar for tier 6 Ildakar spells. You may combine Psionic Techniques and Ildakar spells.",mechanical:!1},{id:"mythic-spell-blade",name:"Mythic Spell Blade",requirements:["-Legendary Spell Blade Ancillary","+6 Mental, Will, or Spiritual, and +6 Physical","+250 Battle or in Psionic Technique, Will Dakar, or Divine Intervention, or +175 in both"],description:"Action Points for Martial Prowess abilities count towards channelling spells of your chosen spellcasting type.",mechanical:!1},{id:"oracle-of-atenikil",name:"Oracle of Atenikil",requirements:["-Blind","-Woman","-At least one 5-Point Psionic Technique unlocked"],description:"You may link with the Dragon Atenikil to learn psionic techniques in exchange for seeing visions he sends.",mechanical:!1},{id:"outlander",name:"Outlander",requirements:["+50 Navigate","-Freinin Race or Wanderer Background"],description:"You may navigate in outerland environments.",mechanical:!1},{id:"paladin-of-duum",name:"Paladin of Duum",requirements:["-Hellock Ancillary","+3 Physical"],description:"An antimagic field aura with a range of Spiritual attribute x10 ft emanates from you. Those affected by the field are slowed. Your critical hits cause your magical creatures and magic-users to be paralyzed for Spiritual attribute rounds.",mechanical:!1},{id:"paragon-of-battle",name:"Paragon of Battle",requirements:["-Weapon Mastery Ancillary","+6 Physical","+250 Battle","-Triple the investment of points into a martial prowess that is required to unlock all martial prowess abilities in the category"],description:"With your chosen martial prowess, you may invent 3 additional signature abilities per character tier advancement. Each of these abilities may be performed once per encounter with 0 energy and AP costs, and are automatic brutal critical hits upon successful attack or reaction.",mechanical:!1},{id:"paragon-of-virtue",name:"Paragon of Virtue",requirements:["+6 Spiritual","+250 Worship or Divine Intervention or +175 in both.","-Aligned"],description:"All worship accrues Deity Relationship with all Aligned Deities.",mechanical:!1},{id:"plague-prince",name:"Plague Prince",requirements:["-Vulture Ancillary","+4 Spiritual"],description:"You may specify 1, 3, and 7 cost Grall Divine Interventions without texts or verses. 3-cost DIs now cost 1 Deity Relationship, and 7-cost now cost 3. You cannot be poisoned and automatically reduce necrosis wounds by 1.",mechanical:!1},{id:"plane-hopper",name:"Plane Hopper",requirements:["+4 Spiritual","+120 Resist Supernatural"],description:"You may travel through extraplanar environments without suffering penalties.",mechanical:!1},{id:"polyglot",name:"Polyglot",requirements:["+3 Mental","+50 Translate"],description:"You gain Mental attribute additional known languages. You gain an additional known language with every character tier advancement.",mechanical:!1},{id:"pontifex-maximus",name:"Pontifex Maximus",requirements:["-Rex Sacrorum Ancillary","+5 Spiritual","+150 Worship and Divine Intervention"],description:"Based on your specific deitys sect, you gain: * Light: Spiritual attribute aura of resist Holy Spiritual damage for yourself and allies * Knowledge: Spiritual attribute aura of resist Mental damage for yourself and allies * Fire: Spiritual attribute aura of resist Burn damage for yourself and allies * Ice: Spiritual attribute aura of resist Cold damage for yourself and allies * Nature: Spiritual attribute aura of resist Necrosis damage for yourself and allies * Dark: Spiritual attribute aura of resist Unholy Spiritual damage for yourself and allies",mechanical:!1},{id:"prodigal-craftsman",name:"Prodigal Craftsman",requirements:["+50 Craft"],description:"You can produce +1 Fine items. Crafting takes 20% less time and resources.",mechanical:!1},{id:"quick-hands",name:"Quick Hands",requirements:["+50 Feat of Agility"],description:"You can use equipment for 1 less AP cost.",mechanical:!1},{id:"rat",name:"Rat",requirements:["-clergy or criminal background","+1 Spiritual","-Permanent singular dedication to Grall"],description:"You may add your spiritual attribute x8 to resist toxins rolls.",mechanical:!1},{id:"red-cloth",name:"Red Cloth",requirements:["-Blue Cloth Ancillary","+5 Spiritual","+125 Worship and Divine Intervention"],description:"You may specify Divine Interventions that cost 25 Deity Relationship without using Texts or Verses, and these DIs only cost 15 Deity Relationship Points.",mechanical:!1},{id:"red-cloth-of-osolon",name:"Red Cloth of Osolon",requirements:["-Red Cloth Ancillary","-Member of Old Narindurin Church","+6 Spiritual","+150 Worship and Divine Intervention"],description:"You are now the leader of the Old Narindurin Church. You may specify Divine Interventions that cost 40 Deity Relationship without using Texts or Verses, and these DIs only cost 25 Deity Relationship Points. Red Cloth of Tuluron Requirements: leader of new church -Red Cloth Ancillary -Member of New Narindurin Church +6 Spiritual +150 Worship and Divine Intervention You are now the leader of the New Narindurin Church. You may specify Divine Interventions that cost 50 Deity Relationship without using Texts or Verses, and these DIs only cost 40 Deity Relationship Points.",mechanical:!1},{id:"red-paladin",name:"Red Paladin",requirements:["-Blue Paladin Ancillary","+4 Spiritual","+125 Sense Supernatural and Resist Supernatural"],description:"You are the leader of a Paladin Chapter. You may expend Deity Relationship points with Rasadan for Aelias Inspire, Floras Valor, and Kashas Bless Divine Interventions. Your smites deal double damage to all unaligned creatures. Your light spells deal spiritual attribute holy spiritual damage to unaligned creatures.",mechanical:!1},{id:"relentless-rex",name:"Relentless Rex",requirements:["+80 Persevere","+40 Endure"],description:"You suffer no morale penalties when you suffer critical hits.",mechanical:!1},{id:"renowned",name:"Renowned",requirements:["+4 Will","-Membership in at least 4 Organizations"],description:"You start with +25 reputation in any organization you interact with.",mechanical:!1},{id:"restless",name:"Restless",requirements:["+4 Physical or Will","+150 Endure"],description:"You become conscious with 4 exhaustion upon succeeding on a Feat of Defiance roll.",mechanical:!1},{id:"rex-sacrorum",name:"Rex Sacrorum",requirements:["-High Diviner Ancillary","+4 Spiritual","+125 Worship and Divine Intervention"],description:"Based on your specific deitys sect, you gain: * Light: Weapon attacks deal additional Spiritual attribute Holy Spiritual damage * Knowledge: Weapon attacks deal additional Spiritual attribute Mental damage * Fire: Weapon attacks deal additional Spiritual attribute Burn damage * Ice: Weapon attacks deal additional Spiritual attribute Cold damage * Nature: Weapon attacks deal additional Spiritual attribute Necrosis damage * Dark: Weapon attacks deal additional Spiritual attribute Unholy Spiritual damage",mechanical:!1},{id:"rheunen-walker",name:"Rheunen Walker",requirements:["+50 Track","+30 Search","-Member of Rheunen Walker Guild Organization"],description:"You can see during Har'Rheunen. You start with one secret path and gain one secret path with every character tier advancement.",mechanical:!1},{id:"rotten-one",name:"Rotten One",requirements:["-Locust Lord Ancillary","+6 Spiritual"],description:"You are the leader of the Cult of Grall. You may travel between planes without penalties and may teleport at will. Grall will give you directives for artifact locations. You may use 40 Deity Relationship cost Grall Divine Interventions without expending deity relationship points Spiritual attribute times per cycle.",mechanical:!1},{id:"savage",name:"Savage",requirements:["-Cruel Flaw","-Grazin or Freinin race or Rammish Anz ancestral ancillary or Ganzenonin Inin ancestral ancillary","+150 Intimidate"],description:"You may use Intimidate in place of Parley. Your use of intimidate and critical attacks deal morale penalties to the other foes in the encounter besides the initial target.",mechanical:!1},{id:"sect-cloth",name:"Sect Cloth",requirements:["+3 Spiritual","+50 Worship or Divine Intervention"],description:"Choose a sect of Aligned Deities. All Worship of any of these Deities accrues Deity Relationship with all Deities of that Sect.",mechanical:!1},{id:"shaman",name:"Shaman",requirements:["+3 Spiritual","+50 Worship","-Anz Race","-Clergy Background"],description:"Must dedicate to only the Nature Sect. Your deities all gain an additional Spiritual attribute Deity Relationship Points passive generation regardless of biome.",mechanical:!1},{id:"shield-maiden",name:"Shield Maiden",requirements:["+50 Battle","+3 Physical","-Woman","-Grazin or Thairin Race","-Warrior or Noble background","-At least one shield martial prowess ability unlocked"],description:"You may expend shield durability to add Battle for an adjacent allys defense. Shields in your hands have additional durability equal to your physical attribute.",mechanical:!1},{id:"shock-troop",name:"Shock Troop",requirements:["+50 Battle","+2 Physical","-One martial prowess ability unlocked"],description:"When you charge, you add your physical attribute twice to damage. When you are ambushing, you add your physical attribute to your damage for the entire encounter until you go unconscious or lose morale.",mechanical:!1},{id:"shrewd",name:"Shrewd",requirements:["-Criminal Background","-Paranoid Flaw"],description:"When you are wanted after committing crimes, you automatically succeed with an Interpret roll once per moon face.",mechanical:!1},{id:"shrine-attendant",name:"Shrine Attendant",requirements:["+3 Spiritual","+100 Worship and Resist Supernatural","-Jiinin Race","-Woman","-Clergy Background"],description:"Must dedicate to only one Deity. You may use Resist Supernatural in place of Battle when defending or Will Dakar when targeted by spells for the purpose of counterspells.",mechanical:!1},{id:"soothing-spirit",name:"Soothing Spirit",requirements:["+2 Will or +2 Spiritual"],description:"You may use Perform or Divine Intervention in place of parley.",mechanical:!1},{id:"spell-jammer",name:"Spell Jammer",requirements:["+4 Physical or Mental","+120 Will Dakar","+80 Craft","-Merchant, Artisan, or Academic Background","-At least 1 Ildakar Faculty unlocked"],description:"You may create physical or mental attribute (whichever is highest) imbued gems per moonface without incurring endure checks.",mechanical:!1},{id:"spell-sculptor",name:"Spell Sculptor",requirements:["+100 Will Dakar and Feat of Agility","-At least 1 Ildakar Faculty Unlocked"],description:"You may shape the exact areas of your spells. Will attribute creatures (minimum 1) within the areas of your spells are exempt from its effects.",mechanical:!1},{id:"spell-slinger",name:"Spell Slinger",requirements:["+4 Physical or Mental","+120 Will Dakar","+80 Craft","-Merchant, Artisan, or Academic Background","-At least 1 Ildakar Faculty unlocked"],description:"You may create physical or mental attribute (whichever is highest) spell scrolls per moonface without incurring endure checks.",mechanical:!1},{id:"starseamstress",name:"Starseamstress",requirements:["+50 Incite Fate","+50 in one Sagacity skill","-Woman"],description:"You may use Sagacity skills in place of Divine Intervention, and without needing Deity Relationship to use Astrology and Secret Knowledge DI spells. Superior Immunity Requirements: resistance to poisons and necrosis, disease, etc +75 Endure +75 Resist Toxins May take an exhaustion penalty instead of contracting a disease or succumbing to a poison whenever you fail the check. In addition, you take half necrosis damage.",mechanical:!1},{id:"survivor",name:"Survivor",requirements:["+50 Endure"],description:"You only need half rations and supplies per moonface to survive without penalties. You may only take this ancillary once.",mechanical:!1},{id:"sword-saint",name:"Sword Saint",requirements:["+6 Physical and +6 Spiritual","-Triple the investment to unlock all MP abilities for medium blades and large blades","-Aligned"],description:"You are one of the Seven Sword Saints of the current Prophet. Swords in your hands deal siege damage and/or holy spiritual damage, as you desire.",mechanical:!1},{id:"time-keeper",name:"Time Keeper",requirements:["-Permanent singular dedication to Silvias","+5 Spiritual","+125 Academic Recall and Gather Intelligence"],description:"You become the Lord of a Time Keeper City. You may summon an epic hero giant bat that aids you. You automatically succeed on academic recall and gather intelligence rolls related to all historical topics or matters of what has transpired upon Adrun.",mechanical:!1},{id:"titangrip",name:"Titangrip",requirements:["+4 Physical","+80 Feat of Strength"],description:"You may dual-wield two-handed weapons.",mechanical:!1},{id:"tise",name:"Tise",requirements:["-Tise Sacrifice Ancillary"],description:"You may use 25 cost Ashi Divine Interventions without spending deity relationship points. Upon succeeding in your campaign spanning goal based on your inciting incident in your background, or your death, you become a Tise permanently. Current Tises will aid you if you are battling powerful enemies of Ashi or about to accomplish his goals.",mechanical:!1},{id:"tise-initiate",name:"Tise Initiate",requirements:["Permanent singular dedication to the Dark God Ashi."],description:"You may use 1 cost Ashi Divine Interventions without spending deity relationship points. You may summon a shadeling to serve you once per moonface during HarRheunen phase.",mechanical:!1},{id:"tise-loyalist",name:"Tise Loyalist",requirements:["-Tise Initiate Ancillary"],description:"You may use 3 cost Ashi Divine Interventions without spending deity relationship points. You may summon spiritual attribute shadelings to serve you once per moonface during HarRheunen phase.",mechanical:!1},{id:"tise-sacrifice",name:"Tise Sacrifice",requirements:["-Tise Loyalist Ancillary"],description:"You may use 7 cost Ashi Divine Interventions without spending deity relationship points. You may summon spiritual attribute wraiths to serve you once per moonface during HarRheunen phase.",mechanical:!1},{id:"touchy",name:"Touchy",requirements:["-Anz, Ganzenonin, Grazin, or Jiinin","-Aggressive Flaw"],description:"When you are critically hit, you are afflicted with the enraged status.",mechanical:!1},{id:"tower-ildakar",name:"Tower Ildakar",requirements:["-Ildakar Background","-Relevant Ildakar Faculty unlocked"],description:"Arkrow (Thermomancy): Thermomancy spells may be cast at one tier higher in one aspect per spell than you have physical/mental. Retovas (Electromancy): Electromancy spells may be cast at one tier higher in one aspect per spell than you have physical/mental. Muras (Vivomancy): Vivomancy spells may be cast at one tier higher in one aspect per spell than you have physical/mental. Parron (Transmutation): Transmutation spells may be cast at one tier higher in one aspect per spell than you have physical/mental. Derus (Artificy): Artificy spells may be cast at one tier higher in one aspect per spell than you have physical/mental. Tower of The Sun (Cosmomancy): Cosmomancy spells may be cast at one tier higher in one aspect per spell than you have physical/mental. The Twin Stars (Oscillomancy): Oscillomancy spells may be cast at one tier higher in one aspect per spell than you have physical/mental. You are now a member of one of the selected organizations. You may only take this ancillary once.",mechanical:!1},{id:"unwilling-to-die",name:"Unwilling to Die",requirements:["+50 Feat of Defiance","-Homeless background or Ganzenonin Ancillary"],description:"You do not die when you fail a Feat of Defiance check. You may use this feature twice per character tier, dying when you fail the third check.",mechanical:!1},{id:"veteran-footsoldier",name:"Veteran Footsoldier",requirements:["+50 Battle","-Warrior background"],description:"When adjacent to a bracing (martial prowess abilities) or defending ally, they may use your defense rolls with battle instead of their own.",mechanical:!1},{id:"vulture",name:"Vulture",requirements:["-bilge baron ancillary","+3 Spiritual"],description:"You are unable to be charmed or turned by aligned creatures. You may become invisible for spiritual attribute minutes per moon face.",mechanical:!1},{id:"warden",name:"Warden",requirements:["-Hunter or Wanderer background","+50 Track or Forage","-At least 1 Long Range Martial Prowess Ability unlocked"],description:"Your ranged attacks do not treat foliage as cover.",mechanical:!1},{id:"weapon-mastery-choose-weapon-category",name:"Weapon Mastery [Choose Weapon Category]",requirements:["-All base abilities in chosen Martial Prowess unlocked.","-Cannot be Armors, Shields, or Exotic"],description:"Choose a Martial Prowess. You may now use all unlocked abilities with this type of weapon, regardless of which Martial Prowess they fall under, so long as they are not under Armors or Shields. If applicable, the range of this Martial Prowess cannot become larger than +1. You may only take this ancillary once.",mechanical:!1},{id:"white-paladin",name:"White Paladin",requirements:["-Red Paladin Ancillary","+4 Physical","+150 Sense Supernatural and +150 Resist Supernatural"],description:"You are in command of The Paladin Order behind the Angelic Vessels of Rasadan and Zera. You may expend Deity Relationship points with Rasadan for all other Aligned Deities Divine Interventions. All weapons you touch deal holy spiritual damage for spiritual attribute minutes, and all armors you touch gain their appropriate damage reduction for unholy spiritual necrosis damage for spiritual attribute minutes.",mechanical:!1},{id:"advanced-martial",name:"Advanced Martial",requirements:["+3 Physical","+100 Battle","-Fledgling Martial Ancillary","-At least 6 Martial Prowess Abilities Unlocked"],description:"You gain +2 AP per round strictly for the purpose of moving or making attacks or reactions with martial prowess abilities.",mechanical:!0},{id:"advanced-psion",name:"Advanced Psion",requirements:["+2 Mental","-Fledgling Psion Ancillary","+80 Psionic Technique"],description:"Unlock Mental attribute 2 Point Techniques you have access to. These Techniques costs 1 Energy.",mechanical:!0},{id:"athletic",name:"Athletic",requirements:["+3 Physical","+50 Feat of Strength"],description:"-1 energy/per round costs if applicable to equipped shields and armors, minimum 0 energy per round, and you can ignore exhaustion the first time it is incurred, once per moonface",mechanical:!0},{id:"diviner-apprentice",name:"Diviner Apprentice",requirements:["-Clergy background","-Member of Thairin Church or Thairin Race","+1 Spiritual","+50 Worship and Divine Intervention"],description:"You choose a specific Deity to be permanently dedicated to. With this Deity, you gain a passive spiritual attribute amount of deity relationship points. Add your character tier to your deity relationship point caps.",mechanical:!0},{id:"energetic",name:"Energetic",requirements:["+3 Physical"],description:"You begin the game with +10% energy at character creation, and gain +10% every level-up. You may only take this ancillary once.",mechanical:!0},{id:"epic-martial",name:"Epic Martial",requirements:["+5 Physical","+200 Battle","-Heroic Martial Ancillary","-At least 12 Martial Prowess Abilities unlocked and 2 Martial Prowess categories with all Martial Prowess Abilities unlocked","-1 Martial Prowess category with more points invested than required to unlock all abilities"],description:"You gain +3 AP per round strictly for the purpose of moving or making attacks or reactions with martial prowess abilities. When you successfully hit with a martial prowess ability, it is automatically a wicked critical.",mechanical:!0},{id:"epic-psion",name:"Epic Psion",requirements:["+4 Mental","-Heroic Psion Ancillary","+150 Psionic Technique"],description:"Unlock Mental attribute 4 Point Techniques you have access to. These Techniques cost 1 Energy.",mechanical:!0},{id:"fledgling-martial",name:"Fledgling Martial",requirements:["+2 Physical","+50 Battle","-At least 3 Martial Prowess abilities unlocked"],description:"You gain +2 AP per round strictly for the purpose of making attacks or reactions with martial prowess abilities.",mechanical:!0},{id:"fledgling-psion",name:"Fledgling Psion",requirements:["+1 Mental","+50 Psionic Technique"],description:"Unlock Mental attribute number of 1 Point Techniques. +1 x Mental attribute Manifold Manifestation.",mechanical:!0},{id:"heroic-martial",name:"Heroic Martial",requirements:["+4 Physical","+150 Battle","-Advanced Martial Ancillary","-At least 9 Martial Prowess Abilities unlocked and all Martial Prowess abilities unlocked in one category"],description:"You gain +2 AP per round strictly for the purpose of moving or making attacks or reactions with martial prowess abilities.",mechanical:!0},{id:"heroic-psion",name:"Heroic Psion",requirements:["+3 Mental","-Advanced Psion Ancillary","+120 Psionic Technique"],description:"Unlock Mental attribute 3 Point Techniques you have access to. These Techniques costs 1 Energy.",mechanical:!0},{id:"ildakar-acolyte",name:"Ildakar Acolyte",requirements:["+50 Will Dakar"],description:"Unlocks Basic Ildakar Faculty. That Faculty costs you -20% energy and action points to use.",mechanical:!0},{id:"ildakar-archmage",name:"Ildakar Archmage",requirements:["-Ildakar Primus Ancillary","+250 Will Dakar","+6 Mental or Will"],description:"Choose one Faculty. When combining Faculties to cast a spell, this Faculty does not count towards the Compound aspect. If you take this Ancillary 6x, you are considered an Ildakar Order.",mechanical:!0},{id:"ildakar-primus",name:"Ildakar Primus",requirements:["-Ildakar Rector Ancillary","+200 Will Dakar"],description:"All Ildakar spell aspects are increased by 20%, regardless of Faculty.",mechanical:!0},{id:"ildakar-prodigy",name:"Ildakar Prodigy",requirements:["+3 Mental","+50 Study"],description:"Basic Ildakar Faculties cost 50% fewer points to unlock.",mechanical:!0},{id:"ildakar-rector",name:"Ildakar Rector",requirements:["-Ildakar Theurgist Ancillary","+150 Will Dakar"],description:"Choose one Faculty. The effects of each Aspect are increased by 50% when you use it.",mechanical:!0},{id:"ildakar-theurgist",name:"Ildakar Theurgist",requirements:["-Ildakar Understudy Ancillary","+120 Will Dakar"],description:"Choose one Advanced Faculty or two Basic Faculties. These now cost -20% energy and action points to use.",mechanical:!0},{id:"ildakar-understudy",name:"Ildakar Understudy",requirements:["-Ildakar Acolyte Ancillary","+80 Will Dakar"],description:"Unlocks Advanced Ildakar Faculty. That Faculty costs you -20% energy and action points to use.",mechanical:!0},{id:"legendary-martial",name:"Legendary Martial",requirements:["+6 Physical","+250 Battle","-Epic Martial Ancillary","-At least 15 Martial Prowess Abilities unlocked","-1 MP where you have double the points invested to unlock all MP abilities in the category."],description:"You gain +3 AP per round strictly for the purpose of moving or making attacks or reactions with martial prowess abilities. Whenever you successfully hit with a martial prowess ability, it is automatically a vicious critical.",mechanical:!0},{id:"legendary-psion",name:"Legendary Psion",requirements:["-Epic Psion Ancillary","+5 Mental","+200 Psionic Technique"],description:"Unlock Mental attribute 5 Point Techniques you have access to. These Techniques cost 1 Energy.",mechanical:!0},{id:"mythic-martial",name:"Mythic Martial",requirements:["-Legendary Martial Ancillary","-20 Martial Prowess Abilities unlocked, at least 2 Martial Prowess categories where you have double the points to unlock all abilities in the MP category."],description:"You gain +3 AP per round strictly for the purpose of moving or making attacks or reactions with martial prowess abilities. Whenever you successfully hit an opponent with a martial prowess ability, it is a brutal critical.",mechanical:!0},{id:"mythic-psion",name:"Mythic Psion",requirements:["+6 Mental","-Legendary Psion Ancillary","+250 Psionic Technique"],description:"Unlock Mental attribute 5 Point Techniques, gaining all of the prior techniques leading to them for free as well. These Techniques cost 1 Energy.",mechanical:!0},{id:"quickcaster",name:"Quickcaster",requirements:["+50 Will Dakar","+50 Feat of Agility"],description:"When you Will Dakar, your spells cost -20% Action Points.",mechanical:!0},{id:"well-of-dakar",name:"Well of Dakar",requirements:["+50 Will Dakar","+50 Endure"],description:"When you Will Dakar, your spells cost -20% Energy.",mechanical:!0},{id:"well-of-divinity",name:"Well of Divinity",requirements:["+4 Spiritual","+100 Worship","+100 Divine Intervention"],description:"Your Deity Relationship Point caps are increased by Spiritual attribute x3.",mechanical:!0}],oE={ancestryGroups:rE,ancillaries:iE},db=`Category,Energy Cost,Action Point Cost,Damage,Type,Range,MP,Two-Handed?,Ability Name,Ability Type,Description
Small Blades,1,1,3,Sharp,01,5,No,Slit,Active,1 Bleed at 0 range
Small Blades,1,1,3,Sharp,01,5,No,Bypass Armor,Active,Bypass all armor at 0 range
Small Blades,1,1,3,Sharp,01,5,No,Thrust,Passive,Move 1 with no AP or energy cost as part of attack
Small Blades,1,1,3,Sharp,01,5,No,Parry,Reaction,"+3 to Battle when defending, +6 while dual wielding"
Small Blades,1,1,3,Sharp,01,5,No,Drawcut,"Reaction, Once/Round","Enemy moves within range, attack with 50% damage"
Small Blades,1,1,3,Sharp,01,5,No,Counter,Reaction,Attack when battle roll is higher while defending
,,,,Sharp,,,,,,
Medium Blades,2,2,7,Sharp,1,8,No,Slash,Active,2 Bleed at 1 range
Medium Blades,2,2,7,Sharp,1,8,No,Pommel,Active,Use blunt damage instead of sharp damage
Medium Blades,2,2,7,Sharp,1,8,No,Thrust,Passive,Move 1 with no AP or energy cost as part of attack
Medium Blades,2,2,7,Sharp,1,8,No,Riposte,Reaction,Automatic hit at 50% damage when defense roll exceeds enemy attack
Medium Blades,2,2,7,Sharp,1,8,No,Drawcut,"Reaction, Once/Round","Enemy moves within range, attack with 50% damage"
Medium Blades,2,2,7,Sharp,1,8,No,Parry,Reaction,+7 to Battle when defending
,,,,Sharp,,,,,,
Large Blades,3,3,12,Sharp,12,10,Yes,Ward,"Stationary, Once/Round",All enemies entering range take 50% damage if they fail to beat your defense; does not work at 01 range
Large Blades,3,3,12,Sharp,12,10,Yes,Devastate,Reaction,Deal 100% more damage on critical hit
Large Blades,3,3,12,Sharp,12,10,Yes,Slash,Active,4 Bleed at 12 range
Large Blades,3,3,12,Sharp,12,10,Yes,Brace,Reaction,+12 defense when enemy moves or charges to attack you
Large Blades,3,3,12,Sharp,12,10,Yes,Departing Blow,Reaction,"Attack when enemy moves out of range, 50% damage"
Large Blades,3,3,12,Sharp,12,10,Yes,Shield,Reaction,+12 defense to adjacent ally when they are attacked
,,,,,,,,,,
Thrown,1,1,5,"Sharp, Blunt",1,5,No,Devastate,Reaction,Deal 100% more damage on critical hit
Thrown,1,1,5,"Sharp, Blunt",1,5,No,Wind-Up,"Active, Once/Round",Gain 3 free movement before attack
Thrown,1,1,5,"Sharp, Blunt",1,5,No,Pin,Reaction,Immobilize/pin target on critical hit
Thrown,1,1,5,"Sharp, Blunt",1,5,No,Kite,Reaction,Move 1 when foe enters range
Thrown,1,1,5,"Sharp, Blunt",1,5,No,Volley,Passive,May throw over walls and obstacles
Thrown,1,1,5,"Sharp, Blunt",1,5,No,Desperate Counter,Reaction,Melee counter 50% damage when opponent fails to overcome defense
,,,,,,,,,,
Small Bearded,1,1,3,Sharp,1,3,No,Sever,Reaction,Sever extremity and cause 50% more bleed damage on critical hit
Small Bearded,1,1,3,Sharp,1,3,No,Slash,Active,1 Bleed at 1 range
Small Bearded,1,1,3,Sharp,1,3,No,Disarm,"Active, Once/Round",Cause foe to drop weapon or item instead of dealing damage
Small Bearded,1,1,3,Sharp,1,3,No,Parry,Reaction,+3 to Battle when defending
Small Bearded,1,1,3,Sharp,1,3,No,Furious Counter,Reaction,Attack for 50% damage when critically hit
Small Bearded,1,1,3,Sharp,1,3,No,Split,Reaction,Critical hit gives foe Dazed status until next turn
,,,,Sharp,,,,,,
Large Bearded,3,3,12,Sharp,12,10,Yes,Sever,Reaction,"Sever limb, tail, or head on critical hit; double bleed damage"
Large Bearded,3,3,12,Sharp,12,10,Yes,Slash,Active,4 Bleed at 12 range
Large Bearded,3,3,12,Sharp,12,10,Yes,Cleave,Stationary,Strike multiple foes in range following an arc until blocked
Large Bearded,3,3,12,Sharp,12,10,Yes,Brace,Reaction,+12 defense when enemy moves or charges to attack
Large Bearded,3,3,12,Sharp,12,10,Yes,Departing Blow,Reaction,"Attack when enemy leaves range, 50% damage"
Large Bearded,3,3,12,Sharp,12,10,Yes,Sweep,Reaction,Knock foe prone if they fail to overcome your defense
,,,,,,,,,,
Polearms,3,3,15,Sharp,23,3,Yes,Hammer,Active,-1 armor durability if you overcome defense
Polearms,3,3,15,Sharp,23,3,Yes,Disarm,"Active, Once/Round",Cause foe to drop weapon or item instead of dealing damage
Polearms,3,3,15,Sharp,23,3,Yes,Stand Fast,"Stationary, Once/Round",Foes entering range take 50% damage if they fail defense roll
Polearms,3,3,15,Sharp,23,3,Yes,Pincer,Reaction,Immobilize charging foe at 3 range if you overcome defense
Polearms,3,3,15,Sharp,23,3,Yes,Hook,Reaction,Immobilize foe moving out of 23 range if you overcome defense
Polearms,3,3,15,Sharp,23,3,Yes,Sweep,Reaction,Knock enemy prone instead of dealing damage if you overcome defense
,,,,,,,,,,
Long Ranged,3,3,15,Sharp,130,10,Yes,Loose,Active,Sharp damage at 130 range
Long Ranged,3,3,15,Sharp,130,10,Yes,Pin,Reaction,Immobilize/pin on critical hit
Long Ranged,3,3,15,Sharp,130,10,Yes,Volley,Passive,May shoot over walls and obstacles (up to 300 ft)
Long Ranged,3,3,15,Sharp,130,10,Yes,Long-Shot,Active,May shoot up to 60 range for 50% damage
Long Ranged,3,3,15,Sharp,130,10,Yes,Patient Shot,"Reaction, Once/Round",Attack foe who breaks cover for 50% damage if you overcome defense
Long Ranged,3,3,15,Sharp,130,10,Yes,Countershot,"Reaction, Once/Round",Counter ranged attack with your own if enemy misses
,,,,,,,,,,
Small Blunt,2,2,7,Blunt,01,3,No,Hammer,Active,-1 armor durability if you overcome defense
Small Blunt,2,2,7,Blunt,01,3,No,Bludgeon,Reaction,Extra attack for 1 energy + AP after critical hit
Small Blunt,2,2,7,Blunt,01,3,No,Parry,Reaction,+7 to Battle when defending
Small Blunt,2,2,7,Blunt,01,3,No,Wind,Reaction,"When foe fails to overcome defense, apply Dazed instead of damage"
Small Blunt,2,2,7,Blunt,01,3,No,Disarm,Reaction,Cause foe to drop weapon/item if they fail to overcome defense
Small Blunt,2,2,7,Blunt,01,3,No,Counter,Reaction,Attack when battle roll is higher while defending
,,,,,,,,,,
Large Blunt,3,3,12,Blunt,12,7,Yes,Hammer,Active,-2 armor durability if you overcome defense
Large Blunt,3,3,12,Blunt,12,7,Yes,Blackout,Reaction,Critical hit may knock foe unconscious (Endure vs Battle roll)
Large Blunt,3,3,12,Blunt,12,7,Yes,Cripple,Reaction,Critical hit breaks bone or joint
Large Blunt,3,3,12,Blunt,12,7,Yes,Brace,Reaction,+12 defense when enemy moves or charges
Large Blunt,3,3,12,Blunt,12,7,Yes,Shield,Reaction,+12 defense to adjacent ally when they are attacked
Large Blunt,3,3,12,Blunt,12,7,Yes,Sunder,Reaction,"Break opponent weapon, shield, or armor on critical hit"
,,,,,,,,,,
Flexible,2,2,5,Sharp or Blunt,13,8,No,Flex,Passive,"Bypasses shields, can hit around corners or over walls"
Flexible,2,2,5,Sharp or Blunt,13,8,No,Sweep,Reaction,Knock foe prone instead of dealing damage if you overcome defense
Flexible,2,2,5,Sharp or Blunt,13,8,No,Bind,Reaction,Immobilize foe at 13 range instead of dealing damage
Flexible,2,2,5,Sharp or Blunt,13,8,No,Counter,Reaction,Attack when battle roll is higher while defending
Flexible,2,2,5,Sharp or Blunt,13,8,No,Crack,Reaction,-1 morale to enemy when they fail to overcome defense
Flexible,2,2,5,Sharp or Blunt,13,8,No,Disarm,Reaction,Disarm foe when they fail to overcome defense
,,,,,,,,,,
Unarmed,1,1,2,Blunt,01,3,No,Strike,Active,2 blunt at 01 range
Unarmed,1,1,2,Blunt,01,3,No,Choke,Active,+1 exhaustion at 0 range if throat accessible
Unarmed,1,1,2,Blunt,01,3,No,Daze,Reaction,Apply Dazed on critical hit
Unarmed,1,1,2,Blunt,01,3,No,Tear and Bite,Active,1 Bleed at 0 range
Unarmed,1,1,2,Blunt,01,3,No,Cripple,Reaction,Break bone or joint on critical hit
Unarmed,1,1,2,Blunt,01,3,No,Gouge,Reaction,Blind or deafen foe at 0 range when defense overcomes attack
Unarmed,1,1,2,Blunt,01,3,No,Sweep,Reaction,Knock enemy prone instead of dealing damage if defense succeeds
Unarmed,1,3,2,Blunt,01,3,No,Grapple,Active,Enter 0 range and initiate grapple
`,hb=`"Category","Energy Cost","Action Point Cost","Damage","Type","Range","MP","Ability Name","Ability Type","Description"
"Shield",1,1,2,"blunt","01",7,"Bash","Active","2 blunt at 01 range"
"Shield",1,1,2,"sharp","01",7,"Rim","Active","2 sharp + Bleed at 01 range"
"Shield",0,0,"","","",7,"Advancing Hold","Passive","+2 DR when moving"
"Shield",1,1,"","","",7,"Raise","Reaction","+2 DR when defending against a ranged attack or spell"
"Shield",1,1,"","","",7,"Brace","Reaction","+2 DR when foe moves or charges to attack you"
"Shield",0,0,"","","",7,"Conditioning","Passive","-1 energy cost/round"
"Soft Armor",1,1,"","","",3,"Evade","Reaction","-1 durability damage upon successful feat of agility in an area effect"
"Soft Armor",1,1,"","","",3,"Coverage","Reaction","Reduce bleed by 3"
"Soft Armor",0,0,"","","",3,"Conceal","Passive","+10 to conceal items while wearing"
"Soft Armor",1,1,"","","",3,"Drop","Stationary, Once/Round","Remove armor and drop"
"Soft Armor",1,1,"","","",3,"Field Repair","Stationary, Once/Round","+1 armor durability if damaged"
"Soft Armor",0,0,"","","",3,"Conditioning","Passive","-1 energy cost/round"
"Hard Armor",0,0,"","","",10,"Superior Unarmed","Passive","+2 unarmed blunt damage and +10 Battle when using Strike"
"Hard Armor",0,0,"","","",10,"Conditioning","Passive","-1 energy cost/round"
"Hard Armor",0,0,"","","",10,"Stealth","Passive","No conceal penalty while wearing"
"Hard Armor",0,1,"","","",10,"Armored Charge","Active","+Physical Mod damage when charging and attacking"
"Hard Armor",0,1,"","","",10,"Tank","Reaction","-50% damage from critical hit upon successful Endure, -1 armor durability"
"Hard Armor",0,1,"","","",10,"Coverage","Reaction","Reduce bleed by DR"
"Cloak",1,1,"","","",3,"Conceal","Active","+10 to conceal roll for small and medium items and weapons"
"Cloak",1,1,"","","",3,"Blind","Once/Round","Used to partially blind a foe as part of a melee attack, giving the foe -3 to the battle roll for defense "
"Cloak",1,1,"","","",3,"Feint","Once/Round","+3 for battle roll with an attack using a small or medium melee weapon"
"Cloak",0,0,"","","",3,"Slow Fall","Reaction","+3 to Feat of Defiance roll while falling"
"Cloak",1,1,"","","",3,"Resist Elements","Passive","+3 to endure against elemental damage and weather"
"Cloak",1,1,"","","",3,"Coverage","Reaction","Reduce bleed, burn, freeze wounds by [insert DR], in exchange for -1 durability"
`,Dl=e=>(e??"").trim(),is=e=>{const t=Dl(e);return!t||t===""?"":t},lE=e=>{const t=Dl(e);if(t)return/^y(es)?$/i.test(t)},Ml=(e,t)=>{const n=tb.parse(e,{header:!0,skipEmptyLines:!0});n.errors.length&&console.warn(`Errors while parsing ${t} CSV`,n.errors);const s=new Map,r=[];for(const i of n.data||[]){const o=Dl(i.Category),l=Dl(i["Ability Name"]);if(!o||!l)continue;const c=`${t}:${o}:${l}`,u=(s.get(c)??0)+1;s.set(c,u);const h={id:u===1?c:`${c}#${u}`,kind:t,category:o,name:l,mpCost:Number(i.MP)||0,energyCost:is(i["Energy Cost"]),actionPointCost:is(i["Action Point Cost"]),damage:is(i.Damage),damageType:is(i.Type),range:is(i.Range),abilityType:is(i["Ability Type"]),description:is(i.Description),twoHanded:lE(i["Two-Handed?"])};r.push(h)}return r.sort((i,o)=>i.category===o.category?i.name.localeCompare(o.name):i.category.localeCompare(o.category))},Ll=[{name:"Thermomancy",category:"Basic"},{name:"Electromancy",category:"Basic"},{name:"Vivomancy",category:"Basic"},{name:"Graviturgy",category:"Basic"},{name:"Pneumancy",category:"Basic"},{name:"Photomancy",category:"Basic"},{name:"Tribomancy",category:"Advanced"},{name:"Artificy",category:"Advanced"},{name:"Astromancy",category:"Advanced"},{name:"Transmutation",category:"Advanced"},{name:"Oscillomancy",category:"Advanced"},{name:"Telechronomancy",category:"Advanced"}],cE=e=>e.replace(/\r\n/g,`
`).replace("\uFEFF",""),uE=(e,t)=>{const n=cE(e),s=t.map(i=>{const o=new RegExp(i,"i").exec(n);return{name:i,index:o?o.index:-1}}).filter(i=>i.index>=0).sort((i,o)=>i.index-o.index),r=new Map;return s.forEach((i,o)=>{const l=i.index,c=o+1<s.length?s[o+1].index:n.length,u=n.slice(l,c).trim();r.set(i.name,u)}),r},dE=e=>{const t=[];let n=null;const s=/^TIER\s*(\d[^]*)$/i;return e.forEach(r=>{const i=r.trimEnd(),o=s.exec(i);if(o){n&&t.push({label:n.label,content:n.buffer.join(`
`).trim()}),n={label:`Tier ${o[1].trim()}`,buffer:[]};return}n&&n.buffer.push(i)}),n&&t.push({label:n.label,content:n.buffer.join(`
`).trim()}),t},hE=e=>{if(!e)return{tiers:[]};const t=e.split(`
`),[,...n]=t,s=[],r=[];let i=!1;n.forEach(c=>{!i&&/^TIER\s*\d/i.test(c)&&(i=!0),i?r.push(c):s.push(c)});const o=dE(r);return{intro:s.join(`
`).trim()||void 0,tiers:o,raw:e}},nm=e=>{const t=uE(e,Ll.map(n=>n.name));return Ll.map(n=>{const s=t.get(n.name),r=hE(s);return{name:n.name,category:n.category,sourceFound:!!s,intro:r.intro,tiers:r.tiers,rawSection:r.raw}})},am=`\uFEFF1. THERMOMANCY
Pyromancy (Heat)  Cryomancy (Cold)
Thermomancy manipulates thermal energy: introducing heat (Pyro) or removing it (Cryo).
Effects scale from mild warmth/frost to absolute temperature extremes at Tier 6.

TIER 1
Pyromancy  Primary Effect
Slightly warm small objects, dry damp items, or ignite loose tinder. Flames produced are weak and easily extinguished. Metals are warmed to the touch but not enough to deform.
Environmental Consequence (Cryomancy)
A faint chill radiates around the target area. Surfaces feel cool, condensation forms, and breath becomes faintly visible. Frost lightly dusts exposed materials but does not impede movement.
Statuses:
Primary: None or Burning (1 burn wound) on direct contact
Ring: None

TIER 2
Pyromancy  Primary Effect
Ignite wood, cloth, and leather; boil water; melt soft metals such as tin or lead. Flames spread across flammable surfaces and generate smoke that reduces visibility.
Environmental Consequence (Cryomancy)
The surrounding ring abruptly cools, forming thin ice films on stone and metal. Air becomes brittle and stinging, and wet surfaces freeze slick. Creatures entering the ring risk Freezing (1) or Slowed for a round.
Statuses:
Primary: Burning, Burn wounds
Ring: Freezing, Slowed

Cryomancy  Primary Effect
Freeze water solid, cause frostbite on exposed skin, stiffen ropes and fabrics, and make common metals brittle at points of stress.
Environmental Consequence (Pyromancy)
Warm air bleeds in from the boundary. Ice sublimates, puddles reappear, and exposed skin tingles with sudden warmth. Brief hot pockets can sting for Burn (1) if touched.
Statuses:
Primary: Freezing, Slowed, Prone (ice slip)
Ring: Minor Burning

TIER 3 
Pyromancy  Primary Effect
Melt common metals (iron, bronze), crack masonry, and generate bursts of flame large enough to engulf a room corner. Smoke becomes thick, and radiant heat can scorch creatures at a distance.
Environmental Consequence (Cryomancy)
A ring of intense cold expands outward: frost rapidly spreads along walls, ice crystals form mid-air and fall like glittering dust, and floor tiles gain slick patches. Creatures entering risk Freezing, Slowed, or Prone from footing failure.
Statuses:
Primary: Burning, Burn wounds, Blinded (smoke)
Ring: Freezing, Slowed, Prone

Cryomancy  Primary Effect
Rapidly freeze creatures or objects, creating brittle shatter points. Walls and floors glaze with ice thick enough to lock doors or jam mechanisms. Prolonged exposure drops core temperature sharply.
Environmental Consequence (Pyromancy)
Air around the cold zone warms sharply, causing steam bursts and dripping condensation. Surfaces become wet and hot to the touch, inflicting Burn (1) on bare skin. Temperature contrast may obscure vision briefly.
Statuses:
Primary: Freezing, Slowed, Unconscious (extreme cold)
Ring: Burning (1), Prone (slippery melt)

TIER 4
Pyromancy  Primary Effect
Liquefy stone or brick, vaporize wood, and destabilize load-bearing structures through thermal shock. Floors buckle from uneven expansion, and metal fixtures deform or droop.
Environmental Consequence (Cryomancy)
A thick freezing band forms instantly. Air temperature plummets, breath crystallizes, and surfaces are coated in hazardous layers of ice. Frostbite risk is immediate on exposed skin. Movement becomes dangerous, invoking Freezing, Slowed, or Prone.
Statuses:
Primary: Severe Burning, Burn wounds, Blinded (heat shimmer)
Ring: Freezing (Intensity), Slowed, Prone

Cryomancy  Primary Effect
Encases entire rooms in solid ice, freezes mechanisms until they fracture, and shatters stone or metal plating. Girders and supports may snap, causing partial collapses.
Environmental Consequence (Pyromancy)
Heat radiates outward, causing ice to crack explosively, spraying shards. Bystanders may receive light Burn (1) from contact with superheated steam. Surfaces shift abruptly from ice to slush.
Statuses:
Primary: Freezing, Unconscious, Slowed
Ring: Burning (1), Prone

TIER 5 
Pyromancy  Primary Effect
Firestorms engulf multiple structures; metals soften en masse; liquids boil explosively; vegetation combusts on contact. Buildings may collapse purely from heat distortion.
Environmental Consequence (Cryomancy)
A coldfront forms around the inferno. Snow-like ice crystals swirl violently, obscuring vision. Ground frost spreads rapidly. Creatures entering this band risk Freezing, Slowed, and Prone from frozen terrain.
Statuses:
Primary: Intense Burning, Blinded, Burn wounds
Ring: Freezing, Slowed, Prone

Cryomancy  Primary Effect
Flash-freezes entire streets or caverns, shattering terrain and immobilizing groups of creatures. Frozen structures collapse under their own brittleness.
Environmental Consequence (Pyromancy)
An expanding heat ring rapidly melts the periphery, creating sudden fog, slippery slush, and loud thermal cracks. Creatures entering take Burn (12) and must check for Prone.
Statuses:
Primary: Severe Freezing, Unconscious, Slowed
Ring: Burning, Prone

TIER 6
Pyromancy  Primary Effect
Generate plasma columns, vaporize matter, erase terrain features, melt entire sections of landscape, or ignite atmospheric layers. Survivors suffer total sensory distortion.
Environmental Consequence (Cryomancy)
A catastrophic cold rebalance occurs. An encircling wall of sub-zero wind erupts, flash-freezing vegetation and stone. Ice forms faster than gravity can pull water down. Anything entering suffers Freezing (max) or immediate Unconsciousness.
Statuses:
Primary: Fatal Burning, Unconscious
Ring: Severe Freezing

Cryomancy  Primary Effect
Drop temperatures to absolute stillness, freezing matter into crystalline dust or halting motion entirely. Forests, buildings, and rivers lock into immobility.
Environmental Consequence (Pyromancy)
Superheated expansion erupts outward as reality reclaims heat. The ring scorches terrain, melts ice in pulses, and blinds creatures with sudden glare. Burn (23) for all exposed creatures.
Statuses:
Primary: Fatal Freezing, Unconscious
Ring: Intense Burning

====================================
2. GRAVITURGY
Hypergravity (Weight/Compression)  Hypogravity (Lightness/Buoyancy)
Graviturgy manipulates local gravitational strength, altering mass, momentum, and vertical stability.

TIER 1
Hypergravity  Primary Effect
Increase the weight of handheld items; make footsteps heavier; cause dust to settle instantly. Sensations include joint stiffness and mild downward tugging.
Environmental Consequence (Hypogravity)
A peripheral lightness causes dust motes to drift upward and small objects to wobble. Footing feels subtly unstable but does not impose penalties.
Statuses:
Primary: None
Ring: None

Hypogravity  Primary Effect
Reduce weight slightly, allowing higher jumps and lighter steps. Items feel buoyant but remain controllable.
Environmental Consequence (Hypergravity)
A slight downward pull thickens the boundary: dropped objects hit the ground harder, and cloth hangs heavily.
Statuses:
Primary: None
Ring: None

TIER 2
Hypergravity  Primary Effect
Weigh down tools, weapons, and small creatures. Movements become sluggish; thrown items drop prematurely; weapon swings feel dragged.
Environmental Consequence (Hypogravity)
Beyond the heavy zone lies a band where footing becomes unreliable. Loose pebbles float slightly before falling. Creatures risk Prone when performing quick movements.
Statuses:
Primary: Crushing, Slowed
Ring: Prone

Hypogravity  Primary Effect
Lighten objects drastically; reduce traction on floors; allow small debris to float. Movement becomes bouncy and imprecise.
Environmental Consequence (Hypergravity)
The boundary zone pulls down sharply: creatures stepping across feel a sudden drop in weight, causing knee buckling or balance checks.
Statuses:
Primary: Prone, Hastened, Slowed
Ring: Prone

TIER 3 
Hypergravity  Primary Effect
Pin weaker creatures to the ground, crack wooden beams, bend metal rods, compress air into visible shimmer distortions.
Environmental Consequence (Hypogravity)
Adjacent areas become semi-weightless. Furniture floats slightly, liquids form globules, and creatures stepping in may drift sideways involuntarily. Risk of Prone from loss of traction.
Statuses:
Primary: Crushing, Blunt wounds, Dazed, Prone
Ring: Prone

Hypogravity  Primary Effect
Cause temporary hovering; detach unsecured items from surfaces; create slow-motion fall zones. Air thins perceptibly.
Environmental Consequence (Hypergravity)
A dense ring forms where gravity snaps back. Steps become leaden, and thrown weapons drop as if striking invisible walls.
Statuses:
Primary: Prone, Hastened, Suffocating (thin air)
Ring: Slowed

TIER 4
Hypergravity  Primary Effect
Crush furnishings into splinters; warp stone archways; collapse ceilings. Metal beams bend inward as if under immense load.
Environmental Consequence (Hypogravity)
Objects beyond the collapse zone float unpredictablytables drift, lamps swing upward, and small stones hover. Characters risk Prone when objects suddenly lose weight around them.
Statuses:
Primary: Severe Crushing, Unconscious
Ring: Prone

Hypogravity  Primary Effect
Remove structural weight; cause entire rooms to float or tilt; dislodge anchored machinery. Liquids form airborne sheets.
Environmental Consequence (Hypergravity)
A ring of enhanced gravity drags debris back down, causing cascading falls and sudden impacts.
Statuses:
Primary: Prone, Suffocating, Slowed
Ring: Crushing (minor)

TIER 5 
Hypergravity  Primary Effect
Crush vehicles, pancake walls, and buckle streets. Objects implode under pressure; creatures are forced prone by sheer weight.
Environmental Consequence (Hypogravity)
A chaotic drift field forms around the heavy zone. Debris floats, rotates, and occasionally rockets outward as gravity fluctuates.
Statuses:
Primary: Crushing, Blunt wounds, Unconscious
Ring: Prone, Dazed

Hypogravity  Primary Effect
Zero-gravity fields emerge. Debris storms swirl; creatures flail while trying to gain control. Entire sections of terrain detach or lift.
Environmental Consequence (Hypergravity)
A sharp gravity boundary slams loose debris downward, producing showers of falling objects.
Statuses:
Primary: Prone, Dazed, Suffocating
Ring: Blunt wounds (falling debris)

TIER 6
Hypergravity  Primary Effect
Collapse hills, crush forests, buckle earth layers. Gravity wells form, dragging matter inward and pulverizing structures.
Environmental Consequence (Hypogravity)
A surrounding region becomes wildly buoyant: trees suspend roots-first in the air, rivers bead into floating water spheres, and boulders drift.
Statuses:
Primary: Fatal Crushing
Ring: Prone, Dazed

Hypogravity  Primary Effect
Cause landscapes to lift, break apart, or drift skyward. Entire ecosystems float, creating vacuum pockets and unstable drift regions.
Environmental Consequence (Hypergravity)
Reasserted gravity slams objects downward at random intervals, producing quakes and falling terrain.
Statuses:
Primary: Unconscious, Suffocating
Ring: Crushing (minormoderate)

====================================
3. ELECTROMANCY
Association (Binding/Charge)  Disassociation (Dissolution/Acid)
Electromancy controls cohesion, charge, nervous stimulation, and corrosive breakdown.

TIER 1
Association  Primary Effect
Generate static sparks, cause hair to rise, make metallic items cling together lightly. Nerves tingle when touched.
Environmental Consequence (Disassociation)
Metal tarnishes slightly at the edges of the zone. Fine dust weakly repels itself, giving the air a gritty feel.
Statuses:
Primary: None
Ring: None

Disassociation  Primary Effect
Metal dulls; cloth threads weaken; leather cracks subtly. Early signs of chemical decay appear.
Environmental Consequence (Association)
Loose metal dust or shavings cluster together magnetically, forming harmless grainy beads.
Statuses:
Primary: None
Ring: None

TIER 2
Association  Primary Effect
Magnetize weapons or tools, lightly stimulate muscles, or create short electrical jolts. Movements feel sharper and more reactive.
Environmental Consequence (Disassociation)
Metal surfaces in the ring develop small pitted spots. Paper or cloth near the boundary shows faint signs of wear.
Statuses:
Primary: Enraged (overstimulation), Stupification (1)
Ring: Minor Laceration (abrasive corrosion)

Disassociation  Primary Effect
Corrode metal fittings; weaken leather straps; begin dissolving protective gear. Acidic fumes irritate eyes and skin.
Environmental Consequence (Association)
Metal scraps in the ring clump together; small screws or nails slide subtly toward one another.
Statuses:
Primary: Laceration (1), Rotting (1)
Ring: Stupification (1) from static discharge

TIER 3 
Association  Primary Effect
Shock creatures; overload sensory organs; pull metallic debris into clusters. Sparks chain across multiple objects.
Environmental Consequence (Disassociation)
The boundary emits a corrosive haze: metal jewelry may pit, wooden tools soften, and exposed skin may sting, causing Laceration (1).
Statuses:
Primary: Burn wounds, Stupification, Enraged
Ring: Laceration (1), Rotting (1)

Disassociation  Primary Effect
Dissolve armor plating; erode walls; create clouds of acidic vapor. Machinery breaks apart as moving parts degrade.
Environmental Consequence (Association)
Electrical arcs briefly jump between metal objects in the ring. Static pulses can sting for Burn (1) and attract loose metal toward surfaces.
Statuses:
Primary: Laceration, Rotting, Necrosis wounds
Ring: Burn (1)

TIER 4
Association  Primary Effect
Emit strong magnetic pulses capable of welding metals, fusing doors shut, or causing massive neural overstimulation. Sparks bounce across entire rooms.
Environmental Consequence (Disassociation)
Objects at the boundary weaken, flaking into rust or powder. Hinges squeal as corrosion initiates.
Statuses:
Primary: Stupification, Burn, Dazed
Ring: Laceration (minor), Rotting

Disassociation  Primary Effect
Flood structures with corrosive force: dissolve beams, consume machinery, and generate toxic acidic mist.
Environmental Consequence (Association)
Metal fragments leap together, forming temporary clusters; thrown metal weapons may pull unexpectedly off course.
Statuses:
Primary: Severe Laceration, Rotting, Unconscious (fumes)
Ring: Burn (1) from magnetic discharge

TIER 5 
Association  Primary Effect
Create lightning webs, electrify terrain, or stimulate entire crowds into spasms. Metal objects heat and fuse.
Environmental Consequence (Disassociation)
Edges of the zone crumble as intense corrosion spreads outward. Painted surfaces bubble and chip away.
Statuses:
Primary: Burn, Stupification, Enraged, Unconscious
Ring: Laceration (12), Rotting

Disassociation  Primary Effect
Produce acidic downpours, dissolve infrastructure, or generate ruststorms that eat through armor and buildings.
Environmental Consequence (Association)
Static charge builds in the periphery. Loose metal components snap together, forming hazardous clumps that impede movement.
Statuses:
Primary: Necrosis, Laceration, Rotting, Unconscious
Ring: Burn (1), Stupification (1)

TIER 6
Association  Primary Effect
Fuse city blocks into welded masses, override nervous systems, and generate continent-spanning electromagnetic storms. Metal flows like liquid and reforms.
Environmental Consequence (Disassociation)
A belt of mass corrosion spreads: metal fences turn to dust, stone darkens and weakens, and vegetation decays chemically.
Statuses:
Primary: Severe Stupification, Enraged, Unconscious
Ring: Laceration (2), Rotting (2)

Disassociation  Primary Effect
Dissolve terrain into corrosive sludge, erase manufactured structures, and convert landscapes into wastelands.
Environmental Consequence (Association)
Giant magnetic fields form transiently, pulling debris into massive floating clumps before collapsing them.
Statuses:
Primary: Fatal Laceration, Rotting, Necrosis
Ring: Burn (12)

====================================
4. PHOTOMANCY
Illumination (Light/Visibility/Illusions)  Attenuation (Dimming/Shadow/Darkness)
Photomancy manipulates light as both energy and perception.
Illumination creates, sharpens, shapes, or bends light into illusions.
Attenuation removes, distorts, or collapses light into shadow or darkness.
Attenuation gains magical darkness at Tier 3 and scales into full sensory suppression.

TIER 1
Illumination  Primary Effect
Brighten dark areas, create simple static illusions (glimmers, small holographic shapes, sparks), enhance reflections, or sharpen visual contrast. Illusions are flat and lack depth but can attract attention.
Environmental Consequence (Attenuation)
Shadows soften slightly and colors appear muted in the ring. Edges lose crispness but remain perceivable.
Statuses:
Primary: None
Ring: None

Attenuation  Primary Effect
Dim lights, slightly blur shapes, soften outlines, or reduce visibility gradients. Limited illusions of vague shadow-movement (non-deceptive) can be created.
Environmental Consequence (Illumination)
Dimness is countered by a faint bright halo around the zone; reflective surfaces twinkle lightly.
Statuses:
Primary: None
Ring: None

TIER 2
Illumination  Primary Effect
Produce focused beams, radiant flares, or visual illusions the size of a small creature or object. These illusions can be colored, textured, and animated, but lack solidity and sound.
Examples: false item appearances, glowing runes, decoy shapes.
Environmental Consequence (Attenuation)
Perimeter shadows deepen noticeably. Visual contrast distorts slightly, causing creatures entering the ring to misread distance briefly.
Statuses:
Primary: Blinded (flash), Revealed
Ring: Stupification (momentary visual confusion)

Attenuation  Primary Effect
Blur object boundaries, obscure identification, and project minor shadow illusions (false silhouettes, shifting outlines). Real objects appear dull and semitransparent.
Environmental Consequence (Illumination)
Peripheral reflections spike. Small light flecks appear around the border, distracting the eye and occasionally imposing Blinded (1).
Statuses:
Primary: Concealed, Slowed (misjudged footing)
Ring: Blinded (minor)

TIER 3 
Illumination gains TRUE ILLUSION at this tier.
Illusions can now appear three-dimensional, animated, and convincing within a room.
Illumination  Primary Effect
Flood a room with clear light or create realistic visual illusions up to creature-scale: phantoms, false doors, misleading terrain, or light-constructed decoys. These illusions can move, react vaguely, and mimic distant sound (visually implied but not auditory).
Can also erase mundane shadows entirely.
Environmental Consequence (Attenuation)
A band of deepening shadow forms. Ambient light behaves erraticallystretching or thickeningcreating pockets where creatures can hide or lose track of terrain.
Statuses:
Primary: Blinded, Revealed
Ring: Concealed, Prone (visual misinterpretation)

Attenuation  Primary Effect
Create magical darkness that entirely negates normal light. Illusions formed inside appear only as faint distortions. Creatures may lose depth perception or orientation.
Shadows can form semi-illusory shapes that confuse movement.
Environmental Consequence (Illumination)
A bright ring contracts around the darkness, producing glare and visual overload. Adjusting vision induces Blinded (12) or forced perception checks.
Statuses:
Primary: Blinded, Deafened (sensory collapse), Stupification
Ring: Blinded

TIER 4
Illumination  Primary Effect
Illuminate entire structures or create multi-room illusions with coherent movement: armies marching, collapsing walls, phantom fires, visual mazes. Illusions may mimic light-based solidity (e.g., hard-light panels) though they still lack physical force.
Perfect for deception, misdirection, or large-scale hazard illusions.
Environmental Consequence (Attenuation)
Shadows outside the illuminated zone grow unnaturally long. Depth perception distorts: hallways seem stretched; corners appear closer or farther than they are. Creatures may stumble or misread cover.
Statuses:
Primary: Blinded, Revealed
Ring: Stupification, Prone

Attenuation  Primary Effect
Swallow entire structures in advanced magical darkness. Even magical light sources struggle. Illusions formed inside appear as faint silhouettes or are consumed entirely. Sensory input becomes unreliable.
Environmental Consequence (Illumination)
Cracks of bright light rupture along walls or objects around the darkness. Dust glitters, surfaces glow, and sudden flashes can impose Blinded (2) on entry.
Statuses:
Primary: Blinded, Concealed, Deafened, Stupification
Ring: Blinded

TIER 5 
Illumination  Primary Effect
Simulate daylight across a district or cavern system; negate magical darkness; create mass illusions such as armies, monsters, environmental transformations, or entirely false landscapes.
Can expose invisible creatures by harsh silhouette lighting.
Environmental Consequence (Attenuation)
A vast dimming ring forms: mist-like shadow, inconsistent visibility, elongated silhouettes, misleading terrain cues. Creatures may intermittently gain or lose concealment.
Statuses:
Primary: Blinded, Revealed
Ring: Concealed, Stupification

Attenuation  Primary Effect
Engulf whole sectors in expansive magical darkness. Navigation becomes guesswork; illusions become unreliable or warped into horror-like shadow imitations.
Can create shifting void-shapes that mimic creatures or terrain.
Environmental Consequence (Illumination)
The boundary emits pulsating glare. Surfaces reflect wildly, creating sudden light spikes. Intense brightness disorients and blinds.
Statuses:
Primary: Blinded, Unconscious (sensory overload), Stupification
Ring: Blinded (severe)

TIER 6
Illumination  Primary Effect
Create light visible for miles; forge illusory landscapes or cities; reveal hidden cosmic structures; banish all darkness across entire regions.
Illusions at this tier can mimic entire armies, environments, or weather phenomena, though still lacking physical force.
Environmental Consequence (Attenuation)
Shadows at the border grow dense enough to resemble fog. Terrain within the ring becomes illusory or misleading: cliffs appear level, openings seem blocked, silhouettes multiply.
Statuses:
Primary: Blinded (intense), Revealed
Ring: Stupification, Prone

Attenuation  Primary Effect
Erase all natural and magical light in a region. Vision is impossibly black. Living creatures lose spatial awareness entirely. Even illusions dissolve into shapeless void.
Environmental Consequence (Illumination)
A radiant, burning glare erupts around the boundaryso bright that creatures cannot look toward it. Terrain edges glow white-hot visually, though not thermally.
Statuses:
Primary: Total Blinded, Unconscious, Stupification
Ring: Severe Blinded, Prone


====================================
5. VIVOMANCY
Curation (Life/Repair)  Necrosis (Decay/Entropy)
Vivomancy governs biological reinforcement or biological collapse.
Curation restores; Necrosis corrupts.
Both Faculties interact strongly with Wounds and Status removal/application.

TIER 1
Curation  Primary Effect
Soothe pain, close minor cuts, reduce bruising, or stabilize a creature. Stops bleeding and slows Laceration.
Environmental Consequence (Necrosis)
A faint smell of rot, slight plant wilting, or browning of nearby leaves occurs. Harmless but unsettling.
Statuses:
Primary: Remove minor Laceration, Stupification
Ring: Rotting (minor aesthetic only)

Necrosis  Primary Effect
Slightly discolor skin, spoil food, wilt plants, or cause minor necrotic blemishes.
Environmental Consequence (Curation)
Nearby vegetation straightens, wounds scab quickly, and ambient life force subtly pushes back decay.
Statuses:
Primary: Rotting (1), Necrosis (1)
Ring: Minor healing (no wounds removed)

TIER 2  Object / Body Scale
Curation  Primary Effect
Heal shallow wounds; remove low-tier status effects; neutralize poisons; mend simple fractures. Skin knits rapidly, and energy stabilizes.
Environmental Consequence (Necrosis)
Dust dries out; weak plants shrivel; insects die. Damp environments develop mold patches.
Statuses:
Primary: Remove Laceration, Remove Burn, Remove Freezing
Ring: Rotting (1)

Necrosis  Primary Effect
Inflict rot on flesh; cause organic decay; damage organs; spoil water. Minor internal deterioration begins.
Environmental Consequence (Curation)
Plants sprout rapidly in response, moss grows over surfaces, and weak regenerative pulses push outward.
Statuses:
Primary: Rotting, Necrosis wounds, Slowed
Ring: Remove minor decay

TIER 3 
Curation  Primary Effect
Regenerate tissue, close deep wounds, purge diseases, restore breathing, repair organ damage. Can remove nearly any negative status short of death.
Environmental Consequence (Necrosis)
A ring of corruption forms: wood warps, fungus spreads, and biological odors sour. Creatures entering suffer Rotting (1) or feel vitality drain.
Statuses:
Primary: Remove most statuses, Heal wounds
Ring: Rotting, Slowed

Necrosis  Primary Effect
Cause muscle deterioration, organ failure, severe infection, and structural collapse of living tissue. Creatures may collapse mid-action.
Environmental Consequence (Curation)
Surrounding area erupts with counteractive growthgrass thickens, wounds knit slightly, insects swarm back to life.
Statuses:
Primary: Rotting, Necrosis wounds, Unconscious
Ring: Heal (1), Remove Slowed

TIER 4
Curation  Primary Effect
Rebuild limbs, repair catastrophic injuries, regrow destroyed organs, reverse poisoning, and revitalize dying creatures.
Environmental Consequence (Necrosis)
Decay pulses outward: wooden beams sprout fungus, stored food spoils instantly, and even stone darkens with mold-veins.
Statuses:
Primary: Remove all negative statuses except death
Ring: Rotting (2), Necrosis (1)

Necrosis  Primary Effect
Collapse biological structures entirely; liquefy organic matter; spread plague-like effects across rooms; kill swarms instantly.
Environmental Consequence (Curation)
Struggling life erupts outward in resistance: glowing veins of regenerative magic, mushroom blooms, and bursts of cellular repair.
Statuses:
Primary: Severe Rotting, Necrosis, Unconscious
Ring: Healing burst (minor), Remove 1 condition

TIER 5 
Curation  Primary Effect
Revitalize forests; repair whole groups of creatures; reanimate fading ecosystems; eliminate plagues.
Environmental Consequence (Necrosis)
A death-line forms around the revitalized zone: dead plants crumble to dust, wildlife avoids the periphery, and spores fill the boundary.
Statuses:
Primary: Heal, Remove statuses in bulk
Ring: Rotting (2), Necrosis (1)

Necrosis  Primary Effect
Destroy ecosystems; reduce forests to mulch; dissolve bodies; plague entire settlements. Water becomes foul.
Environmental Consequence (Curation)
A ring of violent overgrowth formsvines erupt, insects multiply, regenerative blooms blanket the perimeter.
Statuses:
Primary: Severe Rotting, Necrosis, Unconscious
Ring: Remove minor conditions, Healing (weak)

TIER 6
Curation  Primary Effect
Restore entire regions to vitality: heal populations, bring back extinct vegetation, reverse corruption, or rejuvenate barren wastelands.
Environmental Consequence (Necrosis)
A death-blight ring expands outward: soil desiccates, wildlife flees, and anything living in the band slowly decays.
Statuses:
Primary: Massive healing, Remove all statuses
Ring: Rotting (severe), Necrosis wounds

Necrosis  Primary Effect
Strip life from entire zones; kill forests, wildlife, and populations; turn regions into deadlands. Bodies decay into powder.
Environmental Consequence (Curation)
A radiant ring of rebirth bursts outward, sprouting wild growth, resurrecting spores, and stitching minor wounds on creatures entering.
Statuses:
Primary: Fatal Necrosis, Rotting
Ring: Minor healing, Remove small conditions

====================================
6. PNEUMANCY
Pressure (Compression/Force)  Vacuum (Absence/Suction)
Pneumancy governs atmospheric force: crushing pressure, implosive vacuum, suffocation, and explosive air movement.

TIER 1
Pressure  Primary Effect
Increase air density; pop small objects; push lightly against creatures; create firm gusts.
Environmental Consequence (Vacuum)
A soft suction pulls dust inward; paper flutters; ears pop gently.
Statuses:
Primary: None
Ring: None

Vacuum  Primary Effect
Thin air slightly; draw light objects inward; cause candles to flicker out.
Environmental Consequence (Pressure)
Air compresses subtly at the ring, pushing outwardloose fabrics ripple.
Statuses:
Primary: None
Ring: None

TIER 2
Pressure  Primary Effect
Crush small objects, shatter glass, shove creatures forcefully, and deform soft materials. Lung compression begins.
Environmental Consequence (Vacuum)
Air thins sharply; light debris sucks inward; creatures risk coughs and mild Suffocating for a round.
Statuses:
Primary: Crushing, Blunt wounds
Ring: Suffocating (minor)

Vacuum  Primary Effect
Extract air from containers; extinguish flames; cause small implosions. Suffocation begins rapidly.
Environmental Consequence (Pressure)
External air compresses violently, forcing small objects outward.
Statuses:
Primary: Suffocating, Laceration (minor)
Ring: Crushing (minor)

TIER 3 
Pressure  Primary Effect
Compress entire rooms; slam creatures into floors or walls; ruptured eardrums; reduced oxygen intake; loud thunderclap-like pressure changes.
Environmental Consequence (Vacuum)
A suction ring pulls debris inward. Torches die instantly; creatures entering must test against Suffocating and may experience Prone from directional pull.
Statuses:
Primary: Crushing, Deafened, Dazed, Blunt wounds
Ring: Suffocating, Prone

Vacuum  Primary Effect
Create localized voids; implode furniture; rupture containers; choke creatures by removing breathable air.
Environmental Consequence (Pressure)
A pressure rebound at the perimeter produces gusts that knock creatures sideways, potentially inflicting Prone or Blunt wounds.
Statuses:
Primary: Suffocating, Laceration (skin tears), Unconscious
Ring: Crushing (minor), Prone

TIER 4
Pressure  Primary Effect
Crush structural supports; implode tunnels; slam doors inward; generate airshock waves capable of injuring multiple creatures.
Environmental Consequence (Vacuum)
Air is violently sucked from the surrounding ring, dragging gravel, dust, and small objects toward the epicenter. Creature breathing becomes difficult.
Statuses:
Primary: Severe Crushing, Deafened, Unconscious
Ring: Suffocating, Laceration (dust abrasion)

Vacuum  Primary Effect
Remove air from entire structures; cause explosive decompression; collapse walls inward; extinguish all fire.
Environmental Consequence (Pressure)
A ring of hyper-pressurized air rebounds outward, throwing debris and disorienting creatures.
Statuses:
Primary: Severe Suffocating, Unconscious, Laceration
Ring: Dazed, Prone

TIER 5 
Pressure  Primary Effect
Flatten buildings; create crushing atmospheric implosions; weaponize shockwaves that rip apart terrain.
Environmental Consequence (Vacuum)
Surrounding winds pull inward violently, dragging objects and creatures toward the zones edge. Oxygen evaporates rapidly.
Statuses:
Primary: Crushing, Blunt wounds, Unconscious
Ring: Suffocating, Prone

Vacuum  Primary Effect
Create large-scale void zones; strip air from forests or districts; implode structures; suffocate entire groups.
Environmental Consequence (Pressure)
A massive pressure rebound hurls debris outward in a ring, creating devastating shrapnel-like effects.
Statuses:
Primary: Fatal Suffocating, Laceration, Unconscious
Ring: Crushing (moderate), Dazed

TIER 6
Pressure  Primary Effect
Collapse mountainsides; generate atmospheric pillars capable of pulverizing landscapes; rip apart fortresses.
Environmental Consequence (Vacuum)
Entire regions experience sudden partial vacuum, drawing storms, dust, and airborne debris inward violently.
Statuses:
Primary: Fatal Crushing
Ring: Suffocating, Unconscious

Vacuum  Primary Effect
Strip oxygen from valleys; implode ecosystems; create black voids that crush or tear matter from all directions.
Environmental Consequence (Pressure)
Cyclonic pressure blasts expand outward, scouring terrain with hurricane-force shockwaves.
Statuses:
Primary: Fatal Suffocating, Laceration
Ring: Crushing, Dazed
====================================
7. TRANSMUTATION 
Synthesis (Binding/Creation/Reinforcement)  Decompose (Unmaking/Separation/Breakdown)
Transmutation reshapes matter by adding order (Synthesis) or removing order (Decompose).
Matter is borrowed from the environment during Synthesis and expelled into it during Decomposition.
This faculty has some of the strongest environmental consequences in the system.

TIER 1
Synthesis  Primary Effect
Bind loose, simple materials (dust  clump, sand  crumbly lump).
Lightly mend a hairline crack in stone or wood.
Create a tiny amount of a simple, homogenous material (mud, soft clay, paste) using nearby ambient matter.
Environmental Consequence (Decompose)
Local materials lose small flecks of their mass:
     Stone surfaces pit
     Bark becomes brittle
     Soil thins slightly
This depletion is visible but not dangerous.
Statuses:
Primary  None
Ring  None

Decompose  Primary Effect
Separate simple mixtures (sand from water, dust from air).
Undo weak bonds in fresh mortar or crude glue.
Environmental Consequence (Synthesis)
The separated grains or droplets spray outward lightly, coating nearby objects in a thin, homogenous layer of dust, sand, or droplets.
Statuses:
Primary  None
Ring  None

TIER 2
Synthesis  Primary Effect
Combine raw materials into simple compounds (weak mortar, rough paper).
Mend moderate cracks or small holes in wood, stone, or cloth.
Fuse small components into a single crude piece.
Environmental Consequence (Decompose)
Nearby objects show visible wear:
     Wood becomes porous and light
     Stone loses flakes
     Metal dulls
Small objects may become fragile if already old or degraded.
Statuses:
Primary  Remove Laceration (minor), Remove Burn
Ring  Laceration (minor, splintering dust)

Decompose  Primary Effect
Break down simple processed materials into raw components (brick  clay + sand).
Separate simple bonded materials (refining raw iron ore into metal + slag).
Environmental Consequence (Synthesis)
The separated slurry or particulate bursts outward with some force:
     Slurry splashes across the floor
     Dust clouds fill small areas
     Debris coats nearby surfaces thickly
Statuses:
Primary  Laceration (small cuts from particulates), Rotting (vs organics)
Ring  Stupification (brief choking dust)

TIER 3 
Synthesis  Primary Effect
Create simple alloys (bronze from copper + tin).
Produce basic processed materials (bricks, planks) from raw matter.
Generate simple organic material (leather patch, block of wood) from appropriate biomass.
Repair shattered or heavily damaged objects.
Environmental Consequence (Decompose)
Non-target materials thin, crack, or lose structural strength as their mass is cannibalized:
     Stone walls become porous
     Furniture warps or splits
     Beams creak under reduced mass
Statuses:
Primary  Remove some Wounds (Laceration/Burn), repair gear
Ring  Rotting (1), Laceration (1)

Decompose  Primary Effect
Deconstruct simple alloys (bronze  copper/tin dust).
Refine moderate yield ores quickly.
Break down organic materials into component biomass (cellulose, lignin, water).
Significant structural weakening occurs.
Environmental Consequence (Synthesis)
Expelled components fill the chamber:
     Metallic dust clouds
     Choking organic particles
     Sharp particulate that embeds into surfaces
Nearby objects become coated in unstable composite layers.
Statuses:
Primary  Laceration, Rotting, Necrosis (vs creatures)
Ring  Blinded (dust), Stupification (choking fumes)

TIER 4
Synthesis  Primary Effect
Create complex refined materials (crude steel, workable glass).
Shape raw materials into functional tools (rough blades, lenses).
Repair major structural failures (collapsed beams, large wall gaps).
Begin limited form-sculpting of matter (simple weapons, containers, architectural components).
Environmental Consequence (Decompose)
Significant leeching occurs:
     Boulders collapse into aerated shells
     Wood becomes sponge-like
     Metal beams lose bulk
     Floors settle as mass drains into the working spell
Statuses:
Primary  Remove severe structural penalties
Ring  Rotting (2), Laceration (2)

Decompose  Primary Effect
Break down complex alloys (steel  iron + carbon).
Reduce stone into its constituent mineral dusts.
Refine magical ores by separating charged essence from inert matter.
Unweave a simple enchantment by separating its magical field from the objects structure.
Environmental Consequence (Synthesis)
Violent discharge of components:
     Scalding vapors
     Carbon dust clouds
     Toxic or flammable gases
     Objects in the ring are plated with expelled material that rapidly hardens
Statuses:
Primary  Severe Laceration, Necrosis (vs living tissue), Dazed
Ring  Burning (vapors), Suffocating (dust/gas)

TIER 5 
Synthesis  Primary Effect
Create high-grade alloys, strong ceramics, or engineered materials.
Shape mechanically complex objects (simple locks, mechanical hinges).
Synthesize complex alchemical or organic materials (resins, compounds, growth mediums).
Rebuild sections of structures or reshape terrain masses.
Environmental Consequence (Decompose)
Massive extraction from the environment:
     Soil becomes sterile dust
     Nearby structures lose bulk and become unstable
     Large areas of ground collapse slightly
     Vegetation loses moisture and integrity
Statuses:
Primary  Remove most Wounds, fully repair gear
Ring  Laceration (23), Rotting (2)

Decompose  Primary Effect
Break down any common material into base elements.
Reduce magical or alchemical substances into primal components.
Expel these at extreme temperature and pressure.
Environmental Consequence (Synthesis)
High-pressure elemental expulsion:
     Toxic clouds
     Flammable gas pockets
     Plasma flashes from ionized elements
     Molten droplets rain across the perimeter
Statuses:
Primary  Necrosis, Laceration (severe), Burning
Ring  Blinded (thermal flash), Suffocating (toxic atmosphere)

TIER 6
Synthesis  Primary Effect
Truly transmute equivalent-mass materials (lead  gold).
Assemble intricate, functional objects from dissimilar materials (working clock from scrap).
Create simple living organisms (slime-like constructs) from raw mass.
Enact global-scale shaping of matter within a domain.
Environmental Consequence (Decompose)
Catastrophic leeching:
     Ground hollows
     Buildings collapse into weightless husks
     Forests crumble into dry shells
     Entire volumes of matter are drawn inward to fuel creation
Statuses:
Primary  Remove all structural damage
Ring  Severe Rotting, Necrosis, Prone (terrain collapse)

Decompose  Primary Effect
Total conceptual decomposition:
     Separate objects into pure matter (slurry) and pure informational/form energy
     Remove life-energy from bodies (non-Necrosis flavor, conceptual unbinding)
     Reduce structures into raw matter + conceptless potential
Environmental Consequence (Synthesis)
Catastrophic release of raw matter and proto-concepts:
     Surroundings warp into unstable hybrids (clay-glass-wood walls)
     Stone becomes fibrous
     Soil becomes metallic
     Objects fuse into bizarre composites
Statuses:
Primary  Fatal Necrosis/Laceration, Stupification
Ring  Crushing, Burning (slurry splash), Prone
====================================
8. TELECHRONOMANCY
Space (Position/Geometry/Direction)  Time (Acceleration/Delay/Duration)
Telechronomancy manipulates how space is arranged and how time flows locally, never its order or history.
This is the faculty most tightly regulated by metaphysical constraints.

TIER 1
Space  Primary Effect
Shift small objects slightly; bend paths of thrown items by inches; cause corridors to appear marginally longer or shorter; make a cup seem slightly farther than it is.
Environmental Consequence (Time)
A ring of minor temporal wobble forms:
     motion appears fractionally delayed or ahead
     sound arrives with tiny offsets
     visual perception shimmers subtly
It is disorienting but harmless.
Statuses:
Primary  None
Ring  Stupification (fleeting perceptual lag)

Time  Primary Effect
Speed up or slow small processes (dripping water, ember burn rate).
A creatures blink or head turn may occur slightly faster or slower, but not meaningfully in combat.
Environmental Consequence (Space)
Straight lines appear subtly skewed at the perimeter; floor tiles dont quite line up visually.
Statuses:
Primary  None
Ring  Dazed (brief spatial-perception mismatch)

TIER 2
Space  Primary Effect
Teleport small objects across short distances.
Curve the trajectory of projectiles.
Create shallow spatial distortionscorridors with slight bends where none exist.
Environmental Consequence (Time)
Motion inside the ring develops micro-lag:
     hands appear to ghost behind actions
     stepping feels fractionally delayed
     thrown items leave short afterimages
Statuses:
Primary  Prone (misstep risk), Blinded (momentary distortion)
Ring  Stupification

Time  Primary Effect
Speed up a single weapon swing; slow a single thrown object; extend or shorten a spells duration within limits.
Creatures may experience brief bursts of fast-or-slow-time.
Environmental Consequence (Space)
Spatial relations jitter slightly:
     corners appear stretched
     doorframes wobble
     objects seem closer/farther than they are
Statuses:
Primary  Slowed, Hastened
Ring  Prone (misjudged distance)

TIER 3 
Space  Primary Effect
Fold space within a room:
     two corners temporarily connect
     pathways double back subtly
     a doorway may exit into the same room at another angle
     create small teleport anchors
Environmental Consequence (Time)
Temporal drag or slip emerges:
     actions feel a half-second behind
     conversations de-sync
     footsteps echo at unnatural intervals
Statuses:
Primary  Dazed, Prone, Blinded (spatial shearing)
Ring  Stupification, Slowed

Time  Primary Effect
Slow multiple creatures; hasten allied motions; cause projectiles to hang briefly; create stagger-fields that rearrange the timing (not order) of actions.
Creatures may feel like theyre moving through syrup or lightning.
Environmental Consequence (Space)
Spatial distortions ripple across the perimeter:
     lines curve
     floors tilt subtly
     objects double briefly then merge back
Statuses:
Primary  Slowed, Hastened, Unconscious (temporal overload)
Ring  Prone, Dazed

TIER 4
Space  Primary Effect
Warp room geometry dramatically:
     bend hallways into loops
     make rooms intersect themselves
     create localized non-Euclidean geometry
     cause doorways to lead to unexpected angles
These distortions do not create new rooms; they reshape existing geometry.
Environmental Consequence (Time)
Temporal continuity breaks down at the boundary:
     sounds replay
     motions stutter
     creatures sense phantom afterimages of prior movements (not time travel)
Statuses:
Primary  Prone, Blinded, Dazed
Ring  Stupification

Time  Primary Effect
Freeze areas partially (creatures move in extreme slow-motion).
Accelerate environmental processes (rust, melting, drying).
Create time-bubbles where movement is delayed or sped by whole seconds.
Pause objects mid-air without reversing or undoing motion.
Environmental Consequence (Space)
Spatial boundaries ripple:
     walls appear to breathe
     objects seem to sway even when stationary
     shadows stretch unnaturally
Statuses:
Primary  Slowed, Hastened, Unconscious
Ring  Prone, Dazed

TIER 5 
Space  Primary Effect
Reshape towns or cavern systems into labyrinthine structures.
Streets may loop; walls connect unpredictably; distances alter.
Buildings remain intact but spatial relationships between them shift.
Environmental Consequence (Time)
Time dilation surrounds the zone:
     some actions jerk ahead suddenly
     others drag
     creatures entering see flickers of future or past poses, but not events (temporal afterimage, not retrocausality)
Statuses:
Primary  Prone, Blinded, Dazed (severe)
Ring  Stupification, Slowed

Time  Primary Effect
Slow or hasten entire groups.
Create temporal lakes where time is sluggish, or temporal rivers where it flows rapidly.
Projectiles may appear to smear; speech may overlap or fragment.
Environmental Consequence (Space)
Space at the perimeter tessellates brieflyobjects appear duplicated or shifted a small distance before snapping back.
Statuses:
Primary  Slowed, Hastened, Unconscious
Ring  Prone, Dazed

TIER 6
Space  Primary Effect
Rewrite geography on a regional scale:
     mountains shift position
     valleys stretch
     coastlines fold inward
     a city might be pulled closer to another
This is topological rewriting, not creation or destruction of matter.
Environmental Consequence (Time)
Time around the boundary becomes erratic:
     mornings stretch
     shadows flicker
     creatures lose track of seconds or minutes
But no events are undoneonly perception and pacing distort.
Statuses:
Primary  Dazed, Blinded, Prone
Ring  Stupification (severe)

Time  Primary Effect
Slow entire regions (seasons may feel long but still advance normally).
Speed up biological or ecological cycles (plants grow rapidly).
Suppress time locally into near-stillness.
This never creates paradox, memory alteration, or reversal.
Environmental Consequence (Space)
Spatial fractures appear visually:
     objects shimmer between positions
     distances flex
     travelers feel stretched or compressed
No backward causality occurs.
Statuses:
Primary  Unconscious, Slowed (absolute), Stupification
Ring  Prone, Blinded
====================================
9. TRIBOMANCY
Friction (Stiction / Grip)  Inertia (Slide / Glide)
Tribomancy governs how surfaces resist or preserve motion. It magnifies traction, drag, and shearing or strips them away to let objects slip frictionlessly.

TIER 1
Stiction  Primary Effect
Add or remove surface roughness for handheld objects or a 5 ft patch of ground. Loose gravel binds together or becomes as slick as ice.
Environmental Consequence (Inertia)
Air feels sluggish at the edge of the effect. Ribbons or dust hang briefly before settling.
Statuses:
Primary  Slowed (brief), Prone (on failed balance)
Ring  None

Inertia  Primary Effect
Reduce friction on small tools, cloth, or weapon edges. Knots loosen; blades pass with less resistance; tossed items glide slightly farther.
Environmental Consequence (Stiction)
Nearby surfaces gain a faint tackiness; footsteps sound muted.
Statuses:
Primary  None or Slowed (momentary hesitation)
Ring  None

TIER 2
Stiction  Primary Effect
Create sticky fields over 1015 ft zones. Climbing walls gain purchase; foes find their boots tacky; thrown weapons embed rather than ricochet.
Environmental Consequence (Inertia)
Wind at the boundary seems to lag; light debris drifts in slow arcs.
Statuses:
Primary  Slowed, Prone (failed athletics)
Ring  Slowed (minor)

Inertia  Primary Effect
Strip friction from armor joints or vehicle axles. Wheels coast freely; melee swings overextend; grapple attempts slide off.
Environmental Consequence (Stiction)
Dust clings to skin and metal; fabrics feel heavy.
Statuses:
Primary  Slowed, Prone (loss of footing)
Ring  Prone (minor slips)

TIER 3
Stiction  Primary Effect
Lock moving objects in place through shear force: halt charging creatures, freeze doors mid-swing, glue projectiles to shields.
Environmental Consequence (Inertia)
Water at the perimeter ripples sluggishly, as if thickened.
Statuses:
Primary  Immobilized, Prone, Stuck (cannot drop held item)
Ring  Slowed

Inertia  Primary Effect
Create near-frictionless planes up to corridor size. Combatants slide uncontrollably; impacts deflect; thrown objects skip great distances.
Environmental Consequence (Stiction)
Edges of the zone gather grit and debris, forming rough berms.
Statuses:
Primary  Prone, Disarmed (items fly from grip), Slowed (regaining footing)
Ring  Prone (on failed balance)

TIER 4
Stiction  Primary Effect
Amplify traction for siege engines, burrowing claws, or grappling hooks. Creatures can cling to ceilings; ramps become impassable walls of gluey drag.
Environmental Consequence (Inertia)
Sounds stretch and smear at the edge, as if vibrating through tar.
Statuses:
Primary  Immobilized, Grappled (terrain), Suffocating (if mouth sealed by adhesive grit)
Ring  Slowed

Inertia  Primary Effect
Render waterways, battlements, or city streets frictionless. Armies skid uncontrollably; carts rocket forward; anchors fail to catch.
Environmental Consequence (Stiction)
Walls and railings ooze tacky residue that traps loose gear.
Statuses:
Primary  Prone, Disarmed, Slowed
Ring  Prone

TIER 5
Stiction  Primary Effect
Impose crushing shear on machinery or creatures: gears seize, armor plates fuse, and muscles tear if they force motion.
Environmental Consequence (Inertia)
The perimeter warps perception of pace; everything outside seems to drag.
Statuses:
Primary  Immobilized, Laceration (shearing), Exhausted
Ring  Slowed, Prone

Inertia  Primary Effect
Erase kinetic drag across plazas or ships. Massive objects glide with ghostlike ease; collapsing buildings slump sideways instead of straight down.
Environmental Consequence (Stiction)
Dust, pollen, and fog bind at the boundary, forming hazy adhesive curtains.
Statuses:
Primary  Prone, Disarmed, Stupification (momentum shock)
Ring  Slowed

TIER 6
Stiction  Primary Effect
Create continent-scale traction shifts: mountain passes become impassable tar pits; siege walls fuse with the ground; rivers slow to syrup.
Environmental Consequence (Inertia)
Horizons appear to crawl; clouds smear; anything leaving the zone seems to move underwater.
Statuses:
Primary  Immobilized (absolute), Crushing (if motion forced), Exhausted
Ring  Slowed, Prone

Inertia  Primary Effect
Remove friction from vast terrain. Seas turn glassy; storms slide past; entire armies slide across plains with minimal effort.
Environmental Consequence (Stiction)
Cities at the edge collect dense drifts of debris that glue doors and windows shut.
Statuses:
Primary  Prone, Disarmed, Unconscious (momentum trauma)
Ring  Slowed, Prone
10. ARTIFICY
Imbuement (Dakar Infusion / Construct Creation)  Disimbuement (Magic Removal / Radiation Purge)
Artificy is uniquely tied to Dakar radiation, gemstone imbuement, magic item creation, and construct animation.
Unlike other Faculties, Artificys effects often persist for hours, days, or years depending on Duration.

ARTIFICY SPECIFIC RULES
Duration of Imbuement (Enchanting Duration)
Artificy spells that imbue items last according to:
Duration Tier	Duration
1	Physical mod Minutes
2	Physical mod Hours
3	Physical mod Moon Faces
4	Physical mod Phases
5	Physical mod Cycles
6	Physical mod Years
After this period, Dakar radiation leaks out, and all unused charges vanish.

Charged Imbuement Rules
     Imbuement allows embedding Ildakar spells into gemstones
     These imbued gems are then bound into items (not staves/wands)
     Each gemstone provides charges
     Maximum charges depend on item material and gem tiers
     When charges are used, the item takes 16 durability damage
     When durability reaches 0 OR all charges are expended,
the item disintegrates (as consumed gems would)
Example:
A steel shortsword (Durability 10) holds:
     6 Amber-tier spells (Tier 1 gems)
     1 Quartz-tier spell (Tier 4 gem)
Caster has Physical 4  Duration Tier 2  lasts 4 Hours
If all charges are used, the sword crumbles to dust.

Special Combinations
Artificy also enables:
     Staves/Wands: require Artificy + Transmutation
     Undead Animation: requires Artificy + Vivomancy
     Elemental Animation: requires Artificy + relevant Faculty
         Thermomancy  Fire/Ice elementals
         Electromancy  Storm/Charge elementals
         Pneumancy  Air/Pressure elementals
...and so on.

IMBUEMENT (Primary Faculty Effects)
Imbuement always removes Dakar radiation from the immediate area, purifying the zone while imbuing the targeted object(s).
Environmental Consequences escalate as tiers rise, impacting creatures, constructs, elementals, plants, and anomalies.

TIER 1 Imbuement
Primary Effect
     Create basic spellwarped food/water
     Create magical ink for spell scrolls
     Imbue Amber, Pearl, Moonstone for Tier 1 gemstones
     Animate advanced minion and fledgling lieutenanttier constructs/anomalies
Environmental Consequence
     Magic users feel tingling/discomfort
     Local Dakar radiation is absorbed/cleansed
     Weak magical traces flicker and dissipate
Statuses:
Primary  None
Ring  Stupification (minor discomfort), Remove 1 Dakar-related penalty

TIER 2 Imbuement
Primary Effect
     Create magic ammunition
     Create advanced magical potions
     Imbue Turquoise, Opal, Jade
     Animate fledgling hero, advanced lieutenant, and heroic minion constructs/anomalies
Environmental Consequence
Creatures in the area experience:
     Minor Will Dakar penalties
     Elementals/undead/constructs/plants suffer minor movement/physical skill penalties
     Dakar radiation is removed from the environment
Statuses:
Primary  Slowed (minor vs constructs/elementals)
Ring  Stupification (Will Dakar drain), Remove 12 Dakar penalties

TIER 3  Room/Creature Scale Imbuement
Primary Effect
     Create Heroic-tier Dakar-based magic items
     Imbue Onyx, Peridot, Citrine
     Animate advanced hero, heroic lieutenant, and epic minion constructs/anomalies
Environmental Consequence
     Major Will Dakar penalties for nearby magic users
     Constructs/elementals/plants/undead suffer major movement & physical-skill penalties
     The area is cleansed of Dakar radiation
Statuses:
Primary  Stupification (strong), Slowed (strong vs constructs)
Ring  Remove Dakar radiation

TIER 4 Imbuement
Primary Effect
     Create Epic-tier Dakar-based items
     Required for complex magical potions
     Imbue Amethyst, Quartz, Tourmaline
     Animate heroic hero, epic lieutenant, and legendary minion constructs/anomalies
Environmental Consequence
     Anyone with equipped Dakar items or recently consuming spellwarped goods is stunned
     Epic-tier and lower items in the area are denigrated by one tier
     Dakar radiation is fully removed
Statuses:
Primary  Stunned (vs Dakar users), Item Downgrade
Ring  Slowed (constructs), Remove Dakar traces

TIER 5  Imbuement
Primary Effect
     Create Legendary-tier Dakar-based items
     Imbue Emerald, Aquamarine, Spinel
     Animate epic hero, legendary lieutenant, and mythic minion constructs/anomalies
Environmental Consequence
     All Dakar-using entitiesconstructs, elementals, undead, anomalies, plantsare stunned
     Legendary-tier and lower items are denigrated by one tier
     Dakar radiation is removed completely
Statuses:
Primary  Stunned (severe), Slowed (Dakar users), Item Downgrade
Ring  Remove Dakar radiation

TIER 6  Mythic Imbuement
Primary Effect
     Create Mythic-tier Dakar-based items
     Imbue Topaz, Sapphire, Ruby, Diamond
     Animate legendary hero and mythic lieutenant constructs/anomalies
Environmental Consequence
     Dakar-using creatures without protection are knocked unconscious
     Mythic-tier and lower items are denigrated by one tier
     Dakar radiation is burned out so violently that the air physically hums
Statuses:
Primary  Unconscious (Dakar users), Item Downgrade
Ring  Stupification, Remove all Dakar contamination

DISIMBUEMENT (Primary Faculty Effects)
Disimbuement removes magical properties, purges Dakar radiation, and applies necrotic backlash to artificial beings.
Each tier stuns and applies necrosis wounds to increasingly powerful constructs, elementals, plants, undead, and anomalies.

TIER 1 Disimbuement
Primary Effect
     Remove patches of Dakar radiation
     Stun and apply 1 necrosis wound to advanced minion & fledgling lieutenant constructs/elementals/plants/undead/anomalies
Environmental Consequence
     Irradiates particulate and droplets
     Removes 1 necrosis wound from surrounding artificial or Dakar-infused beings
Statuses:
Primary  Stunned (minor), Necrosis (1)
Ring  Necrosis removed (1)

TIER 2 Disimbuement
Primary Effect
     Remove magic from mundane Willing-Dakar-created items (magic ammunition, advanced potions)
     Stun and apply 2 necrosis wounds to fledgling hero, advanced lieutenant, and heroic minion constructs/elementals/plants/undead/anomalies
Environmental Consequence
     Irradiates pebbles/puddles
     Removes 2 necrosis wounds from surrounding affected creatures
Statuses:
Primary  Stunned, Necrosis (2)
Ring  Remove Necrosis (2)

TIER 3  Creature/Room Scale Disimbuement
Primary Effect
     Remove magic from Heroic-tier Dakar-based items
     Stun and apply 3 necrosis wounds to advanced hero, heroic lieutenant, and epic minion constructs/elementals/plants/undead/anomalies
Environmental Consequence
     Irradiates bricks, crates, ponds
     Removes 3 necrosis wounds from surrounding artificial life
Statuses:
Primary  Stunned, Necrosis (3)
Ring  Remove Necrosis (3)

TIER 4 Disimbuement
Primary Effect
     Remove magic from Epic-tier Dakar-based items
     Stun and apply 4 necrosis wounds to heroic hero, epic lieutenant, legendary minion constructs/elementals/undead/plants/anomalies
Environmental Consequence
     Irradiates boulders and lakes
     Creates advanced minion + fledgling miniontier elementals/constructs/anomalies/plants/undead
     Random mundane items become weakly magical
Statuses:
Primary  Stunned, Necrosis (4)
Ring  Random Item Enchantment (weak), Minor creature creation

TIER 5  Disimbuement
Primary Effect
     Remove magic from Legendary-tier Dakar-based items
     Stun and apply 5 necrosis wounds to epic hero, legendary lieutenant, mythic minion constructs/elementals/plants/undead/anomalies
Environmental Consequence
     Irradiates cliffs, roads, copses, rivers, buildings
     Creates heroic minion, advanced lieutenant, fledgling hero constructs/elementals/anomalies/plants/undead
     Random items gain minor magic effects
Statuses:
Primary  Stunned, Necrosis (5)
Ring  Minor magical item creation, Creature manifestation

TIER 6  Mythic Disimbuement
Primary Effect
     Remove magic from Mythic-tier Dakar-based items
     Stun and apply 6 necrosis wounds to legendary hero and mythic lieutenant constructs/elementals/plants/undead/anomalies
Environmental Consequence
     Irradiates entire biomes, settlements, lakes, islands
     Creates epic minion, hero lieutenant, advanced hero constructs/elementals/anomalies/plants/undead
     Random items acquire major magical effects
Statuses:
Primary  Stunned, Necrosis (6)
Ring  Major magical transformations, Creature creation
11. OSCILLOMANCY
Amplification (Resonance/Enhancement)  Dampening (Suppression/Disruption)
Oscillomancy manipulates frequenciesauditory vibrations, waveforms, magical oscillations, resonance patterns, psychic harmonics, and the structural vibration of matter.
This Faculty is uniquely suited to:
     Audio illusions
     Distorting or reinforcing sound
     Harmonic resonance damage
     Disrupting spellcasting (counterspell)
     Enhancing secondary effects of other spells
     Reducing or muting other spell effects
     Stability manipulation (objects, emotions, spells, energy fields)
Oscillomancy is highly reactive and excels in combat magic duels, battlefield control, and manipulation of magical constructs.

====================================
AMPLIFICATION (Primary Effects)
Amplification increases vibration, resonance, perception, volume, harmonic energy, or magical frequency intensity.

TIER 1
Amplification  Primary Effect
Increase volume, brighten sound clarity, or slightly reinforce weak vibrations.
Create simple audio illusions: soft whispers, faint echoes, misleading footsteps.
Can amplify the presence of ambient magic, making it easier to detect but not interact with.
Environmental Consequence (Dampening)
A faint muffling ring emerges: sound becomes slightly dull, footsteps muted, conversations lose sharpness.
Statuses:
Primary  Deafened (minor), Stupification (subtle sensory overload)
Ring  None

Dampening  Primary Effect
Muffle sounds, reduce vibration, swallow echoes.
Disrupt small-scale magical oscillationsminor spells become harder to perceive or aim.
Can slightly reduce the intensity of Tier 1 magical effects.
Environmental Consequence (Amplification)
At the perimeter, soft auditory distortions ariseamplified breathing, heartbeats, or exaggerated floor creaks.
Statuses:
Primary  None
Ring  Deafened (minor)

====================================
TIER 2
Amplification  Primary Effect
Project focused sonic bursts, strengthen breaking points in objects through resonance, and create convincing directional audio illusions (footsteps, voices, growls).
Amplify another casters spell secondary effects (range, area, lingering effects) by a modest amount.
Environmental Consequence (Dampening)
A muted halo forms:
     metal loses its ring
     voices lose reverb
     spells feel heavier to cast
Statuses:
Primary  Deafened, Laceration (from resonant vibrations), Dazed
Ring  Stupification

Dampening  Primary Effect
Suppress sound across a small room, quiet machinery, weaken object resonance.
Act as a Tier-2 counterspell, degrading or collapsing low-level spell structures by canceling their oscillatory patterns.
Can reduce incoming damage from sound-based or resonance-based effects.
Environmental Consequence (Amplification)
Perimeter vibrates subtly:
     objects hum
     air pressure fluctuates
     echoes multiply briefly
Statuses:
Primary  Slowed (spellcasting), Deafened (light)
Ring  Dazed (brief harmonic flutter)

====================================
TIER 3 
Amplification  Primary Effect
Create immersive audio illusions with full spatial depth.
Resonate objects, armor, or terrain to crack or destabilize them.
Amplify the secondary qualities of a spell (e.g., a pyromancy spells heat aura, a photomancy illusions clarity).
Boost allied spell durations or effects slightly.
Environmental Consequence (Dampening)
A silence-field perimeter emerges:
     voices drop out
     footsteps vanish
     magical hums collapse
Creatures entering feel pressure in their ears.
Statuses:
Primary  Deafened, Dazed, Burning (friction heat from resonance), Laceration (microfractures)
Ring  Slowed (spellcasting), Stupification

Dampening  Primary Effect
Shut down sound in a full room, collapse musical illusions, soften explosions, and counterspell reliably at Tier 3.
Suppress ongoing magical effectsreducing radius, duration, or clarity.
Can mute supernatural abilities relying on sound/vibration.
Environmental Consequence (Amplification)
Edges ripple with chaotic echo:
     phantom footsteps
     doubled voices
     flickering resonance patterns
Creatures may react to false signals.
Statuses:
Primary  Slowed (casting), Stupification, Concealed (near silence)
Ring  Dazed, Deafened

====================================
TIER 4
Amplification  Primary Effect
Ignite catastrophic resonance:
     crack foundations
     destabilize structures
     amplify destructive force of spells
     intensify magical surges or backlash
Create large-area complex audio illusions including conversations, atmospheric soundscapes, or monster roars.
Acts as mass metamagic enhancement, boosting allied spell area or duration.
Environmental Consequence (Dampening)
A broad dead-zone forms where:
     all sound collapses
     spells feel thick
     magical constructs falter
Statuses:
Primary  Deafened (severe), Dazed, Laceration (shattered surfaces)
Ring  Slowed (magic), Stupification

Dampening  Primary Effect
Create a wide anti-resonance field:
     silence entire buildings
     nullify ongoing illusions
     drastically reduce effectiveness of spells passing through
     collapse structural vibrations to prevent resonance damage
Acts as a Tier-4 counterspell, collapsing mid-tier spells entirely.
Environmental Consequence (Amplification)
Perimeter crackles with resonance overload:
     walls hum
     floors vibrate
     loud phantom noises erupt unpredictably
Statuses:
Primary  Stunned (shockwave nullification), Deafened (heavy), Slowed (spellcasting)
Ring  Dazed

====================================
TIER 5 
Amplification  Primary Effect
Create city-block-scale resonance phenomena:
     shatter walls
     amplify earthquakes or explosions
     increase spell potency drastically (range, area, duration)
Produce grand-scale audio illusions indistinguishable from reality.
Can force magical fields into over-resonance, causing chain effects.
Environmental Consequence (Dampening)
Vast silence dome:
     no echoes
     no footsteps
     no spell hums
     ranged spells feel slow and resistant
Statuses:
Primary  Deafened (permanent risk), Crushing (pressure waves), Stupification
Ring  Slowed (magic), Concealed

Dampening  Primary Effect
Create zone-wide anti-magic resonance collapse:
     spells cast inside are weakened or fail
     existing effects degrade or sputter out
     magical creatures lose resonance-based powers
Acts as a Tier-5 hard counterspell, collapsing even high-tier effects.
Environmental Consequence (Amplification)
Perimeter erupts with overwhelming vibration:
     shaking windows
     pulsing air
     rhythmic booming
Creatures may lose balance.
Statuses:
Primary  Stunned, Deafened (severe), Slowed (actions)
Ring  Prone, Dazed

====================================
TIER 6
Amplification  Primary Effect
Manipulate resonance across entire regions:
     reshape landscapes via harmonic collapse
     cause mountains to vibrate and fracture
     amplify massive spells to mythic scale
     empower allies magic beyond normal limits
     generate continent-spanning illusions or natural sound phenomena
This is the ultimate metamagic enhancer.
Environmental Consequence (Dampening)
A region-wide void-silence boundary, where:
     magic struggles to function
     psychic resonance dims
     spells require vastly more effort
Statuses:
Primary  Unconscious (wave overload), Deafened (permanent risk), Crushing
Ring  Stupification (severe)

Dampening  Primary Effect
Negate magical resonance on a regional scale.
     major spells collapse
     enchantments fail
     magical beings lose harmonic functions
     battlefield magic becomes nearly impossible
This is a mythic-level counterspell, though it cannot delete magic that is purely conceptual or divine.
Environmental Consequence (Amplification)
A massive resonance storm forms at the boundary:
     earth tremors
     thunderous vibrations
     disorienting echo phenomena
Statuses:
Primary  Unconscious, Slowed (total), Deafened
Ring  Prone, Dazed
====================================
ASTROMANCY  Stellar Directives & Alien Influence
Astromancy has no environmental consequence.
Power is drawn from stellar Dakar directly to the caster or target.
At every tier, Astromancy grants:
     Insight from star-patterns (directives)
     Unique bonuses to mental/perceptive skills
     Ability to attract aliens of specific tier categories
     Ability to ally with aliens or constructs (higher tiers)

TIER 1  Minor Stellar Directive
Primary Effect
     Read basic directives of the stars
     Gain bonuses to:Navigate, Academic Recall, and Translation of alien languages
     Attract advanced minion and fledgling lieutenant aliens into the region
Environmental Consequence
None (stellar energy transfer is non-local)
Statuses:
Primary  None
Ring  None

TIER 2  Object/Creature Scale Directive
Primary Effect
     Read deeper stellar patterns
     Gain bonuses to: Intuition skills
     Gain temporary expansion of Mental attribute
     Communicate verbally with aliens
     Attract heroic minion, advanced lieutenant, and fledgling hero aliens
Environmental Consequence
None
Statuses:
Primary  None

TIER 3  Room/Zone Directive
Primary Effect
     Read stellar directives revealing paths to current desires
     Gain bonuses to all mental-based skills
     Ally with minion-tier aliens
     Attract epic minion, heroic lieutenant, and advanced hero aliens
Environmental Consequence
None
Statuses:
Primary  None

TIER 4  Structure Scale Directive
Primary Effect
     Read stellar directives revealing paths to hidden locations, missed treasures, secret vaults
     Form alliances with lieutenant-tier aliens
     Attract legendary minion, epic lieutenant, and heroic hero aliens
     Allows contracts with constructs
Environmental Consequence
None

TIER 5  Zone/Regional Directive
Primary Effect
     Read stellar directives revealing paths to specific creatures
     Gain damage reduction vs. a chosen foe-type
     Ally with hero-tier aliens
     Attract mythic minion, legendary lieutenant, and epic hero aliens
     Allows contracts with alien individuals
Environmental Consequence
None

TIER 6  Mythic Stellar Directive
Primary Effect
     Read stellar directives revealing paths to hidden artifacts
     Gain ability to deal damage to a type of foe (celestial antipathy)
     Form alliances with alien races and species (not just individuals)
     Attract legendary hero and mythic lieutenant aliens
     Allows contracts with anomalies
Environmental Consequence
None
====================================
LUNAMANCY  Moon Phase Dominion & Planar Gates
Lunamancy also generates no environmental consequence, because energy is pulled from lunar Dakar rather than extracted locally.
Lunamancy operates under three moon phases, each completely changing the effect profile of identical intensity tiers.
Each tiers intensity scale (16) corresponds directly to the fledgling  mythic creature hierarchy.
Lunamancy governs:
     Photomancy synergy
     Holy/mental damage conversion
     Lycanthropic mutation
     Planar communion (upper and lower planes)
     Brief planar transport of spaces

====================================
PHASE 1  HARPHIIEL (The Luminous Moon)
(Amplifies light, holiness, higher-plane connection)
Global Effect of This Phase
For each tier of Lunamancy used under HarPhiiel:
     Photomancy: Illumination spells of the same tier increase by 1 tier
     Illumination spells deal holy spiritual damage and wounds to unaligned creatures
     Illumination spells heal aligned creatures
Tier Effects (16)
Each tier may:
     Commune with beings of the immediate higher plane
     Enlist assistance from those beings
     Transport target spaces briefly into the higher plane
Intensity = the tier of planar creature that can be contacted or influenced (fledgling  mythic).
No Environmental Consequence.

====================================
PHASE 2  HARSUERIN (The Lycan Moon)
(Transformation, anomaly-shaping)
Global Effect
Lunamancy under HarSuerin transforms those in the area into lycanthrope anomalies.
Intensity tier 16 determines the power level of the lycanthrope:
     Tier 1  fledgling hero
     Tier 6  mythic hero
Transformation may be temporary or ritualistically permanent (setting-dependent).
No Environmental Consequence.

====================================
PHASE 3  HARRHUENEN (The Shadowed Moon)
(Amplifies darkness, mental damage, lower-plane communion)
Global Effect of This Phase
For each tier of Lunamancy used under HarRhuenen:
     Photomancy: Attenuation spells increase by 1 tier
     Attenuation spells deal mental damage and wounds to all beings with Mental 1 or higher
Tier Effects (16)
Each tier may:
     Commune with beings of the immediate lower plane
     Enlist aid of those beings
     Transport spaces briefly into the lower plane
Intensity = the tier of planar creature influenced (fledgling  mythic).
No Environmental Consequence.
`,Ol=oE,mE={"thairin-inin":{raceKey:"ININ",subraceKey:"THAIRIN"},"grazin-inin":{raceKey:"ININ",subraceKey:"GRAZIN"},"bryonin-inin":{raceKey:"ININ",subraceKey:"BRYONIN"},"jiinin-inin":{raceKey:"ININ",subraceKey:"JIININ"},"rivanonin-inin":{raceKey:"ININ",subraceKey:"RIVANONIN"},"melfarionin-inin":{raceKey:"ININ",subraceKey:"MELFARIONIN"},"thuilin-inin":{raceKey:"ININ",subraceKey:"THUILIN"},"letelin-inin":{raceKey:"ININ",subraceKey:"LETELIN"},anz:{raceKey:"ANZ"},"phi-ilin":{raceKey:"PHIILIN"},cerevu:{raceKey:"CEREVU"},venii:{raceKey:"VENII"},freinin:{raceKey:"FREININ"}},vf={ANIMAL_HANDLING:"ANIMAL_HUSBANDRY"},sn=e=>(e??"").trim().toLowerCase(),pE="martial_prowess_v2",fE=new Set(["thermomancy","graviturgist","vivomancer","electromancer","pneumancer","photomancer"].map(sn)),gE=()=>{const e=Ml(db,"Weapon"),t=Ml(hb,"Armor"),n=[...e,...t],s=new Map,r=new Map,i=new Map,o=new Map;return n.forEach(l=>{var d;s.set(l.id,l);const c=`${l.kind}:${l.category}`;r.set(c,(r.get(c)??0)+l.mpCost),i.set(c,(i.get(c)??0)+1);const u=sn(l.category);o.has(u)||o.set(u,new Set),(d=o.get(u))==null||d.add(c)}),{abilityMap:s,categoryCosts:r,categoryAbilityCounts:i,categoriesByName:o}},Jr=gE(),yE=e=>{if(typeof window>"u"||!e)return{purchased:new Set};try{const t=window.localStorage.getItem(`${pE}:${e}`);if(!t)return{purchased:new Set};const n=JSON.parse(t),s=Array.isArray(n.purchased)?n.purchased:[];return{purchased:new Set(s.filter(r=>Jr.abilityMap.has(r)))}}catch(t){return console.warn("Unable to read martial prowess state",t),{purchased:new Set}}},vE=e=>{const{purchased:t}=yE(e),n=new Map,s=new Map;return t.forEach(r=>{const i=Jr.abilityMap.get(r);if(!i)return;const o=`${i.kind}:${i.category}`;n.set(o,(n.get(o)??0)+1),s.set(o,(s.get(o)??0)+i.mpCost)}),{totalUnlocked:t.size,unlockedByCategory:n,spentByCategory:s,categoryCosts:Jr.categoryCosts,categoryAbilityCounts:Jr.categoryAbilityCounts,categoriesByName:Jr.categoriesByName}},bE=e=>{const t=new Map;return((e==null?void 0:e.skills)??[]).forEach(n=>{const s=aa(n);t.set(s,wt(n))}),t},_E=(e,t)=>{const n=aa({name:t});return e.has(n)?e.get(n)??null:vf[n]?vf[n]:null},xE=(e,t)=>{const n={};return t.forEach(s=>{n[s]=0}),Object.entries((e==null?void 0:e.skillAllocations)??{}).forEach(([s,r])=>{n[s]=(n[s]??0)+r}),Object.entries((e==null?void 0:e.skillBonuses)??{}).forEach(([s,r])=>{n[s]=(n[s]??0)+r}),n},al=nm(am),wE=new Map(al.map(e=>[sn(e.name),e])),bf="weapon-mastery-choose-weapon-category",kE=e=>{if(!e||typeof window>"u")return{unlocked:new Set,basicUnlocked:0,advancedUnlocked:0,totalBasic:0,totalAdvanced:0};let t={};try{const l=window.localStorage.getItem(`unlocked_faculties_${e}`);t=l?JSON.parse(l):{}}catch(l){console.warn("Unable to read stored Ildakar faculties",l)}const n=new Set;let s=0,r=0;al.forEach(l=>{const c=sn(l.name);(t[c]??t[l.name])&&(n.add(l.name),l.category==="Basic"&&(s+=1),l.category==="Advanced"&&(r+=1))});const i=al.filter(l=>l.category==="Basic").length,o=al.filter(l=>l.category==="Advanced").length;return{unlocked:n,basicUnlocked:s,advancedUnlocked:r,totalBasic:i,totalAdvanced:o}},NE=e=>{const t=new Set,n=new Set;if(!e)return{backgrounds:t,flaws:n};const s=r=>{if(r){if(Array.isArray(r)){r.forEach(i=>t.add(sn(i)));return}t.add(sn(r))}};return s(e.family),s(e.childhood),s(e.adolescence),s(e.adulthood),s(e.incitingIncident),(e.flaws??[]).forEach(r=>n.add(sn(r))),{backgrounds:t,flaws:n}},jE=(e,t,n)=>{var o;const s=new Set;if(!e)return s;const r=e.raceKey?t.get(e.raceKey)??e.raceKey:void 0,i=e.subraceKey?((o=n.get(e.subraceKey))==null?void 0:o.name)??e.subraceKey:void 0;return r&&s.add(sn(r)),i&&s.add(sn(i)),s},SE=e=>{const t=e.toLowerCase(),n=t.includes(" or ")?"any":t.includes(" and ")?"all":t.includes(",")?"any":"all",s=e.replace(/[()]/g,"").split(/,|\bor\b|\band\b|\/|&/i).map(i=>i.trim()).filter(Boolean),r=[];return s.forEach(i=>{const o=i.toUpperCase();["PHYSICAL","MENTAL","SPIRITUAL","WILL"].includes(o)&&r.push(o)}),{keys:r,mode:n}},EE=(e,t)=>{const n=e.toLowerCase(),s=n.includes(" or ")||n.includes(",")?"any":"all",r=e.replace(/[()]/g,"").split(/,|\bor\b|\band\b|\/|&/i).map(l=>l.trim()).filter(Boolean),i=[],o=[];return r.forEach(l=>{const c=_E(t,l);c&&(i.push(c),o.push(l))}),{codes:i,mode:s,original:o}},CE=(e,t,n,s)=>{const r=SE(s);if(r.keys.length>0){const o=r.keys.map(u=>{const d=t.attributes[u]??0;return{key:u,met:d>=n,value:d}}),l=r.mode==="all"?o.every(u=>u.met):o.some(u=>u.met),c=o.filter(u=>!u.met);return{requirement:e,met:l,detail:l?void 0:c.map(u=>`${u.key} ${u.value}/${n}`).join(", ")}}const i=EE(s,t.skillLookup);if(i.codes.length>0){const o=i.codes.map((u,d)=>{const h=t.skills[u]??0;return{code:u,label:i.original[d]??u,met:h>=n,value:h}}),l=i.mode==="all"?o.every(u=>u.met):o.some(u=>u.met),c=o.filter(u=>!u.met);return{requirement:e,met:l,detail:l?void 0:c.map(u=>`${u.label} ${u.value}/${n}`).join(", ")}}return{requirement:e,met:!1,detail:"Requirement could not be matched"}},_f=(e,t)=>e.some(n=>t.has(sn(n))),AE=(e,t,n,s)=>{if(!n.includes("martial prowess"))return null;const r=s.martial,i=Array.from(r.categoryAbilityCounts.entries()).filter(([m,y])=>(r.unlockedByCategory.get(m)??0)>=y),o=Array.from(r.categoriesByName.entries()).filter(([m])=>n.includes(m)),l=t.match(/at least\s*(\d+)\s+martial prowess abilities/i),c=t.match(/(\d+)\s+martial prowess categories? with all/i),u=t.match(/at least\s*(\d+)/i),d=l?Number(l[1]):n.includes("abilities unlocked")&&u?Number(u[1]):null,h=c?Number(c[1]):n.includes("categories with all")?1:null;if(h!==null){const m=i.length,y=m>=h,b=d===null||r.totalUnlocked>=d,_=y&&b,w=[];return y||w.push(`${m}/${h} categories complete`),!b&&d!==null&&w.push(`Martial Prowess abilities ${r.totalUnlocked}/${d}`),{requirement:e,met:_,detail:w.join("; ")||void 0}}if(n.includes("all martial prowess abilities unlocked")){const m=i.length>0;return{requirement:e,met:m,detail:m?void 0:"No categories have all Martial Prowess abilities unlocked"}}if(n.includes("abilities unlocked")){if(o.length>0&&d!==null){const y=o.some(([,_])=>Array.from(_).some(w=>(r.unlockedByCategory.get(w)??0)>=d));return{requirement:e,met:y,detail:y?void 0:"Not enough abilities unlocked in the specified category"}}if(d!==null){const y=r.totalUnlocked>=d,b=y?void 0:`Martial Prowess abilities ${r.totalUnlocked}/${d}`;return{requirement:e,met:y,detail:b}}const m=r.totalUnlocked>0;return{requirement:e,met:m,detail:m?void 0:"No Martial Prowess abilities unlocked"}}if(n.includes("double the points")||n.includes("more points than are required")){const m=n.includes("double the points")?2:1,b=!!Array.from(r.categoryCosts.entries()).find(([w,f])=>(r.spentByCategory.get(w)??0)>=f*m),_=b?void 0:`No category has ${m===2?"double":"more than"} the points needed (${m}x cost)`;return{requirement:e,met:b,detail:_}}if(n.includes("base abilities")&&n.includes("martial prowess")){const m=i.length>0;return{requirement:e,met:m,detail:m?void 0:"No Martial Prowess category has all base abilities unlocked"}}if(n.includes("long range")){const m=r.categoriesByName.get("long range"),b=(m?Array.from(m).reduce((w,f)=>w+(r.unlockedByCategory.get(f)??0),0):0)>0;return{requirement:e,met:b,detail:b?void 0:"No Long Range Martial Prowess abilities unlocked"}}return{requirement:e,met:!1,detail:"Manual verification required"}},IE=(e,t)=>{var i,o;const n=e.replace(/^[-+]/,"").trim(),s=sn(n);if(!s)return{requirement:e,met:!0};const r=AE(e,n,s,t);if(r)return r;if(s.includes("ancillar")){const l=(i=Array.from(t.ancillaryNames.entries()).find(([u])=>s.includes(u)))==null?void 0:i[1],c=l?t.ancillaries.has(l):!1;return{requirement:e,met:c,detail:c?void 0:"Prerequisite ancillary not selected"}}if(s.includes("background")){const l=n.replace(/background/gi,"").split(/,|\bor\b|\band\b/).map(u=>u.trim()).filter(Boolean),c=l.length===0?!1:l.some(u=>{const d=sn(u);return d==="ildakar"?_f(Array.from(fE),t.backgrounds):t.backgrounds.has(d)});return{requirement:e,met:c,detail:c?void 0:"Missing required background"}}if(s.includes("flaw")){const c=n.replace(/flaw/gi,"").split(/,|\bor\b|\band\b/).some(u=>t.flaws.has(sn(u)));return{requirement:e,met:c,detail:c?void 0:"Missing required flaw"}}if(s.includes("race")||n.match(/\banz\b|\bganz|\bgraz|\bjiin/i)){const l=n.replace(/race/gi,"").split(/,|\bor\b|\band\b/).map(u=>u.trim()).filter(Boolean),c=_f(l,t.races);return{requirement:e,met:c,detail:c?void 0:"Race or subrace mismatch"}}if(s.includes("martial prowess")){const l=t.skills.MARTIAL_PROWESS??0,c=n.match(/(\d+)/);if(c){const u=Number(c[1]),d=l>=u;return{requirement:e,met:d,detail:d?void 0:`Martial Prowess ${l}/${u}`}}return{requirement:e,met:l>0,detail:l>0?void 0:"No Martial Prowess recorded"}}if(s.includes("ildakar")){const{ildakar:l}=t,c=n.match(/at\s+least\s*(\d+)\s*basic/i),u=n.match(/at\s+least\s*(\d+)\s*advanced/i),d=n.match(/at\s+least\s*(\d+)/i),h=(o=Array.from(wE.entries()).find(([A])=>s.includes(A)))==null?void 0:o[1];if(h){const A=l.unlocked.has(h.name);return{requirement:e,met:A,detail:A?void 0:`${h.name} not unlocked`}}const m=c?Number(c[1]):null,y=u?Number(u[1]):null,b=d?Number(d[1]):null,_=m===null||l.basicUnlocked>=m,w=y===null||l.advancedUnlocked>=y,f=b===null||l.unlocked.size>=b,p=s.includes("all basic")?l.totalBasic>0&&l.basicUnlocked>=l.totalBasic:!0,g=_&&w&&f&&p&&l.unlocked.size>0,j=[];return!_&&m!==null&&j.push(`Basic ${l.basicUnlocked}/${m}`),!w&&y!==null&&j.push(`Advanced ${l.advancedUnlocked}/${y}`),!f&&b!==null&&j.push(`Faculties ${l.unlocked.size}/${b}`),!p&&s.includes("all basic")&&j.push("Not all basic faculties unlocked"),{requirement:e,met:g,detail:j.join("; ")||(g?void 0:"No Ildakar Faculty unlocked")}}return{requirement:e,met:!1,detail:"Manual verification required"}},PE=(e,t)=>{const n=e.trim();if(!n)return{requirement:e,met:!0};if(n.startsWith("+")){const s=n.match(/\+\s*\d+[^\+]*(?=(?:\+\s*\d+)|$)/g),i=(s&&s.length>0?s:[n]).map(c=>{const u=c.match(/^\+(\d+)\s*(.*)$/);if(!u)return{requirement:c,met:!1,detail:"Invalid format"};const d=Number(u[1]),h=u[2].trim();return CE(c,t,d,h)}),o=i.every(c=>c.met),l=i.filter(c=>!c.met).map(c=>c.detail).filter(Boolean).join("; ")||void 0;return{requirement:e,met:o,detail:l}}return IE(e,t)},TE=(e,t)=>e.map(n=>PE(n,t)),RE=()=>{const e=Ol.ancestryGroups.flatMap(n=>n.entries.map(s=>({id:s.id,name:s.name,description:s.description,requirements:[n.name],category:"ancestry",ancestryGroup:n.name,ancestryGroupId:n.id}))),t=Ol.ancillaries.map(n=>({...n,category:"general"}));return[...e,...t]},ps=RE();ps.filter(e=>e.category==="general");const DE=ps.filter(e=>e.category==="ancestry"),ME=new Map(Ol.ancestryGroups.map(e=>[e.id,e])),LE=new Set(["fledgling-psion","advanced-psion","heroic-psion","epic-psion","legendary-psion","mythic-psion"]),OE=e=>{if(!e)return{total:2,tierAdvancements:0};const t=Math.max(0,Math.floor((e.level-1)/5));return{total:2+t*2,tierAdvancements:t}},Lo=(e,t)=>{if(!e||!t)return!1;const n=mE[e];return!(!n||n.raceKey!==(t.raceKey??"")||n.subraceKey&&n.subraceKey!==(t.subraceKey??""))},$E=()=>{var _e,He,De;const{selectedId:e}=Is(),{data:t}=As(),[n,s]=v.useState([]),[r,i]=v.useState(!0),[o,l]=v.useState(null),[c,u]=v.useState(""),[d,h]=v.useState(!1),m=Ea(),y=v.useMemo(()=>bE(t),[t]),b=v.useMemo(()=>new Map(ps.map(ne=>[sn(ne.name),ne.id])),[]),_=v.useMemo(()=>Sr(e),[e]),[{selected:w,metadata:f,flags:p},g]=v.useState(()=>ba(e)),j=v.useRef(null),A=v.useCallback((ne,me)=>{const we=ne??{};return typeof we.lockedCount=="number"&&we.lockedCount>=0?Math.min(we.lockedCount,me.length):we.locked?(j.current===null&&(j.current=me.length),Math.min(j.current,me.length)):(j.current=null,0)},[]),R=v.useCallback(ne=>{g(me=>{const we=A(me.flags,me.selected),Ye=me.selected.slice(0,we),Fe=typeof ne=="function"?ne(me.selected):ne,z=new Set(ps.map(Z=>Z.id)),U=Fe.filter(Z=>z.has(Z)).filter(Z=>!Ye.includes(Z)),P=[...Ye,...U],H={};return P.forEach(Z=>{me.metadata[Z]&&(H[Z]=me.metadata[Z])}),{selected:P,metadata:H,flags:me.flags??{}}})},[A]),S=A(p,w),k=w.slice(S),N=v.useCallback((ne,me)=>{g(we=>({selected:we.selected,metadata:{...we.metadata,[ne]:{...we.metadata[ne],...me}},flags:we.flags??{}}))},[]);v.useEffect(()=>{g(ba(e))},[_]),v.useEffect(()=>{Cd(e,{selected:w,metadata:f,flags:p})},[p,f,w,e,_]),v.useEffect(()=>{(async()=>{i(!0),l(null);try{const me=await Ct.listCharacters();s(me)}catch(me){const we=me instanceof Error?me.message:"Failed to load characters";l(we)}finally{i(!1)}})()},[]);const E=v.useMemo(()=>n.find(ne=>ne.id===e)??null,[n,e]),{backgrounds:M,flaws:O}=v.useMemo(()=>NE(E==null?void 0:E.backgrounds),[E]),X=v.useMemo(()=>new Map(((t==null?void 0:t.races)??[]).map(ne=>[ne.id,ne.name])),[t]),re=v.useMemo(()=>new Map(((t==null?void 0:t.subraces)??[]).map(ne=>[ne.id,{name:ne.name,raceKey:ne.parentId??""}])),[t]),I=v.useMemo(()=>jE(E,X,re),[X,E,re]),$=E!=null&&E.raceKey?X.get(E.raceKey)??E.raceKey:void 0,L=E!=null&&E.subraceKey&&((_e=re.get(E.subraceKey))!=null&&_e.name)?(He=re.get(E.subraceKey))==null?void 0:He.name:E==null?void 0:E.subraceKey,{total:D,tierAdvancements:F}=OE(E),q=Math.max(D-w.length,0),V=v.useMemo(()=>w.some(ne=>LE.has(ne)),[w]),Q=v.useMemo(()=>xE(E,y),[E,y]),te=v.useMemo(()=>vE((E==null?void 0:E.id)??e),[E==null?void 0:E.id,e]),B=v.useMemo(()=>kE((E==null?void 0:E.id)??e),[E==null?void 0:E.id,e]),ae=v.useMemo(()=>Array.from(te.categoryAbilityCounts.entries()).filter(([ne])=>ne.startsWith("Weapon:")).map(([ne,me])=>{const we=te.unlockedByCategory.get(ne)??0;return{key:ne,label:ne.replace(/^Weapon:/,""),unlocked:we,total:me,complete:we>=me}}).sort((ne,me)=>ne.label.localeCompare(me.label)),[te.categoryAbilityCounts,te.unlockedByCategory]),le=((De=f[bf])==null?void 0:De.weaponCategory)??"",he=ae.find(ne=>ne.key===le);he&&he.complete;const ue=v.useMemo(()=>({character:E,attributes:(E==null?void 0:E.attributes)??{},skills:Q,backgrounds:M,flaws:O,races:I,ancillaries:new Set(w),ancillaryNames:b,skillLookup:y,martial:te,ildakar:B}),[b,M,O,B,te,I,w,E,e,y,Q]),xe=v.useCallback(ne=>ne.category==="ancestry"?ne.requirements.map(me=>({requirement:me,met:!0})):TE(ne.requirements,ue),[ue]),Ne=v.useMemo(()=>{const ne=Ol.ancestryGroups.filter(me=>Lo(me.id,E));return new Set(ne.map(me=>me.id))},[E]),je=v.useMemo(()=>DE.filter(ne=>Ne.has(ne.ancestryGroupId??"")),[Ne]),Ce=E?E.level===1:!1,Ke=v.useMemo(()=>Array.from(Ne).map(ne=>{var me;return((me=ME.get(ne))==null?void 0:me.name)??ne}),[Ne]),Me=E?Ke.length>0?`${Ke.join(", ")}${Ce?"":" (locked after level 1)"}`:"No ancestry ancillaries available for this character.":"Select a character with a race/subrace to unlock ancestry ancillaries.",oe=v.useMemo(()=>{const ne=new Set(je.map(me=>me.id));return ps.filter(me=>me.category==="general"||ne.has(me.id))},[je]),pe=c.trim().toLowerCase(),ve=v.useMemo(()=>{const ne=we=>{const Ye=we.category==="general"||Lo(we.ancestryGroupId,E)&&(Ce||w.includes(we.id)),Fe=xe(we).every(z=>z.met);return Ye&&Fe},me=d?oe.filter(ne):oe;return pe?me.filter(we=>[we.name,we.description,we.ancestryGroup??"",...we.requirements].join(` 
 `).toLowerCase().includes(pe)):me},[Ce,oe,xe,pe,w,E,d]),be=()=>{g(ne=>{const me=Math.min(ne.selected.length,D);j.current=me;const we={...ne.flags,lockedCount:me,locked:!1,psionicsLockRequested:V},{locked:Ye,...Fe}=we,z={selected:ne.selected,metadata:ne.metadata,flags:Fe};return Cd(e,z),z}),V&&m("/player/psionics")},ke=w.map(ne=>ve.find(me=>me.id===ne)||ps.find(me=>me.id===ne)).filter(Boolean),Ie=ne=>{const me=ps.find(we=>we.id===ne);if(!((me==null?void 0:me.category)==="ancestry"&&(!Lo(me.ancestryGroupId,E)||!Ce&&!w.includes(ne)))){if(w.includes(ne)){const we=w.indexOf(ne);if(we>-1&&we<S)return;R(Ye=>Ye.filter(Fe=>Fe!==ne));return}w.length>=D||R(we=>[...we,ne])}},Be=(ne,me)=>{var G;const we=w.includes(ne.id),Ye=we&&w.indexOf(ne.id)<S,Fe=me||we?Ye?"Locked":"Remove":"Add",z=ne.category==="ancestry"&&(!Lo(ne.ancestryGroupId,E)||!Ce&&!we),de=xe(ne),U=de.some(Y=>!Y.met),P=ne.id===bf,H=((G=f[ne.id])==null?void 0:G.weaponCategory)??"",Z=H?ae.find(Y=>Y.key===H):he,ie=P&&(!Z||!Z.complete||!H),ee=me?Ye:we||q<=0||z||U||ie;return a.jsx("div",{className:"ancillaries__card",children:a.jsxs("div",{className:"ancillaries__card-header",children:[a.jsxs("div",{className:"ancillaries__card-body",children:[a.jsxs("div",{className:"ancillaries__card-title-row",children:[a.jsx("h4",{className:"ancillaries__card-title",children:ne.name}),a.jsx("span",{className:"ancillaries__badge",children:ne.category==="general"?"General":"Ancestry"}),ne.ancestryGroup&&a.jsx("span",{className:"ancillaries__badge ancillaries__badge--ancestry",children:ne.ancestryGroup})]}),ne.requirements.length>0&&a.jsxs("div",{className:"ancillaries__requirements",children:[a.jsx("div",{className:"ancillaries__requirements-title",children:"Requirements"}),a.jsx("ul",{className:"ancillaries__requirements-list",children:de.map(Y=>a.jsxs("li",{className:`ancillaries__requirement${Y.met?" ancillaries__requirement--met":""}`,children:[Y.requirement,!Y.met&&Y.detail?`  ${Y.detail}`:""]},`${ne.id}-${Y.requirement}`))})]}),a.jsx("div",{className:"ancillaries__description",children:ne.description}),ne.category==="ancestry"&&!Ce&&!we&&a.jsx("div",{className:"ancillaries__warning",children:"Ancestry ancillaries can only be added at level 1."}),P&&a.jsxs("div",{className:"ancillaries__weapon",children:[a.jsx("label",{className:"ancillaries__weapon-label",children:"Choose Weapon Category"}),a.jsxs("select",{value:H,onChange:Y=>N(ne.id,{weaponCategory:Y.target.value}),className:"ancillaries__select",children:[a.jsx("option",{value:"",children:"Select a weapon category"}),ae.map(Y=>a.jsxs("option",{value:Y.key,children:[Y.label,"  ",Y.unlocked,"/",Y.total," abilities unlocked"]},Y.key))]}),H&&a.jsx("div",{className:`ancillaries__weapon-status${ie?" ancillaries__weapon-status--blocked":""}`,children:Z?Z.complete?"All abilities purchased.":`This category still needs ${Z.total-Z.unlocked} abilities.`:"Select a valid category."}),ie&&a.jsx("div",{className:"ancillaries__weapon-warning",children:"You must fully purchase a weapon category before taking Weapon Mastery."})]})]}),a.jsx("div",{children:a.jsx("button",{onClick:()=>Ie(ne.id),disabled:ee,className:`ancillaries__action${me||we?Ye?" ancillaries__action--locked":" ancillaries__action--remove":" ancillaries__action--add"}`,children:Fe})})]})},ne.id)};return a.jsxs("div",{className:"ancillaries",children:[a.jsx("h2",{className:"ancillaries__title h2",children:"Ancillaries"}),a.jsx("p",{className:"ancillaries__intro subtitle muted",children:"Choose 2 ancillaries at character creation. You gain 2 more picks at every Character Tier Advancement (levels 6, 11, 16, and so on). Entries stay locked until the listed prerequisites are satisfied for the selected character."}),a.jsx("p",{className:"ancillaries__intro subtitle muted",children:"Ancestry ancillaries are locked to your characters race and subrace (when applicable) and can only be chosen at level 1."}),o&&a.jsx("p",{className:"ancillaries__error body",children:o}),a.jsxs("div",{className:"ancillaries__summary",children:[a.jsx("div",{className:"ancillaries__pill",children:a.jsxs("div",{children:[a.jsx("div",{className:"ancillaries__pill-title body",children:"Selected Character"}),a.jsx("div",{className:"ancillaries__pill-subtitle subtitle muted",children:r?"Loading...":E?`${E.name} (Level ${E.level})`:"None"}),E&&a.jsxs("div",{className:"ancillaries__pill-meta caption muted",children:["Race: ",$??"Unknown",L?` / ${L}`:""]})]})}),a.jsxs("div",{className:"ancillaries__pill",children:[a.jsxs("div",{children:[a.jsx("div",{className:"ancillaries__pill-title body",children:"Allowed Ancillaries"}),a.jsxs("div",{className:"ancillaries__pill-subtitle subtitle muted",children:["Base 2 + ",F," tier advancements  2"]})]}),a.jsx("div",{className:`ancillaries__pill-value${q===0?" ancillaries__pill-value--warn":""}`,children:D})]}),a.jsxs("div",{className:"ancillaries__pill",children:[a.jsxs("div",{children:[a.jsx("div",{className:"ancillaries__pill-title body",children:"Remaining Picks"}),a.jsx("div",{className:"ancillaries__pill-subtitle subtitle muted",children:"Available to assign"})]}),a.jsx("div",{className:`ancillaries__pill-value${q>0?"":" ancillaries__pill-value--danger"}`,children:q})]}),a.jsxs("div",{className:"ancillaries__pill",children:[a.jsxs("div",{children:[a.jsx("div",{className:"ancillaries__pill-title body",children:"Ancestry Access"}),a.jsx("div",{className:"ancillaries__pill-subtitle subtitle muted",children:Me})]}),a.jsx("div",{className:`ancillaries__pill-value${Ce?"":" ancillaries__pill-value--warn"}`,children:Ce?"Level 1":E?`Level ${E.level}`:""})]})]}),a.jsxs("div",{className:"ancillaries__search",children:[a.jsx("label",{className:"ancillaries__search-label",children:"Search Ancillaries"}),a.jsxs("div",{className:"ancillaries__search-row",children:[a.jsx("input",{type:"text",value:c,onChange:ne=>u(ne.target.value),placeholder:"Search by name, requirement, or description",className:"ancillaries__input"}),a.jsx("button",{type:"button",onClick:()=>h(ne=>!ne),className:`ancillaries__toggle${d?" ancillaries__toggle--active":""}`,children:d?"Showing Eligible":"Show Eligible"})]})]}),a.jsxs("div",{className:"ancillaries__layout",children:[a.jsx("div",{children:a.jsxs("div",{className:"ancillaries__panel ancillaries__panel--sticky",children:[a.jsxs("div",{className:"ancillaries__panel-header",children:[a.jsx("h3",{className:"ancillaries__panel-title h3",children:"Chosen Ancillaries"}),a.jsxs("span",{className:"ancillaries__badge ancillaries__badge--count",children:[w.length,"/",D]})]}),a.jsxs("div",{className:"ancillaries__lock",children:[a.jsx("button",{type:"button",onClick:be,disabled:k.length===0,className:"ancillaries__button",children:k.length===0?"Ancillaries Locked":"Lock Ancillaries"}),a.jsxs("div",{className:"ancillaries__lock-note",children:["Locks your new ancillary selections so they cannot be changed or removed.",V?" Opens a Psionics prompt to pick ancillary abilities.":""]})]}),S>0&&a.jsxs("div",{className:"ancillaries__locked-note",children:[S," ancillary",S===1?" is":"ies are"," locked. You can add"," ",Math.max(D-w.length,0)," more when you gain new slots."]}),ke.length===0?a.jsx("p",{className:"ancillaries__empty",children:"No ancillaries selected yet."}):ke.map(ne=>Be(ne,!0))]})}),a.jsx("div",{children:a.jsxs("div",{className:"ancillaries__panel",children:[a.jsxs("div",{className:"ancillaries__panel-header",children:[a.jsx("h3",{className:"ancillaries__panel-title h3",children:"All Ancillaries"}),a.jsx("span",{className:"ancillaries__badge ancillaries__badge--count",children:ve.length})]}),ve.map(ne=>Be(ne,!1))]})})]})]})},BE="martial_prowess_v2",mb=e=>`${e.kind}:${e.category}`,Oo=(e,t)=>{const n=new Map;return e.forEach(s=>{const r=t.get(s);if(!r)return;const i=mb(r);n.set(i,(n.get(i)??0)+r.mpCost)}),n},xf=(e,t,n)=>{if(typeof window>"u"||!e)return{categoryPools:{},purchased:new Set};try{const s=window.localStorage.getItem(e);if(!s)return{categoryPools:{},purchased:new Set};const r=JSON.parse(s),i=Array.isArray(r.purchased)?r.purchased.filter(c=>n.has(c)):[],o=new Set(t.map(c=>c.key)),l={};return r.categoryPools&&typeof r.categoryPools=="object"&&Object.entries(r.categoryPools).forEach(([c,u])=>{if(!o.has(c))return;const d=typeof u=="number"&&Number.isFinite(u)?Math.max(0,Math.floor(u)):0;d>0&&(l[c]=d)}),{categoryPools:l,purchased:new Set(i)}}catch(s){return console.warn("Unable to parse martial prowess state",s),{categoryPools:{},purchased:new Set}}},FE=(e,t)=>{if(!(typeof window>"u"||!e))try{const n=JSON.stringify({categoryPools:t.categoryPools,purchased:Array.from(t.purchased)});window.localStorage.setItem(e,n)}catch(n){console.warn("Unable to persist martial prowess state",n)}},qE=({ability:e,purchased:t,remainingMp:n,onPurchase:s})=>{const r=n>=e.mpCost,i=t?"Purchased":r?"Unlocked":"Insufficient MP",o=t?"martial-ability__status martial-ability__status--purchased":r?"martial-ability__status martial-ability__status--available":"martial-ability__status martial-ability__status--blocked";return a.jsx("button",{onClick:()=>s(e),disabled:t||!r,className:`martial-ability${t?" martial-ability--purchased":""}${!t&&!r?" martial-ability--blocked":""}`,children:a.jsxs("div",{className:"martial-ability__content",children:[a.jsxs("div",{className:"martial-ability__header",children:[a.jsxs("div",{className:"martial-ability__title-block",children:[a.jsx("div",{className:"martial-ability__title",children:e.name}),a.jsx("div",{className:"martial-ability__type",children:e.abilityType})]}),a.jsxs("div",{className:"martial-ability__tags",children:[e.twoHanded&&a.jsx("span",{className:"martial-ability__tag martial-ability__tag--two-handed",children:"Two-Handed"}),a.jsxs("span",{className:"martial-ability__tag martial-ability__tag--cost",children:[e.mpCost," MP"]})]})]}),a.jsxs("div",{className:"martial-ability__stats",children:[a.jsx(pa,{label:"Energy",value:e.energyCost}),a.jsx(pa,{label:"Action",value:e.actionPointCost}),a.jsx(pa,{label:"Damage",value:e.damage}),a.jsx(pa,{label:"Type",value:e.damageType}),a.jsx(pa,{label:"Range",value:e.range})]}),a.jsx("div",{className:"martial-ability__description",children:e.description}),a.jsx("div",{className:o,children:i})]})})},pa=({label:e,value:t})=>a.jsxs("div",{className:"martial-stat",children:[a.jsx("span",{className:"martial-stat__label",children:e}),a.jsx("span",{className:"martial-stat__value",children:t})]}),UE=()=>{const e=v.useMemo(()=>[...Ml(db,"Weapon"),...Ml(hb,"Armor")],[]),t=v.useMemo(()=>new Set(e.map($=>$.id)),[e]),n=v.useMemo(()=>new Map(e.map($=>[$.id,$])),[e]),s=v.useMemo(()=>{const $=new Map;for(const L of e){$.has(L.kind)||$.set(L.kind,new Map);const D=$.get(L.kind);D.has(L.category)||D.set(L.category,[]),D.get(L.category).push(L)}for(const L of $.values())for(const D of L.values())D.sort((F,q)=>F.name.localeCompare(q.name));return $},[e]),r=v.useMemo(()=>{const $=[];return s.forEach((L,D)=>{L.forEach((F,q)=>{$.push({key:`${D}:${q}`,kind:D,category:q,abilities:F})})}),$.sort((L,D)=>L.category.localeCompare(D.category))},[s]),{selectedId:i}=Is(),[o,l]=v.useState(null),[c,u]=v.useState(null),[d,h]=v.useState(!1),[m,y]=v.useState(null),b=v.useMemo(()=>i?`${BE}:${i}`:null,[i]),[_,w]=v.useState(()=>xf(b,r,t)),f=v.useMemo(()=>{const $=new Map;for(const L of r)$.has(L.kind)||$.set(L.kind,[]),$.get(L.kind).push(L);return $.forEach(L=>L.sort((D,F)=>D.category.localeCompare(F.category))),$},[r]),p=v.useMemo(()=>r.find($=>$.key===m)??null,[m,r]);v.useEffect(()=>{r.length!==0&&(!m||!r.some($=>$.key===m))&&y(r[0].key)},[m,r]),v.useEffect(()=>{if(l(null),!i){u("Select a character on the Characters page to manage martial prowess."),h(!1);return}u(null),h(!0),Ct.listCharacters().then($=>{const L=$.find(D=>D.id===i)??null;l(L),L||u("Selected character not found. Choose one on the Characters page.")}).catch($=>{const L=$ instanceof Error?$.message:"Failed to load character.";u(L)}).finally(()=>h(!1))},[i]);const g=v.useMemo(()=>{const $=(o==null?void 0:o.skillAllocations)??{},L=(o==null?void 0:o.skillBonuses)??{},D=$.MARTIAL_PROWESS??0,F=L.MARTIAL_PROWESS??0;return Math.max(0,D+F)},[o]),j=v.useCallback($=>{const L=r.map(he=>he.key),D=new Set;$.purchased.forEach(he=>{n.has(he)&&D.add(he)});const F=Oo(D,n),q=Array.from(F.values()).reduce((he,ue)=>he+ue,0),V={};let Q=0;L.forEach(he=>{const ue=F.get(he)??0,xe=$.categoryPools[he]??0,Ne=Math.max(ue,Number.isFinite(xe)?Math.floor(xe):0);V[he]=Ne,Q+=Ne});const te=Math.max(g,q);let B=Math.max(0,Q-te);if(B>0)for(const he of L){if(B<=0)break;const ue=F.get(he)??0,xe=V[he]-ue;if(xe<=0)continue;const Ne=Math.min(xe,B);V[he]-=Ne,B-=Ne}const ae=L.some(he=>($.categoryPools[he]??0)!==V[he])||Object.keys($.categoryPools).some(he=>!L.includes(he)),le=$.purchased.size!==D.size||Array.from($.purchased).some(he=>!D.has(he));return!ae&&!le?$:{categoryPools:V,purchased:D}},[n,r,g]);v.useEffect(()=>{const $=xf(b,r,t);w(j($))},[t,r,j,b]),v.useEffect(()=>{w($=>j($))},[j]),v.useEffect(()=>{FE(b,_)},[_,b]);const A=v.useMemo(()=>Oo(_.purchased,n),[n,_.purchased]),R=v.useMemo(()=>Array.from(A.values()).reduce(($,L)=>$+L,0),[A]),S=v.useMemo(()=>r.reduce(($,L)=>$+(_.categoryPools[L.key]??0),0),[r,_.categoryPools]),k=Math.max(0,g-S),N=Math.max(0,g-R),E=v.useMemo(()=>{const $=new Map;return r.forEach(L=>{const D=_.categoryPools[L.key]??0,F=A.get(L.key)??0;$.set(L.key,Math.max(0,D-F))}),$},[r,A,_.categoryPools]),M=p?_.categoryPools[p.key]??0:0,O=p?E.get(p.key)??0:0,X=Math.max(0,M-O),re=$=>{const L=mb($);w(D=>{if(D.purchased.has($.id))return D;const F=Oo(D.purchased,n);if((D.categoryPools[L]??0)-(F.get(L)??0)<$.mpCost)return D;const Q=new Set(D.purchased);return Q.add($.id),{...D,purchased:Q}})},I=($,L)=>{w(D=>{const F=new Set(Array.from(D.purchased).filter(Ne=>n.has(Ne))),q=Oo(F,n),V=Array.from(q.values()).reduce((Ne,je)=>Ne+je,0),Q=Math.max(g,V),te=r.map(Ne=>Ne.key),B={};te.forEach(Ne=>{const je=q.get(Ne)??0,Ce=D.categoryPools[Ne]??0;B[Ne]=Math.max(je,Number.isFinite(Ce)?Math.floor(Ce):0)});const ae=q.get($)??0,le=Math.max(ae,Number.isFinite(L)?Math.floor(L):0),he=te.reduce((Ne,je)=>je===$?Ne:Ne+B[je],0),ue=Q-he,xe=Math.max(ae,Math.min(le,ue));return B[$]===xe?D:{categoryPools:{...B,[$]:xe},purchased:F}})};return i?d?a.jsx("p",{className:"body muted",children:"Loading character..."}):c?a.jsx("p",{className:"martial-page__error body",children:c}):o?a.jsxs("div",{className:"martial-page",children:[a.jsxs("header",{className:"martial-page__header",children:[a.jsxs("div",{className:"martial-page__header-text",children:[a.jsx("h1",{className:"martial-page__title h1",children:"Martial Prowess"}),a.jsxs("p",{className:"martial-page__subtitle subtitle muted",children:["Character: ",o.name]}),a.jsx("p",{className:"martial-page__hint caption muted",children:"Assign MP to a category, then buy abilities from that category's pool."})]}),a.jsxs("div",{className:"martial-page__summary",children:[a.jsxs("div",{className:"martial-page__stat-card",children:[a.jsx("span",{className:"martial-page__stat-label",children:"Martial Prowess MP"}),a.jsx("div",{className:"martial-page__stat-value",children:g}),a.jsx("span",{className:"martial-page__stat-note",children:"Linked to the Martial Prowess skill on the Characters page."})]}),a.jsxs("div",{className:"martial-page__stat-card martial-page__stat-card--accent",children:[a.jsx("div",{className:"martial-page__stat-title",children:"Unassigned MP"}),a.jsx("div",{className:"martial-page__stat-value martial-page__stat-value--large",children:k}),a.jsx("div",{className:"martial-page__stat-note",children:"Allocate MP to categories before purchasing."})]}),a.jsxs("div",{className:"martial-page__stat-card martial-page__stat-card--accent",children:[a.jsx("div",{className:"martial-page__stat-title",children:"MP Remaining"}),a.jsx("div",{className:"martial-page__stat-value martial-page__stat-value--large",children:N})]})]})]}),a.jsxs("div",{className:"martial-page__layout",children:[a.jsxs("aside",{className:"martial-page__sidebar",children:[a.jsxs("div",{className:"martial-page__sidebar-header",children:[a.jsx("div",{className:"martial-page__sidebar-title h3",children:"Categories"}),a.jsxs("div",{className:"martial-page__sidebar-count",children:[r.length," total"]})]}),["Weapon","Armor"].map($=>{const L=f.get($)??[];return L.length===0?null:a.jsxs("div",{className:"martial-page__kind",children:[a.jsx("div",{className:"martial-page__kind-label",children:$}),a.jsx("div",{className:"martial-page__kind-list",children:L.map(D=>{const F=D.abilities.filter(B=>_.purchased.has(B.id)).length,q=m===D.key,V=_.categoryPools[D.key]??0,Q=E.get(D.key)??0,te=Math.max(0,V-Q);return a.jsxs("button",{onClick:()=>y(D.key),className:`martial-page__category${q?" martial-page__category--active":""}`,children:[a.jsxs("div",{className:"martial-page__category-info",children:[a.jsx("div",{className:"martial-page__category-name",children:D.category}),a.jsxs("div",{className:"martial-page__category-meta",children:[D.abilities.length," abilities"]})]}),a.jsxs("div",{className:"martial-page__category-stats",children:[a.jsxs("div",{className:"martial-page__owned",children:[F," owned"]}),a.jsxs("div",{className:"martial-page__category-detail",children:[a.jsxs("div",{children:[V," MP allocated"]}),a.jsxs("div",{className:Q>0?"martial-page__remaining--ok":"martial-page__remaining--low",children:[Q," MP left (",te," spent)"]})]})]})]},D.key)})})]},$)})]}),a.jsx("main",{className:"martial-page__main",children:p?a.jsxs("section",{className:"martial-page__detail",children:[a.jsxs("div",{className:"martial-page__detail-header",children:[a.jsxs("div",{className:"martial-page__detail-info",children:[a.jsxs("div",{className:"martial-page__detail-title",children:[a.jsx("h2",{className:"martial-page__detail-name h2",children:p.category}),a.jsx("span",{className:"martial-page__detail-kind",children:p.kind})]}),a.jsx("span",{className:"martial-page__detail-hint body muted",children:"Allocate MP to this discipline, then spend that pool on the abilities you want to master."}),a.jsxs("label",{className:"martial-page__allocation",children:[a.jsx("div",{className:"martial-page__allocation-title h3",children:"Category MP Allocation"}),a.jsx("input",{type:"number",value:M,min:X,max:Math.max(M+k,X),onChange:$=>I(p.key,Number($.target.value)||0),onWheel:$=>$.preventDefault(),className:"martial-page__allocation-input"}),a.jsxs("div",{className:"martial-page__allocation-note caption muted",children:["Requires at least ",X," MP to cover purchased abilities."]})]})]}),a.jsxs("div",{className:"martial-page__detail-stats",children:[a.jsx(pa,{label:"Abilities",value:`${p.abilities.length}`}),a.jsx(pa,{label:"Purchased",value:`${p.abilities.filter($=>_.purchased.has($.id)).length}`}),a.jsx(pa,{label:"Allocated",value:`${M}`}),a.jsx(pa,{label:"Category Remaining",value:`${O}`})]})]}),a.jsx("div",{className:"martial-page__ability-grid",children:p.abilities.map($=>{const L=_.purchased.has($.id);return a.jsx(qE,{ability:$,purchased:L,remainingMp:O,onPurchase:re},$.id)})})]}):a.jsx("div",{className:"martial-page__empty",children:"Choose a category on the left to view its abilities."})})]})]}):a.jsx("p",{className:"body",children:"Selected character could not be found."}):a.jsx("p",{className:"body",children:"Please select a character on the Characters page to view martial prowess."})},wf=(e,t)=>{if(typeof window>"u"||!e)return{purchased:new Set,backgroundPicks:new Set,ancillaryPicks:{},lockedAncillaries:new Set};try{const n=window.localStorage.getItem(e);if(!n)return{purchased:new Set,backgroundPicks:new Set,ancillaryPicks:{},lockedAncillaries:new Set};const s=JSON.parse(n),r=Array.isArray(s.purchased)?s.purchased.filter(c=>t.has(c)):[],i=Array.isArray(s.backgroundPicks)?s.backgroundPicks.filter(c=>t.has(c)):[],o={};Object.entries(s.ancillaryPicks??{}).forEach(([c,u])=>{const d=Array.isArray(u)?u.filter(h=>t.has(h)):[];d.length>0&&(o[c]=d)});const l=Array.isArray(s.lockedAncillaries)?s.lockedAncillaries.filter(c=>pb.has(c)):[];return{purchased:new Set(r),backgroundPicks:new Set(i),ancillaryPicks:o,lockedAncillaries:new Set(l)}}catch(n){return console.warn("Unable to parse psionics state",n),{purchased:new Set,backgroundPicks:new Set,ancillaryPicks:{},lockedAncillaries:new Set}}},WE=(e,t)=>{if(!(typeof window>"u"||!e))try{const n=JSON.stringify({purchased:Array.from(t.purchased),backgroundPicks:Array.from(t.backgroundPicks),ancillaryPicks:t.ancillaryPicks,lockedAncillaries:Array.from(t.lockedAncillaries)});window.localStorage.setItem(e,n)}catch(n){console.warn("Unable to persist psionics state",n)}},zE=(e,t)=>{var s;const n=new Map;for(const r of e)n.has(r.tier)||n.set(r.tier,[]),n.get(r.tier).push(r);for(const[r,i]of n.entries()){const o=(s=t==null?void 0:t.tierOrder)==null?void 0:s[r];if(o!=null&&o.length){const l=[];o.forEach(c=>{const u=i.find(d=>d.name===c);u&&l.push(u)}),i.filter(c=>!l.includes(c)).sort((c,u)=>c.name.localeCompare(u.name)).forEach(c=>l.push(c)),n.set(r,l)}else i.sort((l,c)=>l.name.localeCompare(c.name)),n.set(r,i)}return n},HE=(e,t,n,s)=>{var o,l;const r=new Set;(o=s==null?void 0:s.blockedEdges)==null||o.forEach(({from:c,to:u})=>r.add(`${c}->${u}`));const i=[];for(const c of e)c.prerequisiteIds.forEach(u=>{const d=t.get(u);if(!d)return;const h=`${d.name}->${c.name}`;r.has(h)||i.push({fromId:d.id,toId:c.id})});return(l=s==null?void 0:s.extraEdges)==null||l.forEach(({from:c,to:u})=>{const d=n.get(c),h=n.get(u);!d||!h||i.push({fromId:d.id,toId:h.id})}),i},YE={Telepathy:{tierOrder:{2:["Pry","Sense Presence","Interfere","Interconnect","Communicate"],3:["Higher Conscious","Read Memory","Interlink"],4:["Read Genome"],5:["Read Link"]},extraEdges:[{from:"Telepathy",to:"Interconnect"},{from:"Read Memory",to:"Read Genome"},{from:"Read Genome",to:"Read Link"}],blockedEdges:[{from:"Read Memory",to:"Read Link"},{from:"Read Link",to:"Read Genome"}]}},Id={"fledgling-psion":{tier:1,grantsManifoldBonus:!0},"advanced-psion":{tier:2,energyCostOverride:1},"heroic-psion":{tier:3,energyCostOverride:1},"epic-psion":{tier:4,energyCostOverride:1},"legendary-psion":{tier:5,energyCostOverride:1},"mythic-psion":{tier:5,energyCostOverride:1}},kf=["fledgling-psion","advanced-psion","heroic-psion","epic-psion","legendary-psion","mythic-psion"],pb=new Set(Object.keys(Id)),cu={"fledgling-psion":"Fledgling Psion","advanced-psion":"Advanced Psion","heroic-psion":"Heroic Psion","epic-psion":"Epic Psion","legendary-psion":"Legendary Psion","mythic-psion":"Mythic Psion"},VE=({ability:e,purchased:t,unlocked:n,isStarter:s,remainingPsi:r,canSpend:i,spendLockReason:o,onPurchase:l,buttonRef:c})=>{const u=e.tier,d=r>=u,h=!i&&(n||s),m=t?"purchased":h?"locked-window":n?d?"available":"locked-cost":s?d?"starter":"starter-cost":"locked",y=t||!n&&!s||!d||h;return a.jsxs("button",{ref:c,onClick:()=>l(e),disabled:y,title:t?"Already purchased":h?o:n?d?"Purchase ability":"Not enough Psi":s?"Spend Psi to unlock this tree":"Locked",className:`psionics__node psionics__node--${m}${t?" psionics__node--glow":""}`,children:[a.jsx("div",{className:"psionics__node-name",children:e.name}),a.jsxs("div",{className:"psionics__node-tier",children:["Tier ",e.tier]})]})},KE=({treeName:e,tiers:t,lines:n,purchased:s,remainingPsi:r,canSpendPsi:i,spendLockMessage:o,onPurchase:l})=>{const c=v.useRef(null),u=v.useRef(new Map),[d,h]=v.useState([]),[m,y]=v.useState(0),b=v.useCallback(()=>{const O=c.current;if(!O)return;const X=O.getBoundingClientRect(),re=[];n.forEach(({fromId:I,toId:$})=>{const L=u.current.get(I),D=u.current.get($);if(!L||!D)return;const F=L.getBoundingClientRect(),q=D.getBoundingClientRect();re.push({from:{x:F.left-X.left+F.width/2,y:F.top-X.top+F.height/2},to:{x:q.left-X.left+q.width/2,y:q.top-X.top+q.height/2}})}),y(X.height),h(re)},[n]);v.useLayoutEffect(()=>{const O=requestAnimationFrame(b);return()=>cancelAnimationFrame(O)},[b,t]),v.useEffect(()=>{const O=()=>b();return window.addEventListener("resize",O),()=>window.removeEventListener("resize",O)},[b]);const _=Array.from(t.keys()).sort((O,X)=>O-X),w=t.get(1)??[],f=t.get(2)??[],p=_.filter(O=>O>2),g=Math.max(140,80+f.length*14),j=180,A=20,R=130,S=w.length>1?38:0,k=f.length>0?2*Math.PI/f.length:0,N=w.length>0?2*Math.PI/w.length:0,E=v.useMemo(()=>{const O=new Map;let X=Math.max(g,S);return w.forEach((re,I)=>{const $=N*I-Math.PI/2,L=Math.cos($)*S,D=Math.sin($)*S;O.set(re.id,{ability:re,x:L,y:D})}),f.forEach((re,I)=>{const $=k*I-Math.PI/2,L=Math.cos($)*g,D=Math.sin($)*g;O.set(re.id,{ability:re,x:L,y:D})}),p.forEach(re=>{const I=t.get(re)??[],$=g+Array.from({length:re-2}).reduce((F,q,V)=>{const Q=Math.max(R,j-A*V);return F+Q},0);X=Math.max(X,$);const L=I.length>0?2*Math.PI/I.length:0,D=new Map;I.forEach((F,q)=>{const V=F.prerequisiteIds.map(B=>O.get(B)).filter(B=>!!B);let Q=V.length?V.reduce((B,ae)=>B+Math.atan2(ae.y,ae.x),0)/V.length:L*q-Math.PI/2;if(re===3&&V.length){const B=Math.atan2(V[0].y,V[0].x),ae=.3,le=Q-B,he=Math.max(-ae,Math.min(ae,le));Q=B+he}const te=V.length?F.prerequisiteIds[0]:`fallback-${F.id}`;D.has(te)||D.set(te,[]),D.get(te).push({ability:F,baseAngle:Q})}),D.forEach(F=>{F.sort((B,ae)=>B.baseAngle-ae.baseAngle);const Q=Math.min(re===3?.35:.65,Math.max(re===3?.22:.35,Math.PI*.5/Math.max(F.length,2))),te=-((F.length-1)/2)*Q;F.forEach((B,ae)=>{const le=B.baseAngle+te+ae*Q,he=Math.cos(le)*$,ue=Math.sin(le)*$;O.set(B.ability.id,{ability:B.ability,x:he,y:ue})})})}),{positions:Array.from(O.values()),maxRadius:X}},[g,p,N,S,w,f,k,t]),M=Math.max(E.maxRadius*2+180,420);return a.jsxs("div",{ref:c,className:"psionics__tree",children:[a.jsx("svg",{width:"100%",height:m,className:"psionics__tree-lines",children:d.map((O,X)=>a.jsx("line",{x1:O.from.x,y1:O.from.y,x2:O.to.x,y2:O.to.y,stroke:"#345678",strokeWidth:2,strokeLinecap:"round",opacity:.7},`${e}-line-${X}`))}),a.jsx("div",{className:"psionics__tree-body",children:a.jsx("div",{className:"psionics__tree-orbit",style:{minHeight:M},children:E.positions.map(({ability:O,x:X,y:re})=>{const I=Sd(O,s,{allowTier1WithoutPrereq:!1}),$=s.has(O.id),L=O.tier===1&&O.prerequisiteIds.length===0;return a.jsx("div",{className:"psionics__node-wrap",style:{left:`calc(50% + ${X}px)`,top:`calc(50% + ${re}px)`},children:a.jsx(VE,{ability:O,purchased:$,unlocked:I,isStarter:L,remainingPsi:r,canSpend:i,spendLockReason:o,onPurchase:l,buttonRef:D=>{D&&u.current.set(O.id,D)}})},O.id)})})})]})},GE=()=>{var Fe,z,de,U;const[e,t]=v.useState([]),[n,s]=v.useState(null),[r,i]=v.useState(!0),o=v.useMemo(()=>new Set(e.map(P=>P.id)),[e]),l=v.useMemo(()=>new Map(e.map(P=>[P.id,P.tier])),[e]),c=v.useMemo(()=>new Map(e.map(P=>[P.id,P])),[e]),u=v.useMemo(()=>new Map(e.map(P=>[`${P.tree}:${P.name}`,P.id])),[e]),{selectedId:d}=Is(),[h,m]=v.useState(()=>ba(d)),[y,b]=v.useState(null),[_,w]=v.useState(null),[f,p]=v.useState(!1),[g,j]=v.useState(!1),[A,R]=v.useState({}),[S,k]=v.useState([]),[N,E]=v.useState(null);v.useEffect(()=>{let P=!0;return i(!0),s(null),Ct.listPsionicAbilities().then(H=>{if(!P)return;const Z=nb(H.map(ie=>({tree:ie.ability_tree,name:ie.ability,tier:ie.tier??0,prerequisite:ie.prerequisite??null,description:ie.description??"",energyCost:ie.energy_cost??0,formula:null})));t(Z)}).catch(H=>{if(!P)return;const Z=H instanceof Error?H.message:"Failed to load psionic abilities.";s(Z)}).finally(()=>{P&&i(!1)}),()=>{P=!1}},[]);const M=v.useMemo(()=>d?`${tm}:${d}`:null,[d]),O=v.useMemo(()=>{var ie;const P=((ie=y==null?void 0:y.backgrounds)==null?void 0:ie.adulthood)??[],H=new Set;let Z=0;return P.forEach(ee=>{const G=ee.trim().toLowerCase(),Y=sb[G];Y&&(Z+=Y.psiBonus,Y.granted.forEach(({tree:J,name:Ae})=>{const $e=u.get(`${J}:${Ae}`);$e&&H.add($e)}))}),{psiBonus:Z,grantedIds:Array.from(H)}},[u,(Fe=y==null?void 0:y.backgrounds)==null?void 0:Fe.adulthood]),X=v.useMemo(()=>new Set(h.selected.filter(H=>pb.has(H))),[h.selected]),re=v.useMemo(()=>Array.from(X).sort((P,H)=>kf.indexOf(P)-kf.indexOf(H)),[X]),{data:I}=As(),$=(I==null?void 0:I.raceDetails)??{},L=v.useMemo(()=>{const P=H=>{var Z,ie;return H?((ie=(Z=$[H])==null?void 0:Z.disciplines)==null?void 0:ie.psiPoints)??0:0};return P(y==null?void 0:y.raceKey)+P(y==null?void 0:y.subraceKey)},[$,y==null?void 0:y.raceKey,y==null?void 0:y.subraceKey]),[D,F]=v.useState(()=>wf(M,o)),q=D.ancillaryPicks??{},V=D.lockedAncillaries??new Set,Q=v.useMemo(()=>Sr(d),[d]),te=v.useCallback((P,H)=>{if(P!=="mythic-psion")return new Set(H);const Z=new Set,ie=ee=>{if(Z.has(ee))return;Z.add(ee);const G=c.get(ee);G==null||G.prerequisiteIds.forEach(Y=>ie(Y))};return H.forEach(ie),Z},[c]),B=v.useMemo(()=>{const P=new Map;return Object.entries(q).forEach(([H,Z])=>{P.set(H,te(H,Z))}),P},[q,te]);v.useEffect(()=>{const P=wf(M,o),H=new Set([...P.backgroundPicks,...O.grantedIds]);Object.entries(P.ancillaryPicks).forEach(([ie,ee])=>{te(ie,ee).forEach(G=>H.add(G))});const Z=new Set(P.purchased);H.forEach(ie=>Z.delete(ie)),F({purchased:Z,backgroundPicks:P.backgroundPicks,ancillaryPicks:P.ancillaryPicks,lockedAncillaries:P.lockedAncillaries})},[o,O.grantedIds,te,M]),v.useEffect(()=>{WE(M,D)},[D,M]),v.useEffect(()=>{F(P=>{const H={};let Z=!1;const ie=new Set(Array.from(P.lockedAncillaries).filter(ee=>X.has(ee)));return X.forEach(ee=>{const G=P.ancillaryPicks[ee]??[],Y=G.filter(J=>o.has(J));(Y.length!==G.length||!(ee in P.ancillaryPicks))&&(Z=!0),H[ee]=Y}),Object.keys(P.ancillaryPicks).forEach(ee=>{X.has(ee)||(Z=!0)}),ie.size!==P.lockedAncillaries.size&&(Z=!0),Z?{...P,ancillaryPicks:H,lockedAncillaries:ie}:P})},[o,X]),v.useEffect(()=>{if(b(null),m(ba(d)),!d){w("Select a character on the Characters page to manage psionics."),p(!1);return}w(null),p(!0),Ct.listCharacters().then(P=>{const H=P.find(Z=>Z.id===d)??null;b(H),H||w("Selected character not found. Choose one on the Characters page.")}).catch(P=>{const H=P instanceof Error?P.message:"Failed to load character.";w(H)}).finally(()=>p(!1))},[d]),v.useEffect(()=>{F(P=>{const H=new Set(P.lockedAncillaries);return re.forEach((Z,ie)=>{var G;ie<re.length-1&&(((G=P.ancillaryPicks[Z])==null?void 0:G.length)??0)>0&&H.add(Z)}),H.size===P.lockedAncillaries.size?P:{...P,lockedAncillaries:H}})},[re]),v.useEffect(()=>{const P=H=>{H.key===Q&&m(ba(d))};return typeof window<"u"&&window.addEventListener("storage",P),()=>{typeof window<"u"&&window.removeEventListener("storage",P)}},[Q,d]);const ae=((z=y==null?void 0:y.attributes)==null?void 0:z.MENTAL)??0,le=(y==null?void 0:y.level)??1,he=3+ae,ue=Math.max(0,le-1)*he,xe=yS+O.psiBonus+L+ue,Ne=X.has("fledgling-psion")&&(((de=q["fledgling-psion"])==null?void 0:de.length)??0)>0,je=ae+(Ne?ae:0),Ce=le===1||le>=6&&(le-1)%5===0,Me=(Math.floor(Math.max(0,le-1)/5)+1)*5+1,oe=Ce?"":`Psi can only be spent during Character Tier Advancements. Next window opens at level ${Math.max(6,Me)}.`,pe=v.useMemo(()=>Array.from(D.purchased).reduce((P,H)=>P+(l.get(H)??0),0),[l,D.purchased]),ve=Math.max(0,xe-pe),be=v.useMemo(()=>{const P=new Set(D.backgroundPicks);return O.grantedIds.forEach(H=>P.add(H)),B.forEach(H=>H.forEach(Z=>P.add(Z))),D.purchased.forEach(H=>P.add(H)),P},[B,O.grantedIds,D.backgroundPicks,D.purchased]),ke=v.useMemo(()=>{const P=new Map,H=new Map;e.forEach(ie=>{P.has(ie.tree)||(P.set(ie.tree,[]),H.set(ie.tree,new Map)),P.get(ie.tree).push(ie),H.get(ie.tree).set(ie.name,ie)});const Z=new Map;return P.forEach((ie,ee)=>{const G=YE[ee],Y=zE(ie,G),J=H.get(ee),Ae=HE(ie,c,J,G);Z.set(ee,{tiers:Y,lines:Ae})}),Z},[e,c]),Ie=v.useMemo(()=>{const P=new Map;return e.forEach(H=>{be.has(H.id)&&(P.has(H.tree)||P.set(H.tree,[]),P.get(H.tree).push(H))}),P.forEach(H=>{H.sort((Z,ie)=>Z.tier===ie.tier?Z.name.localeCompare(ie.name):Z.tier-ie.tier)}),P},[e,be]),Be=v.useMemo(()=>{const P=new Map;return B.forEach((H,Z)=>{var ee;const ie=(ee=Id[Z])==null?void 0:ee.energyCostOverride;ie&&H.forEach(G=>P.set(G,ie))}),P},[B]),_e=v.useCallback(P=>{const H=(P??re).filter(ie=>!V.has(ie));if(H.length===0)return;const Z={};re.forEach(ie=>{const ee=q[ie]??[],G=V.has(ie)?ee.length:Math.max(ae,0);Z[ie]=new Set(ee.slice(0,G))}),k(H),E(H[0]),R(Z),j(!0)},[q,V,ae,re]),He=v.useCallback(()=>{j(!1),E(null),k([]),R({})},[]),De=!!((U=h.flags)!=null&&U.psionicsLockRequested),ne=v.useCallback(()=>{m(P=>{var Z;if(!((Z=P.flags)!=null&&Z.psionicsLockRequested))return P;const H={...P,flags:{...P.flags,psionicsLockRequested:!1}};return Cd(d,H),H})},[d]);v.useEffect(()=>{!De||re.length===0||(ne(),_e())},[ne,re.length,De,_e]);const me=(P,H)=>{!X.has(P)||P!==N||R(Z=>{const ie={...Z},ee=new Set(ie[P]??[]),G=Object.entries(Z).some(([Y,J])=>Y!==P&&(J==null?void 0:J.has(H)));if(ee.has(H))ee.delete(H);else{if(ae<=0||ee.size>=ae||G)return Z;ee.add(H)}return ie[P]=ee,ie})},we=()=>{if(!N)return;const P=A[N]??new Set(q[N]??[]);F(Z=>{const ie={...Z.ancillaryPicks,[N]:Array.from(P)},ee=new Set(Z.lockedAncillaries);return ee.add(N),{...Z,ancillaryPicks:ie,lockedAncillaries:ee}}),R(Z=>{const ie={...Z};return delete ie[N],ie});const[,...H]=S;H.length===0?He():(k(H),E(H[0]))},Ye=P=>{F(H=>{if(!Ce)return H;const Z=new Set([...H.backgroundPicks,...O.grantedIds,...H.purchased]);if(Object.entries(H.ancillaryPicks).forEach(([Ae,$e])=>{te(Ae,$e).forEach(Ue=>Z.add(Ue))}),Z.has(P.id)||!(P.tier===1&&P.prerequisiteIds.length===0)&&!Sd(P,Z,{allowTier1WithoutPrereq:!1}))return H;const ee=P.tier,G=Array.from(H.purchased).reduce((Ae,$e)=>Ae+(l.get($e)??0),0);if(xe-G<ee)return H;const J=new Set(H.purchased);return J.add(P.id),{...H,purchased:J}})};return d?f?a.jsx("p",{className:"psionics__status",children:"Loading character..."}):_?a.jsx("p",{className:"psionics__error",children:_}):y?r?a.jsx("p",{className:"psionics__status",children:"Loading psionic abilities..."}):n?a.jsx("p",{className:"psionics__error",children:n}):e.length===0?a.jsx("p",{className:"psionics__status",children:"No psionic abilities are available yet."}):a.jsxs(a.Fragment,{children:[g&&a.jsx("div",{className:"psionics__modal",children:a.jsxs("div",{className:"psionics__modal-card",children:[a.jsxs("div",{className:"psionics__modal-header",children:[a.jsx("h3",{className:"psionics__modal-title",children:"Lock Psion Ancillaries"}),a.jsx("button",{onClick:He,className:"psionics__modal-close",children:"Close"})]}),a.jsxs("p",{className:"psionics__modal-intro",children:["Choose up to ",ae," abilities from the current ancillary's tier. Abilities already unlocked elsewhere are not eligible. Once confirmed, selections are locked before moving to the next ancillary."]}),a.jsx("div",{className:"psionics__modal-body",children:N?(()=>{const P=N,H=Id[P],Z=A[P]??new Set(q[P]??[]),ie=Ue=>Object.entries(A).some(([W,fe])=>W!==P&&(fe==null?void 0:fe.has(Ue))),ee=B.get(P)??new Set,G=new Set(be);ee.forEach(Ue=>G.delete(Ue));const Y=e.filter(Ue=>!(Ue.tier!==H.tier||G.has(Ue.id)&&!Z.has(Ue.id)||P!=="mythic-psion"&&!Sd(Ue,G))),J=ae<=0?"Mental Attribute must be above 0":"",Ae=H.energyCostOverride?"Chosen abilities cost 1 Energy.":H.grantsManifoldBonus?"Adds your Mental attribute to Manifold Manifestation.":"",$e=S.slice(1);return a.jsxs("div",{className:"psionics__modal-section",children:[a.jsxs("div",{className:"psionics__modal-section-header",children:[a.jsxs("div",{children:[a.jsx("div",{className:"psionics__modal-section-title",children:cu[P]??P}),a.jsxs("div",{className:"psionics__modal-section-subtitle",children:["Tier ",H.tier," abilities  ",Ae]}),$e.length>0?a.jsxs("div",{className:"psionics__modal-section-next",children:["Next: ",$e.map(Ue=>cu[Ue]??Ue).join(", ")]}):null]}),a.jsxs("div",{className:"psionics__modal-section-count",children:["Selected: ",Z.size,"/",Math.max(ae,0)]})]}),a.jsxs("div",{className:"psionics__modal-options",children:[Y.length===0&&a.jsx("div",{className:"psionics__modal-empty",children:"No abilities available for this tier."}),Y.map(Ue=>{const W=Z.has(Ue.id),fe=!W&&(G.has(Ue.id)||ie(Ue.id))||ae<=0;return a.jsxs("label",{className:`psionics__modal-option${W?" psionics__modal-option--chosen":""}`,style:{opacity:fe?.6:1},children:[a.jsx("input",{type:"checkbox",checked:W,disabled:fe,onChange:()=>me(P,Ue.id),className:"psionics__modal-checkbox"}),a.jsxs("div",{className:"psionics__modal-option-body",children:[a.jsx("div",{className:"psionics__modal-option-title",children:Ue.name}),a.jsxs("div",{className:"psionics__modal-option-subtitle",children:[Ue.tree,"  Tier ",Ue.tier]}),ee.has(Ue.id)?a.jsx("div",{className:"psionics__modal-option-status psionics__modal-option-status--unlocked",children:"Unlocked"}):null,ie(Ue.id)?a.jsx("div",{className:"psionics__modal-option-status psionics__modal-option-status--locked",children:"Chosen for another ancillary."}):null]})]},`${P}-${Ue.id}`)})]}),J&&a.jsx("div",{className:"psionics__modal-warning",children:J}),a.jsxs("div",{className:"psionics__modal-actions",children:[a.jsx("button",{onClick:()=>R(Ue=>({...Ue,[P]:new Set})),className:"psionics__modal-button",children:"Clear"}),a.jsx("button",{onClick:we,disabled:Z.size===0||Z.size>ae||ae<=0,className:"psionics__modal-button psionics__modal-button--primary",children:$e.length>0?"Confirm & Next":"Confirm"})]})]},`ancillary-${P}`)})():a.jsx("div",{className:"psionics__modal-empty",children:"No pending psion ancillaries to configure."})})]})}),a.jsxs("div",{className:"psionics",children:[a.jsxs("header",{className:"psionics__header",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"psionics__title h1",children:"Psionics"}),a.jsxs("p",{className:"psionics__subtitle subtitle muted",children:["Character: ",y.name]})]}),a.jsxs("div",{className:"psionics__metrics",children:[a.jsxs("div",{className:"psionics__metric",children:[a.jsx("span",{className:"psionics__metric-label",children:"Mental Attribute"}),a.jsx("div",{className:"psionics__metric-value",children:ae}),a.jsx("div",{className:"psionics__metric-hint",children:"Used for formulas and per-level gains"})]}),a.jsxs("div",{className:"psionics__metric",children:[a.jsx("span",{className:"psionics__metric-label",children:"Manifold Manifestation Limit"}),a.jsx("div",{className:"psionics__metric-value",children:je}),a.jsxs("div",{className:"psionics__metric-hint",children:["Base Mental: ",ae,Ne?` + ${ae} from Fledgling Psion`:""]})]}),a.jsxs("div",{className:"psionics__metric",children:[a.jsx("div",{className:"psionics__metric-label",children:"Psi Points Earned"}),a.jsx("div",{className:"psionics__metric-value psionics__metric-value--accent",children:xe}),a.jsxs("div",{className:"psionics__metric-hint",children:[L>0&&a.jsxs("span",{children:["Lineage: ",L,". "]}),"Backgrounds: ",O.psiBonus,". Per level: ",he,"  ",Math.max(0,le-1)," = ",ue]})]}),a.jsxs("div",{className:`psionics__metric${Ce?"":" psionics__metric--locked"}`,children:[a.jsx("div",{className:`psionics__metric-label${Ce?"":" psionics__metric-label--warn"}`,children:"Spending Window"}),a.jsx("div",{className:"psionics__metric-value psionics__metric-value--compact",children:Ce?"Open":`Locked until level ${Math.max(6,Me)}`}),a.jsx("div",{className:"psionics__metric-hint",children:"Psi can only be spent during Character Tier Advancements (every 5 levels)."})]}),a.jsxs("div",{className:"psionics__metric",children:[a.jsx("div",{className:"psionics__metric-label",children:"Psion Ancillaries"}),a.jsx("div",{className:"psionics__metric-text",children:re.length?re.map(P=>cu[P]??P).join(", "):"None selected"}),a.jsxs("div",{className:"psionics__ancillary-actions",children:[a.jsx("button",{onClick:_e,disabled:re.length===0,className:"psionics__ancillary-modal-button",children:"Lock Psion Ancillaries"}),a.jsx("span",{className:"psionics__ancillary-hint",children:ae>0?`Select up to ${ae} tier-matched abilities per ancillary.`:"Mental Attribute is required to lock picks."})]})]}),a.jsxs("div",{className:"psionics__metric psionics__metric--center",children:[a.jsx("div",{className:"psionics__metric-label",children:"Psi Points Remaining"}),a.jsx("div",{className:"psionics__metric-value psionics__metric-value--large",children:ve})]})]})]}),a.jsx("div",{className:"psionics__content",children:Array.from(ke.entries()).map(([P,H])=>a.jsxs("section",{className:"psionics__tree-section",children:[a.jsx("h2",{className:"psionics__tree-title h2",children:P}),a.jsx(KE,{treeName:P,tiers:H.tiers,lines:H.lines,purchased:be,remainingPsi:ve,canSpendPsi:Ce,spendLockMessage:oe,onPurchase:Ye})]},P))}),a.jsxs("section",{className:"psionics__unlocked",children:[a.jsx("h2",{className:"psionics__tree-title h2",children:"Unlocked Abilities"}),Array.from(Ie.entries()).length===0?a.jsx("p",{className:"psionics__empty",children:"No abilities unlocked yet."}):a.jsx("div",{className:"psionics__unlocked-list",children:Array.from(Ie.entries()).map(([P,H])=>a.jsxs("div",{className:"psionics__unlocked-group",children:[a.jsx("h3",{className:"psionics__unlocked-title h3",children:P}),a.jsx("div",{className:"psionics__unlocked-items",children:H.map(Z=>{const ie=Z.formula?vS(Z.formula,ae):null,ee=Ed(Z.description,ae);return a.jsxs("div",{className:"psionics__unlocked-card",children:[a.jsxs("div",{className:"psionics__unlocked-header",children:[a.jsxs("div",{children:[a.jsx("div",{className:"psionics__unlocked-name",children:Z.name}),a.jsxs("div",{className:"psionics__unlocked-tier",children:["Tier ",Z.tier]})]}),a.jsxs("div",{className:"psionics__badge-row",children:[a.jsxs("span",{className:"psionics__badge psionics__badge--success",children:[Z.tier," Psi"]}),a.jsx("span",{className:"psionics__badge",children:(()=>{const G=Be.get(Z.id),Y=G??Z.energyCost;return G?`Energy: ${Y} (ancillary)`:`Energy: ${Y}`})()})]})]}),a.jsx("p",{className:"psionics__unlocked-description",children:ee}),a.jsxs("div",{className:"psionics__unlocked-effects",children:[a.jsx("strong",{children:"Prerequisites:"})," ",Z.prerequisiteNames.length?Z.prerequisiteNames.join(", "):"None"]}),Z.formula&&a.jsxs("div",{className:"psionics__unlocked-formula",children:[a.jsx("strong",{children:"Formula:"})," ",Z.formula.replace(/\*/g,"  "),ie!==null&&` = ${ie}`]})]},`unlocked-${P}-${Z.id}`)})})]},`unlocked-${P}`))})]})]})]}):a.jsx("p",{className:"psionics__status",children:"Selected character could not be found."}):a.jsx("p",{className:"psionics__status",children:"Please select a character on the Characters page to view psionics."})},Nf=e=>e.trim().toLowerCase(),$o={Basic:30,Advanced:60},sl=[{tier:1,cost:1},{tier:2,cost:9},{tier:3,cost:27},{tier:4,cost:57},{tier:5,cost:99},{tier:6,cost:153}],fb={Intensity:["Physical Mod x3","Physical Mod x5","Physical Mod x10","Physical Mod x25","Physical Mod x100","Physical Mod x200"],Area:["5 ft","Physical Mod x5 ft","Physical Mod x10 ft","Physical Mod x100 ft","Physical Mod x0.10 miles","Physical Mod Miles"],Range:["Physical Mod x5 ft","Physical Mod x10 ft","Physical Mod x100 ft","Physical Mod Miles","Physical Mod x10 Miles","Physical Mod x100 Miles"],Duration:["1 Round","Physical Mod Rounds","Physical Mod Minutes","Physical Mod Hours","Physical Mod Phases","Physical Mod Cycles"],Origins:["1","2","3","4","5","6"],Compound:["1","2","3","4","5","6"]},Bo=Object.keys(fb),jf=e=>{var t;return((t=sl.find(n=>n.tier===e))==null?void 0:t.cost)??0},Sf=({title:e,children:t})=>a.jsxs("div",{className:"magic-faculties__detail",children:[a.jsx("h3",{className:"magic-faculties__detail-title",children:e}),t]}),JE=({tier:e,defaultOpen:t})=>a.jsxs("details",{open:t,className:"magic-faculties__tier",children:[a.jsx("summary",{className:"magic-faculties__tier-summary",children:e.label}),a.jsx("div",{className:"magic-faculties__tier-content",children:e.content||"No details provided."})]}),QE=({faculty:e,unlocked:t,onToggle:n,canAfford:s,disabled:r,cost:i})=>{const o=t?"unlocked":s?"available":"blocked";return a.jsxs("div",{className:"card stack magic-faculties__card",children:[a.jsxs("div",{className:"cluster magic-faculties__card-header",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"magic-faculties__card-title",children:e.name}),a.jsxs("div",{className:"magic-faculties__card-subtitle",children:[e.category," Faculty  ",i," Ildakar points to unlock"]})]}),a.jsxs("div",{className:"cluster magic-faculties__card-actions",children:[a.jsx("span",{className:`magic-faculties__badge ${e.category==="Basic"?"magic-faculties__badge--basic":"magic-faculties__badge--advanced"}`,children:e.category}),a.jsx("button",{onClick:n,disabled:r||!t&&!s,className:`btn magic-faculties__toggle magic-faculties__toggle--${o}`,title:t?"Remove this Faculty":s?"Unlock this Faculty":"Not enough Ildakar points",children:t?"Remove":s?"Unlock":"Insufficient"})]})]}),e.intro&&a.jsx(Sf,{title:"Overview",children:a.jsx("div",{className:"magic-faculties__body",children:e.intro})}),e.tiers.length>0?a.jsx(Sf,{title:"Tiers",children:e.tiers.map((l,c)=>a.jsx(JE,{tier:l,defaultOpen:c===0},l.label+c))}):a.jsx("div",{className:"magic-faculties__warning",children:"No tier details were found for this faculty in the uploaded text."})]})},XE=()=>{var re;const e=v.useMemo(()=>nm(am),[]),t=e.filter(I=>I.category==="Basic"),n=e.filter(I=>I.category==="Advanced"),{selectedId:s}=Is(),[r,i]=v.useState([]),[o,l]=v.useState(null),[c,u]=v.useState(!0),[d,h]=v.useState({}),[m,y]=v.useState(!1),[b,_]=v.useState(new Set),[w,f]=v.useState(()=>{const I={};return Bo.forEach($=>{I[$]=1}),I});v.useEffect(()=>{let I=!0;return l(null),u(!0),Ct.listCharacters().then($=>{I&&i(Array.isArray($)?$:[])}).catch($=>{if(!I)return;const L=$ instanceof Error?$.message:"Failed to load characters";l(L)}).finally(()=>{I&&u(!1)}),()=>{I=!1}},[]);const p=v.useMemo(()=>`unlocked_faculties_${s??"unassigned"}`,[s]);v.useEffect(()=>{if(typeof window>"u")return;const I=window.localStorage.getItem(p);if(I)try{const $=JSON.parse(I),L={};e.forEach(D=>{const F=Nf(D.name);($[F]??$[D.name])&&(L[D.name]=!0)}),h(L)}catch{h({})}else h({});y(!0)},[p,e]),v.useEffect(()=>{if(typeof window>"u"||!m)return;const I={};Object.entries(d).forEach(([$,L])=>{L&&(I[$]=!0,I[Nf($)]=!0)}),window.localStorage.setItem(p,JSON.stringify(I))},[p,d,m]),v.useEffect(()=>{const I=()=>{const L=ba(s).selected;_(new Set(L))};I();const $=L=>{L.key===Sr(s)&&I()};return typeof window<"u"&&window.addEventListener("storage",$),()=>{typeof window<"u"&&window.removeEventListener("storage",$)}},[s]);const g=v.useMemo(()=>r.find(I=>I.id===s),[r,s]),j=((re=g==null?void 0:g.skillAllocations)==null?void 0:re.ILDAKAR_FACULTY)??0,A=v.useMemo(()=>{let I=1,$=1,L=1;const D=[];b.has("ildakar-prodigy")&&(I*=.5,D.push("Basic Faculty unlock cost -50% (Ildakar Prodigy)"));const F=q=>{$*=.8,L*=.8,D.push(`${q}: -20% AP & Energy`)};return b.has("ildakar-acolyte")&&F("Ildakar Acolyte"),b.has("ildakar-understudy")&&F("Ildakar Understudy"),b.has("ildakar-theurgist")&&F("Ildakar Theurgist"),b.has("quickcaster")&&($*=.8,D.push("Quickcaster: -20% AP")),b.has("well-of-dakar")&&(L*=.8,D.push("Well of Dakar: -20% Energy cost")),{basicCostMultiplier:I,apMultiplier:$,energyMultiplier:L,modifiers:D}},[b]),R=v.useCallback(I=>{const $=$o[I.category];return I.category==="Basic"?Math.ceil($*A.basicCostMultiplier):$},[A.basicCostMultiplier]),S=v.useMemo(()=>e.reduce((I,$)=>d[$.name]?I+R($):I,0),[R,e,d]),k=Math.max(0,j-S),N=I=>{const $=R(I);!d[I.name]&&k<$||h(L=>({...L,[I.name]:!L[I.name]}))},E=v.useMemo(()=>Bo.reduce((I,$)=>I+jf(w[$]),0),[w]),M=Math.round(E*A.apMultiplier),O=Math.round(E*A.energyMultiplier),X=Math.ceil($o.Basic*A.basicCostMultiplier);return a.jsxs("div",{className:"page magic-faculties",children:[a.jsxs("header",{className:"page__header magic-faculties__header",children:[a.jsx("h1",{className:"magic-faculties__title h1",children:"Magic Faculties"}),a.jsxs("p",{className:"magic-faculties__intro subtitle muted",children:["Faculties are unlocked with Ildakar Faculty points. Basic Faculties cost ",X," points and Advanced Faculties cost ",$o.Advanced,". Aspect investments are additive across all six aspects."]})]}),a.jsxs("main",{className:"page__content",children:[a.jsxs("div",{className:"grid magic-faculties__summary",children:[a.jsxs("div",{className:"panel stack magic-faculties__panel",children:[a.jsx("h2",{className:"magic-faculties__panel-title h2",children:"Ildakar Faculty Points"}),o&&a.jsx("div",{className:"magic-faculties__error",children:o}),c?a.jsx("div",{className:"magic-faculties__muted",children:"Loading characters..."}):g?a.jsxs("div",{className:"magic-faculties__stats",children:[a.jsxs("div",{className:"magic-faculties__stat",children:[a.jsx("div",{className:"magic-faculties__stat-label",children:"Available"}),a.jsx("div",{className:"magic-faculties__stat-value",children:j})]}),a.jsxs("div",{className:"magic-faculties__stat",children:[a.jsx("div",{className:"magic-faculties__stat-label",children:"Spent"}),a.jsx("div",{className:"magic-faculties__stat-value",children:S})]}),a.jsxs("div",{className:"magic-faculties__stat",children:[a.jsx("div",{className:"magic-faculties__stat-label",children:"Remaining"}),a.jsx("div",{className:`magic-faculties__stat-value ${k<0?"magic-faculties__stat-value--danger":"magic-faculties__stat-value--success"}`,children:k})]})]}):a.jsx("div",{className:"magic-faculties__muted",children:"Select a character on the Characters page to sync their Ildakar Faculty points here."})]}),a.jsxs("div",{className:"panel stack magic-faculties__panel",children:[a.jsx("h2",{className:"magic-faculties__panel-title h2",children:"Aspect Cost Scaling"}),a.jsx("p",{className:"magic-faculties__panel-text",children:"AP and Energy costs are additive across all six aspects. Example: one Tier 2 aspect with five Tier 1 aspects costs 14 AP/E; one Tier 3 with five Tier 1 costs 33 AP/E."}),a.jsxs("table",{className:"table magic-faculties__table",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"table__row",children:[a.jsx("th",{className:"table__header magic-faculties__table-header",children:"Tier"}),a.jsx("th",{className:"table__header magic-faculties__table-header",children:"AP & Energy Cost"})]})}),a.jsx("tbody",{children:sl.map(I=>a.jsxs("tr",{className:"table__row",children:[a.jsxs("td",{className:"table__cell magic-faculties__table-cell",children:["Tier ",I.tier]}),a.jsx("td",{className:"table__cell magic-faculties__table-cell",children:I.cost})]},I.tier))})]})]})]}),a.jsxs("div",{className:"grid magic-faculties__grid",children:[a.jsxs("div",{className:"panel stack magic-faculties__panel",children:[a.jsx("h2",{className:"magic-faculties__panel-title h2",children:"Faculty Costs"}),a.jsx("p",{className:"magic-faculties__panel-text",children:"Spend Ildakar Faculty points to unlock a Faculty for the caster."}),a.jsxs("ul",{className:"magic-faculties__list",children:[t.map(I=>a.jsxs("li",{children:[I.name,"  ",X," points"]},I.name)),n.map(I=>a.jsxs("li",{children:[I.name,"  ",$o.Advanced," points"]},I.name))]})]}),a.jsxs("div",{className:"panel stack magic-faculties__panel",children:[a.jsx("h2",{className:"magic-faculties__panel-title h2",children:"Aspect Scaling"}),a.jsx("div",{className:"magic-faculties__table-scroll",children:a.jsxs("table",{className:"table magic-faculties__table",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"table__row",children:[a.jsx("th",{className:"table__header magic-faculties__table-header magic-faculties__table-header--spaced",children:"Aspect"}),sl.map(I=>a.jsxs("th",{className:"table__header magic-faculties__table-header magic-faculties__table-header--spaced",children:["Tier ",I.tier]},I.tier))]})}),a.jsx("tbody",{children:Object.entries(fb).map(([I,$])=>a.jsxs("tr",{className:"table__row",children:[a.jsx("td",{className:"table__cell magic-faculties__table-cell magic-faculties__table-cell--strong",children:I}),$.map((L,D)=>a.jsx("td",{className:"table__cell magic-faculties__table-cell",children:L},D))]},I))})]})})]})]}),a.jsxs("div",{className:"panel stack magic-faculties__panel magic-faculties__panel--spaced",children:[a.jsx("h2",{className:"magic-faculties__panel-title h2",children:"Aspect AP & Energy Calculator"}),a.jsxs("p",{className:"magic-faculties__panel-text",children:["Choose a tier for each aspect to total the AP/Energy cost. Values add together exactly as described: six Tier 1 aspects cost ",Bo.length*jf(1)," AP/Energy; mixing tiers sums their respective costs."]}),a.jsx("div",{className:"grid magic-faculties__calculator",children:Bo.map(I=>a.jsxs("label",{className:"stack magic-faculties__field",children:[a.jsx("span",{className:"magic-faculties__field-label",children:I}),a.jsx("select",{value:w[I],onChange:$=>f(L=>({...L,[I]:Number($.target.value)})),className:"select magic-faculties__select",children:sl.map($=>a.jsxs("option",{value:$.tier,children:["Tier ",$.tier,"  Cost ",$.cost]},$.tier))})]},I))}),a.jsxs("div",{className:"cluster magic-faculties__totals",children:[a.jsxs("div",{className:"magic-faculties__total",children:["Total AP Cost: ",M,A.apMultiplier!==1?` (base ${E})`:""]}),a.jsxs("div",{className:"magic-faculties__total",children:["Total Energy Cost: ",O,A.energyMultiplier!==1?` (base ${E})`:""]})]}),A.modifiers.length>0&&a.jsxs("div",{className:"magic-faculties__modifiers",children:[a.jsx("div",{className:"magic-faculties__modifiers-title",children:"Ancillary modifiers applied:"}),a.jsx("ul",{className:"magic-faculties__modifiers-list",children:A.modifiers.map(I=>a.jsx("li",{children:I},I))})]})]}),a.jsx("div",{className:"grid magic-faculties__cards",children:e.map(I=>{const $=R(I),L=k>=$||d[I.name],D=c||!g;return a.jsx(QE,{faculty:I,cost:$,unlocked:!!d[I.name],onToggle:()=>N(I),canAfford:L,disabled:D},I.name)})})]})]})},ZE=[{tier:1,cost:1},{tier:2,cost:9},{tier:3,cost:27},{tier:4,cost:57},{tier:5,cost:99},{tier:6,cost:153}],eC={burn:["Fire","Damage"],heat:["Fire","Damage"],flame:["Fire","Damage"],melt:["Fire","Damage"],smoke:["Obscure","Control"],blind:["Control"],freeze:["Cold","Control"],cold:["Cold"],frost:["Cold"],slow:["Control"],prone:["Control"],unconscious:["Control"],push:["Mobility"],pull:["Mobility"],gravity:["Mobility","Control"],lift:["Mobility"],hazard:["Hazard"],terrain:["Hazard"],barrier:["Support"],shield:["Support"],heal:["Support"],energy:["Support"],stun:["Control"],shock:["Damage"],lightning:["Damage"],radiance:["Damage","Support"],corrosion:["Damage"],poison:["Damage"],bleed:["Damage"],flight:["Mobility"],velocity:["Mobility"],anchor:["Control"],silence:["Control"]},tC=["Clamp total aspect cost to the caster's AP/Energy budget and downgrade tiers if over budget.","Avoid stacking redundant statusesmerge overlapping Burning/Freezing stacks into a single intensity line.","If the ring contradicts the core effect (e.g., upward lift plus crushing gravity), use the dominant goal to decide which wins"],nC=e=>{let t=1779033703^e.length;for(let n=0;n<e.length;n+=1)t=Math.imul(t^e.charCodeAt(n),3432918353),t=t<<13|t>>>19;return()=>(t=Math.imul(t^t>>>16,2246822507),t=Math.imul(t^t>>>13,3266489909),((t^=t>>>16)>>>0&268435455)/268435456)},aC=e=>{var t;return((t=ZE.find(n=>n.tier===e))==null?void 0:t.cost)??0},Ef=e=>Math.max(1,Math.min(6,Math.round(e))),uu=(e,t)=>{const n=`${e} ${t.join(" ")}`.toLowerCase(),s=new Set;return Object.entries(eC).forEach(([r,i])=>{n.includes(r)&&i.forEach(o=>s.add(o))}),/burn/i.test(n)&&/cold|freeze|frost/i.test(n)&&s.add("Thermal"),Array.from(s)},du=e=>e.join(",").split(/[,;]/).map(t=>t.trim()).filter(Boolean),Cf=e=>{const t=e.content.split(`
`).map(i=>i.trim()).filter(Boolean),n=[];let s=null,r=null;if(t.forEach(i=>{if(/primary effect/i.test(i)){s&&(s.tags=uu(`${s.primaryEffect} ${s.consequence??""}`,[...s.statusesPrimary,...s.statusesRing]),n.push(s)),s={name:i.split("")[0].trim()||e.label,primaryEffect:"",consequence:"",statusesPrimary:[],statusesRing:[],tags:[]},r="primary";return}if(/environmental consequence/i.test(i)){r="consequence";return}if(/^statuses/i.test(i)){r="statuses";return}s||(s={name:e.label,primaryEffect:"",consequence:"",statusesPrimary:[],statusesRing:[],tags:[]},r="primary"),r==="primary"?s.primaryEffect=s.primaryEffect?`${s.primaryEffect} ${i}`:i:r==="consequence"?s.consequence=s.consequence?`${s.consequence} ${i}`:i:r==="statuses"&&(/^primary:/i.test(i)?s.statusesPrimary.push(...du([i.replace(/^primary:/i,"")])):/^ring:/i.test(i)?s.statusesRing.push(...du([i.replace(/^ring:/i,"")])):s.statusesPrimary.push(...du([i])))}),s&&(s.tags=uu(`${s.primaryEffect} ${s.consequence??""}`,[...s.statusesPrimary,...s.statusesRing]),n.push(s)),n.length===0){const i={name:e.label,primaryEffect:e.content,statusesPrimary:[],statusesRing:[],tags:uu(e.content,[])};n.push(i)}return n},Af=(e,t,n)=>{const s={Damage:["Damage","Fire","Shock","Cold"],Control:["Control","Obscure"],Mobility:["Mobility","Gravity","Flight"],Support:["Support"],Hazard:["Hazard","Terrain"]},r=e.map(l=>{const c=t.reduce((u,d)=>{const m=(s[d]??[]).filter(y=>l.tags.includes(y)).length;return u+m},0);return{segment:l,overlap:c}}),i=Math.max(...r.map(l=>l.overlap)),o=r.filter(l=>l.overlap===i).map(l=>l.segment);return o[Math.floor(n()*o.length)]||e[0]},sC=(e,t,n)=>{const s=["Intensity","Area","Range","Duration","Origins","Compound"],r=s.reduce((i,o)=>({...i,[o]:1}),{});return e.forEach(i=>{i==="Damage"&&(r.Intensity+=2,r.Range+=1),i==="Control"&&(r.Area+=2,r.Duration+=1,r.Compound+=1),i==="Mobility"&&(r.Range+=1,r.Duration+=1),i==="Support"&&(r.Duration+=1,r.Compound+=1),i==="Hazard"&&(r.Area+=1,r.Duration+=1)}),s.forEach(i=>{r[i]=Ef(r[i]+n())}),r.Intensity=Ef(Math.max(r.Intensity,t)),r},rC=e=>Object.values(e).reduce((t,n)=>t+aC(n),0),iC=(e,t,n)=>{const s=[e.primaryEffect];return t&&s.push(`Ring: ${t.consequence||t.primaryEffect}`),n&&s.push(`Resonates with ${n.name.toLowerCase()}`),s.join("  ")},Fo={prefix:["Plasma","Frost","Graviton","Pulse","Veil","Cinder","Glacier","Aether","Shard","Arc"],suffix:["Bloom","Collapse","Spiral","Crown","Breach","Torrent","Shell","Vortex","Bridge","Rift"]},oC=(e,t,n)=>{const s=n[0]||e.split(" ")[0],r=Fo.prefix[Math.floor(t()*Fo.prefix.length)],i=Fo.suffix[Math.floor(t()*Fo.suffix.length)];return`${s} ${r} ${i}`},lC=(e,t,n)=>{const s=nC(e.seed),r=t?Cf(t):[],i=n?Cf(n):[],o=Af(r,e.goals,s),l=e.allowOpposedRing&&r.length>1?r.find(_=>_!==o):void 0,c=e.secondaryFaculty&&i.length>0?Af(i,e.goals,s):void 0,u=sC(e.goals,e.primaryTier,s),d=rC(u),h=Array.from(new Set([...o.tags,...(l==null?void 0:l.tags)??[],...(c==null?void 0:c.tags)??[]])),m=[...tC,...l?["If the opposed ring would nullify the primary zone, shrink its area or reduce its tier by one."]:[],c?`Blend ${e.secondaryFaculty} by merging statuses instead of stacking damage twice.`:""].filter(Boolean),y=oC(e.primaryFaculty,s,h),b=iC(o,l,c);return{name:y,tagline:b,primaryFaculty:e.primaryFaculty,secondaryFaculty:e.secondaryFaculty,primaryTier:e.primaryTier,secondaryTier:e.secondaryTier,primarySegment:o,ringSegment:l,resonantSegment:c,aspectPlan:u,totalCost:d,tags:h,cautions:m,seed:e.seed}},cC=({goal:e,active:t,onToggle:n})=>a.jsx("button",{onClick:n,className:`spell-creation__goal${t?" spell-creation__goal--active":""}`,children:e}),ds=({children:e})=>a.jsx("span",{className:"spell-creation__pill",children:e}),hu=({label:e,items:t})=>a.jsxs("div",{className:"spell-creation__status",children:[a.jsx("div",{className:"spell-creation__status-label",children:e}),a.jsx("div",{children:t.length?t.map(n=>a.jsx(ds,{children:n},n)):a.jsx("span",{className:"spell-creation__muted",children:"None"})})]}),uC=()=>{var k;const e=v.useMemo(()=>nm(am),[]),[t,n]=v.useState(Ll[0].name),[s,r]=v.useState((k=Ll[1])==null?void 0:k.name),[i,o]=v.useState(3),[l,c]=v.useState(2),[u,d]=v.useState(["Damage","Control"]),[h,m]=v.useState(!0),[y,b]=v.useState(()=>`auto-${Date.now().toString(36)}`),[_,w]=v.useState(null),f=e.find(N=>N.name===t),p=e.find(N=>N.name===s),g=f==null?void 0:f.tiers[Math.min(i-1,((f==null?void 0:f.tiers.length)??1)-1)],j=p==null?void 0:p.tiers[Math.min(l-1,((p==null?void 0:p.tiers.length)??1)-1)],A=N=>{d(E=>E.includes(N)?E.filter(M=>M!==N):[...E,N])},R=()=>{const E=lC({primaryFaculty:t,secondaryFaculty:s||void 0,primaryTier:i,secondaryTier:s?l:void 0,goals:u,seed:y,allowOpposedRing:h},g,j);w(E)};v.useEffect(()=>{R()},[]);const S=()=>{const N=`auto-${Math.random().toString(36).slice(2,8)}`;b(N)};return a.jsxs("div",{className:"spell-creation",children:[a.jsxs("header",{className:"spell-creation__header",children:[a.jsx("div",{className:"spell-creation__badge",children:"Generator"}),a.jsx("h1",{className:"spell-creation__title h1",children:"Automatic Spell Creation"}),a.jsx("p",{className:"spell-creation__subtitle subtitle muted",children:"Build fully composed spells from the Adrun magic faculties. Choose intent, tiers, and resonance rules; the generator pulls tier text directly from the source document, applies aspect budgets, and returns an executable spell packet with statuses and costs."})]}),a.jsxs("div",{className:"spell-creation__grid spell-creation__grid--primary",children:[a.jsxs("section",{className:"spell-creation__card",children:[a.jsx("h2",{className:"spell-creation__card-title h2",children:"Inputs"}),a.jsxs("div",{className:"spell-creation__stack",children:[a.jsxs("label",{className:"spell-creation__field",children:[a.jsx("span",{children:"Primary Faculty"}),a.jsx("select",{value:t,onChange:N=>n(N.target.value),className:"spell-creation__input",children:e.map(N=>a.jsx("option",{value:N.name,children:N.name},N.name))})]}),a.jsxs("label",{className:"spell-creation__field",children:[a.jsx("span",{children:"Primary Tier"}),a.jsx("input",{type:"range",min:1,max:6,value:i,onChange:N=>o(Number(N.target.value))}),a.jsxs("div",{className:"spell-creation__muted",children:["Tier ",i]})]}),a.jsxs("label",{className:"spell-creation__field",children:[a.jsx("span",{children:"Secondary Faculty (resonance)"}),a.jsxs("select",{value:s,onChange:N=>r(N.target.value||void 0),className:"spell-creation__input",children:[a.jsx("option",{value:"",children:"None"}),e.filter(N=>N.name!==t).map(N=>a.jsx("option",{value:N.name,children:N.name},N.name))]})]}),s&&a.jsxs("label",{className:"spell-creation__field",children:[a.jsx("span",{children:"Secondary Tier"}),a.jsx("input",{type:"range",min:1,max:6,value:l,onChange:N=>c(Number(N.target.value))}),a.jsxs("div",{className:"spell-creation__muted",children:["Tier ",l]})]}),a.jsx("div",{className:"spell-creation__goal-list",children:["Damage","Control","Mobility","Support","Hazard"].map(N=>a.jsx(cC,{goal:N,active:u.includes(N),onToggle:()=>A(N)},N))}),a.jsxs("label",{className:"spell-creation__field spell-creation__field--row",children:[a.jsx("input",{type:"checkbox",checked:h,onChange:N=>m(N.target.checked)}),a.jsx("span",{children:"Allow opposed ring/gradient if the faculty tier provides one"})]}),a.jsxs("label",{className:"spell-creation__field",children:[a.jsx("span",{children:"Seed"}),a.jsxs("div",{className:"spell-creation__row",children:[a.jsx("input",{className:"spell-creation__input spell-creation__input--grow",value:y,onChange:N=>b(N.target.value)}),a.jsx("button",{onClick:S,className:"spell-creation__pill-button",children:"Randomize"})]})]}),a.jsx("button",{onClick:R,className:"spell-creation__primary-button",children:"Generate spell"})]})]}),a.jsxs("section",{className:"spell-creation__card",children:[a.jsx("h2",{className:"spell-creation__card-title spell-creation__card-title--tight h2",children:"Generated Spell"}),_?a.jsxs("div",{children:[a.jsx("div",{className:"spell-creation__spell-name",children:_.name}),a.jsx("div",{className:"spell-creation__spell-tagline",children:_.tagline}),a.jsxs("div",{className:"spell-creation__pill-row",children:[a.jsxs(ds,{children:["Core: ",_.primaryFaculty,"  Tier ",_.primaryTier]}),_.secondaryFaculty&&a.jsxs(ds,{children:["Resonant: ",_.secondaryFaculty,"  Tier ",_.secondaryTier]}),_.ringSegment&&a.jsx(ds,{children:"Opposed ring enabled"}),a.jsxs(ds,{children:["AP/Energy Cost: ",_.totalCost]}),a.jsxs(ds,{children:["Seed: ",_.seed]})]}),a.jsxs("div",{className:"spell-creation__section",children:[a.jsx("div",{className:"spell-creation__section-title",children:"Tags"}),a.jsx("div",{children:_.tags.length?_.tags.map(N=>a.jsx(ds,{children:N},N)):a.jsx("span",{className:"spell-creation__muted",children:"No tags derived"})})]}),a.jsxs("div",{className:"spell-creation__section",children:[a.jsx("div",{className:"spell-creation__section-title",children:"Aspect Plan"}),a.jsx("div",{className:"spell-creation__aspect-grid",children:Object.entries(_.aspectPlan).map(([N,E])=>a.jsxs("div",{className:"spell-creation__aspect-pill",children:[N,": Tier ",E]},N))})]}),a.jsxs("div",{className:"spell-creation__payload-grid",children:[a.jsxs("div",{className:"spell-creation__payload",children:[a.jsx("div",{className:"spell-creation__payload-title",children:"Primary Payload"}),a.jsx("div",{className:"spell-creation__payload-text",children:_.primarySegment.primaryEffect}),_.primarySegment.consequence&&a.jsxs("div",{className:"spell-creation__payload-muted",children:[a.jsx("strong",{children:"Environmental:"})," ",_.primarySegment.consequence]}),a.jsx(hu,{label:"Statuses",items:[..._.primarySegment.statusesPrimary]})]}),_.ringSegment&&a.jsxs("div",{className:"spell-creation__payload",children:[a.jsx("div",{className:"spell-creation__payload-title",children:"Opposed Ring"}),a.jsx("div",{className:"spell-creation__payload-text",children:_.ringSegment.consequence||_.ringSegment.primaryEffect}),a.jsx(hu,{label:"Ring Statuses",items:[..._.ringSegment.statusesRing,..._.ringSegment.statusesPrimary]})]}),_.resonantSegment&&a.jsxs("div",{className:"spell-creation__payload",children:[a.jsxs("div",{className:"spell-creation__payload-title",children:["Resonant Blend (",_.secondaryFaculty,")"]}),a.jsx("div",{className:"spell-creation__payload-text",children:_.resonantSegment.primaryEffect}),_.resonantSegment.consequence&&a.jsxs("div",{className:"spell-creation__payload-muted",children:[a.jsx("strong",{children:"Environmental:"})," ",_.resonantSegment.consequence]}),a.jsx(hu,{label:"Resonant Statuses",items:[..._.resonantSegment.statusesPrimary,..._.resonantSegment.statusesRing]})]})]})]}):a.jsx("div",{className:"spell-creation__muted",children:"Generate to see a complete spell packet."})]})]}),a.jsxs("div",{className:"spell-creation__grid spell-creation__grid--secondary",children:[a.jsxs("section",{className:"spell-creation__card",children:[a.jsx("h3",{className:"spell-creation__section-heading h3",children:"Structured extraction"}),a.jsx("p",{className:"spell-creation__paragraph",children:"The generator parses tier text into a primary payload, an optional opposed ring, and a resonance block from a second faculty. It derives tags, statuses, and aspect scaling automatically so you can copy this packet directly into play materials."}),_&&a.jsxs("ul",{className:"spell-creation__bullet-list",children:[a.jsxs("li",{children:[a.jsx("strong",{children:"Primary intent match:"})," ",_.primarySegment.name," selected to best satisfy ",u.join(", ")," goals."]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Cost guardrails:"})," AP/Energy cost ",_.totalCost," derived from aspect tiers; downgrade tiers if this exceeds your build budget."]}),_.ringSegment&&a.jsx("li",{children:"Opposed ring captured from the faculty's secondary half to maintain environmental contrast."}),_.resonantSegment&&a.jsxs("li",{children:["Resonance merges statuses from ",_.secondaryFaculty," instead of stacking raw damage, keeping effects coherent."]})]})]}),a.jsxs("section",{className:"spell-creation__card",children:[a.jsx("h3",{className:"spell-creation__section-heading h3",children:"Safeguards"}),a.jsx("ul",{className:"spell-creation__bullet-list spell-creation__bullet-list--spaced",children:(_==null?void 0:_.cautions.map(N=>a.jsx("li",{className:"spell-creation__bullet-item",children:N},N)))||a.jsx("li",{className:"spell-creation__muted",children:"Generate a spell to see the automatic safety notes."})})]})]})]})},dC={name:"DeityRelationshipPoints",currentKey:"current",capKey:"cap",racialCapBonusOptions:[1,2,3,4,5],capTiers:{20:"50 + (15 * Spiritual Attribute)",40:"75 + (15 * Spiritual Attribute)",60:"100 + (15 * Spiritual Attribute)",80:"125 + (15 * Spiritual Attribute)",100:"150 + (15 * Spiritual Attribute)"}},hC=[{name:"Light",alignment:"Aligned"},{name:"Knowledge",alignment:"Aligned"},{name:"Ice",alignment:"Aligned"},{name:"Fire",alignment:"Aligned"},{name:"Nature",alignment:"Aligned"},{name:"Redeemed Dark",alignment:"Aligned"},{name:"Unaligned",alignment:"Unaligned/Evil"}],mC={apostasy:"Switching between Aligned and Unaligned resets all DR points across that side.",spiritualLimit:"A character may dedicate themselves to a number of deities equal to their Spiritual Attribute.",worshipGeneration:{passive:"Generates 3 * Spiritual Attribute DR if passive conditions are met.",active:"Each worship action grants its listed value multiplied by Spiritual Attribute.",fallback:"If no worship actions are taken and no passive condition is met, gain Spiritual Attribute DR on that Moon Face."},casting:{divineInterventionCost:"1 Energy and 1 Action Point regardless of spell strength",beseech:"Players pick one of three deity-specific spells; the deity/GM determines tier and DR cost unless a Religious Text specifies a tier."},gearIntegration:{equipmentSlots:["Religious Texts","Vestments","Talismans and Symbols","Verses"],effects:{"Religious Texts":"Allow requesting a specific intervention tier; add Spiritual Attribute x Item Tier to Divine Intervention rolls.",Vestments:"Increase Worship rolls by Spiritual Attribute x Item Tier.","Talismans and Symbols":"Increase Resist Supernatural rolls by Spiritual Attribute x Item Tier.",Verses:"Consumable; allow direct free usage of Divine Intervention spells and are expended after one use."}},worshipTracker:"Dashboard for logging active worship actions during roleplay to calculate DR gains."},pC=[{name:"Homma",sect:"Light",alignment:"Aligned",worship:[{name:"Organize",value:1,type:"active"},{name:"Destroy Chaos",value:3,type:"active"},{name:"Bring Order",value:4,type:"active"}],divineInterventions:[{spell:"Turn Evil",effect:"Evil beings are made fearful or cease to be."},{spell:"Turn Chaos",effect:"Chaotic beings are made fearful or cease to be."},{spell:"Assert Authority",effect:"Supernatural and Divine beings obey."}]},{name:"Naiben",sect:"Light",alignment:"Aligned",worship:[{name:"Lawful Place",value:null,type:"passive"},{name:"Enforce Law",value:2,type:"active"},{name:"Apprehend Criminals",value:3,type:"active"}],divineInterventions:[{spell:"Turn Unlawful",effect:"Criminal elements and those who break divine contracts are made fearful or cease to be."},{spell:"Incur Law",effect:"Law, whether mortal or divine, is reasserted."},{spell:"Judge",effect:"Those who have committed to chaos or evil are measured and punished."}]},{name:"Judaira",sect:"Light",alignment:"Aligned",worship:[{name:"Home",value:null,type:"passive"},{name:"Bless Home",value:1,type:"active"},{name:"Soothe Quarrel",value:3,type:"active"}],divineInterventions:[{spell:"Befriend",effect:"You and another mortal are allies."},{spell:"Combine Efforts",effect:"Many of the clergy may use Divine Intervention together."},{spell:"Soothe",effect:"The frightened, wrathful, and grieving are comforted."}]},{name:"Zera",sect:"Light",alignment:"Aligned",worship:[{name:"Treat Tired",value:1,type:"active"},{name:"Treat Sick",value:2,type:"active"},{name:"Treat Injured",value:3,type:"active"}],divineInterventions:[{spell:"Heal",effect:"The bodys wounds are repaired."},{spell:"Revive",effect:"The recently deceased is returned by Nandul on behalf of Zera."},{spell:"Reinvigorate",effect:"The bodys fatigue is diminished."}]},{name:"Aelia",sect:"Light",alignment:"Aligned",worship:[{name:"Beautification",value:1,type:"active"},{name:"Love",value:2,type:"active"},{name:"Heroism",value:4,type:"active"}],divineInterventions:[{spell:"Charm",effect:"Another is infatuated by you."},{spell:"Enhance Appearance",effect:"Your appearance is made more palatable."},{spell:"Inspire",effect:"Morale is enhanced."}]},{name:"Niema",sect:"Light",alignment:"Aligned",worship:[{name:"Make Art",value:1,type:"active"},{name:"Perform",value:2,type:"active"},{name:"Teach Creatives",value:3,type:"active"}],divineInterventions:[{spell:"Music",effect:"Music sounds from the ether."},{spell:"Divine Performance",effect:"Your performance is divinely inspired."},{spell:"Thaumaturgy",effect:"You perform small signs and amplifications."}]},{name:"Rasadan",sect:"Light",alignment:"Aligned",worship:[{name:"Destroy Cultists",value:3,type:"active"},{name:"Banish Evil",value:4,type:"active"},{name:"Destroy Evil",value:4,type:"active"}],divineInterventions:[{spell:"Light",effect:"Light is shed upon darkness."},{spell:"Banish",effect:"Extraplanar beings are returned to their planes or excised from this place."},{spell:"Smite",effect:"Divine Retribution is rendered unto your foe."}]},{name:"Silvias",sect:"Knowledge",alignment:"Aligned",worship:[{name:"Historical Place",value:null,type:"passive"},{name:"Preserve",value:1,type:"active"},{name:"Restore",value:4,type:"active"}],divineInterventions:[{spell:"Haste",effect:"Speed is amplified."},{spell:"Slow",effect:"Action is hindered."},{spell:"Identify",effect:"The identity and purpose of an item is made clear."}]},{name:"Irvine",sect:"Knowledge",alignment:"Aligned",worship:[{name:"Explore",value:1,type:"active"},{name:"Discover",value:1,type:"active"},{name:"Show Discovery",value:2,type:"active"}],divineInterventions:[{spell:"Map",effect:"The surrounding area is known to you."},{spell:"Astrology",effect:"Signs of the moons and stars are known to you."},{spell:"Reveal",effect:"The hidden is revealed."}]},{name:"Emera",sect:"Knowledge",alignment:"Aligned",worship:[{name:"Maintain Watch",value:1,type:"active"},{name:"Science",value:2,type:"active"},{name:"Invent",value:4,type:"active"}],divineInterventions:[{spell:"Innovation",effect:"Your mind is aided so you can solve your problem."},{spell:"Divine Knowledge",effect:"Emera grants you her knowledge."},{spell:"Vigilance",effect:"You discern what shall do harm."}]},{name:"Makis",sect:"Knowledge",alignment:"Aligned",worship:[{name:"Place of Learning",value:null,type:"passive"},{name:"Humility",value:2,type:"active"},{name:"Teach Academics",value:3,type:"active"}],divineInterventions:[{spell:"Imbue Knowledge",effect:"You impart knowledge unto another."},{spell:"Disguise",effect:"Someone shall not be as they seem."},{spell:"Divine Learning",effect:"You absorb the world around you."}]},{name:"Yvan",sect:"Ice",alignment:"Aligned",worship:[{name:"Winter",value:null,type:"passive"},{name:"Cool Place",value:null,type:"passive"},{name:"Seek Solitude",value:1,type:"active"}],divineInterventions:[{spell:"Ice Blast",effect:"Ice from Yvan is used for your offensive purposes."},{spell:"Ice Shield",effect:"Ice from Yvan is used for your defensive purposes."},{spell:"Freeze",effect:"Ice from Yvan is used to incapacitate foes or freeze liquids."}]},{name:"Bjorlund",sect:"Ice",alignment:"Aligned",worship:[{name:"Place of Mercantilism",value:null,type:"passive"},{name:"Trade Honestly",value:1,type:"active"},{name:"Charity",value:2,type:"active"}],divineInterventions:[{spell:"Contract",effect:"A divine oath between multiple parties is officiated."},{spell:"Aid",effect:"You are given help in your efforts by Bjorlund."},{spell:"Shape Ice",effect:"Ice is molded and formed."}]},{name:"Meadrol",sect:"Ice",alignment:"Aligned",worship:[{name:"Travel",value:null,type:"passive"},{name:"Gamble",value:1,type:"active"},{name:"Party",value:1,type:"active"}],divineInterventions:[{spell:"Luck",effect:"Fate is woven in your favor."},{spell:"Teleportation",effect:"You move without moving."},{spell:"Divine Rites of Travel",effect:"Travel commences without hardship."}]},{name:"Aura",sect:"Fire",alignment:"Aligned",worship:[{name:"Summer",value:null,type:"passive"},{name:"Warm Places",value:null,type:"passive"},{name:"Righteous Fury",value:3,type:"active"}],divineInterventions:[{spell:"Lava Blast",effect:"Lava from Aura is used for offensive purposes."},{spell:"Shape Lava",effect:"Lava is molded and formed."},{spell:"Incinerate",effect:"What opposes you is turned to ash."}]},{name:"Vestneus",sect:"Fire",alignment:"Aligned",worship:[{name:"Hunt",value:2,type:"active"},{name:"Farm",value:4,type:"active"},{name:"Defend Place",value:4,type:"active"}],divineInterventions:[{spell:"Divine Hunt",effect:"Your quarry is revealed."},{spell:"Plenty",effect:"Supplies are readily available."},{spell:"Secure",effect:"What is locked cannot be unlocked."}]},{name:"Flora",sect:"Fire",alignment:"Aligned",worship:[{name:"Battle",value:1,type:"active"},{name:"Conquer Place",value:4,type:"active"},{name:"Feat of Bravery",value:4,type:"active"}],divineInterventions:[{spell:"Valor",effect:"Morale is improved."},{spell:"Divine Offense",effect:"Flora aids you in offense."},{spell:"Divine Defense",effect:"Flora aids you in defense."}]},{name:"Theri",sect:"Nature",alignment:"Aligned",worship:[{name:"Endure",value:1,type:"active"},{name:"Repair Common Items",value:1,type:"active"},{name:"Craft",value:2,type:"active"}],divineInterventions:[{spell:"Fortitude",effect:"You endure against all odds."},{spell:"Imbue Soul",effect:"A soul is transferred between vessels."},{spell:"Divine Craft",effect:"A magical artifact is created."}]},{name:"Azuli",sect:"Nature",alignment:"Aligned",worship:[{name:"Wilderness",value:null,type:"passive"},{name:"Care For Flora",value:2,type:"active"},{name:"Resist Temptation",value:3,type:"active"}],divineInterventions:[{spell:"Befriend Plant",effect:"Plantlife becomes an ally."},{spell:"Plant Growth",effect:"Plantlife blooms and ripens."},{spell:"Entangle",effect:"Nature traps a foe of yours."}]},{name:"Kasha",sect:"Nature",alignment:"Aligned",worship:[{name:"Raise Child",value:null,type:"passive"},{name:"Help Family",value:2,type:"active"},{name:"Care For the Mentally Ill",value:4,type:"active"}],divineInterventions:[{spell:"Bless",effect:"Kasha watches over a creature or place."},{spell:"Divine Care",effect:"Kasha aids you in helping the damaged."},{spell:"Heal Mind",effect:"Ones mind is repaired."}]},{name:"Kesh",sect:"Nature",alignment:"Aligned",worship:[{name:"Subterranean Places",value:null,type:"passive"},{name:"Forage",value:1,type:"active"},{name:"Care For Terrestrial",value:2,type:"active"}],divineInterventions:[{spell:"Shape Earth",effect:"Earth is molded and formed."},{spell:"Befriend Animal",effect:"A beast becomes an ally."},{spell:"Harden",effect:"A body is made more durable."}]},{name:"Ar",sect:"Nature",alignment:"Aligned",worship:[{name:"High Places",value:null,type:"passive"},{name:"Read Weather",value:1,type:"active"},{name:"Care For Avian",value:2,type:"active"}],divineInterventions:[{spell:"Gust",effect:"A tempest blows."},{spell:"Fly",effect:"One bound to the land takes to the sky."},{spell:"Lightning",effect:"Lightning and thunder is cast from on high."}]},{name:"Upht",sect:"Nature",alignment:"Aligned",worship:[{name:"Marine Places",value:null,type:"passive"},{name:"Care For Marine",value:2,type:"active"},{name:"Follow Dream",value:4,type:"active"}],divineInterventions:[{spell:"Shape Water",effect:"Water is molded and formed."},{spell:"Dream",effect:"Dreams are revealed and manifest."},{spell:"Control Weather",effect:"Skies, waters, and winds obey."}]},{name:"Nandul",sect:"Redeemed Dark",alignment:"Aligned",worship:[{name:"Respect Dead",value:1,type:"active"},{name:"Restore Graves",value:3,type:"active"},{name:"Destroy Undead",value:3,type:"active"}],divineInterventions:[{spell:"Resurrect",effect:"Those deceased for less than a phase are returned by Nandul."},{spell:"Spare",effect:"The dying are spared from death."},{spell:"Turn Undead",effect:"Undead are made fearful or cease to be."}]},{name:"Ishmadt",sect:"Redeemed Dark",alignment:"Aligned",worship:[{name:"Destroy Lies",value:3,type:"active"},{name:"Exorcise Place",value:3,type:"active"},{name:"Forgive Enemy",value:4,type:"active"}],divineInterventions:[{spell:"Truth",effect:"The truth is revealed."},{spell:"Purify",effect:"The unclean is made clean."},{spell:"Convert",effect:"The unaligned becomes aligned."}]},{name:"Ordurun",sect:"Unaligned",alignment:"Unaligned/Evil",worship:[{name:"Battle",value:1,type:"active"},{name:"Torture",value:2,type:"active"},{name:"Follow Cult Orders",value:4,type:"active"}],divineInterventions:[{spell:"Secret Knowledge",effect:"Ordurun imparts the nature of the universe."},{spell:"Learn Dakar",effect:"Ordurun reveals methods of Willing Dakar."},{spell:"Read Intent",effect:"Anothers intentions are revealed."}]},{name:"Ashi",sect:"Unaligned",alignment:"Unaligned/Evil",worship:[{name:"Lie",value:1,type:"active"},{name:"Sacrifice Mortal",value:3,type:"active"},{name:"Turn To Wraithdom",value:4,type:"active"}],divineInterventions:[{spell:"Darkness",effect:"Light is doused in dark."},{spell:"Lifesteal",effect:"Life is transferred to another."},{spell:"Wraith",effect:"You descend further into Wraithdom as a Tise."}]},{name:"Grall",sect:"Unaligned",alignment:"Unaligned/Evil",worship:[{name:"Dedicate Wealth",value:2,type:"active"},{name:"Steal",value:3,type:"active"},{name:"Perversion",value:4,type:"active"}],divineInterventions:[{spell:"Rot",effect:"Living flesh fails."},{spell:"Rust",effect:"Crafts and natural features fail."},{spell:"Corrupt Area",effect:"The clean becomes unclean."}]},{name:"Duum",sect:"Unaligned",alignment:"Unaligned/Evil",worship:[{name:"Deface",value:1,type:"active"},{name:"Murder",value:3,type:"active"},{name:"Destroy Order",value:4,type:"active"}],divineInterventions:[{spell:"Frenzy",effect:"All succumb to their passions."},{spell:"Antimagic Field",effect:"Psionics, Dakar, and The Divine fail."},{spell:"Incinerate",effect:"What opposes you turns to ash."}]},{name:"Myirata",sect:"Unaligned",alignment:"Unaligned/Evil",worship:[{name:"Alleviate Grief",value:2,type:"active"},{name:"Find Lost Thing",value:2,type:"active"},{name:"Hide Troubled Person",value:3,type:"active"}],divineInterventions:[{spell:"Invisibility",effect:"What is seen becomes hidden."},{spell:"Traverse Planes",effect:"You move between worlds that cannot be reached through ordinary means."},{spell:"Find",effect:"What you seek is found."}]},{name:"Thul",sect:"Unaligned",alignment:"Unaligned/Evil",worship:[{name:"Defend Reputation",value:2,type:"active"},{name:"Honorable Duel",value:3,type:"active"},{name:"Change Order",value:4,type:"active"}],divineInterventions:[{spell:"Valor",effect:"Morale is improved."},{spell:"Compel Duel",effect:"One is fated to face you in single combat."},{spell:"Diminish",effect:"Ones power and glory is reduced."}]},{name:"Baras",sect:"Unaligned",alignment:"Unaligned/Evil",worship:[{name:"Revolt",value:3,type:"active"},{name:"Liberate",value:4,type:"active"},{name:"Usurp",value:4,type:"active"}],divineInterventions:[{spell:"Lift Divine",effect:"The magical is made mundane."},{spell:"Break Contract",effect:"A Divine Contract is made void."},{spell:"Conceal Person",effect:"One cannot be found."}]},{name:"KarDithu",sect:"Unaligned",alignment:"Unaligned/Evil",worship:[{name:"Intimidate",value:1,type:"active"},{name:"Terrorize",value:2,type:"active"},{name:"Torture",value:2,type:"active"}],divineInterventions:[{spell:"Nightmare",effect:"Ones worst fears manifest."},{spell:"Madness",effect:"Ones faculties erode."},{spell:"Fear",effect:"Morale is sapped."}]},{name:"Aduric Primordial",sect:"Unaligned",alignment:"Unaligned/Evil",worship:[{name:"Battle",value:1,type:"active"},{name:"Dedicate Wealth",value:2,type:"active"},{name:"Sacrifice Animal",value:3,type:"active"}],divineInterventions:[{spell:"Summon Elemental",effect:"The natural forces of the world become allies."},{spell:"Luck",effect:"Fate is woven in your favor."},{spell:"Plenty",effect:"Supplies are readily available."}]},{name:"Cosmic Primordial",sect:"Unaligned",alignment:"Unaligned/Evil",worship:[{name:"Extraterrestrial",value:null,type:"passive"},{name:"Dedicate Knowledge",value:2,type:"active"},{name:"Sacrifice Intellect",value:3,type:"active"}],divineInterventions:[{spell:"Astrology",effect:"Signs of the moons and stars are known to you."},{spell:"Secret Knowledge",effect:"Something from beyond imparts the nature of the universe."},{spell:"Befriend Extraterrestrial",effect:"An alien becomes an ally."}]},{name:"Fallen Patriarch/Matriarch",sect:"Unaligned",alignment:"Unaligned/Evil",worship:[{name:"Follow Cult Orders",value:1,type:"active"},{name:"Dedicate Wealth",value:2,type:"active"},{name:"Sacrifice Mortal",value:3,type:"active"}],divineInterventions:{choose:3,options:["Grall","Duum","Thul","Myirata","Baras","KarDithu"]}}],fC={currency:dC,sects:hC,mechanics:mC,deities:pC},gC=(e,t)=>{const n=e.match(/(\d+)\s*\+\s*\(\s*(\d+)\s*\*\s*Spiritual Attribute\s*\)/i);if(!n)return null;const s=Number(n[1]),r=Number(n[2]);return s+r*t},yC=()=>{var V,Q,te;const e=fC,{data:t}=As(),n=(t==null?void 0:t.raceDetails)??{},s=e&&Array.isArray(e.deities)&&e.deities.length>0&&Array.isArray(e.sects)&&e.sects.length>0,r=s?e:{currency:{name:"DeityRelationshipPoints",currentKey:"current",capKey:"cap",racialCapBonusOptions:[],capTiers:{}},sects:[],mechanics:{apostasy:"",spiritualLimit:"",worshipGeneration:{passive:"",active:"",fallback:""},casting:{divineInterventionCost:"",beseech:""},gearIntegration:{equipmentSlots:[],effects:{}},worshipTracker:""},deities:[]},[i,o]=T.useState(3),[l,c]=T.useState(0),[u,d]=T.useState([]),[h,m]=T.useState(""),[y,b]=T.useState(null),[_,w]=T.useState(!1),[f,p]=T.useState(((V=r.deities[0])==null?void 0:V.name)??""),[g,j]=T.useState(((te=(Q=r.deities[0])==null?void 0:Q.worship[0])==null?void 0:te.name)??""),[A,R]=T.useState(1),[S,k]=T.useState([]);T.useEffect(()=>{w(!0),b(null),Ct.listCharacters().then(B=>d(B)).catch(B=>{const ae=B instanceof Error?B.message:"Failed to load characters";b(ae)}).finally(()=>w(!1))},[]);const N=T.useMemo(()=>u.find(B=>B.id===h),[u,h]),E=B=>{var he,ue,xe,Ne,je,Ce;if(!B)return 0;const ae=((ue=(he=n[B.raceKey??""])==null?void 0:he.disciplines)==null?void 0:ue.deityCapPerSpirit)??((xe=n[B.raceKey??""])==null?void 0:xe.deityCapPerSpirit)??0,le=((je=(Ne=n[B.subraceKey??""])==null?void 0:Ne.disciplines)==null?void 0:je.deityCapPerSpirit)??((Ce=n[B.subraceKey??""])==null?void 0:Ce.deityCapPerSpirit)??0;return ae+le};T.useEffect(()=>{var ae,le;if(!N)return;const B=((ae=N.attributes)==null?void 0:ae.SPIRITUAL)??((le=N.attributes)==null?void 0:le.spiritual)??0;o(B),c(E(N))},[N,n]);const M=i*(10+l),O=i,X=T.useMemo(()=>Object.entries(r.currency.capTiers).map(([B,ae])=>({tier:B,formula:ae,target:gC(ae,i)})),[r.currency.capTiers,i]),re=T.useMemo(()=>{const B=new Map;return r.deities.forEach(ae=>{B.has(ae.sect)||B.set(ae.sect,[]),B.get(ae.sect).push(ae)}),r.sects.forEach(ae=>{B.has(ae.name)||B.set(ae.name,[])}),Array.from(B.entries()).map(([ae,le])=>({sect:ae,deities:[...le].sort((he,ue)=>he.name.localeCompare(ue.name))})).sort((ae,le)=>ae.sect.localeCompare(le.sect))},[r.deities,r.sects]),I=T.useMemo(()=>r.deities.find(B=>B.name===f)??r.deities[0],[r.deities,f]),$=(I==null?void 0:I.worship)??[];T.useEffect(()=>{if(!$.length){j("");return}$.some(B=>B.name===g)||j($[0].name)},[$,g]);const L=B=>B.type==="passive"?3*i:typeof B.value=="number"?B.value*i:0,D=()=>{if(!I||!g||A<=0)return;const B=$.find(xe=>xe.name===g);if(!B)return;const ae=L(B),le=Math.max(1,A),he=ae*le,ue={id:`${I.name}-${B.name}-${Date.now()}`,deity:I.name,action:B.name,type:B.type,perAction:ae,count:le,total:he};k(xe=>[...xe,ue])},F=B=>{k(ae=>ae.filter(le=>le.id!==B))},q=S.reduce((B,ae)=>B+ae.total,0);return a.jsxs("div",{className:"deity-page",children:[a.jsxs("header",{className:"deity-header",children:[a.jsx("h1",{className:"deity-title h1",children:"Deity Relationship"}),a.jsx("p",{className:"deity-intro subtitle muted",children:"Manage Deity Relationship Points (DR), cap tiers, worship generation, beseech options, and sect-specific deities."}),!s&&a.jsx("div",{className:"deity-warning",children:"Data for deities failed to load. Showing an empty template so the page remains usable."}),y&&a.jsx("div",{className:"deity-warning",children:y})]}),a.jsxs("section",{className:"deity-grid",children:[a.jsxs("div",{className:"deity-card",children:[a.jsx("h2",{className:"deity-card-title h2",children:"Inputs"}),a.jsxs("label",{className:"deity-label",children:["Character",a.jsxs("select",{value:h,onChange:B=>m(B.target.value),disabled:_,className:"deity-control",children:[a.jsx("option",{value:"",children:"Manual entry"}),u.map(B=>a.jsx("option",{value:B.id,children:B.name},B.id))]})]}),a.jsxs("label",{className:"deity-label",children:["Spiritual Attribute",a.jsx("input",{type:"number",value:i,min:0,onChange:B=>o(Number(B.target.value)||0),onWheel:B=>B.preventDefault(),className:"deity-control"})]}),a.jsxs("label",{className:"deity-label",children:["Racial Cap Bonus",a.jsx("select",{value:l,onChange:B=>c(Number(B.target.value)),className:"deity-control",children:[0,...r.currency.racialCapBonusOptions].map(B=>a.jsx("option",{value:B,children:B},B))}),N&&a.jsxs("div",{className:"deity-note",children:["Auto-set from ",N.name,"'s race/subrace."]})]}),a.jsxs("div",{className:"deity-subtle",children:["Spiritual limit: dedicate to ",O," deities max."]})]}),a.jsxs("div",{className:"deity-card",children:[a.jsx("h2",{className:"deity-card-title h2",children:"Cap & Currency"}),a.jsx("div",{className:"deity-cap",children:M}),a.jsxs("div",{className:"deity-muted deity-spacing",children:[r.currency.name,": ",r.currency.currentKey," / ",r.currency.capKey]}),a.jsx("ul",{className:"deity-list",children:X.map(B=>a.jsxs("li",{children:[B.tier,"% cap target: ",B.target??"-"," (",B.formula,")"]},B.tier))})]}),a.jsxs("div",{className:"deity-card",children:[a.jsx("h2",{className:"deity-card-title h2",children:"Worship Generation"}),a.jsxs("ul",{className:"deity-list",children:[a.jsxs("li",{children:["Passive: ",r.mechanics.worshipGeneration.passive,"  ",3*i," DR"]}),a.jsxs("li",{children:["Active: ",r.mechanics.worshipGeneration.active]}),a.jsxs("li",{children:["Fallback: ",r.mechanics.worshipGeneration.fallback,"  ",i," DR"]})]})]})]}),a.jsxs("section",{className:"deity-card",children:[a.jsx("h2",{className:"deity-heading h2",children:"Mechanics & Gear"}),a.jsxs("div",{className:"deity-gear-grid",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"deity-heading h3",children:"Rules"}),a.jsxs("ul",{className:"deity-list",children:[a.jsx("li",{children:r.mechanics.apostasy}),a.jsx("li",{children:r.mechanics.spiritualLimit}),a.jsx("li",{children:r.mechanics.casting.divineInterventionCost}),a.jsx("li",{children:r.mechanics.casting.beseech})]})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"deity-heading h3",children:"Gear Integration"}),a.jsx("ul",{className:"deity-list",children:r.mechanics.gearIntegration.equipmentSlots.map(B=>a.jsxs("li",{children:[a.jsxs("strong",{children:[B,":"]})," ",r.mechanics.gearIntegration.effects[B]]},B))})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"deity-heading h3",children:"Worship Tracker"}),a.jsx("p",{className:"deity-paragraph",children:r.mechanics.worshipTracker})]})]})]}),a.jsxs("section",{className:"deity-card",children:[a.jsx("h2",{className:"deity-heading h2",children:"Worship Log"}),a.jsxs("div",{className:"deity-grid-tight",children:[a.jsxs("label",{className:"deity-label",children:["Deity",a.jsx("select",{value:(I==null?void 0:I.name)??"",onChange:B=>p(B.target.value),className:"deity-control",children:r.deities.map(B=>a.jsxs("option",{value:B.name,children:[B.name," (",B.sect,")"]},B.name))})]}),a.jsxs("label",{className:"deity-label",children:["Worship Action",a.jsx("select",{value:g,onChange:B=>j(B.target.value),className:"deity-control",children:$.map(B=>a.jsxs("option",{value:B.name,children:[B.name," (",B.type,")"]},B.name))})]}),a.jsxs("label",{className:"deity-label",children:["Times Performed",a.jsx("input",{type:"number",value:A,min:1,onChange:B=>R(Number(B.target.value)||1),onWheel:B=>B.preventDefault(),className:"deity-control"})]})]}),a.jsxs("div",{className:"deity-row",children:[a.jsxs("div",{className:"deity-action-text",children:["Estimated gain: ",(()=>{const B=$.find(ae=>ae.name===g);return B?L(B)*Math.max(1,A):0})()," DR"]}),a.jsx("button",{type:"button",onClick:D,className:"deity-button deity-button--add",children:"Add Entry"}),a.jsxs("div",{className:"deity-total",children:["Total Logged: ",q," DR"]})]}),a.jsx("div",{className:"deity-table-wrap",children:a.jsxs("table",{className:"deity-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Deity"}),a.jsx("th",{children:"Action"}),a.jsx("th",{children:"Type"}),a.jsx("th",{children:"DR per"}),a.jsx("th",{children:"Count"}),a.jsx("th",{children:"Total DR"}),a.jsx("th",{children:"Remove"})]})}),a.jsx("tbody",{children:S.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:7,className:"deity-empty",children:"No worship actions logged yet."})}):S.map(B=>a.jsxs("tr",{children:[a.jsx("td",{children:B.deity}),a.jsx("td",{children:B.action}),a.jsx("td",{className:"deity-type",children:B.type}),a.jsx("td",{children:B.perAction}),a.jsx("td",{children:B.count}),a.jsx("td",{children:B.total}),a.jsx("td",{children:a.jsx("button",{type:"button",onClick:()=>F(B.id),className:"deity-button deity-button--remove",children:"Remove"})})]},B.id))})]})})]}),a.jsxs("section",{className:"deity-card",children:[a.jsx("h2",{className:"deity-heading h2",children:"Sects & Deities"}),a.jsx("div",{className:"deity-sect-grid",children:re.map(B=>{var ae;return a.jsxs("div",{className:"deity-sect-card",children:[a.jsx("h3",{className:"deity-sect-title h3",children:B.sect}),a.jsxs("div",{className:"deity-sect-meta",children:["Alignment: ",((ae=r.sects.find(le=>le.name===B.sect))==null?void 0:ae.alignment)??""]}),B.deities.length===0&&a.jsx("div",{className:"deity-sect-empty",children:"No deities listed."}),B.deities.map(le=>a.jsxs("div",{className:"deity-sect-divider",children:[a.jsxs("div",{className:"deity-sect-row",children:[a.jsx("strong",{children:le.name}),a.jsx("span",{className:"deity-sect-alignment",children:le.alignment})]}),a.jsxs("div",{className:"deity-section-spacing",children:[a.jsx("div",{className:"deity-section-heading subtitle",children:"Worship"}),a.jsx("ul",{className:"deity-list-tight",children:le.worship.map(he=>a.jsxs("li",{children:[a.jsx("strong",{children:he.name})," (",he.type,") "," ",he.type==="passive"?`${3*i} DR when conditions met`:`${he.value??0}  Spiritual (${(he.value??0)*i} DR)`]},he.name))})]}),a.jsxs("div",{className:"deity-section-spacing",children:[a.jsx("div",{className:"deity-section-heading subtitle",children:"Divine Interventions"}),Array.isArray(le.divineInterventions)?a.jsx("ul",{className:"deity-list-tight",children:le.divineInterventions.map(he=>a.jsxs("li",{children:[a.jsxs("strong",{children:[he.spell,":"]})," ",he.effect]},he.spell))}):a.jsx("ul",{className:"deity-list-tight",children:a.jsxs("li",{children:["Choose ",le.divineInterventions.choose," from: ",le.divineInterventions.options.join(", ")]})})]})]},le.name))]},B.sect)})})]})]})},vC={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:"sb_publishable_9AUU36J3CW2PWPdk3nqrtA_RwBAnQqk",VITE_SUPABASE_URL:"https://ebiskijxrorazuroljxt.supabase.co",VITE_WORKER_URL:"https://adurun-campaigns.larhackman.workers.dev"},bC=["VITE_SUPABASE_URL","VITE_SUPABASE_ANON_KEY"];function _C(){const e=vC??{},t=globalThis.__SUPABASE_ENV__??{};return{...e,...t}}function st(){const e=_C(),t=bC.filter(n=>!e[n]);if(t.length)throw new Te(0,`Missing env vars: ${t.join(", ")}`)}async function gb(e){var r;const{data:t,error:n}=await e.auth.getUser();if(n)throw new Te(0,`Failed to load current user: ${n.message}`);const s=(r=t==null?void 0:t.user)==null?void 0:r.id;if(!s)throw new Te(0,"No authenticated user available for this request");return s}function xC(){return typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2)}const wC=7;function kC(){const e=new Date;return e.setDate(e.getDate()+wC),e.toISOString()}function sm(e){return{id:e.id,name:e.name,gmUserId:e.gm_user_id,createdAt:e.created_at??void 0}}function yb(e){return{token:e.token,campaignId:e.campaign_id,createdBy:e.created_by??void 0,createdAt:e.created_at??void 0,expiresAt:e.expires_at??void 0}}function vb(e){return{campaignId:e.campaign_id,playerUserId:e.player_user_id,characterId:e.character_id??void 0,role:e.role??void 0}}function rm(e){return{id:e.id,campaignId:e.campaign_id,name:e.name,statsSkills:e.stats_skills??void 0,attributes:e.attributes??void 0,skills:e.skills??void 0,abilities:e.abilities??void 0,actions:e.actions??void 0,immunities:e.immunities??void 0,resistances:e.resistances??void 0,weaknesses:e.weaknesses??void 0,tags:e.tags??void 0,rank:e.rank??void 0,dr:e.dr??void 0,armorType:e.armor_type??void 0,energyBars:e.energy_bars??void 0,lieutenantId:e.lieutenant_id??void 0,heroId:e.hero_id??void 0}}function im(e){return{id:e.id,campaignId:e.campaign_id,title:e.title,body:e.body??void 0,tags:e.tags??void 0,isPlayerVisible:e.is_player_visible??void 0}}function om(e){var s;const t=((s=e.bestiary_entries)==null?void 0:s.name)??void 0,n=e.character_id??"Unknown";return{id:e.id,campaignId:e.campaign_id,bestiaryEntryId:e.bestiary_entry_id??void 0,characterId:e.character_id??void 0,name:t??n,faction:e.faction??void 0,isActive:e.is_active??void 0,initiative:e.initiative??void 0,notes:e.notes??void 0,energyCurrent:e.energy_max??e.energy_current??void 0,apCurrent:e.ap_max??e.ap_current??void 0,tier:e.tier??void 0,energyMax:e.energy_max??void 0,apMax:e.ap_max??void 0}}function lm(e){return{id:e.id,campaignId:e.campaign_id,combatantId:e.combatant_id,statusKey:e.status_key,durationType:e.duration_type??void 0,durationRemaining:e.duration_remaining??void 0,stacks:e.stacks??void 0,isActive:e.is_active??void 0,appliedAt:e.applied_at??void 0,updatedAt:e.updated_at??void 0}}function cm(e){return{id:e.id,campaignId:e.campaign_id,combatantId:e.combatant_id,woundType:e.wound_type,woundCount:e.wound_count,updatedAt:e.updated_at??void 0}}function bb(e){const t={};return e.name!==void 0&&(t.name=e.name),t}function NC(e){const t={};return e.token!==void 0&&(t.token=e.token),e.campaignId!==void 0&&(t.campaign_id=e.campaignId),e.createdBy!==void 0&&(t.created_by=e.createdBy??null),e.expiresAt!==void 0&&(t.expires_at=e.expiresAt??null),t}function jC(e){const t={};return e.campaignId!==void 0&&(t.campaign_id=e.campaignId),e.playerUserId!==void 0&&(t.player_user_id=e.playerUserId),e.characterId!==void 0&&(t.character_id=e.characterId??null),e.role!==void 0&&(t.role=e.role??null),t}function _b(e){const t={};return e.campaignId!==void 0&&(t.campaign_id=e.campaignId),e.name!==void 0&&(t.name=e.name),e.statsSkills!==void 0&&(t.stats_skills=e.statsSkills??null),e.attributes!==void 0&&(t.attributes=e.attributes??null),e.skills!==void 0&&(t.skills=e.skills??null),e.abilities!==void 0&&(t.abilities=e.abilities??null),e.actions!==void 0&&(t.actions=e.actions??null),e.immunities!==void 0&&(t.immunities=e.immunities??null),e.resistances!==void 0&&(t.resistances=e.resistances??null),e.weaknesses!==void 0&&(t.weaknesses=e.weaknesses??null),e.tags!==void 0&&(t.tags=e.tags??null),e.rank!==void 0&&(t.rank=e.rank??null),e.dr!==void 0&&(t.dr=e.dr??null),e.armorType!==void 0&&(t.armor_type=e.armorType??null),e.energyBars!==void 0&&(t.energy_bars=e.energyBars??null),e.lieutenantId!==void 0&&(t.lieutenant_id=e.lieutenantId??null),e.heroId!==void 0&&(t.hero_id=e.heroId??null),t}function SC(e){const t={};return e.campaignId!==void 0&&(t.campaign_id=e.campaignId),e.bestiaryEntryId!==void 0&&(t.bestiary_entry_id=e.bestiaryEntryId),e.pinnedOrder!==void 0&&(t.pinned_order=e.pinnedOrder??null),t}function xb(e){const t={};return e.campaignId!==void 0&&(t.campaign_id=e.campaignId),e.bestiaryEntryId!==void 0&&(t.bestiary_entry_id=e.bestiaryEntryId??null),e.characterId!==void 0&&(t.character_id=e.characterId??null),e.faction!==void 0&&(t.faction=e.faction??null),e.isActive!==void 0&&(t.is_active=e.isActive??null),e.initiative!==void 0&&(t.initiative=e.initiative??null),e.notes!==void 0&&(t.notes=e.notes??null),e.tier!==void 0&&(t.tier=e.tier??null),e.energyMax!==void 0&&(t.energy_max=e.energyMax??null),e.apMax!==void 0&&(t.ap_max=e.apMax??null),t}async function Ps(e,t,n){const s=await fetch(`/api/campaigns/${encodeURIComponent(e)}/combat/${t}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(n??{})}),r=await s.text();let i=null;if(r)try{i=JSON.parse(r)}catch{i=r}if(!s.ok){const o=typeof i=="object"&&i&&"error"in i?String(i.error):`Request failed with status ${s.status}`;throw new Te(s.status,o,i)}return i}async function EC(e,t={}){return Ps(e,"start",t)}async function CC(e){return Ps(e,"state",{})}async function AC(e,t={}){return Ps(e,"advance",t)}async function IC(e,t={}){return Ps(e,"advance-turn",t)}async function PC(e,t={}){return Ps(e,"resolve-ambush",t)}async function TC(e,t){return Ps(e,"spend",t)}async function RC(e,t){return Ps(e,"reaction",t)}function DC(e){return{campaign_id:e.campaignId,combatant_id:e.combatantId,status_key:e.statusKey,duration_type:e.durationType??null,duration_remaining:e.durationRemaining??null,stacks:e.stacks??1,is_active:e.isActive??!0,applied_at:e.appliedAt??null,updated_at:e.updatedAt??null}}function MC(e){return{campaign_id:e.campaignId,combatant_id:e.combatantId,wound_type:e.woundType,wound_count:e.woundCount??0,updated_at:e.updatedAt??null}}function wb(e){const t={};return e.campaignId!==void 0&&(t.campaign_id=e.campaignId),e.title!==void 0&&(t.title=e.title),e.body!==void 0&&(t.body=e.body??null),e.tags!==void 0&&(t.tags=e.tags??null),e.isPlayerVisible!==void 0&&(t.is_player_visible=e.isPlayerVisible??null),t}async function LC(){st();const e=ze(),{data:t,error:n}=await e.from("campaigns").select("id, name, gm_user_id, created_at").order("created_at",{ascending:!0});if(n)throw new Te(0,`Failed to load campaigns: ${n.message}`);return(t??[]).map(sm)}async function OC(e){st();const t=ze();if(e.name===void 0)throw new Te(0,"name is required to create a campaign");const n=await gb(t),s={...bb(e),gm_user_id:n},{data:r,error:i}=await t.from("campaigns").insert(s).select("id, name, gm_user_id, created_at").single();if(i||!r)throw new Te(0,`Failed to create campaign: ${(i==null?void 0:i.message)??"unknown error"}`);return sm(r)}async function $C(e,t){st();const n=ze(),s=bb(t),{data:r,error:i}=await n.from("campaigns").update(s).eq("id",e).select("id, name, gm_user_id, created_at").single();if(i||!r)throw new Te(0,`Failed to update campaign: ${(i==null?void 0:i.message)??"unknown error"}`);return sm(r)}async function BC(e){st();const t=ze(),{error:n}=await t.from("campaigns").delete().eq("id",e);if(n)throw new Te(0,`Failed to delete campaign: ${n.message}`)}async function FC(e){st();const t=ze(),{data:n,error:s}=await t.from("campaign_invites").select("token, campaign_id, created_by, created_at, expires_at").eq("campaign_id",e).order("created_at",{ascending:!1});if(s)throw new Te(0,`Failed to load campaign invites: ${s.message}`);return(n??[]).map(yb)}async function qC(e){st();const t=ze();if(!e.campaignId)throw new Te(0,"campaignId is required to create an invite");const n=await gb(t),s=NC({...e,token:e.token??xC(),createdBy:n,expiresAt:e.expiresAt??kC()}),{data:r,error:i}=await t.from("campaign_invites").insert(s).select("token, campaign_id, created_by, created_at, expires_at").single();if(i||!r)throw new Te(0,`Failed to create invite: ${(i==null?void 0:i.message)??"unknown error"}`);return yb(r)}async function UC(e){st();const t=ze(),{error:n}=await t.from("campaign_invites").delete().eq("token",e);if(n)throw new Te(0,`Failed to revoke invite: ${n.message}`)}async function WC(e){st();const t=ze(),{data:n,error:s}=await t.from("campaign_members").select("campaign_id, player_user_id, character_id, role").eq("campaign_id",e).order("player_user_id",{ascending:!0});if(s)throw new Te(0,`Failed to load campaign members: ${s.message}`);return(n??[]).map(vb)}async function zC(e){st();const t=ze();if(!e.campaignId||!e.playerUserId)throw new Te(0,"campaignId and playerUserId are required to add a member");const n=jC(e),{data:s,error:r}=await t.from("campaign_members").insert(n).select("campaign_id, player_user_id, character_id, role").single();if(r||!s)throw new Te(0,`Failed to add campaign member: ${(r==null?void 0:r.message)??"unknown error"}`);return vb(s)}async function HC(e,t){st();const n=ze(),{error:s}=await n.from("campaign_members").delete().eq("campaign_id",e).eq("player_user_id",t);if(s)throw new Te(0,`Failed to remove campaign member: ${s.message}`)}async function YC(e){st();const t=ze(),{data:n,error:s}=await t.from("bestiary_entries").select("id, campaign_id, name, stats_skills, attributes, skills, abilities, actions, immunities, resistances, weaknesses, tags, rank, dr, armor_type, energy_bars, lieutenant_id, hero_id").eq("campaign_id",e).order("name",{ascending:!0});if(s)throw new Te(0,`Failed to load bestiary entries: ${s.message}`);return(n??[]).map(rm)}async function VC(e){st();const t=ze();if(!e.campaignId||!e.name)throw new Te(0,"campaignId and name are required to create a bestiary entry");const n=_b(e),{data:s,error:r}=await t.from("bestiary_entries").insert(n).select("id, campaign_id, name, stats_skills, attributes, skills, abilities, actions, immunities, resistances, weaknesses, tags, rank, dr, armor_type, energy_bars, lieutenant_id, hero_id").single();if(r||!s)throw new Te(0,`Failed to create bestiary entry: ${(r==null?void 0:r.message)??"unknown error"}`);return rm(s)}async function KC(e,t){st();const n=ze(),s=_b(t),{data:r,error:i}=await n.from("bestiary_entries").update(s).eq("id",e).select("id, campaign_id, name, stats_skills, attributes, skills, abilities, actions, immunities, resistances, weaknesses, tags, rank, dr, armor_type, energy_bars, lieutenant_id, hero_id").single();if(i||!r)throw new Te(0,`Failed to update bestiary entry: ${(i==null?void 0:i.message)??"unknown error"}`);return rm(r)}async function GC(e){st();const t=ze(),{error:n}=await t.from("bestiary_entries").delete().eq("id",e);if(n)throw new Te(0,`Failed to delete bestiary entry: ${n.message}`)}async function JC(e){st();const t=ze(),n=SC(e),{error:s}=await t.from("npc_pins").insert(n);if(s)throw new Te(0,`Failed to pin bestiary entry: ${s.message}`)}async function QC(e,t){st();const n=ze(),{error:s}=await n.from("npc_pins").delete().eq("campaign_id",e).eq("bestiary_entry_id",t);if(s)throw new Te(0,`Failed to unpin bestiary entry: ${s.message}`)}async function XC(e){st();const t=ze(),[n,s,r]=await Promise.all([t.from("campaign_combatants").select("id, campaign_id, bestiary_entry_id, character_id, faction, is_active, initiative, notes, energy_current, ap_current, tier, energy_max, ap_max, bestiary_entries(id, name)").eq("campaign_id",e).order("initiative",{ascending:!1}),t.from("campaign_combatant_status_effects").select("id, campaign_id, combatant_id, status_key, duration_type, duration_remaining, stacks, is_active, applied_at, updated_at").eq("campaign_id",e),t.from("campaign_combatant_wounds").select("id, campaign_id, combatant_id, wound_type, wound_count, updated_at").eq("campaign_id",e)]);if(n.error)throw new Te(0,`Failed to load combatants: ${n.error.message}`);if(s.error)throw new Te(0,`Failed to load combatant status effects: ${s.error.message}`);if(r.error)throw new Te(0,`Failed to load combatant wounds: ${r.error.message}`);const i=new Map;(s.data??[]).forEach(l=>{const c=lm(l),u=i.get(c.combatantId)??[];u.push(c),i.set(c.combatantId,u)});const o=new Map;return(r.data??[]).forEach(l=>{const c=cm(l),u=o.get(c.combatantId)??[];u.push(c),o.set(c.combatantId,u)}),(n.data??[]).map(l=>{const c=om(l);return{...c,statusEffects:i.get(c.id)??[],wounds:o.get(c.id)??[]}})}async function ZC(e){st();const t=ze();if(!e.campaignId||!e.bestiaryEntryId&&!e.characterId)throw new Te(0,"campaignId and a bestiaryEntryId or characterId are required to create a combatant");const n=xb(e),{data:s,error:r}=await t.from("campaign_combatants").insert(n).select("id, campaign_id, bestiary_entry_id, character_id, faction, is_active, initiative, notes, energy_current, ap_current, tier, energy_max, ap_max, bestiary_entries(id, name)").single();if(r||!s)throw new Te(0,`Failed to create combatant: ${(r==null?void 0:r.message)??"unknown error"}`);return om(s)}async function eA(e,t){st();const n=ze(),s=xb(t),{data:r,error:i}=await n.from("campaign_combatants").update(s).eq("id",e).select("id, campaign_id, bestiary_entry_id, character_id, faction, is_active, initiative, notes, energy_current, ap_current, tier, energy_max, ap_max, bestiary_entries(id, name)").single();if(i||!r)throw new Te(0,`Failed to update combatant: ${(i==null?void 0:i.message)??"unknown error"}`);return om(r)}async function tA(e){st();const t=ze(),{error:n}=await t.from("campaign_combatants").delete().eq("id",e);if(n)throw new Te(0,`Failed to remove combatant: ${n.message}`)}async function nA(e){st();const t=ze(),{data:n,error:s}=await t.from("campaign_combatant_status_effects").select("id, campaign_id, combatant_id, status_key, duration_type, duration_remaining, stacks, is_active, applied_at, updated_at").eq("campaign_id",e);if(s)throw new Te(0,`Failed to load combatant status effects: ${s.message}`);return(n??[]).map(lm)}async function aA(e){st();const t=ze(),n=DC(e),{data:s,error:r}=await t.from("campaign_combatant_status_effects").upsert(n,{onConflict:"combatant_id,status_key"}).select("id, campaign_id, combatant_id, status_key, duration_type, duration_remaining, stacks, is_active, applied_at, updated_at").single();if(r||!s)throw new Te(0,`Failed to upsert combatant status effect: ${(r==null?void 0:r.message)??"unknown error"}`);return lm(s)}async function sA(e){st();const t=ze(),{error:n}=await t.from("campaign_combatant_status_effects").delete().eq("id",e);if(n)throw new Te(0,`Failed to remove combatant status effect: ${n.message}`)}async function rA(e){st();const t=ze(),{data:n,error:s}=await t.from("campaign_combatant_wounds").select("id, campaign_id, combatant_id, wound_type, wound_count, updated_at").eq("campaign_id",e);if(s)throw new Te(0,`Failed to load combatant wounds: ${s.message}`);return(n??[]).map(cm)}async function iA(e){st();const t=ze(),n=MC(e),{data:s,error:r}=await t.from("campaign_combatant_wounds").upsert(n,{onConflict:"combatant_id,wound_type"}).select("id, campaign_id, combatant_id, wound_type, wound_count, updated_at").single();if(r||!s)throw new Te(0,`Failed to upsert combatant wound: ${(r==null?void 0:r.message)??"unknown error"}`);return cm(s)}async function oA(e){st();const t=ze(),{data:n,error:s}=await t.from("setting_entries").select("id, campaign_id, title, body, tags, is_player_visible").eq("campaign_id",e).order("title",{ascending:!0});if(s)throw new Te(0,`Failed to load settings: ${s.message}`);return(n??[]).map(im)}async function lA(e){st();const t=ze();if(!e.campaignId||!e.title)throw new Te(0,"campaignId and title are required to create a setting");const n=wb(e),{data:s,error:r}=await t.from("setting_entries").insert(n).select("id, campaign_id, title, body, tags, is_player_visible").single();if(r||!s)throw new Te(0,`Failed to create setting: ${(r==null?void 0:r.message)??"unknown error"}`);return im(s)}async function cA(e,t){st();const n=ze(),s=wb(t),{data:r,error:i}=await n.from("setting_entries").update(s).eq("id",e).select("id, campaign_id, title, body, tags, is_player_visible").single();if(i||!r)throw new Te(0,`Failed to update setting: ${(i==null?void 0:i.message)??"unknown error"}`);return im(r)}async function uA(e){st();const t=ze(),{error:n}=await t.from("setting_entries").delete().eq("id",e);if(n)throw new Te(0,`Failed to delete setting: ${n.message}`)}const tt={listCampaigns:LC,createCampaign:OC,updateCampaign:$C,deleteCampaign:BC,listCampaignInvites:FC,createCampaignInvite:qC,revokeCampaignInvite:UC,listCampaignMembers:WC,addCampaignMember:zC,removeCampaignMember:HC,listBestiaryEntries:YC,createBestiaryEntry:VC,updateBestiaryEntry:KC,deleteBestiaryEntry:GC,pinBestiaryEntry:JC,unpinBestiaryEntry:QC,listCombatants:XC,createCombatant:ZC,updateCombatant:eA,deleteCombatant:tA,listCombatantStatusEffects:nA,upsertCombatantStatusEffect:aA,removeCombatantStatusEffect:sA,listCombatantWounds:rA,upsertCombatantWound:iA,listSettings:oA,createSetting:lA,updateSetting:cA,deleteSetting:uA,startCombat:EC,advanceCombat:AC,getCombatState:CC,advanceCombatTurn:IC,spendCombatResources:TC,recordCombatReaction:RC,resolveAmbushCheck:PC},dA=e=>`${typeof window<"u"?window.location.origin:"https://adurun.app"}/join/${e}`,hA=()=>{const[e,t]=v.useState([]),[n,s]=v.useState(""),[r,i]=v.useState(null),[o,l]=v.useState({}),[c,u]=v.useState(!0),[d,h]=v.useState(null);v.useEffect(()=>{let w=!0;return(async()=>{u(!0),h(null);try{const p=await tt.listCampaigns();if(!w)return;t(p)}catch(p){if(!w)return;h(p instanceof Error?p.message:"Failed to load campaigns.")}finally{w&&u(!1)}})(),()=>{w=!1}},[]),v.useEffect(()=>{let w=!0;const f=async()=>{const p=await Promise.all(e.map(async g=>{try{const j=await tt.listCampaignInvites(g.id);return[g.id,j[0]??null]}catch{return[g.id,null]}}));w&&l(g=>{const j={...g};return p.forEach(([A,R])=>{j[A]=R}),j})};return e.length>0?f():l({}),()=>{w=!1}},[e]);const m=async w=>{w.preventDefault(),h(null);const f=n.trim();if(f)try{const p=await tt.createCampaign({name:f});t(g=>[p,...g]),s("")}catch(p){h(p instanceof Error?p.message:"Failed to create campaign.")}},y=async w=>{var f;if(typeof navigator<"u"&&((f=navigator.clipboard)!=null&&f.writeText)){await navigator.clipboard.writeText(w),i("Invite link copied."),setTimeout(()=>i(null),2e3);return}i("Clipboard unavailable. Copy manually.")},b=async w=>{h(null);try{const f=o[w];f!=null&&f.token&&await tt.revokeCampaignInvite(f.token);const p=await tt.createCampaignInvite({campaignId:w});l(g=>({...g,[w]:p}))}catch(f){h(f instanceof Error?f.message:"Failed to regenerate invite.")}},_=async w=>{h(null);try{const f=await tt.createCampaignInvite({campaignId:w});l(p=>({...p,[w]:f}))}catch(f){h(f instanceof Error?f.message:"Failed to create invite.")}};return a.jsxs("div",{className:"gm-campaigns",children:[a.jsxs("header",{children:[a.jsx("h2",{className:"gm-campaigns__title h2",children:"Campaigns"}),a.jsx("p",{className:"gm-campaigns__subtitle subtitle muted",children:"Create a campaign and share an invite link with players."})]}),a.jsxs("section",{className:"gm-campaigns__card",children:[a.jsx("h3",{className:"gm-campaigns__card-title h3",children:"Create Campaign"}),a.jsxs("form",{onSubmit:m,className:"gm-campaigns__form",children:[a.jsxs("label",{className:"gm-campaigns__field",children:[a.jsx("span",{className:"gm-campaigns__label",children:"Campaign Name"}),a.jsx("input",{value:n,onChange:w=>s(w.target.value),placeholder:"Crimson Coast",className:"gm-campaigns__input"})]}),a.jsx("button",{type:"submit",className:"gm-campaigns__button gm-campaigns__button--primary",children:"Create Campaign"})]})]}),a.jsxs("section",{className:"gm-campaigns__card",children:[a.jsx("h3",{className:"gm-campaigns__card-title h3",children:"Active Campaigns"}),d&&a.jsx("div",{className:"gm-campaigns__message gm-campaigns__message--error",children:d}),r&&a.jsx("div",{className:"gm-campaigns__message gm-campaigns__message--success",children:r}),c?a.jsx("p",{className:"gm-campaigns__muted body muted",children:"Loading campaigns..."}):e.length===0?a.jsx("p",{className:"gm-campaigns__muted body muted",children:"No campaigns yet. Create one above."}):a.jsx("div",{className:"gm-campaigns__list",children:e.map(w=>{const f=o[w.id],p=f?dA(f.token):null;return a.jsxs("div",{className:"gm-campaigns__item",children:[a.jsxs("div",{className:"gm-campaigns__item-header",children:[a.jsxs("div",{children:[a.jsx("div",{className:"gm-campaigns__item-title",children:w.name}),w.createdAt&&a.jsxs("div",{className:"gm-campaigns__item-meta",children:["Created ",new Date(w.createdAt).toLocaleDateString()]})]}),a.jsx("span",{className:"gm-campaigns__status",children:f?"INVITE READY":"NO INVITE"})]}),a.jsxs("div",{className:"gm-campaigns__invite-row",children:[a.jsx("span",{className:"gm-campaigns__invite-label",children:"Invite Link:"}),a.jsx("span",{className:"gm-campaigns__invite-value",children:p??"Generate an invite to share."})]}),a.jsxs("div",{className:"gm-campaigns__actions",children:[a.jsx(Vh,{to:`/gm/campaigns/${w.id}`,className:"gm-campaigns__button gm-campaigns__button--primary",children:"Open Campaign"}),a.jsx("button",{type:"button",onClick:()=>p&&y(p),disabled:!p,className:"gm-campaigns__button gm-campaigns__button--neutral",children:"Copy Link"}),a.jsx("button",{type:"button",onClick:()=>b(w.id),className:"gm-campaigns__button gm-campaigns__button--danger",children:"Regenerate Link"}),!f&&a.jsx("button",{type:"button",onClick:()=>_(w.id),className:"gm-campaigns__button gm-campaigns__button--primary",children:"Create Invite"})]})]},w.id)})})]})]})},mA=/\b(Hero|Lieutenant|Minion|NPC)\b/i,pA={physical:"PHYSICAL",mental:"MENTAL",spiritual:"SPIRITUAL",will:"WILL"},fA=e=>{const t=e.match(/^(.+?)\s*\((.+)\)$/);if(!t)return null;const n=t[1].trim(),s=t[2],r=s.match(mA),i=r?r[1]:"",o=s.split(/,\s*/).map(l=>l.trim()).filter(l=>l&&!l.toLowerCase().includes("rank"));return{name:n,rank:i,tags:o}},gA=(e,t)=>{const n=/(\d+)\s*(Physical|Mental|Spiritual|Will)/gi;let s=n.exec(e);for(;s;){const r=Number(s[1]),i=pA[s[2].toLowerCase()];t[i]=r,s=n.exec(e)}},yA=(e,t,n,s,r,i)=>{const o=e.match(/([+-]?\d+)\s+(.+)/);if(!o)return;const l=Number(o[1]),c=o[2].trim();if(!Number.isFinite(l)||!c)return;const u=aa({name:c});u&&(t[u]=l,n.size&&!n.has(u)&&s.push({blockIndex:r,entryName:i,message:`Unknown skill '${c}' parsed as ${u}.`,block:e,level:"warning"}))},vA=(e,t,n,s,r,i)=>{const o=e.match(/(\d+)\s*energy/i);o?t.energy=Number(o[1]):/energy/i.test(e)&&s.push({blockIndex:r,entryName:i,message:"Energy mentioned but no numeric value found.",block:e,level:"warning"});const l=e.match(/x\s*(\d+)\s*bars?/i);if(l){const u=Number(l[1]);Number.isFinite(u)&&(n.energyBars=u,t.energy_bars=u)}const c=e.match(/(\d+)\s*ap/i);c?t.ap=Number(c[1]):/\bap\b/i.test(e)&&s.push({blockIndex:r,entryName:i,message:"AP mentioned but no numeric value found.",block:e,level:"warning"})},bA=(e,t,n,s,r,i)=>{const o=e.match(/(\d+)\s*dr/i);if(o){t.dr=Number(o[1]);const l=e.match(/\(([^)]+)\)/);l&&(n.armorType=l[1].trim())}else/\bdr\b/i.test(e)&&s.push({blockIndex:r,entryName:i,message:"DR mentioned but no numeric value found.",block:e,level:"warning"})},_A=e=>{const t=[],n=[],s=[];let r=!1;const i=e.replace(/Damage Type/gi,"Damage").replace(/\s+/g," ").trim(),o=i.matchAll(/Immune\s+to\s+([^,]+?)(?:\s+Damage)?(?:,|$)/gi);for(const d of o){r=!0;const m=d[1].trim().replace(/\s+Damage$/i,"").split(/\s+and\s+/i);for(const y of m){const b=y.trim();b&&!t.includes(b)&&t.push(b)}}const l=i.match(/Cannot\s+be\s+killed\s+by\s+([^,]+?)(?:\s+Damage)?(?:,|$)/i);if(l){r=!0;const h=l[1].trim().replace(/\s+Damage$/i,"").split(/\s+or\s+/i);for(const m of h){const y=m.trim();y&&!t.includes(y)&&t.push(y)}}const c=i.matchAll(/Resistant\s+to\s+([^,]+?)(?:\s+Damage)?(?:,|$)/gi);for(const d of c){r=!0;const m=d[1].trim().replace(/\s+Damage$/i,"").split(/\s+and\s+/i);for(const y of m){const b=y.trim();b&&!n.includes(b)&&n.push(b)}}const u=i.matchAll(/Vulnerable\s+to\s+([^,(]+?)(?:\s+Damage)?(?:\s*\([^)]*\))?(?:,|$)/gi);for(const d of u){r=!0;const m=d[1].trim().replace(/\s+Damage$/i,"").split(/\s+and\s+/i);for(const y of m){const b=y.trim();b&&!s.includes(b)&&s.push(b)}}return{immunities:t,resistances:n,weaknesses:s,matched:r}},If=e=>{const t=e.match(/(\d+\s*-\s*\d+|\d+)\s*range/i);if(t)return t[1].replace(/\s+/g,"")},Pf=e=>{const t=e.match(/(\d+[^,;]*damage)/i);if(t)return t[1].trim()},os=e=>({type:e.type,name:e.name,description:e.description,phase:e.phase,range:e.range,damage:e.damage,rules:e.rules}),xA=(e,t)=>{const n=e.replace(/\r/g,"").trim();if(!n)return{entries:[],messages:[{blockIndex:0,message:"No content provided.",block:"",level:"error"}]};const s=new Set(((t==null?void 0:t.knownSkillCodes)??[]).map(u=>u.toUpperCase())),r=n.split(/\n\s*\n/).map(u=>u.trim()).filter(Boolean);let i;const o=[...r];o.length&&!/\(.+\)/.test(o[0])&&(i=o.shift());const l=[],c=[];return o.forEach((u,d)=>{const h=u.split(`
`).map(E=>E.trim()).filter(Boolean),m=h[0],y=fA(m);if(!y||!y.name){c.push({blockIndex:d,message:"Missing or invalid header line.",block:u,level:"error"});return}if(!y.rank){c.push({blockIndex:d,entryName:y.name,message:`Missing rank for ${y.name}.`,block:u,level:"error"});return}const b={},_={},w=[],f=[],p=[],g=[];let j=null,A=null;const R={name:y.name,rank:y.rank,groupName:i,attributes:b,skills:_,abilities:w,tags:y.tags,immunities:f,resistances:p,weaknesses:g};let S,k,N;for(let E=1;E<h.length;E+=1){const M=h[E],O=M.match(/^Hero:\s*(.+)$/i);if(O){k=O[1].trim();continue}const X=M.match(/^Lieutenant:\s*(.+)$/i);if(X){N=X[1].trim();continue}const re=M.match(/^(Notes|Description):\s*(.+)$/i);if(re){S=re[2].trim();continue}if(/^Attributes:/i.test(M)){j="attributes";continue}if(/^Skill Investments:/i.test(M)){j="skills";continue}const I=M.match(/^Feature\s*\d+\s*\[(.+?)\]:\s*(.+)$/i);if(I){w.push(os({type:"feature",name:I[1],description:I[2]})),j=null;continue}const $=M.match(/^Command Ability\s*\d+\s*\[(.+?)\]:\s*(.+)$/i);if($){w.push(os({type:"command",name:$[1],description:$[2]})),j=null;continue}if(M.match(/^Phase\s*\d+/i)){A=M,j=null;continue}if(j==="attributes"){gA(M,b);continue}if(j==="skills"){yA(M,_,s,c,d,y.name);continue}vA(M,b,R,c,d,y.name),bA(M,b,R,c,d,y.name);const D=_A(M);if(D.matched){for(const q of D.immunities)f.includes(q)||f.push(q);for(const q of D.resistances)p.includes(q)||p.push(q);for(const q of D.weaknesses)g.includes(q)||g.push(q)}const F=M.match(/^([^:]+):\s*(.+)$/);if(F){const q=F[1].trim(),V=F[2].trim();w.push(os({type:A?"phase-action":"action",name:q,description:V,phase:A??void 0,range:If(V),damage:Pf(V)}));continue}if(A){w.push(os({type:"phase-rule",name:A,description:M,phase:A}));continue}if(/movement actions/i.test(M)){w.push(os({type:"action-economy",name:"Action Economy",description:M}));continue}(/damage/i.test(M)||/range/i.test(M))&&w.push(os({type:"action",name:"Attack",description:M,range:If(M),damage:Pf(M)}))}R.heroName=k,R.lieutenantName=N,R.description=S,R.energyBars&&R.energyBars>1&&R.abilities.push(os({type:"phase-unlock",name:"Phase Unlock",rules:`Unlock the next phase each time energy reaches 0 (${R.energyBars} total bars).`})),l.push(R)}),{groupName:i,entries:l,messages:c}},wA="_root_1rxhn_17",kA="_header_1rxhn_59",NA="_title_1rxhn_78",jA="_subtitle_1rxhn_92",SA="_error_1rxhn_101",EA="_mainLayout_1rxhn_114",CA="_sidebar_1rxhn_136",AA="_card_1rxhn_151",IA="_summaryCard_1rxhn_179",PA="_detailPanel_1rxhn_212",TA="_collapsible_1rxhn_221",RA="_sectionHeader_1rxhn_239",DA="_sectionToggle_1rxhn_263",MA="_collapsibleBody_1rxhn_270",LA="_detailStack_1rxhn_293",OA="_detailHeader_1rxhn_298",$A="_detailActions_1rxhn_307",BA="_detailSection_1rxhn_313",FA="_sectionTitle_1rxhn_344",qA="_infoStack_1rxhn_353",UA="_description_1rxhn_358",WA="_form_1rxhn_372",zA="_field_1rxhn_377",HA="_fieldLabel_1rxhn_382",YA="_fieldLabelMedium_1rxhn_390",VA="_input_1rxhn_395",KA="_textarea_1rxhn_420",GA="_primaryButton_1rxhn_429",JA="_secondaryButton_1rxhn_455",QA="_actionButton_1rxhn_472",XA="_actionButtonSecondary_1rxhn_501",ZA="_dangerButton_1rxhn_517",eI="_editButton_1rxhn_533",tI="_submitButton_1rxhn_550",nI="_rowBetween_1rxhn_578",aI="_rowWrap_1rxhn_585",sI="_actionRow_1rxhn_598",rI="_gridAuto120_1rxhn_604",iI="_gridAuto140_1rxhn_610",oI="_gridAuto150_1rxhn_616",lI="_gridAuto160_1rxhn_622",cI="_gridAuto180_1rxhn_628",uI="_gridTwo_1rxhn_634",dI="_gridTwoWide_1rxhn_640",hI="_gridThree_1rxhn_646",mI="_gridThreeWide_1rxhn_652",pI="_listPanel_1rxhn_662",fI="_entryButton_1rxhn_681",gI="_entryName_1rxhn_722",yI="_entryMeta_1rxhn_728",vI="_emptyText_1rxhn_734",bI="_chipRow_1rxhn_746",_I="_rankChip_1rxhn_753",xI="_statLabel_1rxhn_808",wI="_statValue_1rxhn_816",kI="_attributeCard_1rxhn_823",NI="_skillCard_1rxhn_840",jI="_mutedText_1rxhn_859",SI="_mutedTextSmall_1rxhn_863",EI="_mutedTextMedium_1rxhn_868",CI="_valueChip_1rxhn_877",AI="_chipRemove_1rxhn_898",II="_actionList_1rxhn_917",PI="_actionInputsRow_1rxhn_922",TI="_selectionGrid_1rxhn_937",RI="_checkboxRow_1rxhn_943",C={root:wA,header:kA,title:NA,subtitle:jA,error:SA,mainLayout:EA,sidebar:CA,card:AA,summaryCard:IA,detailPanel:PA,collapsible:TA,sectionHeader:RA,sectionToggle:DA,collapsibleBody:MA,detailStack:LA,detailHeader:OA,detailActions:$A,detailSection:BA,sectionTitle:FA,infoStack:qA,description:UA,form:WA,field:zA,fieldLabel:HA,fieldLabelMedium:YA,input:VA,textarea:KA,primaryButton:GA,secondaryButton:JA,actionButton:QA,actionButtonSecondary:XA,dangerButton:ZA,editButton:eI,submitButton:tI,rowBetween:nI,rowWrap:aI,actionRow:sI,gridAuto120:rI,gridAuto140:iI,gridAuto150:oI,gridAuto160:lI,gridAuto180:cI,gridTwo:uI,gridTwoWide:dI,gridThree:hI,gridThreeWide:mI,listPanel:pI,entryButton:fI,entryName:gI,entryMeta:yI,emptyText:vI,chipRow:bI,rankChip:_I,statLabel:xI,statValue:wI,attributeCard:kI,skillCard:NI,mutedText:jI,mutedTextSmall:SI,mutedTextMedium:EI,valueChip:CI,chipRemove:AI,actionList:II,actionInputsRow:PI,selectionGrid:TI,checkboxRow:RI},Ra=["PHYSICAL","MENTAL","SPIRITUAL","WILL"],Fr={PHYSICAL:"Physical",MENTAL:"Mental",SPIRITUAL:"Spiritual",WILL:"Will"},qr=["NPC","Minion","Lieutenant","Hero"],Tf=e=>e<=0||Number.isNaN(e)?"Unknown":e===1?"Fledgling":e===2?"Advanced":e===3?"Heroic":e===4?"Epic":e===5?"Legendary":e===6?"Mythic":`Mythic ${e-5}`,Zn=e=>typeof e=="number"&&!Number.isNaN(e)?`${e}`:typeof e=="string"&&e.trim()?e.trim():"",mu=e=>Array.isArray(e)?e.filter(t=>typeof t=="string").map(t=>t.trim()).filter(Boolean):[],DI=e=>Array.isArray(e)?e.map(t=>{if(!t||typeof t!="object")return null;const n=t,s=typeof n.range=="string"?n.range:"",r=typeof n.damage=="string"?n.damage:"",i=typeof n.damageType=="string"?n.damageType:"";return{energyCost:Zn(n.energyCost),apCost:Zn(n.apCost),range:s,damage:r,damageType:i}}).filter(t=>!!t).filter(t=>[t.energyCost,t.apCost,t.range,t.damage,t.damageType].some(n=>n.trim())):[],Rf=()=>({energyCost:"",apCost:"",range:"",damage:"",damageType:""}),Df=e=>{const t=[];for(const[n,s]of e.entries()){if(![s.energyCost,s.apCost,s.range,s.damage,s.damageType].some(d=>d.trim()))continue;const i=It(`Action ${n+1} energy cost`,s.energyCost);if(i.error)return{error:i.error};const o=It(`Action ${n+1} AP cost`,s.apCost);if(o.error)return{error:o.error};const l=s.range.trim(),c=s.damage.trim(),u=s.damageType.trim();t.push({energyCost:i.value,apCost:o.value,range:l||void 0,damage:c||void 0,damageType:u||void 0})}return{value:t}},Mf=(e,t,n)=>{const s={},r=e.type.trim(),i=e.description.trim();return r&&(s.type=r),i&&(s.description=i),t!==void 0&&(s.tier=t),e.immunities.length&&(s.immunities=e.immunities),e.resistances.length&&(s.resistances=e.resistances),e.weaknesses.length&&(s.weaknesses=e.weaknesses),n&&n.length&&(s.actions=n),s},It=(e,t)=>{const n=t.trim();if(!n)return{};const s=Number(n);return Number.isInteger(s)?{value:s}:{error:`${e} must be an integer.`}},Lf=e=>{const t={};for(const[n,s]of Object.entries(e)){const r=s.trim();if(!r)continue;const i=Number(r);if(!Number.isInteger(i))return{error:`Skill ${n} must be an integer.`};t[n]=i}return{value:t}},pu=e=>Ra.reduce((t,n)=>{const s=Number(e[n]);return t[n]=Number.isFinite(s)?s:0,t},{}),Jt=({title:e,isOpen:t,onToggle:n,children:s})=>a.jsxs("div",{className:C.collapsible,children:[a.jsxs("button",{type:"button",onClick:n,className:C.sectionHeader,children:[a.jsx("span",{children:e}),a.jsx("span",{className:C.sectionToggle,children:t?"":""})]}),t&&a.jsx("div",{className:C.collapsibleBody,children:s})]}),Us=({label:e,values:t,placeholder:n,onChange:s})=>{const[r,i]=v.useState(""),o=()=>{const l=r.trim();l&&(t.includes(l)||s([...t,l]),i(""))};return a.jsxs("div",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:e}),a.jsxs("div",{className:C.rowWrap,children:[a.jsx("input",{value:r,onChange:l=>i(l.target.value),onKeyDown:l=>{l.key==="Enter"&&(l.preventDefault(),o())},placeholder:n,className:C.input}),a.jsx("button",{type:"button",onClick:o,className:C.secondaryButton,children:"Add"})]}),t.length>0&&a.jsx("div",{className:C.chipRow,children:t.map(l=>a.jsxs("span",{className:C.valueChip,children:[l,a.jsx("button",{type:"button",onClick:()=>s(t.filter(c=>c!==l)),className:C.chipRemove,"aria-label":`Remove ${l}`,children:""})]},l))})]})},MI=()=>{const{campaignId:e}=Tn(),{data:t}=As(),[n,s]=v.useState([]),[r,i]=v.useState(e??""),[o,l]=v.useState([]),[c,u]=v.useState(""),[d,h]=v.useState(""),[m,y]=v.useState("NPC"),[b,_]=v.useState(""),[w,f]=v.useState(""),[p,g]=v.useState(""),[j,A]=v.useState(""),[R,S]=v.useState(""),[k,N]=v.useState(""),[E,M]=v.useState(""),[O,X]=v.useState({PHYSICAL:"",MENTAL:"",SPIRITUAL:"",WILL:""}),[re,I]=v.useState({}),[$,L]=v.useState([]),[D,F]=v.useState([]),[q,V]=v.useState([]),[Q,te]=v.useState([]),[B,ae]=v.useState(!1),[le,he]=v.useState(""),[ue,xe]=v.useState(""),[Ne,je]=v.useState(""),[Ce,Ke]=v.useState([]),[Me,oe]=v.useState(""),[pe,ve]=v.useState(""),[be,ke]=v.useState(null),[Ie,Be]=v.useState(!1),[_e,He]=v.useState(""),[De,ne]=v.useState("All"),[me,we]=v.useState(""),[Ye,Fe]=v.useState(""),[z,de]=v.useState(""),[U,P]=v.useState([]),[H,Z]=v.useState([]),[ie,ee]=v.useState(void 0),[G,Y]=v.useState(!1),[J,Ae]=v.useState({core:!0,stats:!0,defenses:!1,actions:!1,attributes:!1,skills:!1,abilities:!1}),[$e,Ue]=v.useState(null),[W,fe]=v.useState(null),[nt,mt]=v.useState(!0),[Rt,Pe]=v.useState(null),[Ve,xt]=v.useState(null),[ia,zi]=v.useState([]),[Hi,zb]=v.useState([]),[Yi,mc]=v.useState(""),[Vi,pc]=v.useState(""),hm=()=>{u(""),h(""),y("NPC"),_(""),f(""),g(""),A(""),S(""),N(""),M(""),X({PHYSICAL:"",MENTAL:"",SPIRITUAL:"",WILL:""}),L([]),F([]),V([]),te([]),I(x=>{const K={};return((t==null?void 0:t.skills)??[]).forEach(se=>{K[wt(se)]=""}),Object.keys(K).length?K:x}),ae(!1),he(""),xe(""),je(""),Ke([]),oe(""),ve("")};v.useEffect(()=>{t!=null&&t.skills&&I(x=>{if(Object.keys(x).length)return x;const K={};return t.skills.forEach(se=>{K[wt(se)]=""}),K})},[t]),v.useEffect(()=>{if(e){i(e);return}let x=!0;return(async()=>{mt(!0),Pe(null);try{const se=await tt.listCampaigns();if(!x)return;s(se),i(ce=>{var ye;return ce||((ye=se[0])==null?void 0:ye.id)||""})}catch(se){if(!x)return;Pe(se instanceof Error?se.message:"Failed to load campaigns.")}finally{x&&mt(!1)}})(),()=>{x=!1}},[e]),v.useEffect(()=>{if(!r){l([]);return}let x=!0;return(async()=>{mt(!0),Pe(null);try{const se=await tt.listBestiaryEntries(r);if(!x)return;l(se)}catch(se){if(!x)return;Pe(se instanceof Error?se.message:"Failed to load bestiary entries.")}finally{x&&mt(!1)}})(),()=>{x=!1}},[r]),v.useEffect(()=>{let x=!0;return xt(null),(async()=>{try{const se=ze(),{data:ce,error:ye}=await se.from("weapon_abilities").select("id, category, ability_name, ability_type, energy_cost, action_point_cost, damage, damage_type, range, description").order("category",{ascending:!0}).order("ability_name",{ascending:!0});if(ye)throw new Error(ye.message);const Ge=(ce??[]).filter(qe=>qe.category&&qe.ability_name).map(qe=>({id:qe.id,category:qe.category,name:qe.ability_name,abilityType:qe.ability_type??void 0,energyCost:typeof qe.energy_cost=="number"?qe.energy_cost:void 0,apCost:typeof qe.action_point_cost=="number"?qe.action_point_cost:void 0,damage:qe.damage??void 0,damageType:qe.damage_type??void 0,range:qe.range??void 0,description:qe.description??void 0})),ot=(await Ct.listPsionicAbilities()).map(qe=>({id:`${qe.ability_tree}:${qe.ability}`,tree:qe.ability_tree,name:qe.ability,tier:qe.tier??void 0,description:qe.description??void 0,energyCost:qe.energy_cost!==null&&qe.energy_cost!==void 0?Number(qe.energy_cost):void 0}));if(!x)return;zi(Ge),zb(ot),mc(qe=>{var Bt;return qe||((Bt=Ge[0])==null?void 0:Bt.category)||""}),pc(qe=>{var Bt;return qe||((Bt=ot[0])==null?void 0:Bt.tree)||""})}catch(se){if(!x)return;xt(se instanceof Error?se.message:"Failed to load abilities.")}})(),()=>{x=!1}},[]);const ut=(t==null?void 0:t.skills)??[],Er=v.useMemo(()=>new Set(ut.map(wt)),[ut]),Ki=v.useMemo(()=>Array.from(new Set(ia.map(x=>x.category))).sort((x,K)=>x.localeCompare(K)),[ia]),Gi=v.useMemo(()=>Array.from(new Set(Hi.map(x=>x.tree))).sort((x,K)=>x.localeCompare(K)),[Hi]),Ji=v.useCallback(x=>`${x.category}::${x.name}${x.abilityType?`::${x.abilityType}`:""}`,[]),Qi=v.useCallback(x=>`${x.tree}::${x.name}`,[]),mm=v.useCallback(x=>({type:"martial",category:x.category,key:Ji(x),name:x.name,description:x.description,range:x.range,damage:x.damage,energyCost:x.energyCost,apCost:x.apCost}),[Ji]),pm=v.useCallback(x=>({type:"psionic",tree:x.tree,key:Qi(x),name:x.name,description:x.description,energyCost:x.energyCost}),[Qi]),Xi=v.useCallback((x,K)=>x.some(ce=>ce.type===K.type&&ce.key===K.key)?x.filter(ce=>!(ce.type===K.type&&ce.key===K.key)):[...x,K],[]),Zi=v.useMemo(()=>ia.filter(x=>x.category===Yi),[ia,Yi]),eo=v.useMemo(()=>Hi.filter(x=>x.tree===Vi),[Hi,Vi]),fm=v.useCallback(x=>{const K=x.statsSkills,se=x.attributes??{},ce=typeof(K==null?void 0:K.type)=="string"?K.type:"",ye=typeof(K==null?void 0:K.description)=="string"?K.description:"",Ge=Zn((K==null?void 0:K.tier)??(se==null?void 0:se.tier)),Se=Zn(se==null?void 0:se.energy),ot=Zn(se==null?void 0:se.ap),qe=Zn((se==null?void 0:se.dr)??x.dr),Bt=typeof x.armorType=="string"?x.armorType:"",oa=Zn((se==null?void 0:se.energy_bars)??x.energyBars),ns=typeof x.rank=="string"?x.rank:"NPC",Hn=mu(K==null?void 0:K.immunities),ao=mu(K==null?void 0:K.resistances),Yn=mu(K==null?void 0:K.weaknesses),Aa=DI(K==null?void 0:K.actions),Je=Ra.reduce((xn,on)=>(xn[on]=Zn(se[on]),xn),{}),et=Ra.reduce((xn,on)=>{const Cr=Number(Je[on]);return xn[on]=Number.isFinite(Cr)?Cr:0,xn},{}),Vn=ma(et,ut),Rs=x.skills??{},la={};ut.forEach(xn=>{const on=wt(xn),Cr=Rs[on]??0,Sm=Vn[on]??0,n_=Cr-Sm;la[on]=Cr!==0||Sm!==0?`${n_}`:""}),Object.entries(Rs).forEach(([xn,on])=>{Er.has(xn)||typeof on=="number"&&!Number.isNaN(on)&&(la[xn]=`${on}`)});const Ia=x.abilities??[],Kn=Ia.find(xn=>xn.type==="custom"),km=typeof(Kn==null?void 0:Kn.name)=="string"?Kn.name:"",Nm=Zn(Kn==null?void 0:Kn.energyCost),jm=Zn(Kn==null?void 0:Kn.apCost),t_=!!(km||Nm||jm);return{id:x.id,name:x.name,type:ce,rank:ns,description:ye,tier:Ge,maxEnergy:Se,maxAp:ot,dr:qe,armorType:Bt,energyBars:oa,attributes:Je,skills:la,actions:Aa,immunities:Hn,resistances:ao,weaknesses:Yn,customAbilityEnabled:t_,customAbilityName:km,customAbilityEnergy:Nm,customAbilityAp:jm,abilities:Ia,lieutenantId:x.lieutenantId??"",heroId:x.heroId??""}},[ut,Er]),rn=v.useMemo(()=>o.map(fm),[o,fm]),gm=v.useMemo(()=>{const x=_e.trim().toLowerCase(),K=me.trim().toLowerCase(),se=Ye.trim();return rn.filter(ce=>!(De!=="All"&&ce.rank!==De||K&&!ce.type.toLowerCase().includes(K)||se&&ce.tier.trim()!==se||x&&!`${ce.name} ${ce.type} ${ce.description}`.toLowerCase().includes(x)))},[rn,_e,De,me,Ye]),ym=v.useCallback(x=>{const K=new Set(x.filter(ye=>ye.rank.toLowerCase()==="hero").map(ye=>ye.name)),se=new Set(x.filter(ye=>ye.rank.toLowerCase()==="lieutenant").map(ye=>ye.name)),ce=[];return x.forEach((ye,Ge)=>{const Se=ye.rank.toLowerCase();Se==="lieutenant"&&(ye.heroName?K.has(ye.heroName)||ce.push({blockIndex:Ge,entryName:ye.name,message:`Lieutenant references unknown hero '${ye.heroName}'.`,block:ye.name,level:"error"}):K.size===1?ye.heroName=Array.from(K)[0]:ce.push({blockIndex:Ge,entryName:ye.name,message:"Lieutenant requires a Hero reference when multiple heroes are present.",block:ye.name,level:"error"})),Se==="minion"&&(ye.lieutenantName?se.has(ye.lieutenantName)||ce.push({blockIndex:Ge,entryName:ye.name,message:`Minion references unknown lieutenant '${ye.lieutenantName}'.`,block:ye.name,level:"error"}):se.size===1?ye.lieutenantName=Array.from(se)[0]:ce.push({blockIndex:Ge,entryName:ye.name,message:"Minion requires a Lieutenant reference when multiple lieutenants are present.",block:ye.name,level:"error"}))}),ce},[]),Hb=v.useCallback(()=>{const x=ut.map(ce=>aa(ce)),K=xA(z,{knownSkillCodes:x}),se=ym(K.entries);P(K.entries),ee(K.groupName),Z([...K.messages,...se])},[z,ut,ym]),fc=x=>{const K=Object.fromEntries(Object.entries(x.attributes).filter(([,se])=>typeof se=="number"&&Number.isFinite(se)));return Object.keys(K).length?K:void 0},gc=x=>{const K=Object.fromEntries(Object.entries(x.skills).filter(([,se])=>typeof se=="number"&&Number.isFinite(se)));return Object.keys(K).length?K:void 0},yc=x=>{var se,ce,ye;const K={};return x.groupName&&(K.type=x.groupName),x.description&&(K.description=x.description),(se=x.immunities)!=null&&se.length&&(K.immunities=x.immunities),(ce=x.resistances)!=null&&ce.length&&(K.resistances=x.resistances),(ye=x.weaknesses)!=null&&ye.length&&(K.weaknesses=x.weaknesses),Object.keys(K).length?K:void 0},to=x=>{const K=x.toLowerCase();return K==="hero"?"Hero":K==="lieutenant"?"Lieutenant":K==="minion"?"Minion":"NPC"},Yb=async()=>{if(!r){Pe("Select a campaign before importing entries.");return}if(!U.length){Pe("Parse the import text before creating entries.");return}if(H.some(x=>x.level==="error")){Pe("Resolve import errors before creating entries.");return}Pe(null),Y(!0);try{const x=U.filter(Se=>Se.rank.toLowerCase()==="hero"),K=U.filter(Se=>Se.rank.toLowerCase()==="lieutenant"),se=U.filter(Se=>Se.rank.toLowerCase()==="minion"),ce=new Map,ye=new Map;for(const Se of x){const ot=await tt.createBestiaryEntry({campaignId:r,name:Se.name,statsSkills:yc(Se),attributes:fc(Se),skills:gc(Se),abilities:Se.abilities,tags:Se.tags,rank:to(Se.rank),dr:Se.attributes.dr,armorType:Se.armorType,energyBars:Se.energyBars});ce.set(Se.name,ot.id)}for(const Se of K){const ot=Se.heroName;if(!ot||!ce.has(ot))throw new Error(`Lieutenant ${Se.name} missing Hero reference.`);const qe=await tt.createBestiaryEntry({campaignId:r,name:Se.name,statsSkills:yc(Se),attributes:fc(Se),skills:gc(Se),abilities:Se.abilities,tags:Se.tags,rank:to(Se.rank),dr:Se.attributes.dr,armorType:Se.armorType,energyBars:Se.energyBars,heroId:ce.get(ot)});ye.set(Se.name,qe.id)}for(const Se of se){const ot=Se.lieutenantName;if(!ot||!ye.has(ot))throw new Error(`Minion ${Se.name} missing Lieutenant reference.`);await tt.createBestiaryEntry({campaignId:r,name:Se.name,statsSkills:yc(Se),attributes:fc(Se),skills:gc(Se),abilities:Se.abilities,tags:Se.tags,rank:to(Se.rank),dr:Se.attributes.dr,armorType:Se.armorType,energyBars:Se.energyBars,lieutenantId:ye.get(ot)})}de(""),P([]),Z([]),ee(void 0);const Ge=await tt.listBestiaryEntries(r);l(Ge)}catch(x){Pe(x instanceof Error?x.message:"Failed to import bestiary entries.")}finally{Y(!1)}};v.useEffect(()=>{var x;Ie||be&&rn.some(K=>K.id===be)||ke(((x=rn[0])==null?void 0:x.id)??null)},[rn,be,Ie]);const Vb=async x=>{if(x.preventDefault(),!r){Pe("Select a campaign before adding entries.");return}Pe(null);const K=c.trim();if(!K)return;const se=It("Tier",w);if(se.error){Pe(se.error);return}const ce=It("Max Energy",p);if(ce.error){Pe(ce.error);return}const ye=It("Max AP",j);if(ye.error){Pe(ye.error);return}const Ge=It("DR",R);if(Ge.error){Pe(Ge.error);return}const Se=It("Energy Bars",E);if(Se.error){Pe(Se.error);return}if(!qr.includes(m)){Pe("Rank must be NPC, Minion, Lieutenant, or Hero.");return}if(m==="Minion"&&!Me){Pe("Minions must be assigned to a Lieutenant.");return}if(m==="Lieutenant"&&!pe){Pe("Lieutenants must be assigned to a Hero.");return}const ot={},qe={};for(const Je of Ra){const et=It(`${Fr[Je]} attribute`,O[Je]);if(et.error){Pe(et.error);return}et.value!==void 0?(qe[Je]=et.value,ot[Je]=et.value):ot[Je]=0}const Bt=Lf(re);if(Bt.error){Pe(Bt.error);return}if(B&&!le.trim()){Pe("Custom ability name is required.");return}const oa=B?It("Custom ability energy cost",ue):{};if(oa.error){Pe(oa.error);return}const ns=B?It("Custom ability AP cost",Ne):{};if(ns.error){Pe(ns.error);return}const Hn=Df($);if(Hn.error){Pe(Hn.error);return}ce.value!==void 0&&(qe.energy=ce.value),ye.value!==void 0&&(qe.ap=ye.value),Ge.value!==void 0&&(qe.dr=Ge.value),Se.value!==void 0&&(qe.energy_bars=Se.value);const ao=ma(ot,ut),Yn={};ut.forEach(Je=>{var Ia;const et=wt(Je),Vn=((Ia=Bt.value)==null?void 0:Ia[et])??0,Rs=ao[et]??0,la=Vn+Rs;la!==0&&(Yn[et]=la)}),Object.entries(Bt.value??{}).forEach(([Je,et])=>{Er.has(Je)||et!==0&&(Yn[Je]=et)});const Aa=[...Ce];B&&Aa.push({type:"custom",key:le.trim(),name:le.trim(),energyCost:oa.value,apCost:ns.value});try{const Je={id:"",name:K,type:d,rank:m,description:b,tier:w,maxEnergy:p,maxAp:j,dr:R,armorType:k,energyBars:E,attributes:O,skills:re,actions:$,immunities:D,resistances:q,weaknesses:Q,customAbilityEnabled:B,customAbilityName:le,customAbilityEnergy:ue,customAbilityAp:Ne,abilities:Aa,lieutenantId:Me,heroId:pe},et=await tt.createBestiaryEntry({campaignId:r,name:K,statsSkills:Mf(Je,se.value,Hn.value),attributes:Object.keys(qe).length?qe:void 0,skills:Object.keys(Yn).length?Yn:void 0,abilities:Aa.length?Aa:void 0,rank:m,dr:Ge.value,armorType:k.trim()||void 0,energyBars:Se.value,lieutenantId:m==="Minion"?Me:void 0,heroId:m==="Lieutenant"?pe:void 0});l(Vn=>[et,...Vn]),ke(et.id),Be(!1),hm()}catch(Je){Pe(Je instanceof Error?Je.message:"Failed to create bestiary entry.")}},Kb=x=>{Ue(x.id),fe({...x}),ke(x.id),Be(!1)},Ts=()=>{Ue(null),fe(null)},Gb=x=>{ke(x),Be(!1),$e&&$e!==x&&Ts()},Jb=()=>{Ts(),hm(),ke(null),Be(!0)},Gt=x=>{Ae(K=>({...K,[x]:!K[x]}))},Qb=async()=>{if(!W||!W.name.trim())return;Pe(null);const x=It("Tier",W.tier);if(x.error){Pe(x.error);return}const K=It("Max Energy",W.maxEnergy);if(K.error){Pe(K.error);return}const se=It("Max AP",W.maxAp);if(se.error){Pe(se.error);return}const ce=It("DR",W.dr);if(ce.error){Pe(ce.error);return}const ye=It("Energy Bars",W.energyBars);if(ye.error){Pe(ye.error);return}if(!qr.includes(W.rank)){Pe("Rank must be NPC, Minion, Lieutenant, or Hero.");return}if(W.rank==="Minion"&&!W.lieutenantId){Pe("Minions must be assigned to a Lieutenant.");return}if(W.rank==="Lieutenant"&&!W.heroId){Pe("Lieutenants must be assigned to a Hero.");return}const Ge={},Se={};for(const Je of Ra){const et=It(`${Fr[Je]} attribute`,W.attributes[Je]);if(et.error){Pe(et.error);return}et.value!==void 0?(Se[Je]=et.value,Ge[Je]=et.value):Ge[Je]=0}const ot=Lf(W.skills);if(ot.error){Pe(ot.error);return}if(W.customAbilityEnabled&&!W.customAbilityName.trim()){Pe("Custom ability name is required.");return}const qe=W.customAbilityEnabled?It("Custom ability energy cost",W.customAbilityEnergy):{};if(qe.error){Pe(qe.error);return}const Bt=W.customAbilityEnabled?It("Custom ability AP cost",W.customAbilityAp):{};if(Bt.error){Pe(Bt.error);return}const oa=Df(W.actions);if(oa.error){Pe(oa.error);return}K.value!==void 0&&(Se.energy=K.value),se.value!==void 0&&(Se.ap=se.value),ce.value!==void 0&&(Se.dr=ce.value),ye.value!==void 0&&(Se.energy_bars=ye.value);const ns=ma(Ge,ut),Hn={};ut.forEach(Je=>{var Ia;const et=wt(Je),Vn=((Ia=ot.value)==null?void 0:Ia[et])??0,Rs=ns[et]??0,la=Vn+Rs;la!==0&&(Hn[et]=la)}),Object.entries(ot.value??{}).forEach(([Je,et])=>{Er.has(Je)||et!==0&&(Hn[Je]=et)});const Yn=[...W.abilities.filter(Je=>Je.type!=="custom")];W.customAbilityEnabled&&Yn.push({type:"custom",key:W.customAbilityName.trim(),name:W.customAbilityName.trim(),energyCost:qe.value,apCost:Bt.value});const Aa=Object.keys(Se).length?Se:void 0;try{const Je=await tt.updateBestiaryEntry(W.id,{name:W.name.trim(),statsSkills:Mf(W,x.value,oa.value),attributes:Aa,skills:Object.keys(Hn).length?Hn:void 0,abilities:Yn.length?Yn:void 0,rank:W.rank,dr:ce.value,armorType:W.armorType.trim()||null,energyBars:ye.value,lieutenantId:W.rank==="Minion"?W.lieutenantId:null,heroId:W.rank==="Lieutenant"?W.heroId:null});l(et=>et.map(Vn=>Vn.id===Je.id?Je:Vn)),Ts()}catch(Je){Pe(Je instanceof Error?Je.message:"Failed to update bestiary entry.")}},Xb=async x=>{Pe(null);try{await tt.deleteBestiaryEntry(x),l(K=>K.filter(se=>se.id!==x)),$e===x&&Ts(),be===x&&ke(null)}catch(K){Pe(K instanceof Error?K.message:"Failed to delete bestiary entry.")}},vm=v.useMemo(()=>pu(O),[O]),Zb=v.useMemo(()=>ma(vm,ut),[vm,ut]),e_=v.useMemo(()=>W?ma(pu(W.attributes),ut):{},[W,ut]),bm=v.useMemo(()=>rn.filter(x=>x.rank==="Lieutenant"),[rn]),_m=v.useMemo(()=>rn.filter(x=>x.rank==="Hero"),[rn]),no=v.useMemo(()=>new Map(rn.map(x=>[x.id,x.name])),[rn]),We=v.useMemo(()=>rn.find(x=>x.id===be)??null,[rn,be]),xm=v.useMemo(()=>We?ma(pu(We.attributes),ut):{},[We,ut]),wm=v.useMemo(()=>{if(!We)return[];const x=xm;return ut.map(K=>{const se=wt(K),ce=We.skills[se]??"",ye=Number.isFinite(Number(ce))?Number(ce):0,Ge=x[se]??0;return{code:se,name:K.name,total:ye+Ge,base:ye,bonus:Ge}}).filter(K=>K.total!==0).sort((K,se)=>se.total-K.total).slice(0,6)},[We,xm,ut]);return a.jsxs("div",{className:C.root,children:[a.jsxs("header",{className:C.header,children:[a.jsx("h2",{className:C.title,children:"Grimoire of Beasts"}),a.jsx("p",{className:C.subtitle,children:"An arcane compendium of creatures, monsters, and adversaries"})]}),Rt&&a.jsx("div",{className:C.error,children:Rt}),nt&&a.jsx("div",{className:C.mutedText,style:{textAlign:"center"},children:"Consulting the ancient scrolls..."}),a.jsxs("div",{className:C.mainLayout,children:[a.jsxs("section",{className:`${C.card} ${C.sidebar}`,children:[a.jsxs("div",{className:C.rowBetween,children:[a.jsx("h3",{className:C.title,style:{fontSize:"1rem"},children:"Creature Index"}),a.jsx("button",{type:"button",onClick:Jb,className:C.primaryButton,children:"Inscribe"})]}),!e&&a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Campaign"}),a.jsx("select",{value:r,onChange:x=>i(x.target.value),className:C.input,children:n.map(x=>a.jsx("option",{value:x.id,children:x.name},x.id))})]}),a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Search"}),a.jsx("input",{value:_e,onChange:x=>He(x.target.value),placeholder:"Search creatures...",className:C.input})]}),a.jsxs("div",{className:C.gridAuto120,children:[a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Rank"}),a.jsxs("select",{value:De,onChange:x=>ne(x.target.value),className:C.input,children:[a.jsx("option",{value:"All",children:"All"}),qr.map(x=>a.jsx("option",{value:x,children:x},x))]})]}),a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Type"}),a.jsx("input",{value:me,onChange:x=>we(x.target.value),placeholder:"Dragon",className:C.input})]}),a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Tier"}),a.jsx("input",{value:Ye,onChange:x=>Fe(x.target.value),placeholder:"3",className:C.input,inputMode:"numeric"})]})]}),a.jsx("div",{className:C.listPanel,children:gm.length===0?a.jsx("div",{className:C.emptyText,children:"No entries match these filters."}):gm.map(x=>{const K=x.id===be,se=(x.rank||"NPC").toLowerCase(),ce=x.rank==="Minion"&&x.lieutenantId?` Lt: ${no.get(x.lieutenantId)??"Unassigned"}`:x.rank==="Lieutenant"&&x.heroId?` Hero: ${no.get(x.heroId)??"Unassigned"}`:"";return a.jsxs("button",{type:"button",onClick:()=>Gb(x.id),className:C.entryButton,"aria-selected":K,style:K?{borderColor:"var(--accent-warm, var(--accent))",background:"var(--accent-soft, var(--surface-2))"}:void 0,children:[a.jsx("span",{className:C.entryName,children:x.name}),a.jsxs("div",{className:C.chipRow,children:[a.jsx("span",{className:C.rankChip,"data-rank":se,children:x.rank||"NPC"}),a.jsxs("span",{className:C.entryMeta,children:[x.tier?`Tier ${x.tier}`:"Tier ","  ",x.type||"Unknown type",ce?`  ${ce}`:""]})]})]},x.id)})})]}),a.jsxs("section",{className:`${C.card} ${C.detailPanel}`,children:[a.jsxs("div",{className:C.detailSection,children:[a.jsxs("div",{className:C.rowBetween,children:[a.jsxs("div",{children:[a.jsx("h3",{className:C.title,style:{fontSize:"1rem"},children:"Transcription Chamber"}),a.jsx("p",{className:C.mutedTextSmall,children:'Transcribe ancient texts into the grimoire. Include "Hero:" or "Lieutenant:" markings to establish dominion.'})]}),a.jsxs("div",{className:C.rowWrap,children:[a.jsx("button",{type:"button",className:C.secondaryButton,onClick:Hb,children:"Decipher Text"}),a.jsx("button",{type:"button",className:C.actionButton,onClick:Yb,disabled:G||U.length===0||H.some(x=>x.level==="error"),children:G?"Inscribing...":"Transcribe to Grimoire"})]})]}),a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Ancient Text"}),a.jsx("textarea",{value:z,onChange:x=>de(x.target.value),rows:10,placeholder:"Feudal Army\\n\\nKnight (Rank 1 Mortal Hero, Aligned)\\n100 energy x3 bars, 9 AP\\n15 DR (plate)\\n...",className:`${C.input} ${C.textarea}`})]}),ie&&a.jsxs("div",{className:C.mutedTextSmall,children:["Detected group: ",ie]}),H.length>0&&a.jsxs("div",{className:C.detailSection,children:[a.jsx("div",{className:C.sectionTitle,children:"Preview Messages"}),a.jsx("div",{className:C.gridTwo,children:H.map((x,K)=>a.jsxs("div",{className:C.skillCard,children:[a.jsxs("span",{className:C.fieldLabelMedium,children:[x.level==="error"?"Error":"Warning",x.entryName?`: ${x.entryName}`:""]}),a.jsx("span",{className:C.mutedTextSmall,children:x.message}),x.block&&a.jsxs("span",{className:C.mutedTextSmall,children:["Source: ",x.block]})]},`${x.blockIndex}-${K}`))})]}),U.length>0&&a.jsxs("div",{className:C.detailSection,children:[a.jsx("div",{className:C.sectionTitle,children:"Parsed Entries"}),a.jsx("div",{className:C.gridTwo,children:U.map(x=>{var K,se,ce;return a.jsxs("div",{className:C.skillCard,children:[a.jsxs("span",{className:C.fieldLabelMedium,children:[x.name,"  ",to(x.rank)]}),a.jsxs("span",{className:C.mutedTextSmall,children:["Attributes: ",Object.keys(x.attributes).length,"  Skills: ",Object.keys(x.skills).length,"  Abilities:"," ",x.abilities.length]}),x.attributes.dr!==void 0&&a.jsxs("span",{className:C.mutedTextSmall,children:["DR: ",x.attributes.dr]}),x.armorType&&a.jsxs("span",{className:C.mutedTextSmall,children:["Armor: ",x.armorType]}),x.energyBars!==void 0&&a.jsxs("span",{className:C.mutedTextSmall,children:["Energy Bars: ",x.energyBars]}),x.heroName&&a.jsxs("span",{className:C.mutedTextSmall,children:["Hero: ",x.heroName]}),x.lieutenantName&&a.jsxs("span",{className:C.mutedTextSmall,children:["Lieutenant: ",x.lieutenantName]}),(K=x.immunities)!=null&&K.length?a.jsxs("span",{className:C.mutedTextSmall,children:["Immune: ",x.immunities.join(", ")]}):null,(se=x.resistances)!=null&&se.length?a.jsxs("span",{className:C.mutedTextSmall,children:["Resistant: ",x.resistances.join(", ")]}):null,(ce=x.weaknesses)!=null&&ce.length?a.jsxs("span",{className:C.mutedTextSmall,children:["Weak: ",x.weaknesses.join(", ")]}):null]},x.name)})})]})]}),!e&&n.length===0?a.jsx("p",{className:`${C.mutedText} ${C.title}`,children:"Create a campaign first to manage a bestiary."}):r?Ie?a.jsxs("form",{onSubmit:Vb,className:C.form,children:[a.jsxs("div",{className:C.rowBetween,children:[a.jsx("h3",{className:C.title,style:{fontSize:"1rem"},children:"Inscribe New Entry"}),a.jsx("button",{type:"button",onClick:()=>Be(!1),className:C.secondaryButton,children:"Abandon"})]}),a.jsxs(Jt,{title:"Core Info",isOpen:J.core,onToggle:()=>Gt("core"),children:[a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Name"}),a.jsx("input",{value:c,onChange:x=>u(x.target.value),placeholder:"Ash Drake",className:C.input})]}),a.jsxs("div",{className:C.gridAuto180,children:[a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Type"}),a.jsx("input",{value:d,onChange:x=>h(x.target.value),placeholder:"Dragon",className:C.input})]}),a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Rank"}),a.jsx("select",{value:m,onChange:x=>{const K=x.target.value;y(K),K!=="Minion"&&oe(""),K!=="Lieutenant"&&ve("")},className:C.input,children:qr.map(x=>a.jsx("option",{value:x,children:x},x))})]})]}),m==="Minion"&&a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Assigned Lieutenant"}),a.jsxs("select",{value:Me,onChange:x=>oe(x.target.value),className:C.input,children:[a.jsx("option",{value:"",children:"Select a lieutenant"}),bm.map(x=>a.jsx("option",{value:x.id,children:x.name},x.id))]})]}),m==="Lieutenant"&&a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Assigned Hero"}),a.jsxs("select",{value:pe,onChange:x=>ve(x.target.value),className:C.input,children:[a.jsx("option",{value:"",children:"Select a hero"}),_m.map(x=>a.jsx("option",{value:x.id,children:x.name},x.id))]})]})]}),a.jsxs(Jt,{title:"Stats",isOpen:J.stats,onToggle:()=>Gt("stats"),children:[a.jsxs("div",{className:C.gridAuto160,children:[a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Tier"}),a.jsx("input",{value:w,onChange:x=>f(x.target.value),placeholder:"3",className:C.input,inputMode:"numeric"}),a.jsx("span",{className:C.mutedTextSmall,children:w?Tf(Number(w)):"Tier name"})]}),a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Max Energy"}),a.jsx("input",{value:p,onChange:x=>g(x.target.value),placeholder:"120",className:C.input,inputMode:"numeric"})]}),a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Max AP"}),a.jsx("input",{value:j,onChange:x=>A(x.target.value),placeholder:"6",className:C.input,inputMode:"numeric"})]}),a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Damage Reduction (DR)"}),a.jsx("input",{value:R,onChange:x=>S(x.target.value),placeholder:"10",className:C.input,inputMode:"numeric"})]}),a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Armor Type"}),a.jsx("input",{value:k,onChange:x=>N(x.target.value),placeholder:"Plate",className:C.input})]}),a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Energy Bars"}),a.jsx("input",{value:E,onChange:x=>M(x.target.value),placeholder:"3",className:C.input,inputMode:"numeric"})]})]}),a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Tactics / Notes"}),a.jsx("textarea",{value:b,onChange:x=>_(x.target.value),rows:3,placeholder:"Breath weapon on round two, vulnerable to cold iron.",className:`${C.input} ${C.textarea}`})]})]}),a.jsxs(Jt,{title:"Defenses",isOpen:J.defenses,onToggle:()=>Gt("defenses"),children:[a.jsx(Us,{label:"Immunities",values:D,onChange:F,placeholder:"Poison"}),a.jsx(Us,{label:"Resistances",values:q,onChange:V,placeholder:"Fire"}),a.jsx(Us,{label:"Weaknesses",values:Q,onChange:te,placeholder:"Cold Iron"})]}),a.jsxs(Jt,{title:"Actions",isOpen:J.actions,onToggle:()=>Gt("actions"),children:[$.length===0?a.jsx("div",{className:C.mutedTextSmall,children:"No actions added yet."}):a.jsx("div",{className:C.actionList,children:$.map((x,K)=>a.jsxs("div",{className:C.actionInputsRow,children:[a.jsx("input",{value:x.energyCost,onChange:se=>L(ce=>ce.map((ye,Ge)=>Ge===K?{...ye,energyCost:se.target.value}:ye)),placeholder:"Energy",className:C.input,inputMode:"numeric"}),a.jsx("input",{value:x.apCost,onChange:se=>L(ce=>ce.map((ye,Ge)=>Ge===K?{...ye,apCost:se.target.value}:ye)),placeholder:"AP",className:C.input,inputMode:"numeric"}),a.jsx("input",{value:x.range,onChange:se=>L(ce=>ce.map((ye,Ge)=>Ge===K?{...ye,range:se.target.value}:ye)),placeholder:"Range",className:C.input}),a.jsx("input",{value:x.damage,onChange:se=>L(ce=>ce.map((ye,Ge)=>Ge===K?{...ye,damage:se.target.value}:ye)),placeholder:"Damage",className:C.input}),a.jsx("input",{value:x.damageType,onChange:se=>L(ce=>ce.map((ye,Ge)=>Ge===K?{...ye,damageType:se.target.value}:ye)),placeholder:"Damage Type",className:C.input}),a.jsx("button",{type:"button",onClick:()=>L(se=>se.filter((ce,ye)=>ye!==K)),className:C.dangerButton,children:"Remove"})]},`action-${K}`))}),a.jsx("button",{type:"button",onClick:()=>L(x=>[...x,Rf()]),className:C.secondaryButton,children:"Add Action"})]}),a.jsx(Jt,{title:"Attributes",isOpen:J.attributes,onToggle:()=>Gt("attributes"),children:a.jsx("div",{className:C.gridTwoWide,children:Ra.map(x=>a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabelMedium,children:Fr[x]}),a.jsx("input",{value:O[x],onChange:K=>X(se=>({...se,[x]:K.target.value})),placeholder:"0",className:C.input,inputMode:"numeric"})]},x))})}),a.jsx(Jt,{title:"Skills",isOpen:J.skills,onToggle:()=>Gt("skills"),children:ut.length===0?a.jsx("div",{className:C.mutedTextMedium,children:"No skills loaded from definitions."}):a.jsx("div",{className:C.gridThreeWide,children:ut.map(x=>{const K=wt(x),se=Zb[K]??0,ce=re[K]??"",ye=Number(ce),Ge=(Number.isFinite(ye)?ye:0)+se;return a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabelMedium,children:x.name}),a.jsx("input",{value:ce,onChange:Se=>I(ot=>({...ot,[K]:Se.target.value})),placeholder:"0",className:C.input,inputMode:"numeric"}),a.jsxs("span",{className:C.mutedTextSmall,children:["Bonus ",se>=0?`+${se}`:se,"  Total ",Ge]})]},K)})})}),a.jsxs(Jt,{title:"Abilities",isOpen:J.abilities,onToggle:()=>Gt("abilities"),children:[Ve&&a.jsxs("div",{className:C.mutedTextSmall,children:["Ability data error: ",Ve]}),a.jsxs("div",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Martial"}),a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabelMedium,children:"Weapon Category"}),a.jsx("select",{value:Yi,onChange:x=>mc(x.target.value),className:C.input,children:Ki.length===0?a.jsx("option",{value:"",children:"No categories available"}):Ki.map(x=>a.jsx("option",{value:x,children:x},x))})]}),Zi.length===0?a.jsx("div",{className:C.mutedTextSmall,children:"No martial abilities for this category."}):a.jsx("div",{className:C.selectionGrid,children:Zi.map(x=>{const K=Ji(x),se=Ce.some(ce=>ce.type==="martial"&&ce.key===K);return a.jsxs("label",{className:C.checkboxRow,children:[a.jsx("input",{type:"checkbox",checked:se,onChange:()=>Ke(ce=>Xi(ce,mm(x)))}),a.jsx("span",{children:x.name})]},K)})})]}),a.jsxs("div",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Psionic"}),a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabelMedium,children:"Tree"}),a.jsx("select",{value:Vi,onChange:x=>pc(x.target.value),className:C.input,children:Gi.length===0?a.jsx("option",{value:"",children:"No trees available"}):Gi.map(x=>a.jsx("option",{value:x,children:x},x))})]}),eo.length===0?a.jsx("div",{className:C.mutedTextSmall,children:"No psionic abilities for this tree."}):a.jsx("div",{className:C.selectionGrid,children:eo.map(x=>{const K=Qi(x),se=Ce.some(ce=>ce.type==="psionic"&&ce.key===K);return a.jsxs("label",{className:C.checkboxRow,children:[a.jsx("input",{type:"checkbox",checked:se,onChange:()=>Ke(ce=>Xi(ce,pm(x)))}),a.jsxs("span",{children:[x.name,x.tier?` (Tier ${x.tier})`:""]})]},K)})})]}),a.jsxs("label",{className:C.checkboxRow,children:[a.jsx("input",{type:"checkbox",checked:B,onChange:x=>ae(x.target.checked)}),a.jsx("span",{className:C.fieldLabel,children:"Custom Ability"})]}),B&&a.jsxs("div",{className:C.gridAuto160,children:[a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Custom Ability Name"}),a.jsx("input",{value:le,onChange:x=>he(x.target.value),placeholder:"Solar Flare",className:C.input})]}),a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Energy Cost"}),a.jsx("input",{value:ue,onChange:x=>xe(x.target.value),placeholder:"8",className:C.input,inputMode:"numeric"})]}),a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"AP Cost"}),a.jsx("input",{value:Ne,onChange:x=>je(x.target.value),placeholder:"2",className:C.input,inputMode:"numeric"})]})]})]}),a.jsx("button",{type:"submit",className:C.submitButton,children:"Add Entry"})]}):We?$e===We.id&&W?a.jsxs("div",{className:C.detailStack,children:[a.jsxs("div",{className:C.rowBetween,children:[a.jsx("h3",{className:C.title,children:"Edit Creature"}),a.jsx("button",{type:"button",onClick:Ts,className:C.secondaryButton,children:"Cancel"})]}),a.jsxs(Jt,{title:"Core Info",isOpen:J.core,onToggle:()=>Gt("core"),children:[a.jsx("input",{value:W.name,onChange:x=>fe({...W,name:x.target.value}),className:C.input}),a.jsxs("div",{className:C.gridAuto160,children:[a.jsx("input",{value:W.type,onChange:x=>fe({...W,type:x.target.value}),placeholder:"Type",className:C.input}),a.jsx("select",{value:W.rank,onChange:x=>{const K=x.target.value;fe({...W,rank:K,lieutenantId:K==="Minion"?W.lieutenantId:"",heroId:K==="Lieutenant"?W.heroId:""})},className:C.input,children:qr.map(x=>a.jsx("option",{value:x,children:x},x))})]}),W.rank==="Minion"&&a.jsxs("select",{value:W.lieutenantId,onChange:x=>fe({...W,lieutenantId:x.target.value}),className:C.input,children:[a.jsx("option",{value:"",children:"Select a lieutenant"}),bm.filter(x=>x.id!==W.id).map(x=>a.jsx("option",{value:x.id,children:x.name},x.id))]}),W.rank==="Lieutenant"&&a.jsxs("select",{value:W.heroId,onChange:x=>fe({...W,heroId:x.target.value}),className:C.input,children:[a.jsx("option",{value:"",children:"Select a hero"}),_m.filter(x=>x.id!==W.id).map(x=>a.jsx("option",{value:x.id,children:x.name},x.id))]})]}),a.jsxs(Jt,{title:"Stats",isOpen:J.stats,onToggle:()=>Gt("stats"),children:[a.jsxs("div",{className:C.gridAuto150,children:[a.jsx("input",{value:W.tier,onChange:x=>fe({...W,tier:x.target.value}),placeholder:"Tier",className:C.input,inputMode:"numeric"}),a.jsx("input",{value:W.maxEnergy,onChange:x=>fe({...W,maxEnergy:x.target.value}),placeholder:"Max Energy",className:C.input,inputMode:"numeric"}),a.jsx("input",{value:W.maxAp,onChange:x=>fe({...W,maxAp:x.target.value}),placeholder:"Max AP",className:C.input,inputMode:"numeric"}),a.jsx("input",{value:W.dr,onChange:x=>fe({...W,dr:x.target.value}),placeholder:"Damage Reduction",className:C.input,inputMode:"numeric"}),a.jsx("input",{value:W.armorType,onChange:x=>fe({...W,armorType:x.target.value}),placeholder:"Armor Type",className:C.input}),a.jsx("input",{value:W.energyBars,onChange:x=>fe({...W,energyBars:x.target.value}),placeholder:"Energy Bars",className:C.input,inputMode:"numeric"})]}),a.jsx("textarea",{value:W.description,onChange:x=>fe({...W,description:x.target.value}),rows:3,placeholder:"Notes",className:`${C.input} ${C.textarea}`})]}),a.jsxs(Jt,{title:"Defenses",isOpen:J.defenses,onToggle:()=>Gt("defenses"),children:[a.jsx(Us,{label:"Immunities",values:W.immunities,onChange:x=>fe({...W,immunities:x}),placeholder:"Poison"}),a.jsx(Us,{label:"Resistances",values:W.resistances,onChange:x=>fe({...W,resistances:x}),placeholder:"Fire"}),a.jsx(Us,{label:"Weaknesses",values:W.weaknesses,onChange:x=>fe({...W,weaknesses:x}),placeholder:"Cold Iron"})]}),a.jsxs(Jt,{title:"Actions",isOpen:J.actions,onToggle:()=>Gt("actions"),children:[W.actions.length===0?a.jsx("div",{className:C.mutedTextSmall,children:"No actions added yet."}):a.jsx("div",{className:C.actionList,children:W.actions.map((x,K)=>a.jsxs("div",{className:C.actionInputsRow,children:[a.jsx("input",{value:x.energyCost,onChange:se=>fe({...W,actions:W.actions.map((ce,ye)=>ye===K?{...ce,energyCost:se.target.value}:ce)}),placeholder:"Energy",className:C.input,inputMode:"numeric"}),a.jsx("input",{value:x.apCost,onChange:se=>fe({...W,actions:W.actions.map((ce,ye)=>ye===K?{...ce,apCost:se.target.value}:ce)}),placeholder:"AP",className:C.input,inputMode:"numeric"}),a.jsx("input",{value:x.range,onChange:se=>fe({...W,actions:W.actions.map((ce,ye)=>ye===K?{...ce,range:se.target.value}:ce)}),placeholder:"Range",className:C.input}),a.jsx("input",{value:x.damage,onChange:se=>fe({...W,actions:W.actions.map((ce,ye)=>ye===K?{...ce,damage:se.target.value}:ce)}),placeholder:"Damage",className:C.input}),a.jsx("input",{value:x.damageType,onChange:se=>fe({...W,actions:W.actions.map((ce,ye)=>ye===K?{...ce,damageType:se.target.value}:ce)}),placeholder:"Damage Type",className:C.input}),a.jsx("button",{type:"button",onClick:()=>fe({...W,actions:W.actions.filter((se,ce)=>ce!==K)}),className:C.dangerButton,children:"Remove"})]},`edit-action-${K}`))}),a.jsx("button",{type:"button",onClick:()=>fe({...W,actions:[...W.actions,Rf()]}),className:C.secondaryButton,children:"Add Action"})]}),a.jsx(Jt,{title:"Attributes",isOpen:J.attributes,onToggle:()=>Gt("attributes"),children:a.jsx("div",{className:C.gridTwo,children:Ra.map(x=>a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabelMedium,children:Fr[x]}),a.jsx("input",{value:W.attributes[x],onChange:K=>fe({...W,attributes:{...W.attributes,[x]:K.target.value}}),placeholder:"0",className:C.input,inputMode:"numeric"})]},x))})}),a.jsx(Jt,{title:"Skills",isOpen:J.skills,onToggle:()=>Gt("skills"),children:ut.length===0?a.jsx("div",{className:C.mutedTextMedium,children:"No skills loaded from definitions."}):a.jsxs("div",{className:C.gridThree,children:[ut.map(x=>{const K=wt(x),se=e_[K]??0,ce=W.skills[K]??"",ye=Number(ce),Ge=(Number.isFinite(ye)?ye:0)+se;return a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabelMedium,children:x.name}),a.jsx("input",{value:ce,onChange:Se=>fe({...W,skills:{...W.skills,[K]:Se.target.value}}),placeholder:"0",className:C.input,inputMode:"numeric"}),a.jsxs("span",{className:C.mutedTextSmall,children:["Bonus ",se>=0?`+${se}`:se,"  Total ",Ge]})]},K)}),Object.keys(W.skills).filter(x=>!Er.has(x)).map(x=>a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabelMedium,children:aa({id:x})}),a.jsx("input",{value:W.skills[x],onChange:K=>fe({...W,skills:{...W.skills,[x]:K.target.value}}),placeholder:"0",className:C.input,inputMode:"numeric"})]},x))]})}),a.jsxs(Jt,{title:"Abilities",isOpen:J.abilities,onToggle:()=>Gt("abilities"),children:[Ve&&a.jsxs("div",{className:C.mutedTextSmall,children:["Ability data error: ",Ve]}),a.jsxs("div",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Martial"}),a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabelMedium,children:"Weapon Category"}),a.jsx("select",{value:Yi,onChange:x=>mc(x.target.value),className:C.input,children:Ki.length===0?a.jsx("option",{value:"",children:"No categories available"}):Ki.map(x=>a.jsx("option",{value:x,children:x},x))})]}),Zi.length===0?a.jsx("div",{className:C.mutedTextSmall,children:"No martial abilities for this category."}):a.jsx("div",{className:C.selectionGrid,children:Zi.map(x=>{const K=Ji(x),se=W.abilities.some(ce=>ce.type==="martial"&&ce.key===K);return a.jsxs("label",{className:C.checkboxRow,children:[a.jsx("input",{type:"checkbox",checked:se,onChange:()=>fe({...W,abilities:Xi(W.abilities,mm(x))})}),a.jsx("span",{children:x.name})]},K)})})]}),a.jsxs("div",{className:C.field,children:[a.jsx("span",{className:C.fieldLabel,children:"Psionic"}),a.jsxs("label",{className:C.field,children:[a.jsx("span",{className:C.fieldLabelMedium,children:"Tree"}),a.jsx("select",{value:Vi,onChange:x=>pc(x.target.value),className:C.input,children:Gi.length===0?a.jsx("option",{value:"",children:"No trees available"}):Gi.map(x=>a.jsx("option",{value:x,children:x},x))})]}),eo.length===0?a.jsx("div",{className:C.mutedTextSmall,children:"No psionic abilities for this tree."}):a.jsx("div",{className:C.selectionGrid,children:eo.map(x=>{const K=Qi(x),se=W.abilities.some(ce=>ce.type==="psionic"&&ce.key===K);return a.jsxs("label",{className:C.checkboxRow,children:[a.jsx("input",{type:"checkbox",checked:se,onChange:()=>fe({...W,abilities:Xi(W.abilities,pm(x))})}),a.jsxs("span",{children:[x.name,x.tier?` (Tier ${x.tier})`:""]})]},K)})})]}),a.jsxs("label",{className:C.checkboxRow,children:[a.jsx("input",{type:"checkbox",checked:W.customAbilityEnabled,onChange:x=>fe({...W,customAbilityEnabled:x.target.checked})}),a.jsx("span",{className:C.fieldLabel,children:"Custom Ability"})]}),W.customAbilityEnabled&&a.jsxs("div",{className:C.gridAuto150,children:[a.jsx("input",{value:W.customAbilityName,onChange:x=>fe({...W,customAbilityName:x.target.value}),placeholder:"Custom Ability",className:C.input}),a.jsx("input",{value:W.customAbilityEnergy,onChange:x=>fe({...W,customAbilityEnergy:x.target.value}),placeholder:"Energy Cost",className:C.input,inputMode:"numeric"}),a.jsx("input",{value:W.customAbilityAp,onChange:x=>fe({...W,customAbilityAp:x.target.value}),placeholder:"AP Cost",className:C.input,inputMode:"numeric"})]})]}),a.jsxs("div",{className:C.actionRow,children:[a.jsx("button",{type:"button",onClick:Qb,className:C.actionButton,children:"Save"}),a.jsx("button",{type:"button",onClick:Ts,className:C.actionButtonSecondary,children:"Cancel"})]})]}):a.jsxs("div",{className:C.detailStack,children:[a.jsxs("div",{className:C.detailHeader,children:[a.jsx("h3",{className:C.title,children:We.name}),a.jsxs("div",{className:C.detailActions,children:[a.jsx("button",{type:"button",onClick:()=>Kb(We),className:C.editButton,children:"Edit"}),a.jsx("button",{type:"button",onClick:()=>Xb(We.id),className:C.dangerButton,children:"Delete"})]})]}),a.jsxs("div",{className:C.summaryCard,children:[a.jsxs("div",{className:C.detailSection,children:[a.jsx("div",{className:C.sectionTitle,children:"Overview"}),a.jsxs("div",{className:C.infoStack,children:[a.jsxs("div",{className:C.mutedTextMedium,children:[We.type||"Unknown type","  ",We.rank||"NPC"]}),We.rank==="Minion"&&We.lieutenantId&&a.jsxs("div",{className:C.mutedTextSmall,children:[" Lt: ",no.get(We.lieutenantId)??"Unassigned"]}),We.rank==="Lieutenant"&&We.heroId&&a.jsxs("div",{className:C.mutedTextSmall,children:[" Hero: ",no.get(We.heroId)??"Unassigned"]}),We.description&&a.jsx("p",{className:C.description,children:We.description})]})]}),a.jsxs("div",{className:C.detailSection,children:[a.jsx("div",{className:C.sectionTitle,children:"Stats"}),a.jsxs("div",{className:C.gridAuto140,children:[a.jsxs("div",{children:[a.jsx("div",{className:C.statLabel,children:"Tier"}),a.jsxs("div",{className:C.statValue,children:[We.tier||""," ",We.tier?`(${Tf(Number(We.tier))})`:""]})]}),a.jsxs("div",{children:[a.jsx("div",{className:C.statLabel,children:"Max Energy"}),a.jsx("div",{className:C.statValue,children:We.maxEnergy||""})]}),a.jsxs("div",{children:[a.jsx("div",{className:C.statLabel,children:"Max AP"}),a.jsx("div",{className:C.statValue,children:We.maxAp||""})]}),a.jsxs("div",{children:[a.jsx("div",{className:C.statLabel,children:"Damage Reduction"}),a.jsx("div",{className:C.statValue,children:We.dr||""}),We.armorType&&a.jsx("div",{className:C.mutedTextSmall,children:We.armorType})]}),a.jsxs("div",{children:[a.jsx("div",{className:C.statLabel,children:"Energy Bars"}),a.jsx("div",{className:C.statValue,children:We.energyBars||""})]}),a.jsxs("div",{children:[a.jsx("div",{className:C.statLabel,children:"Abilities"}),a.jsx("div",{className:C.statValue,children:We.abilities.length?`${We.abilities.length} selected`:"None"})]})]})]}),a.jsxs("div",{className:C.detailSection,children:[a.jsx("div",{className:C.sectionTitle,children:"Defenses"}),a.jsxs("div",{className:C.gridTwo,children:[a.jsxs("div",{children:[a.jsx("div",{className:C.statLabel,children:"Immunities"}),a.jsx("div",{className:C.statValue,children:We.immunities.length?We.immunities.join(", "):""})]}),a.jsxs("div",{children:[a.jsx("div",{className:C.statLabel,children:"Resistances"}),a.jsx("div",{className:C.statValue,children:We.resistances.length?We.resistances.join(", "):""})]}),a.jsxs("div",{children:[a.jsx("div",{className:C.statLabel,children:"Weaknesses"}),a.jsx("div",{className:C.statValue,children:We.weaknesses.length?We.weaknesses.join(", "):""})]})]})]}),a.jsxs("div",{className:C.detailSection,children:[a.jsx("div",{className:C.sectionTitle,children:"Actions"}),We.actions.length===0?a.jsx("div",{className:C.mutedTextMedium,children:"No actions listed."}):a.jsx("div",{className:C.gridTwo,children:We.actions.map((x,K)=>{const se=[x.energyCost?`Energy ${x.energyCost}`:null,x.apCost?`AP ${x.apCost}`:null,x.range?`Range ${x.range}`:null,x.damage?`Damage ${x.damage}`:null,x.damageType?`Type ${x.damageType}`:null].filter(Boolean);return a.jsxs("div",{className:C.skillCard,children:[a.jsxs("span",{className:C.fieldLabelMedium,children:["Action ",K+1]}),se.length>0?a.jsx("span",{className:C.mutedTextSmall,children:se.join("  ")}):a.jsx("span",{className:C.mutedTextSmall,children:"No details provided."})]},`action-display-${K}`)})})]}),a.jsxs("div",{className:C.detailSection,children:[a.jsx("div",{className:C.sectionTitle,children:"Attributes"}),a.jsx("div",{className:C.gridTwo,children:Ra.map(x=>a.jsxs("div",{className:C.attributeCard,children:[a.jsx("div",{className:C.mutedTextSmall,children:Fr[x]}),a.jsx("div",{className:C.statValue,children:We.attributes[x]||"0"})]},x))})]}),a.jsxs("div",{className:C.detailSection,children:[a.jsx("div",{className:C.sectionTitle,children:"Top Skills"}),ut.length===0?a.jsx("div",{className:C.mutedTextMedium,children:"No skills loaded from definitions."}):wm.length===0?a.jsx("div",{className:C.mutedTextMedium,children:"No notable skills listed."}):a.jsx("div",{className:C.gridThree,children:wm.map(x=>a.jsxs("div",{className:C.skillCard,children:[a.jsx("span",{className:C.fieldLabelMedium,children:x.name}),a.jsxs("span",{className:C.mutedTextSmall,children:["Total ",x.total," (Base ",x.base,"  Bonus ",x.bonus>=0?`+${x.bonus}`:x.bonus,")"]})]},x.code))})]}),a.jsxs("div",{className:C.detailSection,children:[a.jsx("div",{className:C.sectionTitle,children:"Abilities"}),We.abilities&&We.abilities.length>0?a.jsx("div",{className:C.gridTwo,children:We.abilities.map((x,K)=>{const se=x.name||x.key||x.type||`Ability ${K+1}`,ce=[x.category?`Category: ${x.category}`:null,x.tree?`Tree: ${x.tree}`:null,x.phase?`Phase: ${x.phase}`:null,x.energyCost!==void 0?`Energy ${x.energyCost}`:null,x.apCost!==void 0?`AP ${x.apCost}`:null,x.range?`Range ${x.range}`:null,x.damage?`Damage ${x.damage}`:null].filter(ye=>!!ye).join("  ");return a.jsxs("div",{className:C.skillCard,children:[a.jsx("span",{className:C.fieldLabelMedium,children:se}),x.type&&a.jsxs("span",{className:C.mutedTextSmall,children:["Type: ",x.type]}),ce&&a.jsx("span",{className:C.mutedTextSmall,children:ce}),(x.description||x.rules)&&a.jsx("span",{className:C.mutedTextSmall,children:x.description??x.rules}),x.tags&&x.tags.length>0&&a.jsxs("span",{className:C.mutedTextSmall,children:["Tags: ",x.tags.join(", ")]})]},`${se}-${K}`)})}):a.jsx("div",{className:C.mutedTextMedium,children:"No abilities listed."})]})]})]}):a.jsx("div",{className:C.mutedText,children:"Select an entry or create a new one."}):a.jsx("p",{className:`${C.mutedText} ${C.title}`,children:"Select a campaign to view or edit bestiary entries."})]})]})]})},LI=()=>`npc-${Math.random().toString(36).slice(2,10)}`,OI=()=>{const[e,t]=v.useState([]),[n,s]=v.useState(""),[r,i]=v.useState(""),[o,l]=v.useState("Active"),[c,u]=v.useState(""),d=m=>{m.preventDefault();const y=n.trim();if(!y)return;const b={id:LI(),name:y,role:r.trim(),status:o.trim()||"Active",notes:c.trim()};t(_=>[b,..._]),s(""),i(""),l("Active"),u("")},h=m=>t(y=>y.filter(b=>b.id!==m));return a.jsxs("div",{className:"npc-hub",children:[a.jsxs("header",{children:[a.jsx("h2",{className:"npc-hub__title h2",children:"NPC Hub"}),a.jsx("p",{className:"npc-hub__subtitle subtitle muted",children:"Pin recurring NPCs to keep story beats and hooks visible. Later, this space will host the roll inbox."})]}),a.jsxs("section",{className:"npc-hub__card",children:[a.jsx("h3",{className:"npc-hub__card-title h3",children:"Pinboard Entry"}),a.jsxs("form",{onSubmit:d,className:"npc-hub__form",children:[a.jsxs("label",{className:"npc-hub__field",children:[a.jsx("span",{className:"npc-hub__label",children:"NPC Name"}),a.jsx("input",{value:n,onChange:m=>s(m.target.value),placeholder:"Marshal Elara",className:"npc-hub__input"})]}),a.jsxs("div",{className:"npc-hub__grid",children:[a.jsxs("label",{className:"npc-hub__field",children:[a.jsx("span",{className:"npc-hub__label",children:"Role"}),a.jsx("input",{value:r,onChange:m=>i(m.target.value),placeholder:"Town guard captain",className:"npc-hub__input"})]}),a.jsxs("label",{className:"npc-hub__field",children:[a.jsx("span",{className:"npc-hub__label",children:"Status"}),a.jsx("input",{value:o,onChange:m=>l(m.target.value),placeholder:"Active",className:"npc-hub__input"})]})]}),a.jsxs("label",{className:"npc-hub__field",children:[a.jsx("span",{className:"npc-hub__label",children:"Hooks / Notes"}),a.jsx("textarea",{value:c,onChange:m=>u(m.target.value),rows:3,placeholder:"Owes the party a favor; hiding an envoy from the Iron Choir.",className:"npc-hub__input npc-hub__input--textarea"})]}),a.jsx("button",{type:"submit",className:"npc-hub__button npc-hub__button--primary",children:"Pin NPC"})]})]}),a.jsxs("section",{className:"npc-hub__card",children:[a.jsx("h3",{className:"npc-hub__card-title h3",children:"Pinned NPCs"}),e.length===0?a.jsx("p",{className:"npc-hub__muted body muted",children:"No NPCs pinned yet."}):a.jsx("div",{className:"npc-hub__list",children:e.map(m=>a.jsxs("div",{className:"npc-hub__item",children:[a.jsxs("div",{className:"npc-hub__item-header",children:[a.jsxs("div",{children:[a.jsx("div",{className:"npc-hub__item-title",children:m.name}),a.jsx("div",{className:"npc-hub__item-meta",children:m.role||"No role noted"})]}),a.jsx("span",{className:"npc-hub__status",children:m.status||"Active"})]}),m.notes&&a.jsx("p",{className:"npc-hub__notes",children:m.notes}),a.jsx("button",{type:"button",onClick:()=>h(m.id),className:"npc-hub__button npc-hub__button--danger",children:"Remove Pin"})]},m.id))})]})]})},Of=e=>{const t=e.split(",").map(n=>n.trim()).filter(Boolean);return t.length?t:void 0},$I=e=>e&&e.length?e.join(", "):"",BI=()=>{const{campaignId:e}=Tn(),[t,n]=v.useState([]),[s,r]=v.useState(e??""),[i,o]=v.useState([]),[l,c]=v.useState(""),[u,d]=v.useState(""),[h,m]=v.useState(""),[y,b]=v.useState(!1),[_,w]=v.useState(null),[f,p]=v.useState(null),[g,j]=v.useState(""),[A,R]=v.useState(!0),[S,k]=v.useState(null),N=()=>{c(""),d(""),m(""),b(!1)};v.useEffect(()=>{if(e){r(e);return}let I=!0;return(async()=>{R(!0),k(null);try{const L=await tt.listCampaigns();if(!I)return;n(L),r(D=>{var F;return D||((F=L[0])==null?void 0:F.id)||""})}catch(L){if(!I)return;k(L instanceof Error?L.message:"Failed to load campaigns.")}finally{I&&R(!1)}})(),()=>{I=!1}},[e]),v.useEffect(()=>{if(!s){o([]);return}let I=!0;return(async()=>{R(!0),k(null);try{const L=await tt.listSettings(s);if(!I)return;o(L)}catch(L){if(!I)return;k(L instanceof Error?L.message:"Failed to load setting notes.")}finally{I&&R(!1)}})(),()=>{I=!1}},[s]);const E=async I=>{if(I.preventDefault(),!s){k("Select a campaign before adding entries.");return}const $=l.trim();if($){k(null);try{const L=await tt.createSetting({campaignId:s,title:$,body:h.trim()||void 0,tags:Of(u),isPlayerVisible:y});o(D=>[L,...D]),N()}catch(L){k(L instanceof Error?L.message:"Failed to create setting note.")}}},M=I=>{w(I.id),p({...I}),j($I(I.tags))},O=()=>{w(null),p(null),j("")},X=async()=>{var I;if(f&&f.title.trim()){k(null);try{const $=await tt.updateSetting(f.id,{title:f.title.trim(),body:((I=f.body)==null?void 0:I.trim())||void 0,tags:Of(g),isPlayerVisible:f.isPlayerVisible});o(L=>L.map(D=>D.id===$.id?$:D)),O()}catch($){k($ instanceof Error?$.message:"Failed to update setting note.")}}},re=async I=>{k(null);try{await tt.deleteSetting(I),o($=>$.filter(L=>L.id!==I)),_===I&&O()}catch($){k($ instanceof Error?$.message:"Failed to delete setting note.")}};return a.jsxs("div",{className:"gm-setting-info",children:[a.jsxs("header",{children:[a.jsx("h2",{className:"gm-setting-info__title h2",children:"Setting Info"}),a.jsx("p",{className:"gm-setting-info__subtitle subtitle muted",children:"Create and maintain campaign setting notes for quick reference."})]}),a.jsxs("section",{className:"gm-setting-info__card",children:[a.jsx("h3",{className:"gm-setting-info__card-title h3",children:"Add Setting Note"}),S&&a.jsx("div",{className:"gm-setting-info__message gm-setting-info__message--error",children:S}),A&&a.jsx("div",{className:"gm-setting-info__message gm-setting-info__message--loading",children:"Loading..."}),!e&&t.length===0?a.jsx("p",{className:"gm-setting-info__muted",children:"Create a campaign first to manage setting notes."}):a.jsxs("form",{onSubmit:E,className:"gm-setting-info__form",children:[!e&&a.jsxs("label",{className:"gm-setting-info__field",children:[a.jsx("span",{className:"gm-setting-info__label",children:"Campaign"}),a.jsx("select",{value:s,onChange:I=>r(I.target.value),className:"gm-setting-info__input",children:t.map(I=>a.jsx("option",{value:I.id,children:I.name},I.id))})]}),a.jsxs("label",{className:"gm-setting-info__field",children:[a.jsx("span",{className:"gm-setting-info__label",children:"Title"}),a.jsx("input",{value:l,onChange:I=>c(I.target.value),placeholder:"Shatterglass Accord",className:"gm-setting-info__input"})]}),a.jsxs("label",{className:"gm-setting-info__field",children:[a.jsx("span",{className:"gm-setting-info__label",children:"Tags"}),a.jsx("input",{value:u,onChange:I=>d(I.target.value),placeholder:"Factions, Politics",className:"gm-setting-info__input"})]}),a.jsxs("label",{className:"gm-setting-info__field",children:[a.jsx("span",{className:"gm-setting-info__label",children:"Content"}),a.jsx("textarea",{value:h,onChange:I=>m(I.target.value),rows:4,placeholder:"Three city-states bound by a fragile alliance...",className:"gm-setting-info__input gm-setting-info__input--textarea"})]}),a.jsxs("label",{className:"gm-setting-info__toggle",children:[a.jsx("input",{type:"checkbox",checked:y,onChange:I=>b(I.target.checked)}),"Share with players"]}),a.jsx("button",{type:"submit",className:"gm-setting-info__button gm-setting-info__button--primary",children:"Add Note"})]})]}),a.jsxs("section",{className:"gm-setting-info__card",children:[a.jsx("h3",{className:"gm-setting-info__card-title h3",children:"Setting Notes"}),i.length===0?a.jsx("p",{className:"gm-setting-info__muted",children:"No setting notes yet."}):a.jsx("div",{className:"gm-setting-info__list",children:i.map(I=>{var L;const $=_===I.id;return a.jsx("div",{className:"gm-setting-info__item",children:$&&f?a.jsxs("div",{className:"gm-setting-info__edit",children:[a.jsx("input",{value:f.title,onChange:D=>p({...f,title:D.target.value}),className:"gm-setting-info__input"}),a.jsx("input",{value:g,onChange:D=>j(D.target.value),placeholder:"Tags",className:"gm-setting-info__input"}),a.jsx("textarea",{value:f.body??"",onChange:D=>p({...f,body:D.target.value}),rows:4,placeholder:"Content",className:"gm-setting-info__input gm-setting-info__input--textarea"}),a.jsxs("label",{className:"gm-setting-info__toggle",children:[a.jsx("input",{type:"checkbox",checked:f.isPlayerVisible??!1,onChange:D=>p({...f,isPlayerVisible:D.target.checked})}),"Share with players"]}),a.jsxs("div",{className:"gm-setting-info__actions",children:[a.jsx("button",{type:"button",onClick:X,className:"gm-setting-info__button gm-setting-info__button--primary",children:"Save"}),a.jsx("button",{type:"button",onClick:O,className:"gm-setting-info__button gm-setting-info__button--secondary",children:"Cancel"})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"gm-setting-info__item-header",children:[a.jsxs("div",{children:[a.jsx("div",{className:"gm-setting-info__item-title",children:I.title}),a.jsx("div",{className:"gm-setting-info__item-tags",children:(L=I.tags)!=null&&L.length?I.tags.join("  "):"Uncategorized"}),a.jsx("div",{className:`gm-setting-info__visibility ${I.isPlayerVisible?"gm-setting-info__visibility--shared":"gm-setting-info__visibility--gm"}`,children:I.isPlayerVisible?"Shared with players":"GM only"})]}),a.jsxs("div",{className:"gm-setting-info__actions",children:[a.jsx("button",{type:"button",onClick:()=>M(I),className:"gm-setting-info__button gm-setting-info__button--secondary",children:"Edit"}),a.jsx("button",{type:"button",onClick:()=>re(I.id),className:"gm-setting-info__button gm-setting-info__button--danger",children:"Delete"})]})]}),I.body&&a.jsx("p",{className:"gm-setting-info__body",children:I.body})]})},I.id)})})]})]})},FI=["PHYSICAL","MENTAL","SPIRITUAL","WILL"],Ur=e=>e&&e.trim().length>0?e:"Unknown",$f=e=>e&&e.length>0?e.join(", "):"None",qI=e=>{var s,r;const t=new Map,n=new Map;return(s=e==null?void 0:e.races)==null||s.forEach(i=>{i.code&&t.set(i.code,i.name)}),(r=e==null?void 0:e.subraces)==null||r.forEach(i=>{i.code&&i.parentId&&n.set(i.code,{name:i.name,raceKey:i.parentId})}),{raceMap:t,subraceMap:n}},UI=e=>{const t=Object.values(e.skillAllocations??{}).reduce((s,r)=>s+r,0),n=Object.values(e.skillBonuses??{}).reduce((s,r)=>s+r,0);return t+n},WI=()=>{var m,y,b,_,w,f,p,g,j,A,R;const{data:e}=As(),[t,n]=v.useState([]),[s,r]=v.useState(null),[i,o]=v.useState(!1),[l,c]=v.useState(null),{raceMap:u,subraceMap:d}=v.useMemo(()=>qI(e),[e]);v.useEffect(()=>{let S=!0;return(async()=>{o(!0),c(null);try{const N=await Ct.listCharacters();if(!S)return;n(N),!s&&N.length>0&&r(N[0].id)}catch(N){if(!S)return;const E=N instanceof Error?N.message:"Unable to load characters";c(E)}finally{S&&o(!1)}})(),()=>{S=!1}},[]);const h=t.find(S=>S.id===s)??null;return a.jsxs("div",{className:"gm-player-characters",children:[a.jsxs("header",{children:[a.jsx("h2",{className:"gm-player-characters__title h2",children:"Player Characters"}),a.jsx("p",{className:"gm-player-characters__subtitle subtitle muted",children:"Review player character sheets without switching to the player UI."})]}),l&&a.jsx("div",{className:"gm-player-characters__error body",children:l}),a.jsxs("div",{className:"gm-player-characters__layout",children:[a.jsxs("section",{className:"gm-player-characters__card",children:[a.jsxs("div",{className:"gm-player-characters__card-header",children:[a.jsx("h3",{className:"gm-player-characters__card-title h3",children:"Characters"}),i&&a.jsx("span",{className:"gm-player-characters__loading caption muted",children:"Loading..."})]}),t.length===0&&!i?a.jsx("p",{className:"gm-player-characters__muted body muted",children:"No characters found."}):a.jsx("div",{className:"gm-player-characters__list",children:t.map(S=>{const k=S.id===s;return a.jsxs("button",{type:"button",onClick:()=>r(S.id),className:`gm-player-characters__item${k?" gm-player-characters__item--active":""}`,children:[a.jsx("div",{className:"gm-player-characters__item-title",children:S.name}),a.jsxs("div",{className:"gm-player-characters__item-meta",children:["Level ",S.level]})]},S.id)})})]}),a.jsx("section",{className:"gm-player-characters__card gm-player-characters__card--tall",children:h?a.jsxs("div",{className:"gm-player-characters__details",children:[a.jsxs("div",{className:"gm-player-characters__details-header",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"gm-player-characters__details-title h3",children:h.name}),a.jsxs("div",{className:"gm-player-characters__details-meta",children:["Level ",h.level,"  ",Ur(u.get(h.raceKey??"")??h.raceKey),h.subraceKey?` / ${((m=d.get(h.subraceKey))==null?void 0:m.name)??h.subraceKey}`:""]})]}),a.jsxs("div",{className:"gm-player-characters__pill-row",children:[a.jsxs("span",{className:"gm-player-characters__pill",children:["Skill Points: ",h.skillPoints]}),a.jsxs("span",{className:"gm-player-characters__pill",children:["Skill Total: ",UI(h)]}),h.fatePoints!==void 0&&a.jsxs("span",{className:"gm-player-characters__pill",children:["Fate Points: ",h.fatePoints]})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"gm-player-characters__section-title h3",children:"Attributes"}),a.jsx("div",{className:"gm-player-characters__attributes",children:FI.map(S=>{var k;return a.jsxs("div",{className:"gm-player-characters__attribute",children:[a.jsx("div",{className:"gm-player-characters__attribute-label",children:S}),a.jsx("div",{className:"gm-player-characters__attribute-value",children:((k=h.attributes)==null?void 0:k[S])??0})]},S)})})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"gm-player-characters__section-title h3",children:"Backgrounds"}),a.jsxs("div",{className:"gm-player-characters__backgrounds",children:[a.jsxs("div",{children:["Family: ",Ur((y=h.backgrounds)==null?void 0:y.family)]}),a.jsxs("div",{children:["Childhood: ",Ur((b=h.backgrounds)==null?void 0:b.childhood)]}),a.jsxs("div",{children:["Adolescence: ",Ur((_=h.backgrounds)==null?void 0:_.adolescence)]}),a.jsxs("div",{children:["Adulthood: ",$f((w=h.backgrounds)==null?void 0:w.adulthood)]}),a.jsxs("div",{children:["Inciting Incident: ",Ur((f=h.backgrounds)==null?void 0:f.incitingIncident)]}),a.jsxs("div",{children:["Flaws: ",$f((p=h.backgrounds)==null?void 0:p.flaws)]})]})]}),a.jsxs("div",{className:"gm-player-characters__notes",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"gm-player-characters__section-title h3",children:"Notes"}),a.jsx("p",{className:"gm-player-characters__note-text",children:((g=h.notes)==null?void 0:g.trim())||"No notes."})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"gm-player-characters__section-title h3",children:"Gear Notes"}),a.jsx("p",{className:"gm-player-characters__note-text",children:((j=h.gearNotes)==null?void 0:j.trim())||"No gear notes."})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"gm-player-characters__section-title h3",children:"Defense Notes"}),a.jsx("p",{className:"gm-player-characters__note-text",children:((A=h.defenseNotes)==null?void 0:A.trim())||"No defense notes."})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"gm-player-characters__section-title h3",children:"Weapon Notes"}),a.jsx("p",{className:"gm-player-characters__note-text",children:((R=h.weaponNotes)==null?void 0:R.trim())||"No weapon notes."})]})]})]}):a.jsx("p",{className:"gm-player-characters__muted body muted",children:"Select a character to view details."})})]})]})},zI=()=>"https://adurun-campaigns.larhackman.workers.dev",HI=e=>{const t=zI(),n=new URL(e,t);return n.search="",n.hash="",n.protocol=n.protocol==="https:"?"wss:":"ws:",n},YI=(e,t,n)=>{const s=HI(`/api/campaigns/${encodeURIComponent(e)}/connect`);n&&s.searchParams.set("user",n);const r=new WebSocket(s.toString());r.addEventListener("open",()=>{var l;return(l=t.onOpen)==null?void 0:l.call(t)}),r.addEventListener("close",()=>{var l;return(l=t.onClose)==null?void 0:l.call(t)}),r.addEventListener("error",l=>{var c;return(c=t.onError)==null?void 0:c.call(t,l)}),r.addEventListener("message",l=>{var c,u,d,h,m,y,b,_,w,f,p,g,j,A,R,S,k,N,E,M,O,X,re,I,$,L,D,F,q;if(typeof l.data=="string")try{const V=JSON.parse(l.data);if(!V||typeof V!="object")return;(c=t.onRawEvent)==null||c.call(t,V);const Q=V.payload;switch(V.type){case"STATE_SYNC":(u=t.onStateSync)==null||u.call(t,Q);break;case"COMBAT_STARTED":(d=t.onCombatStarted)==null||d.call(t,Q);break;case"COMBAT_ENDED":(h=t.onCombatEnded)==null||h.call(t,Q);break;case"ROUND_STARTED":(m=t.onRoundStarted)==null||m.call(t,Q);break;case"TURN_STARTED":(y=t.onTurnStarted)==null||y.call(t,Q);break;case"TURN_ENDED":(b=t.onTurnEnded)==null||b.call(t,Q);break;case"ACTION_DECLARED":(_=t.onActionDeclared)==null||_.call(t,Q);break;case"ACTION_REJECTED":(w=t.onActionRejected)==null||w.call(t,Q);break;case"ACTION_RESOLVED":(f=t.onActionResolved)==null||f.call(t,Q);break;case"REACTION_DECLARED":(p=t.onReactionDeclared)==null||p.call(t,Q);break;case"REACTION_REJECTED":(g=t.onReactionRejected)==null||g.call(t,Q);break;case"REACTIONS_RESOLVED":(j=t.onReactionsResolved)==null||j.call(t,Q);break;case"ENTITY_UPDATED":(A=t.onEntityUpdated)==null||A.call(t,Q);break;case"WOUNDS_APPLIED":(R=t.onWoundsApplied)==null||R.call(t,Q);break;case"STATUS_APPLIED":(S=t.onStatusApplied)==null||S.call(t,Q);break;case"STATUS_REMOVED":(k=t.onStatusRemoved)==null||k.call(t,Q);break;case"GM_OVERRIDE":(N=t.onGmOverride)==null||N.call(t,Q);break;case"INITIATIVE_MODIFIED":(E=t.onInitiativeModified)==null||E.call(t,Q);break;case"SKILL_CONTEST_INITIATED":(M=t.onSkillContestInitiated)==null||M.call(t,Q);break;case"SKILL_CONTEST_DEFENSE_REQUESTED":(O=t.onSkillContestDefenseRequested)==null||O.call(t,Q);break;case"SKILL_CONTEST_RESOLVED":(X=t.onSkillContestResolved)==null||X.call(t,Q);break;case"SKILL_CHECK_REQUESTED":(re=t.onSkillCheckRequested)==null||re.call(t,Q);break;case"SKILL_CHECK_ROLLED":(I=t.onSkillCheckRolled)==null||I.call(t,Q);break;case"ENTITY_REMOVED":($=t.onEntityRemoved)==null||$.call(t,Q);break;case"LOBBY_PLAYER_JOINED":(L=t.onLobbyPlayerJoined)==null||L.call(t,Q);break;case"LOBBY_PLAYER_LEFT":(D=t.onLobbyPlayerLeft)==null||D.call(t,Q);break;case"LOBBY_PLAYER_READY":(F=t.onLobbyPlayerReady)==null||F.call(t,Q);break;case"LOBBY_STATE_SYNC":(q=t.onLobbyStateSync)==null||q.call(t,Q);break}}catch{return}});const i=l=>{r.readyState===WebSocket.OPEN&&r.send(JSON.stringify(l))};return{socket:r,send:i,close:()=>r.close(),requestState:()=>{i({type:"REQUEST_STATE"})}}},VI=(e,t,n,s)=>{const r=s==null?void 0:s.maxRetries,i=s==null?void 0:s.retryDelay;let o=null,l=0,c=!1;const u=()=>{o=YI(e,{...t,onOpen:()=>{var d;l=0,o==null||o.requestState(),(d=t.onOpen)==null||d.call(t)},onClose:()=>{var d,h;(d=t.onClose)==null||d.call(t),!c&&l<r&&(l++,(h=s==null?void 0:s.onReconnecting)==null||h.call(s,l),setTimeout(u,i*Math.pow(1.5,l-1)))},onError:d=>{var h;(h=t.onError)==null||h.call(t,d)}},n)};return u(),{get socket(){return(o==null?void 0:o.socket)??null},send:d=>o==null?void 0:o.send(d),close:()=>{c=!0,o==null||o.close()},requestState:()=>o==null?void 0:o.requestState(),isConnected:()=>{var d;return((d=o==null?void 0:o.socket)==null?void 0:d.readyState)===WebSocket.OPEN},reconnect:()=>{c=!1,l=0,o==null||o.close(),u()}}},KI=()=>"https://adurun-campaigns.larhackman.workers.dev";async function _n(e,t,n){const r=`${KI()}/api/campaigns/${encodeURIComponent(e)}/combat/${t}`,i=await fetch(r,{method:"POST",headers:{"content-type":"application/json"},credentials:"include",body:JSON.stringify(n??{})}),o=await i.text();let l=null;if(o)try{l=JSON.parse(o)}catch{l=o}if(!i.ok){const c=typeof l=="object"&&l&&"error"in l?String(l.error):`Request failed with status ${i.status}`;throw new Te(i.status,c,l)}return l}async function GI(e){return _n(e,"auth-state",{})}async function JI(e,t){const n={initiativeMode:t.initiativeMode,manualInitiative:t.manualInitiative,entityIds:t.entityIds,entities:t.entities};return _n(e,"auth-start",n)}async function QI(e,t){const n={reason:t.reason};return _n(e,"auth-end-combat",n)}async function XI(e,t){const n={senderId:t.senderId,entityId:t.entityId,type:t.type,targetEntityId:t.targetEntityId,roll:t.roll,apCost:t.apCost,energyCost:t.energyCost,interruptible:t.interruptible??!0,metadata:t.metadata};return _n(e,"auth-declare-action",n)}async function ZI(e,t){const n={senderId:t.senderId,entityId:t.entityId,type:t.type,targetActionId:t.targetActionId,skill:t.skill,roll:t.roll,apCost:t.apCost,energyCost:t.energyCost};return _n(e,"auth-declare-reaction",n)}async function e1(e,t){return _n(e,"auth-resolve-reactions",{senderId:t})}async function t1(e,t){const n={senderId:t.senderId,entityId:t.entityId,voluntary:t.voluntary??!0};return _n(e,"auth-end-turn",n)}async function n1(e,t){const n={type:t.type,gmId:t.gmId,targetEntityId:t.targetEntityId,data:t.data,reason:t.reason};return _n(e,"auth-gm-override",n)}async function a1(e,t){return _n(e,"auth-initiate-skill-contest",t)}async function s1(e,t){return _n(e,"auth-respond-skill-contest",t)}async function r1(e,t){return _n(e,"auth-request-skill-check",t)}async function i1(e,t){return _n(e,"auth-submit-skill-check",t)}async function o1(e,t){return _n(e,"auth-remove-entity",t)}function l1(e,t){if(e.phase!=="active-turn"||e.activeEntityId!==t)return!1;const n=e.entities[t];return n?n.ap.current>0:!1}function c1(e,t){if(e.phase!=="reaction-interrupt"&&e.phase!=="active-turn"||e.activeEntityId===t)return!1;const n=e.entities[t];return n?n.reaction.available:!1}function u1(e){return e.activeEntityId?e.entities[e.activeEntityId]??null:null}function d1(e){return e.initiativeOrder.map(t=>e.entities[t]).filter(t=>t!==void 0)}function h1(e,t){return Object.values(e.entities).filter(n=>n.faction===t)}const Qt={getAuthoritativeState:GI,startCombat:JI,endCombat:QI,declareAction:XI,declareReaction:ZI,resolveReactions:e1,endTurn:t1,gmOverride:n1,initiateSkillContest:a1,respondToSkillContest:s1,requestSkillCheck:r1,submitSkillCheck:i1,removeEntity:o1,canEntityAct:l1,canEntityReact:c1,getActiveEntity:u1,getEntitiesInInitiativeOrder:d1,getEntitiesByFaction:h1},kb=v.createContext(void 0),Nb=({children:e,campaignId:t,userId:n,isGm:s=!1,onCombatStarted:r,onCombatEnded:i,onRoundStarted:o,onTurnStarted:l,onTurnEnded:c,onActionDeclared:u,onActionResolved:d,onReactionDeclared:h,onReactionsResolved:m,onEntityUpdated:y,onWoundsApplied:b,onStatusApplied:_,onStatusRemoved:w,onGmOverride:f,onInitiativeModified:p})=>{const[g,j]=v.useState("disconnected"),[A,R]=v.useState(0),[S,k]=v.useState(null),[N,E]=v.useState(null),[M,O]=v.useState(null),[X,re]=v.useState({}),[I,$]=v.useState({}),L=v.useRef(null),D=s?"gm":`player:${n}`,F=s?"gm":n;v.useEffect(()=>{if(!t)return;j("connecting"),O(null);const G=VI(t,{onStateSync:Y=>{k(Y.state)},onOpen:()=>{j("connected"),R(0)},onClose:()=>{j("disconnected")},onError:()=>{j("error"),O("WebSocket connection error")},onCombatStarted:Y=>{k(Y.state),r==null||r(Y)},onCombatEnded:Y=>{k(null),i==null||i(Y)},onRoundStarted:Y=>{k(J=>J&&{...J,round:Y.round,initiativeOrder:Y.initiativeOrder,lastUpdatedAt:new Date().toISOString()}),o==null||o(Y)},onTurnStarted:Y=>{k(J=>J&&{...J,activeEntityId:Y.entityId,round:Y.round,turnIndex:Y.turnIndex,phase:"active-turn",lastUpdatedAt:new Date().toISOString()}),l==null||l(Y)},onTurnEnded:Y=>{var J;k(Ae=>{if(!Ae)return Ae;const $e=Ae.entities[Y.entityId];return $e?{...Ae,entities:{...Ae.entities,[Y.entityId]:{...$e,energy:{...$e.energy,current:Math.min($e.energy.max,$e.energy.current+Y.energyGained)}}},lastUpdatedAt:new Date().toISOString()}:Ae}),(J=L.current)==null||J.requestState(),c==null||c(Y)},onActionDeclared:Y=>{k(J=>J&&{...J,pendingAction:Y.action,phase:Y.phase,lastUpdatedAt:new Date().toISOString()}),u==null||u(Y)},onActionResolved:Y=>{k(J=>J&&{...J,pendingAction:null,log:[...J.log,Y.log],lastUpdatedAt:new Date().toISOString()}),d==null||d(Y)},onReactionDeclared:Y=>{k(J=>{if(!J)return J;const Ae=J.entities[Y.reaction.entityId];return{...J,pendingReactions:[...J.pendingReactions,Y.reaction],phase:"reaction-interrupt",entities:Ae?{...J.entities,[Y.reaction.entityId]:{...Ae,reaction:{available:!1}}}:J.entities,lastUpdatedAt:new Date().toISOString()}}),h==null||h(Y)},onReactionsResolved:Y=>{k(J=>J&&{...J,pendingAction:null,pendingReactions:[],phase:"active-turn",log:[...J.log,...Y.log??[]],lastUpdatedAt:new Date().toISOString()}),m==null||m(Y)},onEntityUpdated:Y=>{k(J=>{if(!J)return J;const Ae=J.entities[Y.entityId];return Ae?{...J,entities:{...J.entities,[Y.entityId]:{...Ae,...Y.changes}},lastUpdatedAt:new Date().toISOString()}:J}),y==null||y(Y)},onWoundsApplied:Y=>{k(J=>{if(!J)return J;const Ae=J.entities[Y.entityId];if(!Ae)return J;const $e={...Ae.wounds};for(const[Ue,W]of Object.entries(Y.wounds))$e[Ue]=($e[Ue]??0)+(W??0);return{...J,entities:{...J.entities,[Y.entityId]:{...Ae,wounds:$e}},lastUpdatedAt:new Date().toISOString()}}),b==null||b(Y)},onStatusApplied:Y=>{k(J=>{if(!J)return J;const Ae=J.entities[Y.entityId];if(!Ae)return J;const $e=Ae.statusEffects.findIndex(W=>W.key===Y.statusKey),Ue=$e>=0?Ae.statusEffects.map((W,fe)=>fe===$e?{...W,stacks:Y.stacks,duration:Y.duration}:W):[...Ae.statusEffects,{key:Y.statusKey,stacks:Y.stacks,duration:Y.duration}];return{...J,entities:{...J.entities,[Y.entityId]:{...Ae,statusEffects:Ue}},lastUpdatedAt:new Date().toISOString()}}),_==null||_(Y)},onStatusRemoved:Y=>{k(J=>{if(!J)return J;const Ae=J.entities[Y.entityId];return Ae?{...J,entities:{...J.entities,[Y.entityId]:{...Ae,statusEffects:Ae.statusEffects.filter($e=>$e.key!==Y.statusKey)}},lastUpdatedAt:new Date().toISOString()}:J}),w==null||w(Y)},onGmOverride:Y=>{f==null||f(Y)},onInitiativeModified:Y=>{k(J=>J&&{...J,initiativeOrder:Y.newOrder,lastUpdatedAt:new Date().toISOString()}),p==null||p(Y)},onSkillContestInitiated:Y=>{re(J=>({...J,[Y.contest.contestId]:Y.contest}))},onSkillContestDefenseRequested:Y=>{},onSkillContestResolved:Y=>{re(J=>{const Ae={...J};return delete Ae[Y.contest.contestId],Ae})},onSkillCheckRequested:Y=>{$(J=>({...J,[Y.check.checkId]:Y.check}))},onSkillCheckRolled:Y=>{$(J=>{const Ae={...J};return Ae[Y.check.checkId]&&(Ae[Y.check.checkId]={...Ae[Y.check.checkId],rollData:Y.rollData,status:"rolled"}),Ae})},onEntityRemoved:Y=>{k(J=>{if(!J)return J;const Ae={...J.entities};return delete Ae[Y.entityId],{...J,entities:Ae,initiativeOrder:J.initiativeOrder.filter($e=>$e!==Y.entityId),lastUpdatedAt:new Date().toISOString()}})},onLobbyPlayerJoined:Y=>{E(Y.lobbyState)},onLobbyPlayerLeft:Y=>{E(Y.lobbyState)},onLobbyPlayerReady:Y=>{E(Y.lobbyState)},onLobbyStateSync:Y=>{E(Y.lobbyState)}},n,{maxRetries:10,retryDelay:2e3,onReconnecting:Y=>{j("reconnecting"),R(Y)}});return L.current=G,()=>{G.close(),L.current=null,j("disconnected")}},[t,n]);const q=(S==null?void 0:S.phase)??null,V=(S==null?void 0:S.round)??0,Q=v.useMemo(()=>S!=null&&S.activeEntityId?S.entities[S.activeEntityId]??null:null,[S==null?void 0:S.activeEntityId,S==null?void 0:S.entities]),te=v.useMemo(()=>Q?Q.controller===D:!1,[Q,D]),B=v.useMemo(()=>S?Object.values(S.entities).filter(ee=>ee.controller===D):[],[S==null?void 0:S.entities,D]),ae=v.useMemo(()=>{var ee;return!S||S.phase!=="active-turn"&&S.phase!=="reaction-interrupt"||!((ee=S.pendingAction)!=null&&ee.interruptible)?!1:B.some(G=>G.reaction.available&&G.alive&&G.id!==S.activeEntityId)},[S,B]),le=(S==null?void 0:S.pendingAction)??null,he=(S==null?void 0:S.pendingReactions)??[],ue=v.useMemo(()=>Object.values(X).find(G=>{var Y;return G.status==="awaiting_defense"&&((Y=S==null?void 0:S.entities[G.targetId])==null?void 0:Y.controller)===D})??null,[X,S==null?void 0:S.entities,D]),xe=v.useMemo(()=>Object.values(I).filter(G=>G.status==="pending"&&G.targetPlayerId===n),[I,n]),Ne=v.useMemo(()=>!S||S.phase!=="initiative-rolling"?[]:B.filter(ee=>{var G;return!((G=S.initiativeRolls)!=null&&G[ee.id])}),[S,B]),je=v.useCallback(ee=>S==null?void 0:S.entities[ee],[S==null?void 0:S.entities]),Ce=v.useCallback(ee=>S?Object.values(S.entities).filter(G=>G.faction===ee):[],[S==null?void 0:S.entities]),Ke=v.useCallback(()=>S?S.initiativeOrder.map(ee=>S.entities[ee]).filter(ee=>ee!==void 0):[],[S==null?void 0:S.initiativeOrder,S==null?void 0:S.entities]),Me=v.useCallback(async ee=>{try{O(null);const G=await Qt.startCombat(t,ee);k(G.state)}catch(G){const Y=G instanceof Error?G.message:"Failed to start combat";throw O(Y),G}},[t,F]),oe=v.useCallback(async ee=>{try{O(null),await Qt.endCombat(t,ee),k(null)}catch(G){const Y=G instanceof Error?G.message:"Failed to end combat";throw O(Y),G}},[t,F]),pe=v.useCallback(async()=>{try{O(null);const ee=await Qt.getAuthoritativeState(t);k(ee.state)}catch(ee){const G=ee instanceof Error?ee.message:"Failed to refresh state";throw O(G),ee}},[t]),ve=v.useCallback(async ee=>{try{O(null);const G=await Qt.submitInitiativeRoll(t,ee);k(G.state)}catch(G){const Y=G instanceof Error?G.message:"Failed to submit initiative roll";throw O(Y),G}},[t,F]),be=v.useCallback(async ee=>{try{O(null);const G=await Qt.declareAction(t,{...ee,senderId:F});k(G.state)}catch(G){const Y=G instanceof Error?G.message:"Failed to declare action";throw O(Y),G}},[t]),ke=v.useCallback(async ee=>{try{O(null);const G=await Qt.declareReaction(t,{...ee,senderId:F});k(G.state)}catch(G){const Y=G instanceof Error?G.message:"Failed to declare reaction";throw O(Y),G}},[t]),Ie=v.useCallback(async ee=>{try{O(null);const G=await Qt.endTurn(t,{...ee,senderId:F});k(G.state)}catch(G){const Y=G instanceof Error?G.message:"Failed to end turn";throw O(Y),G}},[t]),Be=v.useCallback(async()=>{try{O(null);const ee=await Qt.resolveReactions(t,F);k(ee.state)}catch(ee){const G=ee instanceof Error?ee.message:"Failed to resolve reactions";throw O(G),ee}},[t,F]),_e=v.useCallback(async ee=>{try{O(null);const G=await Qt.gmOverride(t,{...ee,gmId:n});k(G.state)}catch(G){const Y=G instanceof Error?G.message:"Failed to apply GM override";throw O(Y),G}},[t,n]),He=v.useCallback(async ee=>_e({type:"force_initiative_roll",targetEntityId:ee,gmId:n}),[_e,n]),De=v.useCallback(async(ee,G,Y,J,Ae,$e)=>_e({type:"add_resource_modifier",targetEntityId:ee,gmId:n,data:{resource:G,modifierType:Y,amount:J,duration:Ae,source:$e}}),[_e,n]),ne=v.useCallback(async(ee,G,Y)=>_e({type:"remove_resource_modifier",targetEntityId:ee,gmId:n,data:{resource:G,modifierId:Y}}),[_e,n]),me=v.useCallback(async(ee,G,Y)=>_e({type:G==="ap"?"adjust_ap":"adjust_energy",targetEntityId:ee,gmId:n,data:{delta:Y}}),[_e,n]),we=v.useCallback(async ee=>{try{O(null),await Qt.initiateSkillContest(t,ee)}catch(G){const Y=G instanceof Error?G.message:"Failed to initiate skill contest";throw O(Y),G}},[t]),Ye=v.useCallback(async ee=>{try{O(null),await Qt.respondToSkillContest(t,ee)}catch(G){const Y=G instanceof Error?G.message:"Failed to respond to skill contest";throw O(Y),G}},[t]),Fe=v.useCallback(async ee=>{try{O(null),await Qt.requestSkillCheck(t,ee)}catch(G){const Y=G instanceof Error?G.message:"Failed to request skill check";throw O(Y),G}},[t]),z=v.useCallback(async ee=>{try{O(null),await Qt.submitSkillCheck(t,ee)}catch(G){const Y=G instanceof Error?G.message:"Failed to submit skill check";throw O(Y),G}},[t]),de=v.useCallback(async ee=>{try{O(null),await Qt.removeEntity(t,ee)}catch(G){const Y=G instanceof Error?G.message:"Failed to remove entity";throw O(Y),G}},[t]),U=v.useCallback(ee=>{var G;(G=L.current)!=null&&G.socket&&L.current.socket.send(JSON.stringify({type:"LOBBY_JOIN",userId:n,characterId:ee}))},[n]),P=v.useCallback(()=>{var ee;(ee=L.current)!=null&&ee.socket&&L.current.socket.send(JSON.stringify({type:"LOBBY_LEAVE",userId:n}))},[n]),H=v.useCallback((ee,G)=>{var Y;(Y=L.current)!=null&&Y.socket&&L.current.socket.send(JSON.stringify({type:"LOBBY_TOGGLE_READY",userId:n,isReady:ee,characterId:G}))},[n]),Z=v.useCallback(()=>{O(null)},[]),ie=v.useMemo(()=>({campaignId:t,connectionStatus:g,reconnectAttempt:A,state:S,lobbyState:N,phase:q,round:V,activeEntity:Q,isMyTurn:te,myControlledEntities:B,canDeclareReaction:ae,pendingAction:le,pendingReactions:he,pendingSkillContests:X,pendingSkillChecks:I,myPendingDefense:ue,myPendingSkillChecks:xe,getEntity:je,getEntitiesByFaction:Ce,getEntitiesInInitiativeOrder:Ke,startCombat:Me,endCombat:oe,refreshState:pe,submitInitiativeRoll:ve,myPendingInitiativeRolls:Ne,declareAction:be,declareReaction:ke,endTurn:Ie,initiateSkillContest:we,respondToSkillContest:Ye,requestSkillCheck:Fe,submitSkillCheck:z,resolveReactions:Be,gmOverride:_e,removeEntity:de,forceInitiativeRoll:He,addResourceModifier:De,removeResourceModifier:ne,adjustResource:me,joinLobby:U,leaveLobby:P,toggleReady:H,error:M,clearError:Z}),[t,g,A,S,N,q,V,Q,te,B,ae,le,he,X,I,ue,xe,je,Ce,Ke,Me,oe,pe,ve,Ne,be,ke,Ie,we,Ye,Fe,z,Be,_e,de,He,De,ne,me,U,P,H,M,Z]);return a.jsx(kb.Provider,{value:ie,children:e})},Ui=()=>{const e=v.useContext(kb);if(!e)throw new Error("useCombat must be used within CombatProvider");return e},jb=()=>{const{phase:e,round:t,activeEntity:n,isMyTurn:s,endTurn:r,pendingAction:i}=Ui();return{phase:e,round:t,activeEntity:n,isMyTurn:s,endTurn:r,pendingAction:i}},m1=()=>{const{canDeclareReaction:e,pendingReactions:t,declareReaction:n,resolveReactions:s}=Ui();return{canDeclareReaction:e,pendingReactions:t,declareReaction:n,resolveReactions:s}},Sb=()=>{const{state:e,getEntity:t,getEntitiesByFaction:n,getEntitiesInInitiativeOrder:s,myControlledEntities:r}=Ui();return{entities:(e==null?void 0:e.entities)??{},getEntity:t,getEntitiesByFaction:n,getEntitiesInInitiativeOrder:s,myControlledEntities:r}},p1=e=>{const t=[[1e3,"M"],[900,"CM"],[500,"D"],[400,"CD"],[100,"C"],[90,"XC"],[50,"L"],[40,"XL"],[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]];let n="",s=e;for(const[r,i]of t)for(;s>=r;)n+=i,s-=r;return n||"I"},Bf={setup:{rune:"",label:"Setup",position:0},initiative:{rune:"",label:"Initiative",position:1},"active-turn":{rune:"",label:"Active",position:2},"reaction-interrupt":{rune:"",label:"Interrupt",position:3},resolution:{rune:"",label:"Resolve",position:4},completed:{rune:"",label:"Complete",position:5}},Eb=({phase:e,round:t,onPhaseClick:n,className:s=""})=>{const i=Bf[e].position*60%360;return a.jsxs("div",{className:`phase-dial ${s}`,"data-phase":e,children:[a.jsxs("div",{className:"phase-dial__frame",children:[a.jsxs("svg",{className:"phase-dial__decorative-ring",viewBox:"0 0 200 200",children:[a.jsx("circle",{cx:"100",cy:"100",r:"95",fill:"none",stroke:"currentColor",strokeWidth:"2",opacity:"0.3"}),a.jsx("circle",{cx:"100",cy:"100",r:"90",fill:"none",stroke:"currentColor",strokeWidth:"1",strokeDasharray:"5,5",opacity:"0.2"})]}),a.jsxs("div",{className:"phase-dial__round",children:[a.jsx("span",{className:"phase-dial__round-label",children:"Round"}),a.jsx("span",{className:"phase-dial__round-value war-text-roman",children:p1(t)})]}),a.jsx("div",{className:"phase-dial__indicator",style:{transform:`rotate(${i}deg)`,transition:"transform 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55)"},children:a.jsx("div",{className:"phase-dial__indicator-pointer"})}),a.jsx("div",{className:"phase-dial__phases",children:Object.entries(Bf).map(([o,l])=>{const c=o===e,u=(l.position*60-90)*(Math.PI/180),d=75,h=100+d*Math.cos(u),m=100+d*Math.sin(u);return a.jsxs("button",{className:`phase-dial__phase ${c?"phase-dial__phase--active":""}`,style:{position:"absolute",left:`${h}%`,top:`${m}%`,transform:"translate(-50%, -50%)"},onClick:()=>n==null?void 0:n(o),disabled:!n,title:l.label,"aria-label":`${l.label} phase${c?" (active)":""}`,children:[a.jsx("span",{className:"phase-dial__phase-rune",children:l.rune}),c&&a.jsx("span",{className:"phase-dial__phase-label",children:l.label})]},o)})})]}),a.jsxs("svg",{className:"phase-dial__connections",viewBox:"0 0 200 200",children:[a.jsx("defs",{children:a.jsxs("linearGradient",{id:"phase-energy-gradient",children:[a.jsx("stop",{offset:"0%",stopColor:"var(--war-ember)",stopOpacity:"0"}),a.jsx("stop",{offset:"50%",stopColor:"var(--war-ember-glow)",stopOpacity:"0.8"}),a.jsx("stop",{offset:"100%",stopColor:"var(--war-ember)",stopOpacity:"0"})]})}),a.jsx("circle",{cx:"100",cy:"100",r:"75",fill:"none",stroke:"url(#phase-energy-gradient)",strokeWidth:"2",strokeDasharray:"10,5",className:"phase-dial__energy-ring",style:{animation:"war-rotate 20s linear infinite"}})]})]})},Cb=({entities:e,initiativeOrder:t,activeEntityId:n,onEntityClick:s,className:r=""})=>{const i=t.map(o=>e.find(l=>l.id===o)).filter(o=>o!==void 0);return a.jsxs("div",{className:`initiative-tower ${r}`,children:[a.jsxs("div",{className:"initiative-tower__header",children:[a.jsx("div",{className:"initiative-tower__header-icon",children:""}),a.jsx("h3",{className:"initiative-tower__title war-text-display",children:"Initiative"})]}),a.jsx("div",{className:"initiative-tower__list",children:i.length===0?a.jsx("div",{className:"initiative-tower__empty",children:a.jsx("p",{children:"No combatants"})}):i.map((o,l)=>{var y;const c=o.id===n,u=!o.alive,d=`initiative-tower__entry--${o.faction}`,h=c?"initiative-tower__entry--active":"",m=u?"initiative-tower__entry--defeated":"";return a.jsxs(v.Fragment,{children:[l>0&&a.jsx("div",{className:"initiative-tower__chain",children:a.jsx("svg",{className:"initiative-tower__chain-svg",viewBox:"0 0 20 40",preserveAspectRatio:"none",children:a.jsx("line",{x1:"10",y1:"0",x2:"10",y2:"40",stroke:"currentColor",strokeWidth:"2",strokeDasharray:"4,2",className:"initiative-tower__chain-line"})})}),a.jsxs("button",{className:`initiative-tower__entry ${d} ${h} ${m}`,onClick:()=>s==null?void 0:s(o.id),disabled:!s,"aria-label":`${o.name} - ${c?"Acting":"Waiting"}`,title:`${o.name}
AP: ${o.ap.current}/${o.ap.max} | Energy: ${o.energy.current}/${o.energy.max}`,children:[a.jsxs("div",{className:"initiative-tower__portrait",children:[a.jsx("div",{className:"initiative-tower__portrait-placeholder",children:o.name.charAt(0).toUpperCase()}),c&&a.jsx("div",{className:"initiative-tower__active-indicator",children:""}),u&&a.jsx("div",{className:"initiative-tower__defeated-overlay",children:a.jsx("span",{className:"initiative-tower__defeated-mark",children:""})})]}),a.jsxs("div",{className:"initiative-tower__info",children:[a.jsx("div",{className:"initiative-tower__name",children:o.name}),a.jsxs("div",{className:"initiative-tower__resources",children:[a.jsxs("span",{className:"initiative-tower__resource initiative-tower__resource--ap",children:[o.ap.current,"/",o.ap.max," AP"]}),a.jsxs("span",{className:"initiative-tower__resource initiative-tower__resource--energy",children:[o.energy.current,"/",o.energy.max," EN"]})]})]}),((y=o.reaction)==null?void 0:y.available)&&!c&&a.jsx("div",{className:"initiative-tower__reaction",title:"Reaction available",children:""})]})]},o.id)})}),a.jsx("div",{className:"initiative-tower__footer",children:a.jsxs("div",{className:"initiative-tower__count",children:[i.length," combatant",i.length!==1?"s":""]})})]})},$l=({entity:e,isActive:t=!1,isSelected:n=!1,onClick:s,showTargetPrompt:r=!1,compact:i=!1,className:o=""})=>{var d;const l=e.faction||"enemy",c=!e.alive,u=["entity-token",`entity-token--${l}`,t&&"entity-token--active",n&&"entity-token--selected",c&&"entity-token--defeated",i&&"entity-token--compact",s&&"entity-token--clickable",o].filter(Boolean).join(" ");return a.jsxs("div",{className:u,onClick:s,role:s?"button":void 0,tabIndex:s?0:void 0,onKeyDown:s?h=>h.key==="Enter"&&s():void 0,"aria-label":`${e.name}${t?" - Acting":""}${c?" - Defeated":""}`,children:[a.jsxs("div",{className:"entity-token__frame","aria-hidden":"true",children:[l==="ally"&&a.jsx("div",{className:"entity-token__ornament entity-token__ornament--ally",children:""}),l==="enemy"&&a.jsx("div",{className:"entity-token__ornament entity-token__ornament--enemy",children:""})]}),t&&a.jsx("div",{className:"entity-token__banner",children:a.jsx("span",{className:"entity-token__banner-text",children:"ACTING"})}),a.jsxs("div",{className:"entity-token__header",children:[a.jsx("h4",{className:"entity-token__name war-text-body",children:e.name}),c&&a.jsx("span",{className:"entity-token__status-icon",title:"Defeated",children:""})]}),!i&&a.jsxs("div",{className:"entity-token__resources",children:[a.jsxs("div",{className:"entity-token__resource-row",children:[a.jsx("span",{className:"entity-token__resource-label",children:"AP"}),a.jsx("div",{className:"entity-token__resource-bar",children:a.jsx("div",{className:"entity-token__resource-fill entity-token__resource-fill--ap",style:{width:`${e.ap.current/e.ap.max*100}%`}})}),a.jsxs("span",{className:"entity-token__resource-value war-text-mono",children:[e.ap.current,"/",e.ap.max]})]}),a.jsxs("div",{className:"entity-token__resource-row",children:[a.jsx("span",{className:"entity-token__resource-label",children:"EN"}),a.jsx("div",{className:"entity-token__resource-bar",children:a.jsx("div",{className:"entity-token__resource-fill entity-token__resource-fill--energy",style:{width:`${e.energy.current/e.energy.max*100}%`}})}),a.jsxs("span",{className:"entity-token__resource-value war-text-mono",children:[e.energy.current,"/",e.energy.max]})]})]}),i&&a.jsxs("div",{className:"entity-token__resources-compact war-text-mono",children:[a.jsxs("span",{className:"entity-token__compact-stat",children:[e.ap.current,"/",e.ap.max," AP"]}),a.jsx("span",{className:"entity-token__compact-separator",children:""}),a.jsxs("span",{className:"entity-token__compact-stat",children:[e.energy.current,"/",e.energy.max," EN"]})]}),!i&&Object.values(e.wounds).some(h=>h>0)&&a.jsxs("div",{className:"entity-token__wounds",children:[a.jsx("div",{className:"entity-token__section-label",children:"Wounds"}),a.jsx("div",{className:"entity-token__wound-list",children:Object.entries(e.wounds).map(([h,m])=>m>0&&a.jsxs("span",{className:`entity-token__wound entity-token__wound--${h}`,title:`${m} ${h} wound${m!==1?"s":""}`,children:[f1(h)," ",m]},h))})]}),!i&&e.statusEffects.length>0&&a.jsxs("div",{className:"entity-token__status-effects",children:[a.jsx("div",{className:"entity-token__section-label",children:"Status"}),a.jsx("div",{className:"entity-token__status-list",children:e.statusEffects.map((h,m)=>a.jsxs("span",{className:"entity-token__status-badge",title:`${h.key}${h.stacks>1?` (${h.stacks})`:""}${h.duration?` - ${h.duration} rounds`:""}`,children:[h.key,h.stacks>1&&a.jsxs("span",{className:"entity-token__status-stack",children:["",h.stacks]})]},`${h.key}-${m}`))})]}),r&&a.jsx("div",{className:"entity-token__target-prompt",children:a.jsx("span",{className:"entity-token__target-text",children:" SELECT TARGET "})}),((d=e.reaction)==null?void 0:d.available)&&!t&&a.jsx("div",{className:"entity-token__reaction-badge",title:"Reaction available",children:""})]})};function f1(e){return{burn:"",freeze:"",laceration:"",blunt:"",mental:"",necrosis:"",spiritual:""}[e]||""}const qo=({current:e,max:t,type:n,label:s,compact:r=!1,showValues:i=!0,className:o=""})=>{const l=e/t*100,c=l<=30,u=l<=15,d=Array.from({length:t},(b,_)=>_),h=Math.floor(e),m=e-h,y=["resource-segments",`resource-segments--${n}`,r&&"resource-segments--compact",c&&"resource-segments--low",u&&"resource-segments--critical",o].filter(Boolean).join(" ");return a.jsxs("div",{className:y,children:[s&&a.jsxs("div",{className:"resource-segments__header",children:[a.jsx("span",{className:"resource-segments__label",children:s}),i&&a.jsxs("span",{className:"resource-segments__value war-text-mono",children:[e,"/",t]})]}),a.jsx("div",{className:"resource-segments__bar",children:d.map(b=>{const _=b<h,w=b===h&&m>0,f=w?m*100:0;return a.jsx("div",{className:`resource-segments__segment ${_?"resource-segments__segment--filled":""} ${w?"resource-segments__segment--partial":""}`,style:w?{background:`linear-gradient(to right, var(--segment-fill-color) ${f}%, var(--segment-empty-color) ${f}%)`}:void 0,"aria-hidden":"true"},b)})}),a.jsxs("span",{className:"war-sr-only",children:[s," ",e," out of ",t,c&&" (low)"]})]})},g1={burn:{icon:"",color:"var(--war-wound-burn)",penalty:"-3 to physical skills per wound"},freeze:{icon:"",color:"var(--war-wound-freeze)",penalty:"-1 AP per wound"},laceration:{icon:"",color:"var(--war-wound-laceration)",penalty:"-3 energy per round per wound"},blunt:{icon:"",color:"var(--war-wound-blunt)",penalty:"+1 movement energy cost per wound"},mental:{icon:"",color:"var(--war-wound-mental)",penalty:"-3 to mental skills per wound"},necrosis:{icon:"",color:"var(--war-wound-necrosis)",penalty:"-3 to max energy per wound"},spiritual:{icon:"",color:"var(--war-wound-spiritual)",penalty:"-3 to spiritual skills per wound"}},y1=({wounds:e,compact:t=!1,showPenalties:n=!1,hideEmpty:s=!1,className:r=""})=>{const i=Object.entries(e).filter(([l,c])=>c>0);if(s&&i.length===0)return null;const o=["wound-display",t&&"wound-display--compact",r].filter(Boolean).join(" ");return a.jsxs("div",{className:o,children:[!t&&a.jsxs("div",{className:"wound-display__header",children:[a.jsx("span",{className:"wound-display__label",children:"Wounds"}),a.jsxs("span",{className:"wound-display__total war-text-mono",children:[i.reduce((l,[c,u])=>l+u,0)," total"]})]}),a.jsx("div",{className:"wound-display__list",children:i.length===0?!s&&a.jsx("span",{className:"wound-display__empty",children:"No wounds"}):i.map(([l,c])=>{const u=g1[l],d=n?`${l}: ${c}  ${u.penalty}`:`${l}: ${c}`;return a.jsxs("div",{className:`wound-display__wound wound-display__wound--${l}`,title:d,style:{borderColor:u.color},children:[a.jsx("span",{className:"wound-display__icon",children:u.icon}),a.jsxs("span",{className:"wound-display__count war-text-mono",children:["",c]}),n&&!t&&a.jsx("span",{className:"wound-display__penalty",children:u.penalty})]},l)})})]})},v1={BLESSED:"buff",HASTENED:"buff",BLINDED:"debuff",BURNING:"debuff",CHARMED:"debuff",CRUSHING:"debuff",CURSED:"debuff",DAZED:"debuff",DEAFENED:"debuff",ENRAGED:"neutral",FREEZING:"debuff",INTOXICATED:"debuff",BLEEDING:"debuff",PRONE:"debuff",RENDED:"debuff",ROTTING:"debuff",SLOWED:"debuff",STUPIFICATION:"debuff",SUFFOCATING:"debuff",UNCONSCIOUS:"debuff"},b1={BLESSED:"Improved saving throws and healing received",HASTENED:"Increased movement and action speed",BLINDED:"Cannot see, disadvantage on attacks",BURNING:"Takes burn damage each round",CHARMED:"Friendly towards source, won't attack",CRUSHING:"Takes blunt damage each round",CURSED:"Disadvantage on attacks and saves",DAZED:"Reduced actions and reactions",DEAFENED:"Cannot hear, may miss sound-based cues",ENRAGED:"Bonus damage but reckless attacks",FREEZING:"Takes freeze damage each round",INTOXICATED:"Impaired judgment and coordination",BLEEDING:"Takes laceration damage each round",PRONE:"Lying down, disadvantage on attacks",RENDED:"Takes spiritual damage each round",ROTTING:"Takes necrosis damage each round",SLOWED:"Reduced movement speed",STUPIFICATION:"Takes mental damage each round",SUFFOCATING:"Cannot breathe, taking damage",UNCONSCIOUS:"Helpless, cannot take actions"},_1=({status:e,size:t="md",showDuration:n=!0,onClick:s,className:r=""})=>{const i=v1[e.key]||"neutral",o=b1[e.key]||"",l=[e.key,e.stacks>1&&`${e.stacks} stacks`,e.duration&&`${e.duration} round${e.duration!==1?"s":""} remaining`,o].filter(Boolean).join("  "),c=["status-pill",`status-pill--${i}`,`status-pill--${t}`,s&&"status-pill--clickable",r].filter(Boolean).join(" ");return a.jsxs("div",{className:c,title:l,onClick:s,role:s?"button":void 0,tabIndex:s?0:void 0,onKeyDown:s?u=>u.key==="Enter"&&s():void 0,children:[a.jsx("span",{className:"status-pill__name",children:e.key}),e.stacks>1&&a.jsxs("span",{className:"status-pill__stacks war-text-mono",children:["",e.stacks]}),n&&e.duration!==null&&a.jsxs("span",{className:"status-pill__duration war-text-mono",children:[e.duration,"r"]})]})},Ff=({effects:e,size:t="md",showDuration:n=!0,onStatusClick:s,className:r=""})=>e.length===0?null:a.jsx("div",{className:`status-list ${r}`,children:e.map((i,o)=>a.jsx(_1,{status:i,size:t,showDuration:n,onClick:s?()=>s(i):void 0},`${i.key}-${o}`))}),dc=({entity:e,selectedSkill:t,onSkillChange:n,label:s="Select Skill",placeholder:r="Choose a skill...",disabled:i=!1})=>{if(!e)return a.jsxs("div",{className:"skill-selector",children:[a.jsx("label",{children:s}),a.jsx("select",{disabled:!0,children:a.jsx("option",{children:"No entity selected"})})]});const o=e.skills||{},l=Object.entries(o),c=v.useMemo(()=>{var h;const d={Physical:[],Mental:[],Spiritual:[],Will:[],Subsistence:[],Intuition:[],Presence:[],Cunning:[],Sagacity:[],Benediction:[],Other:[]};for(const[m,y]of l){const b=aa({id:m,name:m}),_=em[b]||[];if(_.length===0)d.Other.push([m,y]);else if(_.length===1){const w=_[0].charAt(0)+_[0].slice(1).toLowerCase();(h=d[w])==null||h.push([m,y])}else if(_.length===2){const w=_.join("+");w==="PHYSICAL+MENTAL"?d.Subsistence.push([m,y]):w==="PHYSICAL+SPIRITUAL"?d.Intuition.push([m,y]):w==="PHYSICAL+WILL"?d.Presence.push([m,y]):w==="MENTAL+WILL"?d.Cunning.push([m,y]):w==="MENTAL+SPIRITUAL"?d.Sagacity.push([m,y]):w==="SPIRITUAL+WILL"?d.Benediction.push([m,y]):d.Other.push([m,y])}}return Object.entries(d).filter(([m,y])=>y.length>0).map(([m,y])=>[m,y.sort(([b],[_])=>b.localeCompare(_))])},[l]),u="skill-select";return a.jsxs("div",{className:"skill-selector",children:[a.jsx("label",{htmlFor:u,children:s}),l.length===0?a.jsx("input",{id:u,type:"text",value:t??"",onChange:d=>n(d.target.value),placeholder:r,disabled:i,className:"skill-select"}):a.jsxs("select",{id:u,value:t??"",onChange:d=>n(d.target.value),disabled:i,className:"skill-select",children:[a.jsx("option",{value:"",disabled:!0,children:r}),c.map(([d,h])=>a.jsx("optgroup",{label:`${d} Skills`,children:h.map(([m,y])=>a.jsxs("option",{value:m,children:[m," (",y>=0?"+":"",y,")"]},m))},d))]})]})},Wi=({diceCount:e,keepHighest:t,onDiceCountChange:n,onKeepHighestChange:s,minDice:r=1,maxDice:i=10,disabled:o=!1,className:l=""})=>{const c=["dice-roll-config",o&&"dice-roll-config--disabled",l].filter(Boolean).join(" ");return a.jsxs("div",{className:c,children:[a.jsxs("div",{className:"dice-roll-config__field",children:[a.jsxs("label",{className:"dice-roll-config__label",children:["Dice Count:",a.jsx("input",{type:"number",min:r,max:i,value:e,onChange:u=>n(Number(u.target.value)),className:"dice-roll-config__input war-text-mono",disabled:o})]}),a.jsxs("div",{className:"dice-roll-config__preview war-text-mono",children:[e,"d100"]})]}),a.jsx("div",{className:"dice-roll-config__field",children:a.jsxs("label",{className:"dice-roll-config__checkbox-label",children:[a.jsx("input",{type:"checkbox",checked:t,onChange:u=>s(u.target.checked),disabled:o,className:"dice-roll-config__checkbox"}),a.jsxs("span",{className:"dice-roll-config__checkbox-text",children:["Keep ",t?"Highest":"Lowest"]})]})}),a.jsxs("div",{className:"dice-roll-config__description",children:["Roll ",e," ",e===1?"die":"dice"," and use the"," ",t?"highest":"lowest"," result"]})]})},qf=[{type:"attack",icon:"",label:"Attack",description:"Strike at a foe with your weapon",apCost:2,needsTarget:!0},{type:"spell",icon:"",label:"Spell",description:"Cast a magical spell",apCost:2,needsTarget:!0},{type:"ability",icon:"",label:"Ability",description:"Use a special ability",apCost:2,needsTarget:!0},{type:"movement",icon:"",label:"Move",description:"Change position on the battlefield",apCost:1,needsTarget:!1},{type:"item",icon:"",label:"Item",description:"Use an item from your inventory",apCost:1,needsTarget:!1}],x1=({entity:e,enemies:t,onDeclareAction:n,onInitiateSkillContest:s,onEndTurn:r,disabled:i=!1,className:o=""})=>{const[l,c]=v.useState("attack"),[u,d]=v.useState(null),[h,m]=v.useState(null),[y,b]=v.useState(2),[_,w]=v.useState(!0),[f,p]=v.useState(!1),g=qf.find(M=>M.type===l),j=g?e.ap.current>=g.apCost:!1,A=(g==null?void 0:g.needsTarget)??!1,R=((g==null?void 0:g.type)==="attack"||(g==null?void 0:g.type)==="spell")&&s,S=!i&&j&&(!A||u)&&(!R||f&&h),k=()=>{if(!(!S||!g)){if(R&&u&&h&&s){const M=Array.from({length:y},()=>Math.floor(Math.random()*100)+1),O=e.skills[h]||0;s(u,h,{diceCount:y,diceSize:100,rawValues:M,keepHighest:_,modifier:O})}else n(g.type,g.apCost,A?u??void 0:void 0);d(null),m(null),p(!1)}},N=M=>{d(M),R&&p(!0)},E=["action-grimoire",i&&"action-grimoire--disabled",o].filter(Boolean).join(" ");return i?a.jsx("div",{className:`${E} action-grimoire--closed`,children:a.jsxs("div",{className:"action-grimoire__closed-state",children:[a.jsxs("div",{className:"action-grimoire__book-cover",children:[a.jsx("div",{className:"action-grimoire__book-title war-text-display",children:"Action Grimoire"}),a.jsx("div",{className:"action-grimoire__lock",children:""})]}),a.jsx("p",{className:"action-grimoire__waiting-text",children:"Awaiting your turn..."})]})}):a.jsxs("div",{className:E,children:[a.jsxs("div",{className:"action-grimoire__header",children:[a.jsx("h3",{className:"action-grimoire__title war-text-display",children:" Declare Action"}),a.jsxs("button",{className:"action-grimoire__end-turn",onClick:r,title:"End your turn",children:[a.jsx("span",{className:"action-grimoire__end-turn-icon",children:""}),a.jsx("span",{className:"action-grimoire__end-turn-text",children:"End Turn"})]})]}),a.jsx("div",{className:"action-grimoire__tabs",children:qf.map(M=>{const O=l===M.type,X=e.ap.current>=M.apCost;return a.jsxs("button",{className:`action-grimoire__tab ${O?"action-grimoire__tab--selected":""} ${X?"":"action-grimoire__tab--disabled"}`,onClick:()=>{c(M.type),d(null)},disabled:!X,title:`${M.label} (${M.apCost} AP)`,children:[a.jsx("span",{className:"action-grimoire__tab-icon",children:M.icon}),a.jsx("span",{className:"action-grimoire__tab-label",children:M.label}),a.jsxs("span",{className:"action-grimoire__tab-cost war-text-mono",children:[M.apCost," AP"]})]},M.type)})}),a.jsx("div",{className:"action-grimoire__content",children:g&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"action-grimoire__description",children:[a.jsx("p",{className:"action-grimoire__description-text",children:g.description}),a.jsxs("div",{className:"action-grimoire__cost-display",children:[a.jsx("span",{className:"action-grimoire__cost-label",children:"Cost:"}),a.jsxs("span",{className:"action-grimoire__cost-value war-text-mono",children:[g.apCost," AP"]})]})]}),A&&a.jsxs("div",{className:"action-grimoire__targets",children:[a.jsx("label",{className:"action-grimoire__targets-label",children:"Select Target:"}),t.length===0?a.jsx("p",{className:"action-grimoire__no-targets",children:"No valid targets available"}):a.jsx("div",{className:"action-grimoire__target-grid",children:t.map(M=>a.jsxs("button",{className:`action-grimoire__target ${u===M.id?"action-grimoire__target--selected":""}`,onClick:()=>N(M.id),children:[a.jsx("span",{className:"action-grimoire__target-name",children:M.name}),a.jsxs("span",{className:"action-grimoire__target-info war-text-mono",children:[M.ap.current,"/",M.ap.max," AP"]}),M.statusEffects.length>0&&a.jsxs("span",{className:"action-grimoire__target-status",children:[M.statusEffects.length," effect",M.statusEffects.length!==1?"s":""]})]},M.id))})]}),f&&a.jsxs("div",{className:"action-grimoire__skill-section",children:[a.jsx(dc,{entity:e,selectedSkill:h,onSkillChange:m,label:"Attack Skill:",placeholder:"Choose your attack skill..."}),a.jsx(Wi,{diceCount:y,keepHighest:_,onDiceCountChange:b,onKeepHighestChange:w})]}),a.jsxs("button",{className:"action-grimoire__submit",onClick:k,disabled:!S,children:[a.jsx("span",{className:"action-grimoire__submit-icon",children:g.icon}),a.jsx("span",{className:"action-grimoire__submit-text",children:R&&f?"Roll Attack":`Declare ${g.label}`})]})]})}),a.jsx("div",{className:"action-grimoire__page-edge","aria-hidden":"true"})]})},w1=({available:e,pulsing:t=!1,onClick:n,label:s="React",className:r=""})=>{const i=["reaction-sigil",!e&&"reaction-sigil--dormant",e&&!t&&"reaction-sigil--available",t&&"reaction-sigil--pulsing",r].filter(Boolean).join(" ");return e?a.jsxs("button",{className:i,onClick:n,"aria-label":`Declare reaction${t?" (action pending!)":""}`,title:t?"Action in progress - React now!":"Reaction available",children:[t&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"reaction-sigil__ring reaction-sigil__ring--1"}),a.jsx("div",{className:"reaction-sigil__ring reaction-sigil__ring--2"}),a.jsx("div",{className:"reaction-sigil__ring reaction-sigil__ring--3"})]}),a.jsx("div",{className:"reaction-sigil__rune",children:""}),s&&a.jsxs("div",{className:"reaction-sigil__label",children:[t&&a.jsx("span",{className:"reaction-sigil__label-emphasis",children:" "}),s,t&&a.jsx("span",{className:"reaction-sigil__label-emphasis",children:" "})]}),t&&a.jsx("div",{className:"reaction-sigil__particles","aria-hidden":"true",children:Array.from({length:8}).map((o,l)=>a.jsx("div",{className:"reaction-sigil__particle",style:{transform:`rotate(${l*45}deg) translateY(-40px)`,animationDelay:`${l*.1}s`}},l))})]}):a.jsx("div",{className:i,"aria-hidden":"true",children:a.jsx("div",{className:"reaction-sigil__rune reaction-sigil__rune--depleted",children:""})})},Uf={combat_started:{icon:"",color:"var(--war-gold)",label:"Combat Begins"},combat_ended:{icon:"",color:"var(--war-gold)",label:"Combat Ends"},round_started:{icon:"",color:"var(--war-gold)",label:"New Round"},turn_started:{icon:"",color:"var(--war-storm)",label:"Turn Start"},turn_ended:{icon:"",color:"var(--war-storm)",label:"Turn End"},action_declared:{icon:"",color:"var(--war-ember)",label:"Action"},action_resolved:{icon:"",color:"var(--war-jade)",label:"Resolved"},action_cancelled:{icon:"",color:"var(--war-text-tertiary)",label:"Cancelled"},reaction_declared:{icon:"",color:"var(--war-storm)",label:"Reaction"},reaction_resolved:{icon:"",color:"var(--war-jade)",label:"Reaction Resolved"},wounds_applied:{icon:"",color:"var(--war-blood)",label:"Wound"},status_applied:{icon:"",color:"var(--war-jade)",label:"Status"},status_removed:{icon:"",color:"var(--war-text-tertiary)",label:"Status Ended"},status_tick:{icon:"",color:"var(--war-text-secondary)",label:"Status Tick"},resources_updated:{icon:"",color:"var(--war-text-secondary)",label:"Resources"},gm_override:{icon:"",color:"var(--war-gold)",label:"GM Override"}},Ab=({log:e,entities:t,onEntryClick:n,maxEntries:s=100,showFilters:r=!1,className:i=""})=>{const[o,l]=v.useState(new Set),[c,u]=v.useState(new Set),d=v.useRef(null);v.useEffect(()=>{var p;(p=d.current)==null||p.scrollIntoView({behavior:"smooth"})},[e.length]);const h=p=>{if(!p)return"Unknown";const g=t.find(j=>j.id===p);return(g==null?void 0:g.name)||"Unknown"},m=p=>{const g=h(p.sourceEntityId),j=h(p.targetEntityId),A=p.data||{};switch(p.type){case"combat_started":return"The battle begins!";case"combat_ended":return`Combat concluded: ${A.reason||"unknown"}`;case"round_started":return`Round ${A.round||"?"} begins`;case"turn_started":return`${g}'s turn`;case"turn_ended":return`${g} ends their turn`;case"action_declared":return`${g} declares ${A.actionType||"action"}${j!=="Unknown"?` targeting ${j}`:""}`;case"action_resolved":return`${g}'s ${A.actionType||"action"} resolves`;case"action_cancelled":return`${g}'s action cancelled`;case"reaction_declared":return`${g} reacts with ${A.reactionType||"reaction"}`;case"reaction_resolved":return`${g}'s reaction resolves`;case"wounds_applied":return`${j} takes ${A.woundType||""} wound${typeof A.count=="number"&&A.count>1?"s":""}`;case"status_applied":return`${j} gains ${A.statusKey||"status"}`;case"status_removed":return`${j} loses ${A.statusKey||"status"}`;case"status_tick":return`${g}'s ${A.statusKey||"status"} ticks`;case"resources_updated":return`${g}'s resources updated`;case"gm_override":return`GM: ${A.description||"Override applied"}`;default:return"Unknown event"}},y=p=>{l(g=>{const j=new Set(g);return j.has(p)?j.delete(p):j.add(p),j})},b=e.filter(p=>c.size===0?!0:c.has(p.type)).slice(-s),_=b.filter(p=>o.has(p.id)),w=b.filter(p=>!o.has(p.id)),f=["combat-chronicle",i].filter(Boolean).join(" ");return a.jsxs("div",{className:f,children:[a.jsxs("div",{className:"combat-chronicle__header",children:[a.jsx("h3",{className:"combat-chronicle__title war-text-display",children:" Battle Chronicle"}),r&&a.jsx("button",{className:"combat-chronicle__filter-toggle",onClick:()=>{},title:"Filter events",children:""})]}),_.length>0&&a.jsxs("div",{className:"combat-chronicle__pinned",children:[a.jsx("div",{className:"combat-chronicle__pinned-label",children:" Pinned Events"}),_.map(p=>a.jsx(Wf,{entry:p,config:Uf[p.type],message:m(p),isPinned:!0,onTogglePin:()=>y(p.id),onClick:n?()=>n(p):void 0},`pinned-${p.id}`))]}),a.jsxs("div",{className:"combat-chronicle__scroll",children:[w.length===0?a.jsx("div",{className:"combat-chronicle__empty",children:"No combat events yet..."}):w.map(p=>a.jsx(Wf,{entry:p,config:Uf[p.type],message:m(p),isPinned:!1,onTogglePin:()=>y(p.id),onClick:n?()=>n(p):void 0},p.id)),a.jsx("div",{ref:d})]})]})},Wf=({entry:e,config:t,message:n,isPinned:s,onTogglePin:r,onClick:i})=>{const o=e.type==="round_started"||e.type==="combat_started"||e.type==="combat_ended",l=new Date(e.timestamp).toLocaleTimeString(),c=["combat-chronicle__entry",o&&"combat-chronicle__entry--important",i&&"combat-chronicle__entry--clickable",s&&"combat-chronicle__entry--pinned"].filter(Boolean).join(" ");return a.jsxs("div",{className:c,style:{borderLeftColor:t.color},onClick:i,title:`${l} - ${t.label}`,children:[a.jsx("div",{className:"combat-chronicle__entry-icon",children:t.icon}),a.jsxs("div",{className:"combat-chronicle__entry-content",children:[a.jsx("div",{className:"combat-chronicle__entry-message",children:n}),e.data&&Object.keys(e.data).length>0&&a.jsx("div",{className:"combat-chronicle__entry-details war-text-mono",children:JSON.stringify(e.data,null,0)})]}),a.jsx("button",{className:`combat-chronicle__entry-pin ${s?"combat-chronicle__entry-pin--active":""}`,onClick:u=>{u.stopPropagation(),r()},title:s?"Unpin":"Pin",children:""})]})},k1=({entity:e,onRoll:t,rollResult:n,disabled:s=!1,className:r=""})=>{var A;const[i,o]=v.useState(2),[l,c]=v.useState(!0),[u,d]=v.useState(!1),[h,m]=v.useState(null),y=e.initiativeSkill||"initiative",b=e.skills[y]||0,_=()=>{d(!0),setTimeout(()=>{const R=Array.from({length:i},()=>Math.floor(Math.random()*100)+1),S=l?Math.max(...R):Math.min(...R);m({rawValues:R,selectedDie:S}),d(!1)},800)},w=()=>{if(!h)return;const R={diceCount:i,diceSize:100,rawValues:h.rawValues,keepHighest:l,modifier:b};t(R)},f=h?h.selectedDie+b:0,p=!!h||!!n,g=n||h,j=["initiative-roll-panel",s&&"initiative-roll-panel--disabled",r].filter(Boolean).join(" ");return a.jsxs("div",{className:j,children:[a.jsxs("div",{className:"initiative-roll-panel__header",children:[a.jsx("h3",{className:"initiative-roll-panel__title war-text-display",children:" Roll Initiative"}),a.jsx("div",{className:"initiative-roll-panel__entity-name",children:e.name})]}),a.jsxs("div",{className:"initiative-roll-panel__skill-info",children:[a.jsx("div",{className:"initiative-roll-panel__skill-label",children:"Initiative Skill:"}),a.jsx("div",{className:"initiative-roll-panel__skill-name",children:y.toUpperCase()}),a.jsxs("div",{className:"initiative-roll-panel__skill-modifier war-text-mono",children:["+",b]})]}),!p&&a.jsxs("div",{className:"initiative-roll-panel__config",children:[a.jsxs("label",{className:"initiative-roll-panel__config-label",children:["Number of Dice:",a.jsx("input",{type:"number",min:1,max:10,value:i,onChange:R=>o(Number(R.target.value)),className:"initiative-roll-panel__config-input",disabled:s})]}),a.jsxs("label",{className:"initiative-roll-panel__config-checkbox",children:[a.jsx("input",{type:"checkbox",checked:l,onChange:R=>c(R.target.checked),disabled:s}),"Keep ",l?"Highest":"Lowest"]})]}),g&&a.jsxs("div",{className:"initiative-roll-panel__results",children:[a.jsx("div",{className:"initiative-roll-panel__dice-values",children:(A=g.rawValues)==null?void 0:A.map((R,S)=>a.jsx("div",{className:`initiative-roll-panel__die ${R===g.selectedDie?"initiative-roll-panel__die--selected":""}`,children:R},S))}),a.jsxs("div",{className:"initiative-roll-panel__calculation",children:[a.jsx("span",{className:"initiative-roll-panel__calc-selected",children:g.selectedDie}),a.jsx("span",{className:"initiative-roll-panel__calc-operator",children:"+"}),a.jsx("span",{className:"initiative-roll-panel__calc-modifier",children:b}),a.jsx("span",{className:"initiative-roll-panel__calc-equals",children:"="}),a.jsx("span",{className:"initiative-roll-panel__calc-total war-text-mono",children:(n==null?void 0:n.total)||f})]})]}),a.jsxs("div",{className:"initiative-roll-panel__actions",children:[!p&&a.jsx("button",{className:"initiative-roll-panel__roll-btn",onClick:_,disabled:s||u,children:u?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"initiative-roll-panel__spinner",children:""}),"Rolling..."]}):a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"initiative-roll-panel__roll-icon",children:""}),"Roll Initiative"]})}),h&&!n&&a.jsxs("button",{className:"initiative-roll-panel__confirm-btn",onClick:w,disabled:s,children:[a.jsx("span",{className:"initiative-roll-panel__confirm-icon",children:""}),"Confirm Roll"]}),n&&a.jsx("div",{className:"initiative-roll-panel__submitted",children:" Roll Submitted"})]}),a.jsx("div",{className:"initiative-roll-panel__border","aria-hidden":"true"})]})},Pd={"gm-request":{icon:"",seal:"",priority:1,defaultDuration:null,ariaLabel:"Urgent request from Game Master"},"attack-incoming":{icon:"",seal:"",priority:1,defaultDuration:null,ariaLabel:"Incoming attack warning"},"turn-warning":{icon:"",seal:"",priority:2,defaultDuration:1e4,ariaLabel:"Turn time warning"},"combat-event":{icon:"",seal:"",priority:3,defaultDuration:5e3,ariaLabel:"Combat event notification"},system:{icon:"",seal:"",priority:3,defaultDuration:5e3,ariaLabel:"System notification"}},N1=({notifications:e,onDismiss:t})=>{const n=v.useMemo(()=>[...e].sort((s,r)=>{const i=Pd[s.type].priority,o=Pd[r.type].priority;return i-o}).slice(0,2),[e]);return a.jsx("div",{className:"notification-banner-container",role:"region","aria-live":"polite","aria-label":"Combat notifications",children:n.map((s,r)=>a.jsx(j1,{notification:s,onDismiss:t,stackIndex:r},s.id))})},j1=({notification:e,onDismiss:t,stackIndex:n})=>{const[s,r]=T.useState(!1),i=Pd[e.type],o=e.duration??i.defaultDuration;T.useEffect(()=>{if(o===null)return;const h=setTimeout(()=>{l()},o);return()=>clearTimeout(h)},[o,e.id]);const l=()=>{r(!0),setTimeout(()=>{t(e.id)},200)},c=()=>{e.action&&(e.action.onClick(),l())},u=o===null,d=i.priority===1;return a.jsxs("div",{className:`
        notification-scroll
        notification-scroll--${e.type}
        ${s?"notification-scroll--exiting":""}
        ${u?"notification-scroll--persistent":""}
        ${d?"notification-scroll--urgent":""}
      `,style:{"--stack-index":n,"--animation-delay":`${n*100}ms`},role:"alert","aria-label":i.ariaLabel,children:[a.jsxs("div",{className:"notification-scroll__seal","aria-hidden":"true",children:[a.jsx("div",{className:"notification-scroll__seal-wax",children:i.seal}),a.jsx("div",{className:"notification-scroll__seal-ribbon"})]}),a.jsxs("div",{className:"notification-scroll__content",children:[a.jsxs("div",{className:"notification-scroll__header",children:[a.jsx("span",{className:"notification-scroll__icon","aria-hidden":"true",children:i.icon}),a.jsx("h3",{className:"notification-scroll__title",children:e.title})]}),a.jsx("p",{className:"notification-scroll__message",children:e.message}),a.jsxs("div",{className:"notification-scroll__actions",children:[e.action&&a.jsx("button",{className:"notification-scroll__action-btn",onClick:c,type:"button",children:e.action.label}),a.jsx("button",{className:"notification-scroll__dismiss-btn",onClick:l,"aria-label":"Dismiss notification",type:"button",children:""})]})]}),a.jsx("div",{className:"notification-scroll__torn-edge","aria-hidden":"true"})]})},S1=({isVisible:e,entityName:t,ap:n,energy:s,onDismiss:r})=>{T.useEffect(()=>{if(!e)return;const o=setTimeout(()=>{r()},2e3);return()=>clearTimeout(o)},[e,r]);const i=T.useCallback(o=>{(o.key===" "||o.key==="Enter"||o.key==="Escape")&&(o.preventDefault(),r())},[r]);return T.useEffect(()=>{if(e)return document.addEventListener("keydown",i),()=>document.removeEventListener("keydown",i)},[e,i]),e?a.jsxs("div",{className:"turn-announcement",onClick:r,role:"alertdialog","aria-modal":"true","aria-labelledby":"turn-announcement-title","aria-describedby":"turn-announcement-description",children:[a.jsx("div",{className:"turn-announcement__backdrop","aria-hidden":"true"}),a.jsxs("div",{className:"turn-announcement__rune-circle","aria-hidden":"true",children:[a.jsx("div",{className:"turn-announcement__rune-ring turn-announcement__rune-ring--outer",children:[...Array(8)].map((o,l)=>a.jsx("div",{className:"turn-announcement__rune",style:{"--rune-index":l},children:""},`outer-${l}`))}),a.jsx("div",{className:"turn-announcement__rune-ring turn-announcement__rune-ring--inner",children:[...Array(6)].map((o,l)=>a.jsx("div",{className:"turn-announcement__rune",style:{"--rune-index":l},children:""},`inner-${l}`))})]}),a.jsxs("div",{className:"turn-announcement__content",children:[a.jsx("div",{className:"turn-announcement__icon","aria-hidden":"true",children:""}),a.jsx("h1",{id:"turn-announcement-title",className:"turn-announcement__title",children:"YOUR TURN"}),a.jsx("div",{className:"turn-announcement__entity",children:t}),a.jsxs("div",{id:"turn-announcement-description",className:"turn-announcement__resources",children:[a.jsxs("div",{className:"turn-announcement__resource",children:[a.jsx("span",{className:"turn-announcement__resource-icon",children:""}),a.jsxs("span",{className:"turn-announcement__resource-value",children:[n.current,"/",n.max]}),a.jsx("span",{className:"turn-announcement__resource-label",children:"Action Points"})]}),a.jsx("div",{className:"turn-announcement__resource-divider","aria-hidden":"true",children:""}),a.jsxs("div",{className:"turn-announcement__resource",children:[a.jsx("span",{className:"turn-announcement__resource-icon",children:""}),a.jsxs("span",{className:"turn-announcement__resource-value",children:[s.current,"/",s.max]}),a.jsx("span",{className:"turn-announcement__resource-label",children:"Energy"})]})]}),a.jsxs("div",{className:"turn-announcement__hint",children:[a.jsx("kbd",{className:"turn-announcement__key",children:"SPACE"}),a.jsx("span",{children:"or click to continue"})]})]}),a.jsxs("div",{className:"turn-announcement__corner-runes","aria-hidden":"true",children:[a.jsx("div",{className:"turn-announcement__corner-rune turn-announcement__corner-rune--tl",children:""}),a.jsx("div",{className:"turn-announcement__corner-rune turn-announcement__corner-rune--tr",children:""}),a.jsx("div",{className:"turn-announcement__corner-rune turn-announcement__corner-rune--bl",children:""}),a.jsx("div",{className:"turn-announcement__corner-rune turn-announcement__corner-rune--br",children:""})]}),a.jsxs("svg",{className:"turn-announcement__energy-lines","aria-hidden":"true",children:[a.jsx("defs",{children:a.jsxs("radialGradient",{id:"turn-energy-gradient",children:[a.jsx("stop",{offset:"0%",stopColor:"#D4AF37",stopOpacity:"0.8"}),a.jsx("stop",{offset:"100%",stopColor:"#D4AF37",stopOpacity:"0"})]})}),a.jsx("circle",{cx:"50%",cy:"50%",r:"30%",fill:"none",stroke:"url(#turn-energy-gradient)",strokeWidth:"2",className:"turn-announcement__energy-ring turn-announcement__energy-ring--1"}),a.jsx("circle",{cx:"50%",cy:"50%",r:"40%",fill:"none",stroke:"url(#turn-energy-gradient)",strokeWidth:"1.5",className:"turn-announcement__energy-ring turn-announcement__energy-ring--2"}),a.jsx("circle",{cx:"50%",cy:"50%",r:"50%",fill:"none",stroke:"url(#turn-energy-gradient)",strokeWidth:"1",className:"turn-announcement__energy-ring turn-announcement__energy-ring--3"})]})]}):null},E1=({pendingContests:e,entities:t,onResolveContest:n,className:s=""})=>{var _;const[r,i]=v.useState(null),[o,l]=v.useState(null),[c,u]=v.useState(2),[d,h]=v.useState(!0),m=e.find(w=>w.contestId===r);v.useEffect(()=>{e.length>0&&!r&&(i(e[0].contestId),l(e[0].suggestedDefenseSkill||null))},[e,r]);const y=()=>{if(!m||!o)return;const w=t[m.targetId];if(!w)return;const f=Array.from({length:c},()=>Math.floor(Math.random()*100)+1),p=w.skills[o]||0,g={diceCount:c,diceSize:100,rawValues:f,keepHighest:d,modifier:p};n(m.contestId,o,g),i(null),l(null)};if(e.length===0)return null;const b=["gm-contest-resolution",s].filter(Boolean).join(" ");return a.jsxs("div",{className:b,children:[a.jsx("div",{className:"gm-contest-resolution__header",children:a.jsxs("h3",{className:"gm-contest-resolution__title war-text-display",children:[" Resolve Contests (",e.length,")"]})}),a.jsx("div",{className:"gm-contest-resolution__list",children:e.map(w=>{const f=t[w.initiatorId],p=t[w.targetId],g=w.contestId===r;return!f||!p?null:a.jsxs("button",{className:`gm-contest-resolution__contest ${g?"gm-contest-resolution__contest--selected":""}`,onClick:()=>{i(w.contestId),l(w.suggestedDefenseSkill||null)},children:[a.jsxs("div",{className:"gm-contest-resolution__contest-header",children:[a.jsx("span",{className:"gm-contest-resolution__attacker",children:f.name}),a.jsx("span",{className:"gm-contest-resolution__vs",children:"vs"}),a.jsx("span",{className:"gm-contest-resolution__defender",children:p.name})]}),a.jsxs("div",{className:"gm-contest-resolution__attack-info",children:[a.jsx("span",{className:"gm-contest-resolution__skill",children:w.initiatorSkill}),a.jsxs("span",{className:"gm-contest-resolution__roll war-text-mono",children:["Roll: ",w.initiatorRoll.total]})]})]},w.contestId)})}),m&&a.jsxs("div",{className:"gm-contest-resolution__interface",children:[a.jsxs("div",{className:"gm-contest-resolution__defender-section",children:[a.jsxs("h4",{className:"gm-contest-resolution__section-title",children:["Defender: ",(_=t[m.targetId])==null?void 0:_.name]}),a.jsx(dc,{entity:t[m.targetId]||null,selectedSkill:o,onSkillChange:l,label:"Defense Skill:",placeholder:m.suggestedDefenseSkill||"Choose defense skill..."}),a.jsx(Wi,{diceCount:c,keepHighest:d,onDiceCountChange:u,onKeepHighestChange:h})]}),a.jsxs("button",{className:"gm-contest-resolution__resolve-btn",onClick:y,disabled:!o,children:[a.jsx("span",{className:"gm-contest-resolution__resolve-icon",children:""}),"Roll Defense & Resolve"]})]}),a.jsx("div",{className:"gm-contest-resolution__border","aria-hidden":"true"})]})},C1=e=>e.startsWith("player:")?e.substring(7):"gm",A1=({entities:e,onInitiateContest:t,onRequestSkillCheck:n,disabled:s=!1,className:r=""})=>{const[i,o]=v.useState(null),[l,c]=v.useState(null),[u,d]=v.useState(null),[h,m]=v.useState(2),[y,b]=v.useState(!0),[_,w]=v.useState(!1),[f,p]=v.useState(""),[g,j]=v.useState(!1),[A,R]=v.useState(!1),S=v.useMemo(()=>[...e].sort((L,D)=>L.name.localeCompare(D.name)),[e]),k=S.find(L=>L.id===i)??null,N=S.find(L=>L.id===l)??null,E=!!l&&!g,M=!E,O=E?N==null?void 0:N.controller.startsWith("player:"):k==null?void 0:k.controller.startsWith("player:");v.useEffect(()=>{g&&c(null)},[g]),v.useEffect(()=>{i&&l===i&&c(null)},[i,l]),v.useEffect(()=>{O||R(!1)},[O]);const X=v.useMemo(()=>S.filter(L=>L.id!==i),[S,i]),re=async()=>{if(!k||!u)return;if(E){if(!N)return;const q=Array.from({length:h},()=>Math.floor(Math.random()*100)+1),V=k.skills[u]??0,Q={diceCount:h,diceSize:100,rawValues:q,keepHighest:y,modifier:V};try{await t({initiatorEntityId:k.id,targetEntityId:N.id,skill:u,roll:Q,gmCanResolve:A}),c(null),d(null),R(!1)}catch{return}return}const L=C1(k.controller),D=_&&f?parseInt(f,10):void 0,F=k.controller==="gm"?!0:A;try{await n({targetPlayerId:L,targetEntityId:k.id,skill:u,targetNumber:typeof D=="number"&&Number.isFinite(D)?D:void 0,diceCount:h,keepHighest:y,gmCanResolve:F}),d(null),w(!1),p(""),R(!1)}catch{return}},I=!!k&&!!u&&!s&&(M||!!N),$=["skill-check-request-panel",s&&"skill-check-request-panel--disabled",r].filter(Boolean).join(" ");return S.length===0?a.jsx("div",{className:"skill-check-request-panel skill-check-request-panel--empty",children:a.jsx("p",{children:"No entities available"})}):a.jsxs("div",{className:$,children:[a.jsx("div",{className:"skill-check-request-panel__header",children:a.jsx("h3",{className:"skill-check-request-panel__title war-text-display",children:"Skill Actions"})}),a.jsx("div",{className:"skill-check-request-panel__section",children:a.jsxs("label",{className:"skill-check-request-panel__label",children:["Roller:",a.jsxs("select",{value:i||"",onChange:L=>{o(L.target.value||null),d(null)},disabled:s,className:"skill-check-request-panel__select",children:[a.jsx("option",{value:"",children:"Choose entity..."}),S.map(L=>a.jsx("option",{value:L.id,children:L.name},L.id))]})]})}),a.jsx("div",{className:"skill-check-request-panel__section",children:a.jsxs("label",{className:"skill-check-request-panel__checkbox-label",children:[a.jsx("input",{type:"checkbox",checked:g,onChange:L=>j(L.target.checked),disabled:s}),"Straight check (skip contest target)"]})}),a.jsx("div",{className:"skill-check-request-panel__section",children:a.jsxs("label",{className:"skill-check-request-panel__label",children:["Target:",a.jsxs("select",{value:l||"",onChange:L=>c(L.target.value||null),disabled:s||g||!k,className:"skill-check-request-panel__select",children:[a.jsx("option",{value:"",children:"No target (skill check)"}),X.map(L=>a.jsx("option",{value:L.id,children:L.name},L.id))]})]})}),a.jsx("div",{className:"skill-check-request-panel__section",children:a.jsx(dc,{entity:k,selectedSkill:u,onSkillChange:d,label:"Skill:",placeholder:"Choose skill...",disabled:s||!k})}),a.jsx("div",{className:"skill-check-request-panel__section",children:a.jsx(Wi,{diceCount:h,keepHighest:y,onDiceCountChange:m,onKeepHighestChange:b,disabled:s||!k})}),M&&k&&u&&a.jsxs("div",{className:"skill-check-request-panel__section",children:[a.jsxs("label",{className:"skill-check-request-panel__checkbox-label",children:[a.jsx("input",{type:"checkbox",checked:_,onChange:L=>w(L.target.checked),disabled:s}),"Set Target Number (DC)"]}),_&&a.jsx("input",{type:"number",value:f,onChange:L=>p(L.target.value),placeholder:"Target number...",min:1,max:200,disabled:s,className:"skill-check-request-panel__input skill-check-request-panel__input--number"})]}),O&&a.jsx("div",{className:"skill-check-request-panel__section",children:a.jsxs("label",{className:"skill-check-request-panel__checkbox-label",children:[a.jsx("input",{type:"checkbox",checked:A,onChange:L=>R(L.target.checked),disabled:s}),"Allow GM to roll for player"]})}),a.jsx("button",{className:"skill-check-request-panel__request-btn",onClick:re,disabled:!I,children:E?`Initiate Contest${N?` vs ${N.name}`:""}`:`Request ${u||"Skill"} Check`}),a.jsx("div",{className:"skill-check-request-panel__border","aria-hidden":"true"})]})},I1=({pendingChecks:e,entities:t,onResolveCheck:n,className:s=""})=>{var y;const[r,i]=v.useState(null),[o,l]=v.useState(2),[c,u]=v.useState(!0),d=e.find(b=>b.checkId===r);v.useEffect(()=>{e.length>0&&!r&&i(e[0].checkId)},[e,r]),v.useEffect(()=>{d&&(l(d.diceCount??2),u(d.keepHighest??!0))},[d==null?void 0:d.checkId]);const h=()=>{if(!d)return;const b=t[d.targetEntityId];if(!b)return;const _=Array.from({length:o},()=>Math.floor(Math.random()*100)+1),w=b.skills[d.skill]??0,f={diceCount:o,diceSize:100,rawValues:_,keepHighest:c,modifier:w};n(d.checkId,f),i(null)};if(e.length===0)return null;const m=["gm-skill-check-resolution",s].filter(Boolean).join(" ");return a.jsxs("div",{className:m,children:[a.jsx("div",{className:"gm-skill-check-resolution__header",children:a.jsxs("h3",{className:"gm-skill-check-resolution__title war-text-display",children:["Resolve Skill Checks (",e.length,")"]})}),a.jsx("div",{className:"gm-skill-check-resolution__list",children:e.map(b=>{const _=t[b.targetEntityId];if(!_)return null;const w=b.checkId===r;return a.jsxs("button",{className:`gm-skill-check-resolution__check ${w?"gm-skill-check-resolution__check--selected":""}`,onClick:()=>i(b.checkId),children:[a.jsxs("div",{className:"gm-skill-check-resolution__check-header",children:[a.jsx("span",{className:"gm-skill-check-resolution__entity",children:_.name}),a.jsx("span",{className:"gm-skill-check-resolution__skill",children:b.skill})]}),b.targetNumber!==void 0&&a.jsxs("div",{className:"gm-skill-check-resolution__target-number",children:["Target: ",b.targetNumber]})]},b.checkId)})}),d&&a.jsxs("div",{className:"gm-skill-check-resolution__interface",children:[a.jsxs("div",{className:"gm-skill-check-resolution__details",children:[a.jsxs("div",{className:"gm-skill-check-resolution__detail",children:["Roller: ",((y=t[d.targetEntityId])==null?void 0:y.name)??"Unknown"]}),a.jsxs("div",{className:"gm-skill-check-resolution__detail",children:["Skill: ",d.skill]})]}),a.jsx(Wi,{diceCount:o,keepHighest:c,onDiceCountChange:l,onKeepHighestChange:u}),a.jsx("button",{className:"gm-skill-check-resolution__resolve-btn",onClick:h,children:"Roll & Submit"})]}),a.jsx("div",{className:"gm-skill-check-resolution__border","aria-hidden":"true"})]})},P1=({npcEntities:e,targetableEntities:t,activeNpcId:n,onInitiateAttack:s,disabled:r=!1,className:i=""})=>{var j;const[o,l]=v.useState(n||null),[c,u]=v.useState(null),[d,h]=v.useState(null),[m,y]=v.useState(2),[b,_]=v.useState(!0);v.useEffect(()=>{n&&l(n)},[n]);const w=e.find(A=>A.id===o),f=w&&c&&d&&!r,p=()=>{if(!f||!w)return;const A=Array.from({length:m},()=>Math.floor(Math.random()*100)+1),R=w.skills[d]||0,S={diceCount:m,diceSize:100,rawValues:A,keepHighest:b,modifier:R};s(w.id,c,d,S),u(null),h(null)};if(e.length===0)return a.jsx("div",{className:"npc-action-panel npc-action-panel--empty",children:a.jsx("p",{children:"No GM-controlled entities available"})});const g=["npc-action-panel",r&&"npc-action-panel--disabled",i].filter(Boolean).join(" ");return a.jsxs("div",{className:g,children:[a.jsx("div",{className:"npc-action-panel__header",children:a.jsx("h3",{className:"npc-action-panel__title war-text-display",children:" NPC Attack"})}),!n&&a.jsx("div",{className:"npc-action-panel__npc-select",children:a.jsxs("label",{className:"npc-action-panel__label",children:["Select NPC:",a.jsxs("select",{value:o||"",onChange:A=>{l(A.target.value),h(null)},disabled:r,className:"npc-action-panel__select",children:[a.jsx("option",{value:"",disabled:!0,children:"Choose NPC..."}),e.map(A=>a.jsxs("option",{value:A.id,children:[A.name," (",A.ap.current,"/",A.ap.max," AP)"]},A.id))]})]})}),n&&w&&a.jsxs("div",{className:"npc-action-panel__active-npc",children:[a.jsx("div",{className:"npc-action-panel__npc-name war-text-display",children:w.name}),a.jsxs("div",{className:"npc-action-panel__npc-resources war-text-mono",children:[w.ap.current,"/",w.ap.max," AP"]})]}),w&&a.jsxs("div",{className:"npc-action-panel__targets",children:[a.jsx("label",{className:"npc-action-panel__label",children:"Select Target:"}),t.length===0?a.jsx("p",{className:"npc-action-panel__no-targets",children:"No targets available"}):a.jsx("div",{className:"npc-action-panel__target-grid",children:t.map(A=>a.jsxs("button",{className:`npc-action-panel__target ${c===A.id?"npc-action-panel__target--selected":""}`,onClick:()=>u(A.id),disabled:r,children:[a.jsx("span",{className:"npc-action-panel__target-name",children:A.name}),a.jsxs("span",{className:"npc-action-panel__target-info war-text-mono",children:[A.energy.current,"/",A.energy.max," HP"]})]},A.id))})]}),w&&c&&a.jsxs("div",{className:"npc-action-panel__attack-config",children:[a.jsx(dc,{entity:w,selectedSkill:d,onSkillChange:h,label:"Attack Skill:",placeholder:"Choose attack skill...",disabled:r}),a.jsx(Wi,{diceCount:m,keepHighest:b,onDiceCountChange:y,onKeepHighestChange:_,disabled:r})]}),w&&c&&a.jsxs("button",{className:"npc-action-panel__attack-btn",onClick:p,disabled:!f,children:[a.jsx("span",{className:"npc-action-panel__attack-icon",children:""}),"Attack ",(j=t.find(A=>A.id===c))==null?void 0:j.name]}),a.jsx("div",{className:"npc-action-panel__border","aria-hidden":"true"})]})},T1=({entities:e,initiativeRolls:t,onForceRoll:n,className:s=""})=>{const[r,i]=v.useState(new Set),o=Object.values(e),l=o.filter(h=>t[h.id]),c=o.filter(h=>!t[h.id]),u=async h=>{i(m=>new Set(m).add(h));try{await n(h)}catch(m){console.error("Failed to force roll:",m)}finally{i(m=>{const y=new Set(m);return y.delete(h),y})}},d=h=>{const m=t[h.id];return m?m.roll+m.skillValue:0};return a.jsxs("div",{className:`gm-initiative-status ${s}`,children:[a.jsxs("div",{className:"gm-initiative-status__header",children:[a.jsx("h3",{children:"Initiative Status"}),a.jsxs("div",{className:"gm-initiative-status__counts",children:[a.jsxs("span",{className:"rolled-count",children:[" ",l.length," Rolled"]}),a.jsxs("span",{className:"pending-count",children:[" ",c.length," Pending"]})]})]}),l.length>0&&a.jsxs("div",{className:"gm-initiative-status__section gm-initiative-status__section--rolled",children:[a.jsx("h4",{children:"Rolled"}),a.jsx("ul",{className:"entity-list",children:l.sort((h,m)=>d(m)-d(h)).map(h=>{const m=d(h),y=t[h.id];return a.jsxs("li",{className:"entity-status entity-status--rolled",children:[a.jsx("span",{className:"status-icon",children:""}),a.jsx("span",{className:"entity-name",children:h.displayName||h.name}),a.jsxs("span",{className:"initiative-roll",children:[y.roll," + ",y.skillValue," = ",a.jsx("strong",{children:m})]})]},h.id)})})]}),c.length>0&&a.jsxs("div",{className:"gm-initiative-status__section gm-initiative-status__section--pending",children:[a.jsx("h4",{children:"Pending"}),a.jsx("ul",{className:"entity-list",children:c.map(h=>a.jsxs("li",{className:"entity-status entity-status--pending",children:[a.jsx("span",{className:"status-icon",children:""}),a.jsx("span",{className:"entity-name",children:h.displayName||h.name}),a.jsx("button",{className:"force-roll-btn",onClick:()=>u(h.id),disabled:r.has(h.id),children:r.has(h.id)?"Rolling...":"Force Roll"})]},h.id))})]})]})},R1=({entity:e,onAdjustResource:t,onAddModifier:n,onRemoveModifier:s,className:r=""})=>{const[i,o]=v.useState(""),[l,c]=v.useState(null),[u,d]=v.useState({type:"add_max",amount:5,duration:null,source:""}),h=async(_,w)=>{await t(_,w)},m=async _=>{const w=parseInt(i,10);isNaN(w)||(await t(_,w),o(""))},y=async()=>{!l||!u.source||(await n(l,u.type,u.amount,u.duration,u.source),c(null),d({type:"add_max",amount:5,duration:null,source:""}))},b=_=>{const w=e[_],f=_==="ap"?"AP":"Energy";return a.jsxs("div",{className:"resource-controls",children:[a.jsxs("div",{className:"resource-header",children:[a.jsx("h4",{children:f}),a.jsxs("div",{className:"resource-values",children:[a.jsx("span",{className:"current",children:w.current}),a.jsx("span",{className:"separator",children:"/"}),a.jsx("span",{className:"max",children:w.max}),w.baseMax!==w.max&&a.jsxs("span",{className:"base-max",title:"Base maximum",children:["(base: ",w.baseMax,")"]})]})]}),a.jsxs("div",{className:"quick-adjustments",children:[a.jsx("button",{onClick:()=>h(_,-5),className:"adjust-btn adjust-btn--minus",children:"-5"}),a.jsx("button",{onClick:()=>h(_,-1),className:"adjust-btn adjust-btn--minus",children:"-1"}),a.jsx("button",{onClick:()=>h(_,1),className:"adjust-btn adjust-btn--plus",children:"+1"}),a.jsx("button",{onClick:()=>h(_,5),className:"adjust-btn adjust-btn--plus",children:"+5"})]}),a.jsxs("div",{className:"custom-adjustment",children:[a.jsx("input",{type:"number",value:i,onChange:p=>o(p.target.value),placeholder:"Custom amount",className:"custom-input"}),a.jsx("button",{onClick:()=>m(_),className:"apply-btn",children:"Apply"})]}),a.jsx("button",{onClick:()=>c(_),className:"add-modifier-btn",children:"Add Modifier"}),w.modifiers&&w.modifiers.length>0&&a.jsxs("div",{className:"active-modifiers",children:[a.jsx("h5",{children:"Active Modifiers"}),a.jsx("ul",{className:"modifier-list",children:w.modifiers.map(p=>a.jsxs("li",{className:"modifier-item",children:[a.jsxs("span",{className:"modifier-info",children:[a.jsx("strong",{children:p.source}),p.type==="add_max"&&` +${p.amount} max`,p.type==="reduce_max"&&` -${p.amount} max`,p.type==="add_current"&&` +${p.amount} current`,p.duration!==null&&` (${p.duration} rounds)`]}),a.jsx("button",{onClick:()=>s(_,p.id),className:"remove-modifier-btn",children:""})]},p.id))})]})]},_)};return a.jsxs("div",{className:`gm-resource-panel ${r}`,children:[a.jsx("h3",{children:"Resource Management"}),a.jsxs("div",{className:"resources-container",children:[b("energy"),b("ap")]}),l&&a.jsx("div",{className:"modifier-dialog-overlay",onClick:()=>c(null),children:a.jsxs("div",{className:"modifier-dialog",onClick:_=>_.stopPropagation(),children:[a.jsxs("h4",{children:["Add ",l.toUpperCase()," Modifier"]}),a.jsxs("div",{className:"form-field",children:[a.jsx("label",{children:"Type"}),a.jsxs("select",{value:u.type,onChange:_=>d({...u,type:_.target.value}),children:[a.jsx("option",{value:"add_max",children:"Increase Maximum"}),a.jsx("option",{value:"reduce_max",children:"Decrease Maximum"}),a.jsx("option",{value:"add_current",children:"Temporary Boost"})]})]}),a.jsxs("div",{className:"form-field",children:[a.jsx("label",{children:"Amount"}),a.jsx("input",{type:"number",value:u.amount,onChange:_=>d({...u,amount:parseInt(_.target.value)||0}),min:"1"})]}),a.jsxs("div",{className:"form-field",children:[a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:u.duration!==null,onChange:_=>d({...u,duration:_.target.checked?3:null})}),"Expires after rounds"]}),u.duration!==null&&a.jsx("input",{type:"number",value:u.duration,onChange:_=>d({...u,duration:parseInt(_.target.value)||1}),min:"1",className:"duration-input"})]}),a.jsxs("div",{className:"form-field",children:[a.jsx("label",{children:"Source/Reason"}),a.jsx("input",{type:"text",value:u.source,onChange:_=>d({...u,source:_.target.value}),placeholder:"e.g., Blessing of Strength"})]}),a.jsxs("div",{className:"dialog-actions",children:[a.jsx("button",{onClick:()=>c(null),className:"cancel-btn",children:"Cancel"}),a.jsx("button",{onClick:y,disabled:!u.source,className:"confirm-btn",children:"Add Modifier"})]})]})})]})},D1=({result:e,entities:t,onDismiss:n,autoDismissMs:s=5e3,className:r=""})=>{v.useEffect(()=>{const u=setTimeout(()=>{n()},s);return()=>clearTimeout(u)},[s,n]);const i=e.winnerId?t[e.winnerId]:null,o=e.loserId?t[e.loserId]:null,l=u=>{switch(u){case"wicked":return"Wicked!";case"vicious":return"Vicious!";case"brutal":return"Brutal!";default:return""}},c=u=>{switch(u){case"wicked":return"tier-wicked";case"vicious":return"tier-vicious";case"brutal":return"tier-brutal";default:return""}};return a.jsxs("div",{className:`contest-result-toast ${c(e.criticalTier)} ${r}`,onClick:n,children:[a.jsx("div",{className:"toast-content",children:e.isTie?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"contest-header",children:"Contest Tie!"}),a.jsxs("div",{className:"contest-details",children:[(i==null?void 0:i.displayName)||(i==null?void 0:i.name)," vs ",(o==null?void 0:o.displayName)||(o==null?void 0:o.name)]}),a.jsxs("div",{className:"contest-totals",children:["Both rolled ",e.winnerTotal]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"contest-header",children:[(i==null?void 0:i.displayName)||(i==null?void 0:i.name)," Wins",e.criticalTier!=="normal"&&a.jsx("span",{className:"tier-badge",children:l(e.criticalTier)})]}),a.jsxs("div",{className:"contest-details",children:["vs ",(o==null?void 0:o.displayName)||(o==null?void 0:o.name)]}),a.jsxs("div",{className:"contest-totals",children:[e.winnerTotal," vs ",e.loserTotal]})]})}),a.jsx("div",{className:"toast-dismiss-hint",children:"Click to dismiss"})]})},M1={normal:{label:"Success",rune:"",color:"#D4AF37"},wicked:{label:"Wicked Strike",rune:"",color:"#FFD700"},vicious:{label:"Vicious Blow",rune:"",color:"#FFA500"},brutal:{label:"BRUTAL DEVASTATION",rune:"",color:"#FF4500"}},Td=({isOpen:e,variant:t,entity:n,checkRequest:s,contest:r,entities:i=[],contestMode:o="spectator",onSubmit:l,onClose:c})=>{const[u,d]=T.useState(""),[h,m]=T.useState(2),[y,b]=T.useState(!0),[_,w]=T.useState(!1),[f,p]=T.useState(null),g=r&&i?i.find(q=>o==="initiator"?q.id===r.targetId:q.id===r.initiatorId):null,j=Object.keys(n.skills||{}),A=o==="defender"?(r==null?void 0:r.suggestedDefenseSkill)||(r==null?void 0:r.initiatorSkill)||"":(r==null?void 0:r.initiatorSkill)||"",R=t==="initiative"?n.initiativeSkill||"initiative":t==="skill-check"?(s==null?void 0:s.skill)||"":A,S=R||j[0]||"",k=n.skills[u||S]||0,N=t==="initiative"?"Roll Initiative":t==="skill-check"?`Skill Check: ${R}`:o==="initiator"?`Attack: ${S||"Choose Skill"}`:"Defend Yourself",E=t==="contest"&&(o==="defender"||o==="initiator");T.useEffect(()=>{e&&(d(S),m(2),b(!0),p(null),w(!1))},[e,S]);const M=T.useCallback(q=>{e&&(q.key==="Escape"?(q.preventDefault(),!f&&t!=="contest"&&c()):q.key===" "&&!f&&!_?(q.preventDefault(),O()):q.key==="Enter"&&f&&(q.preventDefault(),X()))},[e,f,_,t]);T.useEffect(()=>(document.addEventListener("keydown",M),()=>document.removeEventListener("keydown",M)),[M]);const O=()=>{w(!0),setTimeout(()=>{const q=Array.from({length:h},()=>Math.floor(Math.random()*100)+1),V=y?Math.max(...q):Math.min(...q),Q=V+k;p({rawValues:q,selectedValue:V,modifier:k,total:Q}),w(!1)},800)},X=()=>{if(!f)return;const q={diceCount:h,diceSize:100,rawValues:f.rawValues,keepHighest:y,modifier:f.modifier};t==="initiative"?l({variant:"initiative",roll:q}):t==="skill-check"&&s?l({variant:"skill-check",checkId:s.checkId,roll:q}):t==="contest"&&r&&l({variant:"contest",contestId:r.contestId,skill:u||S,roll:q})},re=(q,V)=>a.jsxs("div",{className:`roll-overlay__entity-card roll-overlay__entity-card--${V}`,children:[a.jsx("div",{className:"roll-overlay__entity-portrait",children:a.jsx("div",{className:"roll-overlay__entity-avatar",children:q.name.charAt(0)})}),a.jsxs("div",{className:"roll-overlay__entity-info",children:[a.jsx("h3",{className:"roll-overlay__entity-name",children:q.name}),a.jsxs("div",{className:"roll-overlay__entity-stats",children:[a.jsxs("div",{className:"roll-overlay__stat",children:[a.jsx("span",{className:"roll-overlay__stat-icon",children:""}),a.jsxs("span",{className:"roll-overlay__stat-value",children:[q.energy.current,"/",q.energy.max]})]}),a.jsxs("div",{className:"roll-overlay__stat",children:[a.jsx("span",{className:"roll-overlay__stat-icon",children:""}),a.jsxs("span",{className:"roll-overlay__stat-value",children:[q.ap.current,"/",q.ap.max]})]})]})]})]}),I=()=>a.jsxs("div",{className:"roll-overlay__dice-arena",children:[_&&a.jsx("div",{className:"roll-overlay__dice-particles",children:Array.from({length:12}).map((q,V)=>a.jsx("div",{className:"roll-overlay__particle",style:{"--particle-index":V}},V))}),f?a.jsxs("div",{className:"roll-overlay__result",children:[a.jsx("div",{className:"roll-overlay__dice-display",children:f.rawValues.map((q,V)=>a.jsx("div",{className:`roll-overlay__die ${q===f.selectedValue?"roll-overlay__die--selected":""}`,children:q},V))}),a.jsxs("div",{className:"roll-overlay__calculation",children:[a.jsx("span",{className:"roll-overlay__calc-die",children:f.selectedValue}),a.jsx("span",{className:"roll-overlay__calc-operator",children:"+"}),a.jsx("span",{className:"roll-overlay__calc-modifier",children:f.modifier}),a.jsx("span",{className:"roll-overlay__calc-equals",children:"="}),a.jsx("span",{className:"roll-overlay__calc-total",children:f.total})]})]}):a.jsxs("div",{className:"roll-overlay__dice-prompt",children:[a.jsx("div",{className:"roll-overlay__dice-icon",children:""}),a.jsx("p",{className:"roll-overlay__dice-label",children:_?"Rolling...":"Ready to roll"})]})]}),$=()=>{if(!r||r.status!=="resolved"||!r.outcome)return null;const q=r.outcome.criticalTier||"normal",V=M1[q],te=r.outcome.winnerId===n.id,B=Math.abs(r.outcome.winnerTotal-r.outcome.loserTotal);return a.jsxs("div",{className:`roll-overlay__contest-result roll-overlay__contest-result--${q}`,children:[a.jsx("div",{className:"roll-overlay__contest-result-rune",children:V.rune}),a.jsx("h3",{className:"roll-overlay__contest-result-title",children:te?V.label:"Defeated"}),a.jsxs("p",{className:"roll-overlay__contest-result-margin",children:["Margin: ",B]})]})};if(!e)return null;const L=t==="contest",D=t==="skill-check"&&(s==null?void 0:s.targetNumber),F=o==="initiator"?"Attack Skill:":"Defense Skill:";return a.jsxs("div",{className:`roll-overlay roll-overlay--${t}`,onClick:q=>{q.target===q.currentTarget&&!f&&t!=="contest"&&c()},role:"dialog","aria-modal":"true","aria-labelledby":"roll-overlay-title",children:[a.jsx("div",{className:"roll-overlay__backdrop"}),a.jsxs("div",{className:"roll-overlay__frame-corners",children:[a.jsx("div",{className:"roll-overlay__corner roll-overlay__corner--tl"}),a.jsx("div",{className:"roll-overlay__corner roll-overlay__corner--tr"}),a.jsx("div",{className:"roll-overlay__corner roll-overlay__corner--bl"}),a.jsx("div",{className:"roll-overlay__corner roll-overlay__corner--br"})]}),a.jsxs("div",{className:"roll-overlay__content",children:[a.jsxs("header",{className:"roll-overlay__header",children:[a.jsx("h2",{id:"roll-overlay-title",className:"roll-overlay__title",children:N}),D&&a.jsxs("div",{className:"roll-overlay__target-number",children:[a.jsx("span",{className:"roll-overlay__target-label",children:"Target:"}),a.jsx("span",{className:"roll-overlay__target-value",children:s.targetNumber})]})]}),a.jsxs("div",{className:`roll-overlay__arena ${L?"roll-overlay__arena--contest":""}`,children:[L&&g?a.jsxs(a.Fragment,{children:[re(o==="initiator"?n:g,"left"),a.jsx("div",{className:"roll-overlay__contest-divider",children:a.jsx("div",{className:"roll-overlay__vs-badge",children:"VS"})}),re(o==="initiator"?g:n,"right")]}):re(n,"center"),I(),$()]}),a.jsxs("div",{className:"roll-overlay__controls",children:[E&&a.jsxs("div",{className:"roll-overlay__skill-selector",children:[a.jsx("label",{htmlFor:"contest-skill",className:"roll-overlay__label",children:F}),j.length===0?a.jsx("input",{id:"contest-skill",type:"text",value:u,onChange:q=>d(q.target.value),className:"roll-overlay__select",placeholder:"Enter skill...",disabled:!!f}):a.jsx("select",{id:"contest-skill",value:u,onChange:q=>d(q.target.value),className:"roll-overlay__select",disabled:!!f,children:j.map(q=>a.jsxs("option",{value:q,children:[q," (",n.skills[q]>=0?"+":"",n.skills[q],")"]},q))})]}),!f&&a.jsxs("div",{className:"roll-overlay__dice-config",children:[a.jsxs("div",{className:"roll-overlay__config-group",children:[a.jsx("label",{htmlFor:"dice-count",className:"roll-overlay__label",children:"Dice:"}),a.jsx("select",{id:"dice-count",value:h,onChange:q=>m(Number(q.target.value)),className:"roll-overlay__select roll-overlay__select--compact",children:[1,2,3,4].map(q=>a.jsxs("option",{value:q,children:[q,"d100"]},q))})]}),a.jsxs("div",{className:"roll-overlay__config-group",children:[a.jsx("label",{htmlFor:"keep-mode",className:"roll-overlay__label",children:"Keep:"}),a.jsxs("select",{id:"keep-mode",value:y?"highest":"lowest",onChange:q=>b(q.target.value==="highest"),className:"roll-overlay__select roll-overlay__select--compact",children:[a.jsx("option",{value:"highest",children:"Highest"}),a.jsx("option",{value:"lowest",children:"Lowest"})]})]}),a.jsxs("div",{className:"roll-overlay__modifier-display",children:["Modifier: ",a.jsxs("span",{className:"roll-overlay__modifier-value",children:[k>=0?"+":"",k]})]})]}),a.jsx("div",{className:"roll-overlay__actions",children:f?a.jsxs("button",{onClick:X,className:"roll-overlay__button roll-overlay__button--confirm",children:["Confirm Roll",a.jsx("kbd",{className:"roll-overlay__hotkey",children:"ENTER"})]}):a.jsxs(a.Fragment,{children:[a.jsxs("button",{onClick:O,disabled:_,className:"roll-overlay__button roll-overlay__button--primary",children:[_?"Rolling...":"Roll Dice",!_&&a.jsx("kbd",{className:"roll-overlay__hotkey",children:"SPACE"})]}),t!=="contest"&&a.jsxs("button",{onClick:c,className:"roll-overlay__button roll-overlay__button--secondary",children:["Cancel",a.jsx("kbd",{className:"roll-overlay__hotkey",children:"ESC"})]})]})})]})]})]})},L1=({campaignName:e,players:t,combatants:n,playerCharacters:s,bestiaryEntries:r,initiativeMode:i,manualInitiative:o,onManualInitiativeChange:l,onInitiativeModeChange:c,onAddCombatant:u,onAddPlayerCharacter:d,onRemoveCombatant:h,onStartCombat:m,isStarting:y=!1})=>{const[b,_]=T.useState(""),[w,f]=T.useState("enemy"),p=r.filter(S=>S.name.toLowerCase().includes(b.toLowerCase())),g=t.filter(S=>S.isReady).length,j=n.length>0,A=n.filter(S=>S.faction==="ally"),R=n.filter(S=>S.faction==="enemy");return a.jsxs("div",{className:"combat-lobby combat-lobby--gm",children:[a.jsxs("header",{className:"lobby-header",children:[a.jsx("div",{className:"lobby-header__seal",children:""}),a.jsxs("div",{className:"lobby-header__content",children:[a.jsx("h1",{className:"lobby-header__title",children:e}),a.jsx("p",{className:"lobby-header__subtitle",children:"War Council Chamber"})]}),a.jsx("div",{className:"lobby-header__seal lobby-header__seal--right",children:""})]}),a.jsxs("div",{className:"lobby-content",children:[a.jsxs("aside",{className:"lobby-sidebar lobby-sidebar--left",children:[a.jsxs("div",{className:"player-roster",children:[a.jsx("div",{className:"player-roster__header",children:a.jsxs("h2",{className:"section-title",children:[a.jsx("span",{className:"section-title__icon",children:""}),"Player Characters"]})}),a.jsx("div",{className:"player-roster__list",children:s.length===0?a.jsx("div",{className:"player-roster__empty",children:"No player characters assigned"}):s.map(S=>a.jsxs("div",{className:`player-roster-card ${S.isDeployed?"player-roster-card--deployed":""}`,children:[a.jsxs("div",{className:"player-roster-card__header",children:[a.jsx("h3",{className:"player-roster-card__name",children:S.characterName}),S.isDeployed&&a.jsx("span",{className:"player-roster-card__status",children:"Deployed"})]}),a.jsxs("p",{className:"player-roster-card__player",children:["Player: ",S.playerName]}),a.jsx("button",{className:"player-roster-card__add",onClick:()=>d(S.characterId),disabled:S.isDeployed,children:S.isDeployed?"Already Deployed":"Deploy player character"})]},S.characterId))})]}),a.jsxs("div",{className:"bestiary-browser",children:[a.jsx("div",{className:"bestiary-browser__header",children:a.jsxs("h2",{className:"section-title",children:[a.jsx("span",{className:"section-title__icon",children:""}),"Bestiary Codex"]})}),a.jsxs("div",{className:"faction-selector",children:[a.jsxs("button",{className:`faction-btn ${w==="ally"?"faction-btn--active":""}`,onClick:()=>f("ally"),children:[a.jsx("span",{className:"faction-btn__icon",children:""}),"Allies"]}),a.jsxs("button",{className:`faction-btn ${w==="enemy"?"faction-btn--active":""}`,onClick:()=>f("enemy"),children:[a.jsx("span",{className:"faction-btn__icon",children:""}),"Enemies"]})]}),a.jsx("div",{className:"bestiary-search",children:a.jsx("input",{type:"text",className:"bestiary-search__input",placeholder:"Search creatures...",value:b,onChange:S=>_(S.target.value)})}),a.jsx("div",{className:"bestiary-list",children:p.length===0?a.jsx("div",{className:"bestiary-list__empty",children:"No creatures found"}):p.map(S=>a.jsxs("div",{className:"bestiary-card",children:[a.jsxs("div",{className:"bestiary-card__header",children:[a.jsx("h3",{className:"bestiary-card__name",children:S.name}),a.jsxs("span",{className:"bestiary-card__tier",children:["Tier ",S.tier]})]}),a.jsx("div",{className:"bestiary-card__stats",children:S.rank&&a.jsx("span",{className:"stat-badge",children:S.rank})}),a.jsxs("button",{className:"bestiary-card__add",onClick:()=>u(S.id,w),children:[a.jsx("span",{className:"bestiary-card__add-icon",children:"+"}),"Deploy to ",w==="ally"?"Allies":"Enemies"]})]},S.id))})]})]}),a.jsx("main",{className:"lobby-main",children:a.jsxs("div",{className:"battle-roster",children:[a.jsxs("div",{className:"battle-roster__header",children:[a.jsxs("h2",{className:"section-title",children:[a.jsx("span",{className:"section-title__icon",children:""}),"Battle Roster"]}),a.jsxs("span",{className:"combatant-count",children:[n.length," Combatants"]})]}),a.jsxs("div",{className:"roster-section",children:[a.jsxs("h3",{className:"roster-section__title",children:[a.jsx("span",{className:"roster-section__icon",children:""}),"Allied Forces (",A.length,")"]}),a.jsx("div",{className:"roster-list",children:A.length===0?a.jsx("div",{className:"roster-list__empty",children:"No allies deployed"}):A.map(S=>a.jsxs("div",{className:"roster-card roster-card--ally",children:[a.jsxs("div",{className:"roster-card__header",children:[a.jsx("h4",{className:"roster-card__name",children:S.name}),a.jsx("button",{className:"roster-card__remove",onClick:()=>h(S.id),title:"Remove from roster",children:""})]}),a.jsxs("div",{className:"roster-card__stats",children:[a.jsxs("span",{className:"stat-chip",children:["Tier ",S.tier]}),a.jsxs("span",{className:"stat-chip",children:[S.energyMax," HP"]}),a.jsxs("span",{className:"stat-chip",children:[S.apMax," AP"]})]})]},S.id))})]}),a.jsxs("div",{className:"roster-section",children:[a.jsxs("h3",{className:"roster-section__title roster-section__title--enemy",children:[a.jsx("span",{className:"roster-section__icon",children:""}),"Enemy Forces (",R.length,")"]}),a.jsx("div",{className:"roster-list",children:R.length===0?a.jsx("div",{className:"roster-list__empty",children:"No enemies deployed"}):R.map(S=>a.jsxs("div",{className:"roster-card roster-card--enemy",children:[a.jsxs("div",{className:"roster-card__header",children:[a.jsx("h4",{className:"roster-card__name",children:S.name}),a.jsx("button",{className:"roster-card__remove",onClick:()=>h(S.id),title:"Remove from roster",children:""})]}),a.jsxs("div",{className:"roster-card__stats",children:[a.jsxs("span",{className:"stat-chip",children:["Tier ",S.tier]}),a.jsxs("span",{className:"stat-chip",children:[S.energyMax," HP"]}),a.jsxs("span",{className:"stat-chip",children:[S.apMax," AP"]})]})]},S.id))})]}),a.jsxs("div",{className:"initiative-selector",children:[a.jsx("h3",{className:"initiative-selector__label",children:"Initiative Order:"}),a.jsxs("div",{className:"initiative-options",children:[a.jsx("button",{className:`initiative-btn ${i==="players-first"?"initiative-btn--active":""}`,onClick:()=>c("players-first"),children:"Players First"}),a.jsx("button",{className:`initiative-btn ${i==="enemies-first"?"initiative-btn--active":""}`,onClick:()=>c("enemies-first"),children:"Enemies First"}),a.jsx("button",{className:`initiative-btn ${i==="interleaved"?"initiative-btn--active":""}`,onClick:()=>c("interleaved"),children:"Interleaved"})]}),a.jsxs("label",{className:"initiative-manual",children:[a.jsx("input",{type:"checkbox",checked:o,onChange:S=>l(S.target.checked)}),a.jsx("span",{children:"Manual Initiative Rolls (players roll)"})]})]}),a.jsxs("div",{className:"lobby-actions",children:[a.jsxs("button",{className:"start-combat-btn",onClick:m,disabled:!j||y,children:[a.jsx("span",{className:"start-combat-btn__icon",children:""}),a.jsx("span",{className:"start-combat-btn__text",children:y?"Initiating Combat...":"Begin Battle"}),a.jsx("span",{className:"start-combat-btn__icon",children:""})]}),!j&&a.jsx("p",{className:"lobby-actions__hint",children:"Deploy at least one combatant to begin"})]})]})}),a.jsx("aside",{className:"lobby-sidebar lobby-sidebar--right",children:a.jsxs("div",{className:"readiness-panel",children:[a.jsxs("div",{className:"readiness-panel__header",children:[a.jsxs("h2",{className:"section-title",children:[a.jsx("span",{className:"section-title__icon",children:""}),"Adventurers"]}),a.jsxs("span",{className:"readiness-count",children:[g,"/",t.length," Ready"]})]}),a.jsx("div",{className:"player-list",children:t.length===0?a.jsx("div",{className:"player-list__empty",children:"No players connected"}):t.map(S=>a.jsxs("div",{className:`player-card ${S.isReady?"player-card--ready":""} ${S.isConnected?"":"player-card--disconnected"}`,children:[a.jsx("div",{className:"player-card__seal",children:S.isReady?"":""}),a.jsxs("div",{className:"player-card__info",children:[a.jsx("h4",{className:"player-card__name",children:S.name}),S.characterName&&a.jsx("p",{className:"player-card__character",children:S.characterName}),!S.isConnected&&a.jsx("p",{className:"player-card__status",children:"Disconnected"})]})]},S.id))})]})})]})]})},O1=({campaignName:e,playerName:t,characterName:n,isReady:s,onToggleReady:r,otherPlayers:i})=>{const o=i.length+1,l=i.filter(c=>c.isReady).length+(s?1:0);return a.jsxs("div",{className:"combat-lobby combat-lobby--player",children:[a.jsxs("header",{className:"lobby-header",children:[a.jsx("div",{className:"lobby-header__seal",children:""}),a.jsxs("div",{className:"lobby-header__content",children:[a.jsx("h1",{className:"lobby-header__title",children:e}),a.jsx("p",{className:"lobby-header__subtitle",children:"War Council Chamber"})]}),a.jsx("div",{className:"lobby-header__seal lobby-header__seal--right",children:""})]}),a.jsx("div",{className:"lobby-content lobby-content--centered",children:a.jsxs("main",{className:"player-lobby-main",children:[a.jsxs("div",{className:"character-panel",children:[a.jsx("div",{className:"character-panel__header",children:a.jsxs("h2",{className:"section-title",children:[a.jsx("span",{className:"section-title__icon",children:""}),"Your Character"]})}),a.jsxs("div",{className:"character-display",children:[a.jsx("div",{className:"character-display__portrait",children:a.jsx("div",{className:"character-display__portrait-frame",children:n?n.charAt(0).toUpperCase():t.charAt(0).toUpperCase()})}),a.jsxs("div",{className:"character-display__info",children:[a.jsx("h3",{className:"character-display__name",children:n||"No Character Selected"}),a.jsxs("p",{className:"character-display__player",children:["Played by ",t]})]})]})]}),a.jsxs("div",{className:"ready-section",children:[a.jsxs("button",{className:`ready-toggle ${s?"ready-toggle--ready":""}`,onClick:()=>r(!s),children:[a.jsx("span",{className:"ready-toggle__seal",children:s?"":""}),a.jsx("span",{className:"ready-toggle__text",children:s?"READY FOR BATTLE":"Mark as Ready"})]}),a.jsx("p",{className:"ready-section__hint",children:s?"Waiting for Game Master to begin combat...":"Click to signal you're prepared for combat"})]}),a.jsxs("div",{className:"adventurers-panel",children:[a.jsxs("div",{className:"adventurers-panel__header",children:[a.jsxs("h2",{className:"section-title",children:[a.jsx("span",{className:"section-title__icon",children:""}),"Fellow Adventurers"]}),a.jsxs("span",{className:"readiness-count",children:[l,"/",o," Ready"]})]}),a.jsx("div",{className:"adventurer-list",children:i.length===0?a.jsx("div",{className:"adventurer-list__empty",children:"You are the only adventurer in the lobby"}):i.map(c=>a.jsxs("div",{className:`adventurer-card ${c.isReady?"adventurer-card--ready":""} ${c.isConnected?"":"adventurer-card--disconnected"}`,children:[a.jsx("div",{className:"adventurer-card__seal",children:c.isReady?"":""}),a.jsxs("div",{className:"adventurer-card__info",children:[a.jsx("h4",{className:"adventurer-card__name",children:c.name}),c.characterName&&a.jsx("p",{className:"adventurer-card__character",children:c.characterName}),!c.isConnected&&a.jsx("p",{className:"adventurer-card__status",children:"Disconnected"})]}),a.jsx("div",{className:"adventurer-card__status-text",children:c.isReady?"Ready":"Not Ready"})]},c.id))})]})]})})]})},$1=e=>{const t=e.skillAllocations??{},n=e.skillBonuses??{},s={};return new Set([...Object.keys(t),...Object.keys(n)]).forEach(i=>{s[i]=(t[i]??0)+(n[i]??0)}),s},Rd=e=>{const t=e.raceKey==="ANZ"?140:100,n=e.raceKey==="ANZ"?14:10,s=Math.max(1,e.level);return Math.round(t+n*(s-1))};function B1(e,t,n,s){var _;const r=e.characterId?s.get(e.characterId):void 0,i=e.bestiaryEntryId?n.get(e.bestiaryEntryId):void 0,o=r?$1(r):(i==null?void 0:i.skills)??(i==null?void 0:i.statsSkills)??{},l={burn:0,freeze:0,laceration:0,blunt:0,mental:0,necrosis:0,spiritual:0};if(e.wounds)for(const w of e.wounds){const f=w.woundType;l[f]=(l[f]??0)+w.woundCount}const c=(e.statusEffects??[]).filter(w=>w.isActive!==!1).map(w=>({key:w.statusKey.toUpperCase(),stacks:w.stacks??1,duration:w.durationRemaining??null})),u=((_=e.faction)==null?void 0:_.toLowerCase())??"enemy",d=e.characterId?t.get(e.characterId):void 0,h=d?`player:${d}`:"gm",m=r?Rd(r):e.energyMax??100,y=e.apMax??6,b=e.tier??(r?Math.max(1,r.level):1);return{id:e.id,name:(r==null?void 0:r.name)??e.name,controller:h,faction:u,skills:o,initiativeSkill:"initiative",energy:{current:e.energyCurrent??m,max:m},ap:{current:e.apCurrent??y,max:y},tier:b,reaction:{available:!0},statusEffects:c,wounds:l,alive:!0,bestiaryEntryId:e.bestiaryEntryId}}const F1=({campaignId:e,userId:t})=>{const{state:n,lobbyState:s,connectionStatus:r,error:i,clearError:o,startCombat:l,endCombat:c,endTurn:u,resolveReactions:d,gmOverride:h,myPendingDefense:m,joinLobby:y,leaveLobby:b,initiateSkillContest:_,respondToSkillContest:w,requestSkillCheck:f,submitSkillCheck:p,pendingSkillChecks:g,forceInitiativeRoll:j,addResourceModifier:A,removeResourceModifier:R,adjustResource:S}=Ui(),{phase:k,round:N,activeEntity:E,pendingAction:M}=jb(),{getEntitiesByFaction:O,getEntitiesInInitiativeOrder:X}=Sb(),[re,I]=v.useState(null),[$,L]=v.useState(null),[D,F]=v.useState([]),[q,V]=v.useState([]),[Q,te]=v.useState([]),[B,ae]=v.useState(null),[le,he]=v.useState([]),[ue,xe]=v.useState(!0),[Ne,je]=v.useState("players-first"),[Ce,Ke]=v.useState(!1),[Me,oe]=v.useState(!1),[pe,ve]=v.useState(null),be=n?O("ally"):[],ke=n?O("enemy"):[];n&&X();const Ie=n!==null&&k!=="completed",Be=i||re,_e=$&&(n==null?void 0:n.entities[$]),He=v.useMemo(()=>n?Object.values(n.entities):[],[n]),De=v.useMemo(()=>new Map(Q.map(W=>[W.id,W])),[Q]),ne=v.useMemo(()=>n?Object.values(n.entities).filter(W=>W.controller==="gm"):[],[n]),me=v.useMemo(()=>n!=null&&n.pendingSkillContests?Object.values(n.pendingSkillContests).filter(W=>{if(W.status!=="awaiting_defense")return!1;const fe=n.entities[W.targetId];return fe?fe.controller==="gm"||W.gmCanResolve:!1}):[],[n]),we=v.useMemo(()=>Object.values(g??{}).filter(fe=>fe.status==="pending"&&fe.gmCanResolve),[g]),Ye=(E==null?void 0:E.controller)==="gm";v.useEffect(()=>{async function W(){try{xe(!0);const nt=(await tt.listCampaigns()).find(xt=>xt.id===e),[mt,Rt,Pe,Ve]=await Promise.all([tt.listCombatants(e),tt.listBestiaryEntries(e),tt.listCampaignMembers(e),Ct.listCampaignCharacters(e)]);ae(nt||null),F(mt),V(Rt),he(Pe),te(Ve)}catch(fe){I("Failed to load campaign data"),console.error(fe)}finally{xe(!1)}}W()},[e]),v.useEffect(()=>{if(!Ie&&!ue)return y(),()=>{b()}},[Ie,ue,y,b]);const Fe=async(W,fe)=>{try{const nt=q.find(Rt=>Rt.id===W);if(!nt)return;const mt=await tt.createCombatant({campaignId:e,bestiaryEntryId:W,faction:fe,energyMax:nt.energyBars?nt.energyBars*10:100,apMax:6,tier:nt.rank==="Hero"?3:nt.rank==="Lieutenant"?2:1});F(Rt=>[...Rt,mt])}catch(nt){I(nt instanceof Error?nt.message:"Failed to add combatant")}},z=async W=>{try{const fe=De.get(W),nt=fe?Rd(fe):100,mt=fe?Math.max(1,fe.level):1,Rt=await tt.createCombatant({campaignId:e,characterId:W,faction:"ally",energyMax:nt,apMax:6,tier:mt});F(Pe=>[...Pe,Rt])}catch(fe){I(fe instanceof Error?fe.message:"Failed to add player character")}},de=async W=>{try{await tt.deleteCombatant(W),F(fe=>fe.filter(nt=>nt.id!==W))}catch(fe){I(fe instanceof Error?fe.message:"Failed to remove combatant")}},U=async()=>{try{oe(!0);const W=new Map;le.forEach(Pe=>{Pe.characterId&&W.set(Pe.characterId,Pe.playerUserId)});const fe=new Map(q.map(Pe=>[Pe.id,Pe])),nt=D.map(Pe=>B1(Pe,W,fe,De)),mt={};nt.forEach(Pe=>{mt[Pe.id]=Pe}),await l({entities:mt,initiativeMode:Ne==="interleaved"?"individual":"group",manualInitiative:Ce})}catch(W){I(W instanceof Error?W.message:"Failed to start combat")}finally{oe(!1)}},P=async W=>{try{await c({reason:W})}catch(fe){I(fe instanceof Error?fe.message:"Failed to end combat")}},H=async()=>{if(E)try{await u({entityId:E.id,voluntary:!0})}catch(W){I(W instanceof Error?W.message:"Failed to end turn")}},Z=async()=>{try{await d()}catch(W){I(W instanceof Error?W.message:"Failed to resolve reactions")}},ie=W=>{L(W)},ee=W=>{W.sourceEntityId&&L(W.sourceEntityId)},G=async(W,fe,nt)=>{try{const mt=me.find(Rt=>Rt.contestId===W);if(!mt)return;await w({contestId:W,entityId:mt.targetId,skill:fe,roll:nt})}catch(mt){I(mt instanceof Error?mt.message:"Failed to resolve contest")}},Y=async W=>{try{await _(W)}catch(fe){throw I(fe instanceof Error?fe.message:"Failed to initiate contest"),fe}},J=async(W,fe,nt,mt)=>{ve({attackerId:W,targetId:fe,skill:nt})},Ae=async W=>{if(!(!pe||W.variant!=="contest"))try{await _({initiatorEntityId:pe.attackerId,targetEntityId:pe.targetId,skill:W.skill,roll:W.roll}),ve(null)}catch(fe){I(fe instanceof Error?fe.message:"Failed to initiate NPC attack")}},$e=async W=>{try{await f(W)}catch(fe){throw I(fe instanceof Error?fe.message:"Failed to request skill check"),fe}},Ue=async(W,fe)=>{try{await p({checkId:W,roll:fe})}catch(nt){I(nt instanceof Error?nt.message:"Failed to resolve skill check")}};if(ue)return a.jsx("div",{className:"war-gm-page","data-theme":"dark-fantasy",children:a.jsx("div",{className:"war-gm-page__loading",children:a.jsx("h2",{children:"Loading Combat Data..."})})});if(!Ie){const W=le.map(Ve=>{var zi;const xt=s==null?void 0:s.players[Ve.playerUserId],ia=Ve.characterId?(zi=De.get(Ve.characterId))==null?void 0:zi.name:void 0;return{id:Ve.playerUserId,name:Ve.playerUserId.substring(0,8),characterName:ia,isReady:(xt==null?void 0:xt.isReady)??!1,isConnected:!!xt}}),fe=D.map(Ve=>{var ia;const xt=Ve.characterId?De.get(Ve.characterId):void 0;return{id:Ve.id,bestiaryEntryId:Ve.bestiaryEntryId,characterId:Ve.characterId,name:(xt==null?void 0:xt.name)??Ve.name,faction:((ia=Ve.faction)==null?void 0:ia.toLowerCase())||"enemy",tier:Ve.tier??(xt?Math.max(1,xt.level):1),energyMax:xt?Rd(xt):Ve.energyMax||100,apMax:Ve.apMax||6}}),nt=new Set(D.map(Ve=>Ve.characterId).filter(Ve=>!!Ve)),Rt=le.filter(Ve=>!!Ve.characterId).map(Ve=>{const xt=De.get(Ve.characterId);return{playerId:Ve.playerUserId,playerName:Ve.playerUserId.substring(0,8),characterId:Ve.characterId,characterName:(xt==null?void 0:xt.name)??"Unknown Character",isDeployed:nt.has(Ve.characterId)}}),Pe=q.map(Ve=>({id:Ve.id,name:Ve.name,tier:Ve.rank==="Hero"?3:Ve.rank==="Lieutenant"?2:1,energyMax:Ve.energyBars?Ve.energyBars*10:void 0,apMax:6,rank:Ve.rank}));return a.jsx(L1,{campaignName:(B==null?void 0:B.name)||"Campaign",players:W,combatants:fe,playerCharacters:Rt,bestiaryEntries:Pe,initiativeMode:Ne,manualInitiative:Ce,onManualInitiativeChange:Ke,onInitiativeModeChange:je,onAddCombatant:Fe,onAddPlayerCharacter:z,onRemoveCombatant:de,onStartCombat:U,isStarting:Me})}return a.jsxs("div",{className:"war-gm-page","data-theme":"dark-fantasy",children:[a.jsxs("header",{className:"war-gm-page__header",children:[a.jsxs("div",{className:"war-gm-page__header-content",children:[a.jsx("h1",{className:"war-gm-page__title war-text-display",children:" Battle Command"}),k&&a.jsx("div",{className:"war-gm-page__phase-dial",children:a.jsx(Eb,{phase:k,round:N})}),a.jsx("div",{className:"war-gm-page__header-status",children:a.jsxs("div",{className:`war-gm-page__connection war-gm-page__connection--${r}`,children:[a.jsx("span",{className:"war-gm-page__connection-dot"}),a.jsx("span",{className:"war-gm-page__connection-label",children:r})]})})]}),Be&&a.jsxs("div",{className:"war-gm-page__error",children:[a.jsx("span",{children:Be}),a.jsx("button",{onClick:()=>{o(),I(null)},children:""})]})]}),a.jsxs("main",{className:"war-gm-page__main",children:[a.jsxs("aside",{className:"war-gm-page__sidebar war-gm-page__sidebar--left",children:[a.jsx(Cb,{entities:n!=null&&n.entities?Object.values(n.entities):[],initiativeOrder:(n==null?void 0:n.initiativeOrder)??[],activeEntityId:(n==null?void 0:n.activeEntityId)??null,onEntityClick:ie}),a.jsxs("div",{className:"war-gm-page__controls",children:[a.jsxs("div",{className:"war-gm-page__control-section",children:[a.jsx("h3",{className:"war-gm-page__control-title",children:"Round Controls"}),a.jsx("button",{className:"war-gm-page__control-btn war-gm-page__control-btn--end-turn",onClick:H,disabled:!E,children:" End Turn"}),k==="reaction-interrupt"&&(n==null?void 0:n.pendingReactions.length)>0&&a.jsxs("button",{className:"war-gm-page__control-btn war-gm-page__control-btn--resolve",onClick:Z,children:[" Resolve Reactions (",n.pendingReactions.length,")"]})]}),a.jsxs("div",{className:"war-gm-page__control-section war-gm-page__control-section--danger",children:[a.jsx("h3",{className:"war-gm-page__control-title",children:"End Combat"}),a.jsxs("div",{className:"war-gm-page__end-btns",children:[a.jsx("button",{className:"war-gm-page__end-btn war-gm-page__end-btn--victory",onClick:()=>P("victory"),children:" Victory"}),a.jsx("button",{className:"war-gm-page__end-btn war-gm-page__end-btn--defeat",onClick:()=>P("defeat"),children:" Defeat"}),a.jsx("button",{className:"war-gm-page__end-btn war-gm-page__end-btn--end",onClick:()=>P("gm_ended"),children:" End"})]})]})]})]}),a.jsxs("section",{className:"war-gm-page__battlefield",children:[E&&a.jsxs("div",{className:"war-gm-page__active-panel",children:[a.jsxs("div",{className:"war-gm-page__active-header",children:[a.jsx("div",{className:"war-gm-page__active-indicator",children:""}),a.jsxs("div",{className:"war-gm-page__active-info",children:[a.jsx("h2",{className:"war-gm-page__active-name war-text-display",children:E.name}),a.jsx("span",{className:"war-gm-page__active-faction",children:E.faction==="ally"?"Allied Forces":"Enemy Forces"})]})]}),a.jsxs("div",{className:"war-gm-page__active-resources",children:[a.jsx(qo,{current:E.ap.current,max:E.ap.max,type:"ap",label:"Action Points"}),a.jsx(qo,{current:E.energy.current,max:E.energy.max,type:"energy",label:"Energy"})]}),E.statusEffects.length>0&&a.jsx(Ff,{effects:E.statusEffects,size:"sm"}),M&&a.jsxs("div",{className:"war-gm-page__pending-action",children:[a.jsx("span",{className:"war-gm-page__pending-label",children:"Pending:"}),a.jsx("span",{className:"war-gm-page__pending-type",children:M.type}),M.interruptible&&a.jsx("span",{className:"war-gm-page__pending-interruptible",children:" Interruptible"})]})]}),k==="initiative-rolling"&&n&&a.jsx("div",{className:"war-gm-page__initiative-status-panel",children:a.jsx(T1,{entities:n.entities,initiativeRolls:n.initiativeRolls||{},onForceRoll:j})}),me.length>0&&n&&a.jsx("div",{className:"war-gm-page__contest-panel",children:a.jsx(E1,{pendingContests:me,entities:n.entities,onResolveContest:G})}),we.length>0&&n&&a.jsx("div",{className:"war-gm-page__contest-panel",children:a.jsx(I1,{pendingChecks:we,entities:n.entities,onResolveCheck:Ue})}),Ye&&E&&k==="active-turn"&&a.jsx("div",{className:"war-gm-page__npc-panel",children:a.jsx(P1,{npcEntities:ne,targetableEntities:He,activeNpcId:E.id,onInitiateAttack:J})}),k==="active-turn"&&He.length>0&&a.jsx("div",{className:"war-gm-page__skill-check-panel",children:a.jsx(A1,{entities:He,onInitiateContest:Y,onRequestSkillCheck:$e})}),a.jsxs("div",{className:"war-gm-page__zones",children:[a.jsxs("div",{className:"war-gm-page__zone war-gm-page__zone--allies",children:[a.jsx("h3",{className:"war-gm-page__zone-title war-text-display",children:" Allied Forces"}),a.jsx("div",{className:"war-gm-page__token-grid",children:be.length===0?a.jsx("div",{className:"war-gm-page__zone-empty",children:"No allies"}):be.map(W=>a.jsx($l,{entity:W,isActive:W.id===(n==null?void 0:n.activeEntityId),isSelected:W.id===$,onClick:()=>ie(W.id)},W.id))})]}),a.jsxs("div",{className:"war-gm-page__zone war-gm-page__zone--enemies",children:[a.jsx("h3",{className:"war-gm-page__zone-title war-text-display",children:" Enemy Forces"}),a.jsx("div",{className:"war-gm-page__token-grid",children:ke.length===0?a.jsx("div",{className:"war-gm-page__zone-empty",children:"No enemies"}):ke.map(W=>a.jsx($l,{entity:W,isActive:W.id===(n==null?void 0:n.activeEntityId),isSelected:W.id===$,onClick:()=>ie(W.id)},W.id))})]})]})]}),a.jsx("aside",{className:"war-gm-page__sidebar war-gm-page__sidebar--right",children:_e?a.jsxs("div",{className:"war-gm-page__detail-panel",children:[a.jsxs("div",{className:"war-gm-page__detail-header",children:[a.jsx("h3",{className:"war-gm-page__detail-title war-text-display",children:_e.name}),a.jsx("button",{className:"war-gm-page__detail-close",onClick:()=>L(null),children:""})]}),a.jsxs("div",{className:"war-gm-page__detail-content",children:[a.jsxs("div",{className:"war-gm-page__detail-section",children:[a.jsx("h4",{className:"war-gm-page__detail-section-title",children:"Resources"}),a.jsx(qo,{current:_e.ap.current,max:_e.ap.max,type:"ap",label:"AP"}),a.jsx(qo,{current:_e.energy.current,max:_e.energy.max,type:"energy",label:"Energy"})]}),Object.values(_e.wounds).some(W=>W>0)&&a.jsxs("div",{className:"war-gm-page__detail-section",children:[a.jsx("h4",{className:"war-gm-page__detail-section-title",children:"Wounds"}),a.jsx(y1,{wounds:_e.wounds,showPenalties:!0})]}),_e.statusEffects.length>0&&a.jsxs("div",{className:"war-gm-page__detail-section",children:[a.jsx("h4",{className:"war-gm-page__detail-section-title",children:"Status Effects"}),a.jsx(Ff,{effects:_e.statusEffects,showDuration:!0})]}),a.jsx("div",{className:"war-gm-page__detail-section war-gm-page__detail-section--gm",children:a.jsx(R1,{entity:_e,onAdjustResource:(W,fe)=>S(_e.id,W,fe),onAddModifier:(W,fe,nt,mt,Rt)=>A(_e.id,W,fe,nt,mt,Rt),onRemoveModifier:(W,fe)=>R(_e.id,W,fe)})})]})]}):a.jsx("div",{className:"war-gm-page__detail-empty",children:a.jsx("p",{children:"Click an entity to view details"})})})]}),a.jsx("footer",{className:"war-gm-page__footer",children:a.jsx(Ab,{log:(n==null?void 0:n.log)??[],entities:n!=null&&n.entities?Object.values(n.entities):[],onEntryClick:ee,maxEntries:50})}),pe&&(n==null?void 0:n.entities[pe.attackerId])&&(n==null?void 0:n.entities[pe.targetId])&&a.jsx(Td,{isOpen:!0,variant:"contest",entity:n.entities[pe.attackerId],contest:{contestId:`temp-${Date.now()}`,initiatorId:pe.attackerId,initiatorSkill:pe.skill,initiatorRoll:{skill:pe.skill,modifier:0,diceCount:0,keepHighest:!0,rawDice:[],selectedDie:0,total:0,audit:""},targetId:pe.targetId,autoRollDefense:!1,status:"pending",createdAt:new Date().toISOString()},entities:n!=null&&n.entities?Object.values(n.entities):[],contestMode:"initiator",onSubmit:Ae,onClose:()=>ve(null)})]})},q1=()=>{const{campaignId:e}=Tn(),[t,n]=v.useState(null),[s,r]=v.useState(!1),[i,o]=v.useState(!0),[l,c]=v.useState(null);return v.useEffect(()=>{async function u(){try{const d=ze(),{data:h,error:m}=await d.auth.getUser();if(m||!h.user){c("Not authenticated");return}if(n(h.user.id),e){const b=(await tt.listCampaigns()).find(_=>_.id===e);r((b==null?void 0:b.gmUserId)===h.user.id)}}catch(d){c("Failed to load user data"),console.error(d)}finally{o(!1)}}u()},[e]),e?i?a.jsx("div",{className:"war-gm-page","data-theme":"dark-fantasy",children:a.jsx("div",{className:"war-gm-page__loading",children:a.jsx("h2",{children:"Loading..."})})}):l||!t?a.jsxs("div",{className:"war-gm-page__error-state",children:[a.jsxs("h2",{children:["Error: ",l||"Not authenticated"]}),a.jsx("p",{children:"Please log in to access combat."})]}):a.jsx(Nb,{campaignId:e,userId:t,isGm:s,children:a.jsx(F1,{campaignId:e,userId:t})}):a.jsxs("div",{className:"war-gm-page__error-state",children:[a.jsx("h2",{children:"Error: No Campaign ID"}),a.jsx("p",{children:"Cannot load GM combat without a campaign ID."})]})},U1=()=>"https://adurun-campaigns.larhackman.workers.dev",W1=e=>{const t=U1(),n=new URL(e,t);return n.search="",n.hash="",n.protocol=n.protocol==="https:"?"wss:":"ws:",n},z1=(e,t,n)=>{var o;const s=W1(`/api/combat/${encodeURIComponent(e)}/connect`);s.searchParams.set("playerId",n.playerId),s.searchParams.set("isGM",String(n.isGM)),(o=n.controlledEntityIds)!=null&&o.length&&s.searchParams.set("entities",n.controlledEntityIds.join(","));const r=new WebSocket(s.toString());r.addEventListener("open",()=>{var l;return(l=t.onOpen)==null?void 0:l.call(t)}),r.addEventListener("close",()=>{var l;return(l=t.onClose)==null?void 0:l.call(t)}),r.addEventListener("error",l=>{var c;return(c=t.onConnectionError)==null?void 0:c.call(t,l)}),r.addEventListener("message",l=>{var c,u,d,h,m,y,b,_,w,f,p,g,j,A,R,S,k,N,E,M,O,X;if(typeof l.data=="string")try{const re=JSON.parse(l.data);if(!re||typeof re!="object")return;const I=re.payload??{};switch(re.type){case"STATE_SYNC":(c=t.onStateSync)==null||c.call(t,I);break;case"COMBAT_STARTED":(u=t.onCombatStarted)==null||u.call(t,I);break;case"COMBAT_ENDED":(d=t.onCombatEnded)==null||d.call(t,I);break;case"ROUND_STARTED":(h=t.onRoundStarted)==null||h.call(t,I);break;case"TURN_STARTED":(m=t.onTurnStarted)==null||m.call(t,I);break;case"TURN_ENDED":(y=t.onTurnEnded)==null||y.call(t,I);break;case"INITIATIVE_UPDATED":(b=t.onInitiativeUpdated)==null||b.call(t,I);break;case"MOVEMENT_EXECUTED":(_=t.onMovementExecuted)==null||_.call(t,I);break;case"ATTACK_RESOLVED":(w=t.onAttackResolved)==null||w.call(t,I);break;case"ABILITY_RESOLVED":(f=t.onAbilityResolved)==null||f.call(t,I);break;case"REACTION_RESOLVED":(p=t.onReactionResolved)==null||p.call(t,I);break;case"CHANNELING_STARTED":(g=t.onChannelingStarted)==null||g.call(t,I);break;case"CHANNELING_CONTINUED":(j=t.onChannelingContinued)==null||j.call(t,I);break;case"CHANNELING_RELEASED":(A=t.onChannelingReleased)==null||A.call(t,I);break;case"CHANNELING_INTERRUPTED":(R=t.onChannelingInterrupted)==null||R.call(t,I);break;case"ENTITY_UPDATED":(S=t.onEntityUpdated)==null||S.call(t,I);break;case"ENTITY_UNCONSCIOUS":(k=t.onEntityUnconscious)==null||k.call(t,I);break;case"ENTITY_DIED":(N=t.onEntityDied)==null||N.call(t,I);break;case"ENDURE_ROLL_REQUIRED":(E=t.onEndureRollRequired)==null||E.call(t,I);break;case"DEATH_CHECK_REQUIRED":(M=t.onDeathCheckRequired)==null||M.call(t,I);break;case"ACTION_REJECTED":(O=t.onActionRejected)==null||O.call(t,I);break;case"ERROR":(X=t.onError)==null||X.call(t,I);break}}catch{}});const i=(l,c)=>{r.readyState===WebSocket.OPEN&&r.send(JSON.stringify({type:l,payload:c??{},requestId:crypto.randomUUID()}))};return{socket:r,send:i,close:()=>r.close(),requestState:()=>i("REQUEST_STATE"),isConnected:()=>r.readyState===WebSocket.OPEN}},H1=(e,t,n)=>{const s=n.maxRetries??5,r=n.retryDelay??2e3;let i=null,o=0,l=!1;const c=()=>{i=z1(e,{...t,onOpen:()=>{var u;o=0,i==null||i.requestState(),(u=t.onOpen)==null||u.call(t)},onClose:()=>{var u,d;(u=t.onClose)==null||u.call(t),!l&&o<s&&(o++,(d=n.onReconnecting)==null||d.call(n,o),setTimeout(c,r*Math.pow(1.5,o-1)))},onConnectionError:u=>{var d;(d=t.onConnectionError)==null||d.call(t,u)}},n)};return c(),{get socket(){return(i==null?void 0:i.socket)??null},send:(u,d)=>i==null?void 0:i.send(u,d),close:()=>{l=!0,i==null||i.close()},requestState:()=>i==null?void 0:i.requestState(),isConnected:()=>(i==null?void 0:i.isConnected())??!1,reconnect:()=>{l=!1,o=0,i==null||i.close(),c()}}},Y1={connectionStatus:"disconnected",reconnectAttempt:0,combatId:null,campaignId:null,phase:null,round:0,currentTurnIndex:-1,currentEntityId:null,entities:{},initiative:[],hexPositions:{},controlledEntityIds:[],version:0,selectedEntityId:null,targetEntityId:null,pendingEndureRoll:null,pendingDeathCheck:null,lastError:null};function V1(e,t){switch(t.type){case"SET_CONNECTION_STATUS":return{...e,connectionStatus:t.status,reconnectAttempt:t.attempt??0};case"STATE_SYNC":return{...e,combatId:t.state.combatId,campaignId:t.state.campaignId,phase:t.state.phase,round:t.state.round,currentTurnIndex:t.state.currentTurnIndex,currentEntityId:t.state.currentEntityId,entities:t.state.entities,initiative:t.state.initiative,hexPositions:t.state.hexPositions,controlledEntityIds:t.controlledEntityIds,version:t.state.version};case"COMBAT_STARTED":return{...e,combatId:t.combatId,phase:"setup"};case"COMBAT_ENDED":return{...e,phase:"completed",pendingEndureRoll:null,pendingDeathCheck:null};case"ROUND_STARTED":return{...e,round:t.round};case"TURN_STARTED":return{...e,currentEntityId:t.entityId,currentTurnIndex:t.turnIndex,phase:"active"};case"TURN_ENDED":{const n=e.entities[t.entityId];return n!=null&&n.energy?{...e,entities:{...e.entities,[t.entityId]:{...n,energy:{...n.energy,current:Math.min(n.energy.max,n.energy.current+t.energyGained)}}}}:e}case"INITIATIVE_UPDATED":return{...e,initiative:t.initiative};case"ENTITY_UPDATED":{const n=e.entities[t.entityId];return n?{...e,entities:{...e.entities,[t.entityId]:{...n,...t.updates}},version:e.version+1}:e}case"ENTITY_POSITION_UPDATED":return{...e,hexPositions:{...e.hexPositions,[t.entityId]:t.position},version:e.version+1};case"SET_PENDING_ENDURE":return{...e,pendingEndureRoll:{entityId:t.entityId,damage:t.damage}};case"SET_PENDING_DEATH_CHECK":return{...e,pendingDeathCheck:{entityId:t.entityId,damage:t.damage}};case"CLEAR_PENDING_ROLLS":return{...e,pendingEndureRoll:null,pendingDeathCheck:null};case"SELECT_ENTITY":return{...e,selectedEntityId:t.entityId};case"SET_TARGET":return{...e,targetEntityId:t.entityId};case"SET_ERROR":return{...e,lastError:t.error};case"INCREMENT_VERSION":return{...e,version:e.version+1};default:return e}}const Ib=T.createContext(null);function um({children:e,combatId:t,playerId:n,isGM:s,controlledCharacterIds:r=[]}){const[i,o]=T.useReducer(V1,Y1),l=T.useRef(null);T.useEffect(()=>{o({type:"SET_CONNECTION_STATUS",status:"connecting"});const f=H1(t,{onOpen:()=>{o({type:"SET_CONNECTION_STATUS",status:"connected"})},onClose:()=>{o({type:"SET_CONNECTION_STATUS",status:"disconnected"})},onConnectionError:()=>{o({type:"SET_ERROR",error:"Connection error"})},onStateSync:p=>{o({type:"STATE_SYNC",state:p.state,controlledEntityIds:p.yourControlledEntities})},onCombatStarted:p=>{o({type:"COMBAT_STARTED",combatId:p.combatId})},onCombatEnded:()=>{o({type:"COMBAT_ENDED"})},onRoundStarted:p=>{o({type:"ROUND_STARTED",round:p.round})},onTurnStarted:p=>{o({type:"TURN_STARTED",entityId:p.entityId,turnIndex:p.turnIndex})},onTurnEnded:p=>{o({type:"TURN_ENDED",entityId:p.entityId,energyGained:p.energyGained})},onInitiativeUpdated:p=>{o({type:"INITIATIVE_UPDATED",initiative:p.initiative})},onMovementExecuted:p=>{var g,j;o({type:"ENTITY_POSITION_UPDATED",entityId:p.entityId,position:p.to}),o({type:"ENTITY_UPDATED",entityId:p.entityId,updates:{ap:{current:p.remainingAP,max:((j=(g=i.entities[p.entityId])==null?void 0:g.ap)==null?void 0:j.max)??6}}})},onAttackResolved:p=>{var g,j;o({type:"ENTITY_UPDATED",entityId:p.targetId,updates:{energy:{current:p.targetEnergy,max:((j=(g=i.entities[p.targetId])==null?void 0:g.energy)==null?void 0:j.max)??100},wounds:p.targetWounds}})},onChannelingStarted:p=>{o({type:"ENTITY_UPDATED",entityId:p.entityId,updates:{channeling:{spellName:p.spellName,energyChanneled:p.energyChanneled??0,apChanneled:p.apChanneled??0,totalCost:p.totalCost??0,progress:p.progress??0}}})},onChannelingContinued:p=>{o({type:"ENTITY_UPDATED",entityId:p.entityId,updates:{channeling:{spellName:p.spellName,energyChanneled:p.energyChanneled??0,apChanneled:p.apChanneled??0,totalCost:p.totalCost??0,progress:p.progress??0}}})},onChannelingReleased:p=>{o({type:"ENTITY_UPDATED",entityId:p.entityId,updates:{channeling:void 0}})},onChannelingInterrupted:p=>{o({type:"ENTITY_UPDATED",entityId:p.entityId,updates:{channeling:void 0}})},onEntityUnconscious:p=>{o({type:"ENTITY_UPDATED",entityId:p.entityId,updates:{unconscious:!0}})},onEntityDied:p=>{o({type:"ENTITY_UPDATED",entityId:p.entityId,updates:{alive:!1,unconscious:!1}})},onEndureRollRequired:p=>{o({type:"SET_PENDING_ENDURE",entityId:p.entityId,damage:p.triggeringDamage})},onDeathCheckRequired:p=>{o({type:"SET_PENDING_DEATH_CHECK",entityId:p.entityId,damage:p.triggeringDamage})},onActionRejected:p=>{o({type:"SET_ERROR",error:p.reason})},onError:p=>{o({type:"SET_ERROR",error:p.message})}},{playerId:n,isGM:s,controlledEntityIds:r,onReconnecting:p=>{o({type:"SET_CONNECTION_STATUS",status:"reconnecting",attempt:p})}});return l.current=f,()=>{f.close(),l.current=null}},[t,n,s,r]);const c=T.useCallback((f,p)=>{var g;(g=l.current)==null||g.send(f,p)},[]),u=T.useMemo(()=>({startCombat:f=>c("START_COMBAT",f?{entities:f}:{}),endCombat:()=>c("END_COMBAT"),submitInitiativeRoll:(f,p,g)=>c("SUBMIT_INITIATIVE_ROLL",{entityId:f,roll:p,tiebreaker:g}),endTurn:f=>c("END_TURN",{entityId:f}),delayTurn:f=>c("DELAY_TURN",{entityId:f}),readyAction:(f,p)=>c("READY_ACTION",{entityId:f,triggerCondition:p}),declareMovement:(f,p,g,j)=>c("DECLARE_MOVEMENT",{entityId:f,targetQ:p,targetR:g,path:j}),declareAttack:f=>c("DECLARE_ATTACK",f),declareAbility:f=>c("DECLARE_ABILITY",f),declareReaction:f=>c("DECLARE_REACTION",f),startChanneling:f=>c("START_CHANNELING",f),continueChanneling:(f,p,g)=>c("CONTINUE_CHANNELING",{entityId:f,additionalEnergy:p,additionalAP:g}),releaseSpell:(f,p)=>c("RELEASE_SPELL",{entityId:f,targetId:p}),abortChanneling:f=>c("ABORT_CHANNELING",{entityId:f}),submitEndureRoll:(f,p,g)=>{c("SUBMIT_ENDURE_ROLL",{entityId:f,rollTotal:p,success:g}),o({type:"CLEAR_PENDING_ROLLS"})},submitDeathCheck:(f,p,g)=>{c("SUBMIT_DEATH_CHECK",{entityId:f,rollTotal:p,success:g}),o({type:"CLEAR_PENDING_ROLLS"})},gmOverride:(f,p)=>c("GM_OVERRIDE",{entityId:f,updates:p}),gmMoveEntity:(f,p,g)=>c("GM_MOVE_ENTITY",{entityId:f,targetQ:p,targetR:g}),gmApplyDamage:(f,p,g)=>c("GM_APPLY_DAMAGE",{entityId:f,damage:p,damageType:g}),gmModifyResources:(f,p,g)=>c("GM_MODIFY_RESOURCES",{entityId:f,ap:p,energy:g}),gmAddEntity:f=>c("GM_ADD_ENTITY",{entity:f}),gmRemoveEntity:f=>c("GM_REMOVE_ENTITY",{entityId:f}),selectEntity:f=>o({type:"SELECT_ENTITY",entityId:f}),setTarget:f=>o({type:"SET_TARGET",entityId:f}),clearError:()=>o({type:"SET_ERROR",error:null})}),[c]),d=T.useCallback(f=>s?!0:i.controlledEntityIds.includes(f),[s,i.controlledEntityIds]),h=T.useMemo(()=>i.currentEntityId?d(i.currentEntityId):!1,[i.currentEntityId,d]),m=T.useCallback(f=>i.entities[f],[i.entities]),y=T.useCallback(f=>i.hexPositions[f],[i.hexPositions]),b=T.useCallback(()=>{if(i.currentEntityId)return i.entities[i.currentEntityId]},[i.currentEntityId,i.entities]),_=T.useCallback(()=>i.initiative.map(f=>({...i.entities[f.entityId],initiativeRoll:f.roll})).filter(f=>!!f.id),[i.initiative,i.entities]),w=T.useMemo(()=>({state:i,actions:u,isGM:s,isMyTurn:h,canControlEntity:d,getEntity:m,getEntityPosition:y,getCurrentTurnEntity:b,getInitiativeOrder:_}),[i,u,s,h,d,m,y,b,_]);return a.jsx(Ib.Provider,{value:w,children:e})}function ra(){const e=T.useContext(Ib);if(!e)throw new Error("useCombat must be used within a CombatProvider");return e}const _a=e=>Number.isFinite(e)&&!Number.isNaN(e),Bl=e=>typeof e=="object"&&e!==null,K1=e=>typeof e=="function",Fl=e=>Bl(e)&&_a(e.col)&&_a(e.row),G1=e=>Bl(e)&&_a(e.x)&&_a(e.y),Dd=e=>Array.isArray(e)&&_a(e[0])&&_a(e[1]),hc=(e,t)=>t+e*(t&1)>>1;function J1(e,t){return(e%t+t)%t}const Q1=(e,t)=>J1(e+t,8),Md=([e,t,n=-e-t])=>({q:e,r:t,s:n});function ql({q:e,r:t,s:n}){const s=_a(e),r=_a(t),i=_a(n);if(s&&r&&i)return{q:e,r:t,s:n};if(s&&r)return{q:e,r:t,s:-e-t};if(s&&i)return{q:e,r:-e-n,s:n};if(r&&i)return{q:-t-n,r:t,s:n};throw new TypeError(`Can't determine three cube coordinates from less than two coordinates. Received: { q: ${e}, r: ${t}, s: ${n} }.`)}var jn=(e=>(e.FLAT="FLAT",e.POINTY="POINTY",e))(jn||{});function X1(e,t){if(Bl(e)&&e.xRadius>0&&e.yRadius>0)return e;if(Bl(e)&&e.width>0&&e.height>0){const{width:n,height:s}=e;return t===jn.POINTY?{xRadius:n/Math.sqrt(3),yRadius:s/2}:{xRadius:n/2,yRadius:s/Math.sqrt(3)}}if(e>0)return{xRadius:e,yRadius:e};throw new TypeError(`Invalid dimensions: ${JSON.stringify(e)}. Dimensions must be expressed as an Ellipse ({ xRadius: number, yRadius: number }), a Rectangle ({ width: number, height: number }) or a number.`)}function Z1(e,t){if(G1(e))return e;if(!t)throw new TypeError(`Supply a bounding box ({ width: number, height: number }). Received: ${JSON.stringify(t)}`);if(e==="topLeft")return{x:t.width*-.5,y:t.height*-.5};throw new TypeError(`Invalid origin: ${JSON.stringify(e)}. Origin must be expressed as a Point ({ x: number, y: number }) or the string 'topLeft'.`)}class dm{constructor(t=[0,0]){vc(this,"q");vc(this,"r");const{q:n,r:s}=Ul(this,t);this.q=n,this.r=s}static get settings(){const{dimensions:t,orientation:n,origin:s,offset:r}=this.prototype;return{dimensions:t,orientation:n,origin:s,offset:r}}get center(){const{width:t,height:n,x:s,y:r}=this;return{x:t/2-s,y:n/2-r}}get col(){return zf(this).col}get corners(){const{orientation:t,width:n,height:s,x:r,y:i}=this;return t===jn.POINTY?eP(n,s,r,i):tP(n,s,r,i)}get dimensions(){return Qr.dimensions}get height(){const{orientation:t,dimensions:{yRadius:n}}=this;return t===jn.POINTY?n*2:n*Math.sqrt(3)}get isFlat(){return this.orientation===jn.FLAT}get isPointy(){return this.orientation===jn.POINTY}get orientation(){return Qr.orientation}get origin(){return Qr.origin}get offset(){return Qr.offset}get row(){return zf(this).row}get width(){const{orientation:t,dimensions:{xRadius:n}}=this;return t===jn.POINTY?n*Math.sqrt(3):n*2}get x(){return Hf(this).x}get y(){return Hf(this).y}get s(){return-this.q-this.r}clone(t=this){return new this.constructor(t)}equals(t){return nP(this,Fl(t)?Db(this,t):t)}toString(){return`${this.constructor.name}(${this.q},${this.r})`}translate(t){return iP(this,t)}}const Qr={dimensions:{xRadius:1,yRadius:1},orientation:jn.POINTY,origin:{x:0,y:0},offset:-1},eP=(e,t,n,s)=>[{x:n+e*.5,y:s-t*.25},{x:n+e*.5,y:s+t*.25},{x:n,y:s+t*.5},{x:n-e*.5,y:s+t*.25},{x:n-e*.5,y:s-t*.25},{x:n,y:s-t*.5}],tP=(e,t,n,s)=>[{x:n+e*.25,y:s-t*.5},{x:n+e*.5,y:s},{x:n+e*.25,y:s+t*.5},{x:n-e*.25,y:s+t*.5},{x:n-e*.5,y:s},{x:n-e*.25,y:s-t*.5}];function Pb(e){const{dimensions:t,orientation:n,origin:s,offset:r}={...Qr,...e};return class extends dm{get dimensions(){return X1(t,n)}get orientation(){return n}get origin(){return Z1(s,this)}get offset(){return r}}}function nP(e,t){if(Fl(e)&&Fl(t))return e.col===t.col&&e.row===t.row;if(Object.hasOwn(e,"col")||Object.hasOwn(t,"col"))throw new Error(`Can't compare coordinates where one are offset coordinates. Either pass two offset coordinates or two axial/cube coordinates. Received: ${JSON.stringify(e)} and ${JSON.stringify(t)}`);const n=Dd(e)?Md(e):e,s=Dd(t)?Md(t):t;return n.q===s.q&&n.r===s.r}const aP=(e,t,n)=>({col:e+hc(n,t),row:t}),sP=(e,t,n)=>({col:e,row:t+hc(n,e)}),zf=({q:e,r:t,offset:n,isPointy:s})=>s?aP(e,t,n):sP(e,t,n),Hf=({orientation:e,dimensions:{xRadius:t,yRadius:n},origin:{x:s,y:r},q:i,r:o})=>e===jn.POINTY?{x:t*Math.sqrt(3)*(i+o/2)-s,y:n*3/2*o-r}:{x:t*3/2*i-s,y:n*Math.sqrt(3)*(o+i/2)-r},Tb=(e,t,n)=>{const s=e-hc(n,t),r=t,i=-s-r;return{q:s,r,s:i}},Rb=(e,t,n)=>{const s=e,r=t-hc(n,e),i=-s-r;return{q:s,r,s:i}},Db=({offset:e,orientation:t},{col:n,row:s})=>t===jn.POINTY?Tb(n,s,e):Rb(n,s,e),Ld=e=>{const{q:t,r:n,s}=ql(e);let r=Math.round(t),i=Math.round(n),o=Math.round(s);const l=Math.abs(t-r),c=Math.abs(n-i),u=Math.abs(s-o);return l>c&&l>u?r=-i-o:c>u?i=-r-o:o=-r-i,{q:r,r:i,s:o}},rP=({dimensions:{xRadius:e,yRadius:t},origin:n,orientation:s},{x:r,y:i})=>(r+=n.x,i+=n.y,s===jn.POINTY?Ld({q:Math.sqrt(3)*r/(3*e)-i/(3*t),r:2/3*(i/t)}):Ld({q:2/3*(r/e),r:Math.sqrt(3)*i/(3*t)-r/(3*e)}));function Ul(e,t){return Dd(t)?Md(t):Fl(t)?Db(e,t):ql(t)}function iP(e,t){const{q:n,r:s,s:r}=ql(e),{q:i,r:o,s:l}=ql(t),c={q:n+i,r:s+o,s:r+l};return e instanceof dm?e.clone(c):c}function Od(e,t,n){const{q:s,r,s:i}=Ul(e,t),{q:o,r:l,s:c}=Ul(e,n);return Math.max(Math.abs(s-o),Math.abs(r-l),Math.abs(i-c))}var pn=(e=>(e[e.N=0]="N",e[e.NE=1]="NE",e[e.E=2]="E",e[e.SE=3]="SE",e[e.S=4]="S",e[e.SW=5]="SW",e[e.W=6]="W",e[e.NW=7]="NW",e))(pn||{});const oP=[null,{q:1,r:-1},{q:1,r:0},{q:0,r:1},null,{q:-1,r:1},{q:-1,r:0},{q:0,r:-1}],lP=[{q:0,r:-1},{q:1,r:-1},null,{q:1,r:0},{q:0,r:1},{q:-1,r:1},null,{q:-1,r:0}],cP=({offset:e,q:t,r:n,col:s,row:r},i)=>{if(i===pn.S||i===pn.N){const l=i===pn.S?r+1:r-1;return Tb(s,l,e)}const o=oP[i];return{q:t+o.q,r:n+o.r}},uP=({offset:e,q:t,r:n,col:s,row:r},i)=>{if(i===pn.E||i===pn.W){const l=i===pn.E?s+1:s-1;return Rb(l,r,e)}const o=lP[i];return{q:t+o.q,r:n+o.r}},$d=(e,t)=>e.clone(e.isPointy?cP(e,t):uP(e,t));function Bd(e){return Array.isArray(e)?function(t,n){const s=[];let r=n;for(const i of e)for(const o of i(t,r))s.push(r=o);return s}:e}function Yf(e){return dP(e)?hP(e):mP(e)}function dP(e){return e.direction in pn}function hP({start:e,direction:t,length:n}){return function(s,r){const i=[];let o=s(e??r);!e&&r&&(o=$d(o,t));for(let l=0;l<n;l++)i.push(o),o=$d(o,t);return i}}function mP({start:e,stop:t}){return function(n,s){const r=[],i=n(e??s),o=Vf(i),l=Vf(Ul(i,t)),c=pP(o,l),u=Od(i,i,t),d=1/Math.max(u,1);let h=!e&&s?1:0;for(h;h<=u;h++){const m=Ld(c(d*h));r.push(n(m))}return r}}function Vf({q:e,r:t,s:n}){return{q:e+1e-6,r:t+1e-6,s:n+-2e-6}}function pP(e,t){return n=>{const s=e.q*(1-n)+t.q*n,r=e.r*(1-n)+t.r*n;return{q:s,r}}}function fP(e,t,{includeSource:n=!0}={}){return function(s,r){const i=[];for(const o of Bd(e)(s,r)){n&&i.push(o);for(const l of Bd(t)(s,o))i.push(l)}return i}}function gP(e,t){return function(n,s){const{width:r,height:i,start:o,direction:l=pn.E}=e,c=o??s??[0,0],u=fP(Yf({start:c,direction:Q1(l,2),length:i}),Yf({direction:l,length:r-1}))(n,c);return!o&&s?u.slice(1):u}}pn.E,pn.N,pn.S,pn.W;var wn,Fa,Wt,Xr,qd,Ud,Wd;const da=class da{constructor(t,n=[]){so(this,Wt);so(this,wn);so(this,Fa,new Map);if(t instanceof da){_c(this,wn,ln(t,wn)),this.setHexes(t);return}_c(this,wn,t),this.setHexes(Rn(this,Wt,qd).call(this,n))}static fromIterable(t){const n=t[Symbol.iterator]().next().value;if(!n)throw new TypeError(`Can't create grid from empty iterable: ${JSON.stringify(t)}`);return new da(n.constructor,t)}static fromJSON({hexSettings:t,coordinates:n},s){if(s){const i=n.map(s),o=i.length>0?i[0].constructor:s({q:0,r:0},0,[{q:0,r:0}]).constructor;return new da(o,i)}const r=Pb(t);return new da(r,n.map(i=>new r(i)))}get size(){return ln(this,Fa).size}get pixelWidth(){if(this.size===0)return 0;const{isPointy:t,width:n}=this.hexPrototype,s=this.toArray(),{0:r,length:i,[i-1]:o}=t?s.sort((l,c)=>c.s-l.s||l.q-c.q):s.sort((l,c)=>l.q-c.q);return o.x-r.x+n}get pixelHeight(){if(this.size===0)return 0;const{isPointy:t,height:n}=this.hexPrototype,s=this.toArray(),{0:r,length:i,[i-1]:o}=t?s.sort((l,c)=>l.r-c.r):s.sort((l,c)=>c.s-l.s||l.r-c.r);return o.y-r.y+n}[Symbol.iterator](){return ln(this,Fa).values()}get hexPrototype(){return ln(this,wn).prototype}createHex(t){return new(ln(this,wn))(t)}getHex(t){const n=this.createHex(t);return ln(this,Fa).get(n.toString())}hasHex(t){return ln(this,Fa).has(t.toString())}setHexes(t){for(const n of t){const s=n instanceof dm?n:new(ln(this,wn))(n);Rn(this,Wt,Xr).call(this,s)}return this}filter(t){var s;const n=new da(ln(this,wn));for(const r of this)t(r)&&Rn(s=n,Wt,Xr).call(s,r);return n}map(t){var s;const n=new da(ln(this,wn));for(const r of this)Rn(s=n,Wt,Xr).call(s,t(r));return n}traverse(t,{bail:n=!1}={}){var r;const s=new da(ln(this,wn));for(const i of Rn(this,Wt,qd).call(this,t)){const o=this.getHex(i);if(o)Rn(r=s,Wt,Xr).call(r,o);else if(n)return s}return s}forEach(t){for(const n of this)t(n);return this}reduce(t,n){if(n===void 0){let r,i,o;for(const l of this)i=o,o=l,i&&(r=t(i,o));return r}let s=n;for(const r of this)s=t(s,r);return s}toArray(){return Array.from(this)}toJSON(){const{dimensions:t,orientation:n,origin:s,offset:r}=this.hexPrototype;return{hexSettings:{dimensions:t,orientation:n,origin:s,offset:r},coordinates:this.toArray()}}toString(){return`${this.constructor.name}(${this.size})`}pointToHex(t,{allowOutside:n=!0}={}){const s=rP(this.hexPrototype,t),r=this.getHex(s);return n?r??this.createHex(s):r}distance(t,n,{allowOutside:s=!0}={}){if(s)return Od(this.hexPrototype,t,n);const r=this.getHex(t),i=this.getHex(n);if(!(!r||!i))return Od(this.hexPrototype,r,i)}neighborOf(t,n,{allowOutside:s=!0}={}){const r=$d(this.createHex(t),n),i=this.getHex(r);return s?i??r:i}};wn=new WeakMap,Fa=new WeakMap,Wt=new WeakSet,Xr=function(t){ln(this,Fa).set(t.toString(),t)},qd=function(t){return Rn(this,Wt,Ud).call(this,t)?Rn(this,Wt,Wd).call(this,t):Array.isArray(t)&&Rn(this,Wt,Ud).call(this,t[0])?Rn(this,Wt,Wd).call(this,Bd(t)):t},Ud=function(t){return K1(t)},Wd=function(t){return t(this.createHex.bind(this))};let Fd=da;const Kf={normal:{fill:"rgba(51, 65, 85, 0.6)",stroke:"rgba(100, 116, 139, 0.8)"},difficult:{fill:"rgba(120, 53, 15, 0.7)",stroke:"rgba(180, 83, 9, 0.8)"},hazard:{fill:"rgba(127, 29, 29, 0.7)",stroke:"rgba(185, 28, 28, 0.8)"},water:{fill:"rgba(30, 58, 138, 0.7)",stroke:"rgba(59, 130, 246, 0.8)"},impassable:{fill:"rgba(17, 24, 39, 0.9)",stroke:"rgba(55, 65, 81, 0.8)"}};function yP({points:e,terrainType:t="normal",isMovementTarget:n=!1,isAttackTarget:s=!1,isPathHex:r=!1,isSelected:i=!1,isCurrentTurn:o=!1,isOccupied:l=!1}){const c=Kf[t]||Kf.normal;let u=c.fill,d=c.stroke,h=1;return i?(d="rgba(250, 204, 21, 0.9)",h=3):o&&(d="rgba(34, 197, 94, 0.9)",h=2),n&&!l&&(u="rgba(59, 130, 246, 0.4)",i||(d="rgba(59, 130, 246, 0.7)")),s&&(u="rgba(239, 68, 68, 0.4)",i||(d="rgba(239, 68, 68, 0.7)")),r&&(u="rgba(34, 197, 94, 0.5)"),a.jsxs("g",{className:"hex-cell",children:[a.jsx("polygon",{points:e,fill:u,stroke:d,strokeWidth:h,className:"transition-colors duration-150 hover:brightness-110"}),t==="hazard"&&a.jsx("text",{x:"0",y:"0",textAnchor:"middle",dominantBaseline:"middle",className:"text-xs fill-red-400 font-bold pointer-events-none select-none",style:{fontSize:"10px"},children:""}),t==="impassable"&&a.jsx("line",{x1:"-12",y1:"-12",x2:"12",y2:"12",stroke:"rgba(127, 29, 29, 0.8)",strokeWidth:"2",className:"pointer-events-none"})]})}const Gf={ally:{fill:"rgba(34, 197, 94, 0.9)",stroke:"rgba(22, 163, 74, 1)",text:"#ffffff"},enemy:{fill:"rgba(239, 68, 68, 0.9)",stroke:"rgba(220, 38, 38, 1)",text:"#ffffff"},neutral:{fill:"rgba(234, 179, 8, 0.9)",stroke:"rgba(202, 138, 4, 1)",text:"#000000"}},Jf={minion:14,full:18,lieutenant:22,hero:26};function vP({entity:e,isSelected:t=!1,isCurrentTurn:n=!1,isControlled:s=!1,onClick:r}){const i=Gf[e.faction]||Gf.ally,o=Jf[e.tier]||Jf.full,l=e.energy?Math.max(0,Math.min(100,e.energy.current/e.energy.max*100)):100;e.ap&&Math.max(0,Math.min(100,e.ap.current/e.ap.max*100));const c=(e.displayName||e.name).charAt(0).toUpperCase(),u=e.unconscious,d=e.alive===!1,h=!!e.channeling,m=e.wounds?Object.values(e.wounds).reduce((y,b)=>y+(b||0),0):0;return a.jsxs("g",{className:`entity-marker cursor-pointer transition-transform duration-150 ${s?"hover:scale-110":""}`,onClick:r,children:[t&&a.jsx("circle",{r:o+6,fill:"none",stroke:"rgba(250, 204, 21, 0.9)",strokeWidth:"3",strokeDasharray:"4 2",className:"animate-pulse"}),n&&!t&&a.jsx("circle",{r:o+4,fill:"none",stroke:"rgba(34, 197, 94, 0.8)",strokeWidth:"2"}),a.jsx("circle",{r:o,fill:d?"rgba(55, 65, 81, 0.9)":i.fill,stroke:d?"rgba(31, 41, 55, 1)":i.stroke,strokeWidth:"2",opacity:u?.5:1}),a.jsx("text",{x:"0",y:"1",textAnchor:"middle",dominantBaseline:"middle",fill:i.text,className:"font-bold pointer-events-none select-none",style:{fontSize:`${o*.8}px`},opacity:d?.5:1,children:d?"":c}),e.tier!=="minion"&&!d&&a.jsxs("g",{transform:`translate(-${o}, ${o+4})`,children:[a.jsx("rect",{width:o*2,height:"4",fill:"rgba(31, 41, 55, 0.8)",rx:"2"}),a.jsx("rect",{width:o*2*l/100,height:"4",fill:l>50?"rgba(34, 197, 94, 0.9)":l>25?"rgba(250, 204, 21, 0.9)":"rgba(239, 68, 68, 0.9)",rx:"2"})]}),e.tier!=="minion"&&e.ap&&!d&&a.jsx("g",{transform:`translate(-${o}, ${o+10})`,children:Array.from({length:Math.min(e.ap.max,10)}).map((y,b)=>a.jsx("circle",{cx:3+b*4,cy:"2",r:"1.5",fill:b<e.ap.current?"rgba(96, 165, 250, 0.9)":"rgba(55, 65, 81, 0.6)"},b))}),h&&a.jsxs("g",{transform:`translate(${o-4}, -${o-4})`,children:[a.jsx("circle",{r:"6",fill:"rgba(168, 85, 247, 0.9)",stroke:"rgba(147, 51, 234, 1)",strokeWidth:"1"}),a.jsx("text",{x:"0",y:"1",textAnchor:"middle",dominantBaseline:"middle",fill:"#ffffff",style:{fontSize:"8px"},className:"font-bold pointer-events-none select-none",children:""})]}),m>0&&!d&&a.jsxs("g",{transform:`translate(-${o-4}, -${o-4})`,children:[a.jsx("circle",{r:"6",fill:"rgba(185, 28, 28, 0.9)",stroke:"rgba(127, 29, 29, 1)",strokeWidth:"1"}),a.jsx("text",{x:"0",y:"1",textAnchor:"middle",dominantBaseline:"middle",fill:"#ffffff",style:{fontSize:"8px"},className:"font-bold pointer-events-none select-none",children:m>9?"9+":m})]}),u&&!d&&a.jsx("g",{transform:`translate(0, -${o+8})`,children:a.jsx("text",{x:"0",y:"0",textAnchor:"middle",dominantBaseline:"middle",fill:"rgba(250, 204, 21, 0.9)",style:{fontSize:"12px"},className:"pointer-events-none select-none",children:""})}),s&&!d&&a.jsx("polygon",{points:"0,-3 3,0 0,3 -3,0",fill:"rgba(96, 165, 250, 0.9)",stroke:"rgba(59, 130, 246, 1)",strokeWidth:"0.5",transform:`translate(${o-2}, ${o-2})`})]})}const Ln=40,bP=Pb({dimensions:Ln,orientation:jn.POINTY,origin:"topLeft"});function Qf(e,t){return`${e},${t}`}function _P(e){const t=[];for(let n=0;n<6;n++){const s=Math.PI/180*(60*n-30),r=e*Math.cos(s),i=e*Math.sin(s);t.push(`${r},${i}`)}return t.join(" ")}function Xf(e,t,n){const s=n*(Math.sqrt(3)*e+Math.sqrt(3)/2*t),r=n*(3/2*t);return{x:s,y:r}}function Mb({width:e=15,height:t=10,terrain:n={},movementRange:s,attackRange:r,movementPath:i,onHexClick:o,onHexHover:l,onEntityClick:c,className:u=""}){const{state:d,getEntity:h,getEntityPosition:m,canControlEntity:y}=ra(),{entities:b,hexPositions:_,selectedEntityId:w,currentEntityId:f}=d,p=T.useMemo(()=>new Fd(bP,gP({width:e,height:t})),[e,t]),g=T.useMemo(()=>_P(Ln),[]),j=T.useMemo(()=>{const M=Ln*2,O=Ln*Math.sqrt(3)*e+Ln,X=Ln*1.5*t+Ln;return`-${M} -${M} ${O+M*2} ${X+M*2}`},[e,t]),A=T.useMemo(()=>!i||i.length<2?null:`M ${i.map(O=>{const X=Xf(O.q,O.r,Ln);return`${X.x},${X.y}`}).join(" L ")}`,[i]),R=T.useCallback((M,O)=>{o==null||o({q:M,r:O})},[o]),S=T.useCallback((M,O,X)=>{l==null||l(X?{q:M,r:O}:null)},[l]),k=T.useCallback((M,O)=>{O.stopPropagation(),c==null||c(M)},[c]),N=T.useMemo(()=>{const M=new Map;for(const[O,X]of Object.entries(_))M.set(Qf(X.q,X.r),O);return M},[_]),E=T.useMemo(()=>{const M=[];for(const O of p){const X=Qf(O.q,O.r),re=Xf(O.q,O.r,Ln),I=n[X],$=N.get(X),L=$?b[$]:void 0,D=(s==null?void 0:s.has(X))??!1,F=(r==null?void 0:r.has(X))??!1,q=(i==null?void 0:i.some(B=>B.q===O.q&&B.r===O.r))??!1,V=w&&$===w,Q=$===f,te=$?y($):!1;M.push(a.jsxs("g",{transform:`translate(${re.x}, ${re.y})`,onClick:()=>R(O.q,O.r),onMouseEnter:()=>S(O.q,O.r,!0),onMouseLeave:()=>S(O.q,O.r,!1),className:"cursor-pointer",children:[a.jsx(yP,{points:g,terrainType:I==null?void 0:I.type,isMovementTarget:D,isAttackTarget:F,isPathHex:q,isSelected:!!V,isCurrentTurn:!!Q,isOccupied:!!$}),L&&a.jsx(vP,{entity:L,isSelected:!!V,isCurrentTurn:!!Q,isControlled:te,onClick:B=>k(L.id,B)})]},X))}return M},[p,g,n,N,b,s,r,i,w,f,y,R,S,k]);return a.jsx("div",{className:`relative overflow-auto ${u}`,children:a.jsxs("svg",{viewBox:j,className:"w-full h-full min-w-[800px] min-h-[600px]",style:{background:"transparent"},children:[a.jsx("defs",{children:a.jsx("pattern",{id:"hex-grid-pattern",width:Ln*Math.sqrt(3),height:Ln*3,patternUnits:"userSpaceOnUse",children:a.jsx("rect",{width:"100%",height:"100%",fill:"transparent"})})}),A&&a.jsx("path",{d:A,fill:"none",stroke:"var(--color-primary, #3b82f6)",strokeWidth:"3",strokeDasharray:"8 4",strokeLinecap:"round",strokeLinejoin:"round",opacity:"0.7"}),a.jsx("g",{className:"hex-grid",children:E})]})})}const fu={blunt:{label:"Blunt Trauma",shortLabel:"Blunt",icon:"",color:"text-stone-300",bgColor:"bg-stone-800",penalty:"-1 Physical per wound"},burn:{label:"Burn",shortLabel:"Burn",icon:"",color:"text-orange-400",bgColor:"bg-orange-900/50",penalty:"-1 to all actions per wound"},freeze:{label:"Frostbite",shortLabel:"Freeze",icon:"",color:"text-cyan-300",bgColor:"bg-cyan-900/50",penalty:"-1 Movement per wound"},laceration:{label:"Laceration",shortLabel:"Slash",icon:"",color:"text-red-400",bgColor:"bg-red-900/50",penalty:"Bleeding: -5 Energy/turn per wound"},mental:{label:"Mental Trauma",shortLabel:"Mental",icon:"",color:"text-purple-400",bgColor:"bg-purple-900/50",penalty:"-1 Mental per wound"},necrosis:{label:"Necrosis",shortLabel:"Decay",icon:"",color:"text-green-400",bgColor:"bg-green-900/50",penalty:"-10 Max Energy per wound"},holy_spiritual:{label:"Holy Rending",shortLabel:"Holy",icon:"",color:"text-yellow-300",bgColor:"bg-yellow-900/50",penalty:"Rended (Holy): -10 Energy/turn"},unholy_spiritual:{label:"Unholy Rending",shortLabel:"Unholy",icon:"",color:"text-violet-400",bgColor:"bg-violet-900/50",penalty:"Rended (Unholy): -10 Energy/turn"}},Zf=["blunt","burn","freeze","laceration","mental","necrosis","holy_spiritual","unholy_spiritual"];function Lb({wounds:e,compact:t=!1,showPenalties:n=!1,onWoundChange:s,editable:r=!1}){const i=Zf.filter(l=>(e[l]||0)>0),o=Object.values(e).reduce((l,c)=>l+(c||0),0);return t?o===0?a.jsx("span",{className:"text-xs text-slate-500 italic",children:"No wounds"}):a.jsx("div",{className:"flex flex-wrap gap-1",children:i.map(l=>{const c=fu[l],u=e[l]||0;return a.jsxs("span",{className:`inline-flex items-center gap-0.5 px-1.5 py-0.5 rounded text-xs ${c.bgColor} ${c.color}`,title:`${c.label}: ${u} (${c.penalty})`,children:[a.jsx("span",{children:c.icon}),a.jsx("span",{className:"font-medium",children:u})]},l)})}):a.jsxs("div",{className:"space-y-1",children:[a.jsx("div",{className:"flex items-center justify-between mb-2",children:a.jsxs("h4",{className:"text-sm font-semibold text-slate-300",children:["Wounds",o>0&&a.jsxs("span",{className:"ml-2 text-red-400",children:["(",o," total)"]})]})}),a.jsx("div",{className:"grid grid-cols-2 gap-1",children:Zf.map(l=>{const c=fu[l],u=e[l]||0,d=u>0;return a.jsxs("div",{className:`flex items-center gap-2 px-2 py-1 rounded transition-colors ${d?`${c.bgColor} ${c.color}`:"bg-slate-800/50 text-slate-500"}`,children:[a.jsx("span",{className:"text-sm",children:c.icon}),a.jsx("span",{className:"flex-1 text-xs font-medium truncate",children:c.shortLabel}),r&&s?a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("button",{onClick:()=>s(l,-1),disabled:u===0,className:"w-5 h-5 flex items-center justify-center rounded bg-slate-700 hover:bg-slate-600 disabled:opacity-30 disabled:cursor-not-allowed text-xs",children:"-"}),a.jsx("span",{className:"w-4 text-center text-xs font-bold",children:u}),a.jsx("button",{onClick:()=>s(l,1),className:"w-5 h-5 flex items-center justify-center rounded bg-slate-700 hover:bg-slate-600 text-xs",children:"+"})]}):a.jsx("span",{className:`text-sm font-bold ${d?"text-white":"text-slate-600"}`,children:u})]},l)})}),n&&o>0&&a.jsxs("div",{className:"mt-2 pt-2 border-t border-slate-700",children:[a.jsx("h5",{className:"text-xs font-semibold text-slate-400 mb-1",children:"Active Penalties"}),a.jsx("ul",{className:"space-y-0.5",children:i.map(l=>{const c=fu[l],u=e[l]||0;return a.jsxs("li",{className:`text-xs ${c.color} flex items-center gap-1`,children:[a.jsx("span",{children:c.icon}),a.jsx("span",{children:c.penalty.replace("per wound",`(${u})`)})]},l)})})]})]})}function xP({current:e,max:t,color:n,label:s,showNumbers:r=!0}){const i=Math.max(0,Math.min(100,e/t*100));return a.jsxs("div",{className:"space-y-0.5",children:[a.jsxs("div",{className:"flex justify-between text-xs",children:[a.jsx("span",{className:"text-slate-400",children:s}),r&&a.jsxs("span",{className:"text-slate-300 font-medium",children:[e,"/",t]})]}),a.jsx("div",{className:"h-2 bg-slate-700 rounded-full overflow-hidden",children:a.jsx("div",{className:`h-full ${n} transition-all duration-300`,style:{width:`${i}%`}})})]})}function wP({current:e,max:t}){return a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs text-slate-400",children:"AP:"}),a.jsx("div",{className:"flex gap-0.5",children:Array.from({length:t}).map((n,s)=>a.jsx("div",{className:`w-2.5 h-2.5 rounded-sm ${s<e?"bg-blue-400":"bg-slate-700"}`},s))}),a.jsxs("span",{className:"text-xs text-slate-500 ml-1",children:[e,"/",t]})]})}function kP({spellName:e,progress:t,energyChanneled:n,apChanneled:s,totalCost:r}){const i=Math.min(100,t*100),o=i>=100;return a.jsxs("div",{className:"mt-2 p-2 bg-purple-900/30 border border-purple-700/50 rounded",children:[a.jsxs("div",{className:"flex items-center justify-between mb-1",children:[a.jsxs("span",{className:"text-xs font-medium text-purple-300",children:["Channeling: ",e]}),o&&a.jsx("span",{className:"text-xs font-bold text-green-400",children:"READY!"})]}),a.jsx("div",{className:"h-2 bg-purple-900/50 rounded-full overflow-hidden mb-1",children:a.jsx("div",{className:`h-full ${o?"bg-green-400":"bg-purple-400"} transition-all duration-300`,style:{width:`${i}%`}})}),a.jsxs("div",{className:"flex justify-between text-xs text-purple-400",children:[a.jsxs("span",{children:["Energy: ",n,"/",r]}),a.jsxs("span",{children:["AP: ",s,"/",r]})]})]})}function zd({entity:e,isSelected:t=!1,isCurrentTurn:n=!1,isControlled:s=!1,showDetails:r=!1,onClick:i,onTargetClick:o}){const l=e.alive===!1,c=e.unconscious,u=e.tier==="minion",d={ally:{border:t?"border-yellow-400":n?"border-green-500":"border-green-700/50",bg:"bg-green-900/20",badge:"bg-green-700 text-green-100"},enemy:{border:t?"border-yellow-400":n?"border-red-500":"border-red-700/50",bg:"bg-red-900/20",badge:"bg-red-700 text-red-100"},neutral:{border:t?"border-yellow-400":n?"border-yellow-500":"border-yellow-700/50",bg:"bg-yellow-900/20",badge:"bg-yellow-700 text-yellow-100"}},h=d[e.faction]||d.ally,m=e.wounds?Object.values(e.wounds).reduce((y,b)=>y+(b||0),0):0;return a.jsxs("div",{className:`rounded-lg border-2 ${h.border} ${h.bg} transition-all duration-200 ${i?"cursor-pointer hover:brightness-110":""} ${l?"opacity-50":""}`,onClick:i,children:[a.jsxs("div",{className:"flex items-center justify-between p-2 border-b border-slate-700/50",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[n&&a.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400 animate-pulse"}),a.jsx("h3",{className:`font-semibold ${l?"text-slate-500 line-through":c?"text-slate-400":"text-slate-100"}`,children:e.displayName||e.name}),l&&a.jsx("span",{className:"px-1.5 py-0.5 text-xs rounded bg-slate-700 text-slate-400",children:"Dead"}),c&&!l&&a.jsx("span",{className:"px-1.5 py-0.5 text-xs rounded bg-amber-700 text-amber-100",children:"Unconscious"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:`px-1.5 py-0.5 text-xs rounded capitalize ${e.tier==="hero"?"bg-purple-700 text-purple-100":e.tier==="lieutenant"?"bg-amber-700 text-amber-100":e.tier==="minion"?"bg-slate-600 text-slate-300":"bg-slate-700 text-slate-300"}`,children:e.tier}),a.jsx("span",{className:`px-1.5 py-0.5 text-xs rounded capitalize ${h.badge}`,children:e.faction}),o&&!l&&a.jsx("button",{onClick:y=>{y.stopPropagation(),o()},className:"p-1 rounded bg-red-700 hover:bg-red-600 text-red-100 text-xs",title:"Set as target",children:""})]})]}),a.jsxs("div",{className:"p-2 space-y-2",children:[!u&&e.energy&&a.jsx(xP,{current:e.energy.current,max:e.energy.max,color:e.energy.current>e.energy.max*.5?"bg-green-500":e.energy.current>e.energy.max*.25?"bg-yellow-500":"bg-red-500",label:"Energy"}),!u&&e.ap&&a.jsx(wP,{current:e.ap.current,max:e.ap.max}),u&&a.jsx("div",{className:"text-xs text-slate-400",children:"Minion - Defeated on threshold damage"}),e.channeling&&a.jsx(kP,{...e.channeling}),r&&a.jsxs("div",{className:"space-y-1 text-xs",children:[e.immunities&&e.immunities.length>0&&a.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.jsx("span",{className:"text-slate-500",children:"Immune:"}),e.immunities.map(y=>a.jsx("span",{className:"px-1 py-0.5 rounded bg-blue-900/50 text-blue-300",children:y},y))]}),e.resistances&&e.resistances.length>0&&a.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.jsx("span",{className:"text-slate-500",children:"Resist:"}),e.resistances.map(y=>a.jsx("span",{className:"px-1 py-0.5 rounded bg-slate-700 text-slate-300",children:y},y))]}),e.weaknesses&&e.weaknesses.length>0&&a.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.jsx("span",{className:"text-slate-500",children:"Weak:"}),e.weaknesses.map(y=>a.jsx("span",{className:"px-1 py-0.5 rounded bg-red-900/50 text-red-300",children:y},y))]})]}),!u&&m>0&&a.jsx("div",{className:"pt-1 border-t border-slate-700/50",children:a.jsx(Lb,{wounds:e.wounds,compact:!r,showPenalties:r})})]}),s&&a.jsx("div",{className:"px-2 py-1 bg-blue-900/30 border-t border-blue-700/50 text-xs text-blue-300 text-center",children:"You control this entity"})]})}function NP({entityId:e,availableAP:t,physicalAttribute:n,onComplete:s}){const{actions:r,getEntityPosition:i}=ra(),[o,l]=T.useState(null),[c,u]=T.useState([]),d=i(e),h=Math.max(n,3),m=t*h,y=T.useCallback((p,g)=>(Math.abs(p.q-g.q)+Math.abs(p.q+p.r-g.q-g.r)+Math.abs(p.r-g.r))/2,[]),b=T.useCallback(p=>Math.ceil(p/h),[h]);T.useCallback(p=>{if(!d)return;const g=y(d,p);b(g)<=t&&(l(p),u([d,p]))},[d,t,y,b]);const _=T.useCallback(()=>{o&&(r.declareMovement(e,o.q,o.r,c),s==null||s())},[r,e,o,c,s]),w=o&&d?y(d,o):0,f=b(w);return a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"text-sm text-slate-300",children:[a.jsx("p",{children:"Click a hex on the grid to move."}),a.jsxs("p",{className:"text-slate-400 mt-1",children:["Movement: ",h," hexes per AP (",m," max hexes with ",t," AP)"]})]}),o&&a.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-700/50 rounded",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"text-sm text-slate-300",children:["Target: (",o.q,", ",o.r,")"]}),a.jsxs("div",{className:"text-sm",children:[a.jsx("span",{className:"text-slate-400",children:"Distance: "}),a.jsxs("span",{className:"text-blue-400",children:[w," hexes"]}),a.jsx("span",{className:"text-slate-500 mx-2",children:""}),a.jsx("span",{className:"text-slate-400",children:"Cost: "}),a.jsxs("span",{className:f<=t?"text-green-400":"text-red-400",children:[f," AP"]})]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>{l(null),u([])},className:"px-3 py-1 text-sm rounded bg-slate-600 hover:bg-slate-500 text-slate-100 transition-colors",children:"Clear"}),a.jsx("button",{onClick:_,disabled:f>t,className:"px-3 py-1 text-sm rounded bg-blue-600 hover:bg-blue-500 disabled:bg-slate-700 disabled:text-slate-500 text-blue-100 transition-colors",children:"Confirm Move"})]})]}),a.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx("span",{className:"text-slate-400",children:"Manual:"}),a.jsx("input",{type:"number",placeholder:"Q",className:"w-16 px-2 py-1 rounded bg-slate-700 border border-slate-600 text-slate-200 text-center",onChange:p=>{const g=parseInt(p.target.value)||0;l(j=>({q:g,r:(j==null?void 0:j.r)??0}))}}),a.jsx("input",{type:"number",placeholder:"R",className:"w-16 px-2 py-1 rounded bg-slate-700 border border-slate-600 text-slate-200 text-center",onChange:p=>{const g=parseInt(p.target.value)||0;l(j=>({q:(j==null?void 0:j.q)??0,r:g}))}})]})]})}const jP={small_blades:"Small Blades (Dagger, Knife)",medium_blades:"Medium Blades (Sword, Scimitar)",large_blades:"Large Blades (Greatsword, Claymore)",small_bearded:"Small Bearded (Hatchet)",large_bearded:"Large Bearded (Battleaxe)",polearms:"Polearms (Spear, Halberd)",long_ranged:"Long Ranged (Bow, Crossbow)",thrown:"Thrown (Javelin, Throwing Knife)",small_blunt:"Small Blunt (Club, Mace)",large_blunt:"Large Blunt (Warhammer, Maul)",flexible:"Flexible (Whip, Flail)",unarmed:"Unarmed"};function SP({entityId:e,availableAP:t,availableEnergy:n,selectedWeapon:s,onWeaponChange:r,onComplete:i}){var j,A,R,S,k;const{state:o,actions:l,getEntityPosition:c}=ra(),[u,d]=T.useState(null),[h,m]=T.useState(10),y=gu[s],b=c(e),_=t>=y.ap&&n>=y.energy,w=T.useMemo(()=>b?Object.entries(o.entities).filter(([N,E])=>{if(N===e||E.alive===!1)return!1;const M=o.hexPositions[N];if(!M)return!1;const O=(Math.abs(b.q-M.q)+Math.abs(b.q+b.r-M.q-M.r)+Math.abs(b.r-M.r))/2;return O>=y.minRange&&O<=y.maxRange}).map(([N,E])=>({...E,id:N})):[],[o.entities,o.hexPositions,e,b,y]),f=u?o.entities[u]:null,p=T.useMemo(()=>{if(!u||!b)return null;const N=o.hexPositions[u];return N?(Math.abs(b.q-N.q)+Math.abs(b.q+b.r-N.q-N.r)+Math.abs(b.r-N.r))/2:null},[u,b,o.hexPositions]),g=T.useCallback(()=>{!u||!_||(l.declareAttack({attackerId:e,targetId:u,weaponCategory:s,apCost:y.ap,energyCost:y.energy,baseDamage:y.damage,damageType:y.type,attackRoll:h}),i==null||i())},[l,e,u,s,y,h,_,i]);return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm text-slate-400",children:"Weapon Category"}),a.jsx("select",{value:s,onChange:N=>r(N.target.value),className:"w-full px-3 py-2 rounded bg-slate-700 border border-slate-600 text-slate-200",children:Object.keys(gu).map(N=>{const E=gu[N],M=t>=E.ap&&n>=E.energy;return a.jsxs("option",{value:N,disabled:!M,children:[jP[N]," - ",E.damage," dmg (",E.type,")",M?"":" [Not enough resources]"]},N)})})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 p-3 bg-slate-700/50 rounded text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-slate-400",children:"AP Cost: "}),a.jsx("span",{className:t>=y.ap?"text-blue-400":"text-red-400",children:y.ap})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-slate-400",children:"Energy Cost: "}),a.jsx("span",{className:n>=y.energy?"text-green-400":"text-red-400",children:y.energy})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-slate-400",children:"Base Damage: "}),a.jsx("span",{className:"text-red-400",children:y.damage})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-slate-400",children:"Damage Type: "}),a.jsx("span",{className:"text-orange-400 capitalize",children:y.type})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("span",{className:"text-slate-400",children:"Range: "}),a.jsxs("span",{className:"text-cyan-400",children:[y.minRange===y.maxRange?y.minRange:`${y.minRange}-${y.maxRange}`," ","hexes"]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"text-sm text-slate-400",children:["Target (",w.length," in range)"]}),w.length>0?a.jsx("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:w.map(N=>{var E,M;return a.jsxs("button",{onClick:()=>d(N.id),className:`w-full flex items-center justify-between px-3 py-2 rounded transition-colors ${u===N.id?"bg-red-700 text-red-100":"bg-slate-700 hover:bg-slate-600 text-slate-200"}`,children:[a.jsxs("span",{className:"flex items-center gap-2",children:[a.jsx("span",{className:`w-2 h-2 rounded-full ${N.faction==="enemy"?"bg-red-500":"bg-green-500"}`}),a.jsx("span",{children:N.displayName||N.name})]}),a.jsxs("span",{className:"text-xs text-slate-400",children:[N.tier,"  ",((E=N.energy)==null?void 0:E.current)??"?","/",((M=N.energy)==null?void 0:M.max)??"?"," HP"]})]},N.id)})}):a.jsxs("div",{className:"text-sm text-slate-500 italic p-3 bg-slate-700/30 rounded",children:["No valid targets in range (",y.minRange,"-",y.maxRange," hexes)"]})]}),u&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm text-slate-400",children:"Attack Roll Result"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"number",value:h,onChange:N=>m(parseInt(N.target.value)||0),min:1,max:100,className:"w-24 px-3 py-2 rounded bg-slate-700 border border-slate-600 text-slate-200 text-center"}),a.jsx("button",{onClick:()=>m(Math.floor(Math.random()*20)+1),className:"px-3 py-2 rounded bg-slate-600 hover:bg-slate-500 text-slate-200 text-sm",children:"Roll d20"}),a.jsx("span",{className:"text-xs text-slate-500",children:"(Enter your actual roll result)"})]})]}),f&&a.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-700/50 rounded",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"text-sm font-medium text-slate-200",children:["Attacking: ",f.displayName||f.name]}),a.jsxs("div",{className:"text-xs text-slate-400",children:["Distance: ",p," hex",p!==1?"es":"","  HP: ",((j=f.energy)==null?void 0:j.current)??"?","/",((A=f.energy)==null?void 0:A.max)??"?"]}),a.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[((R=f.immunities)==null?void 0:R.includes(y.type))&&a.jsxs("span",{className:"px-1.5 py-0.5 text-xs rounded bg-blue-900/50 text-blue-300",children:["IMMUNE to ",y.type]}),((S=f.resistances)==null?void 0:S.includes(y.type))&&a.jsxs("span",{className:"px-1.5 py-0.5 text-xs rounded bg-slate-600 text-slate-300",children:["Resistant to ",y.type," ( dmg)"]}),((k=f.weaknesses)==null?void 0:k.includes(y.type))&&a.jsxs("span",{className:"px-1.5 py-0.5 text-xs rounded bg-red-900/50 text-red-300",children:["Weak to ",y.type," (2 dmg)"]})]})]}),a.jsx("button",{onClick:g,disabled:!_,className:"px-4 py-2 rounded bg-red-600 hover:bg-red-500 disabled:bg-slate-700 disabled:text-slate-500 text-red-100 font-medium transition-colors",children:"Attack!"})]})]})}const gu={small_blades:{energy:1,ap:1,damage:3,minRange:0,maxRange:1,type:"laceration"},medium_blades:{energy:2,ap:2,damage:7,minRange:1,maxRange:1,type:"laceration"},large_blades:{energy:3,ap:3,damage:12,minRange:1,maxRange:2,type:"laceration"},small_bearded:{energy:1,ap:1,damage:3,minRange:1,maxRange:1,type:"laceration"},large_bearded:{energy:3,ap:3,damage:12,minRange:1,maxRange:2,type:"laceration"},polearms:{energy:3,ap:3,damage:15,minRange:2,maxRange:3,type:"laceration"},long_ranged:{energy:3,ap:3,damage:15,minRange:1,maxRange:30,type:"laceration"},thrown:{energy:1,ap:1,damage:5,minRange:1,maxRange:5,type:"laceration"},small_blunt:{energy:2,ap:2,damage:7,minRange:0,maxRange:1,type:"blunt"},large_blunt:{energy:3,ap:3,damage:12,minRange:1,maxRange:2,type:"blunt"},flexible:{energy:2,ap:2,damage:5,minRange:1,maxRange:3,type:"blunt"},unarmed:{energy:1,ap:1,damage:2,minRange:0,maxRange:1,type:"blunt"}};function EP({onModeChange:e}){var p,g,j,A;const{state:t,actions:n,isMyTurn:s,getCurrentTurnEntity:r,canControlEntity:i}=ra(),[o,l]=T.useState("none"),[c,u]=T.useState("unarmed"),d=r(),h=s&&d&&!d.unconscious&&d.alive!==!1,m=((p=d==null?void 0:d.ap)==null?void 0:p.current)??0,y=((g=d==null?void 0:d.energy)==null?void 0:g.current)??0,b=T.useCallback(R=>{l(R),e==null||e(R)},[e]),_=T.useCallback(()=>{l("none"),e==null||e("none")},[e]),w=T.useCallback(()=>{d&&n.endTurn(d.id)},[n,d]),f=T.useCallback(()=>{d&&n.delayTurn(d.id)},[n,d]);return h?a.jsxs("div",{className:"bg-slate-800/80 border border-slate-700 rounded-lg overflow-hidden",children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-slate-700/50 border-b border-slate-600",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("span",{className:"font-semibold text-slate-200",children:[d.displayName||d.name,"'s Turn"]}),a.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[a.jsxs("span",{className:"text-blue-400",children:["AP: ",m,"/",((j=d.ap)==null?void 0:j.max)??6]}),a.jsxs("span",{className:"text-green-400",children:["Energy: ",y,"/",((A=d.energy)==null?void 0:A.max)??100]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:f,className:"px-3 py-1 text-sm rounded bg-amber-700 hover:bg-amber-600 text-amber-100 transition-colors",children:"Delay"}),a.jsx("button",{onClick:w,className:"px-3 py-1 text-sm rounded bg-slate-600 hover:bg-slate-500 text-slate-100 transition-colors",children:"End Turn"})]})]}),a.jsx("div",{className:"p-3",children:o==="none"?a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsxs("button",{onClick:()=>b("move"),disabled:m<1,className:"flex items-center gap-2 px-4 py-2 rounded bg-blue-700 hover:bg-blue-600 disabled:bg-slate-700 disabled:text-slate-500 text-blue-100 transition-colors",children:[a.jsx("span",{children:""}),a.jsx("span",{children:"Move"}),a.jsx("span",{className:"text-xs opacity-75",children:"(1+ AP)"})]}),a.jsxs("button",{onClick:()=>b("attack"),disabled:m<1||y<1,className:"flex items-center gap-2 px-4 py-2 rounded bg-red-700 hover:bg-red-600 disabled:bg-slate-700 disabled:text-slate-500 text-red-100 transition-colors",children:[a.jsx("span",{children:""}),a.jsx("span",{children:"Attack"}),a.jsx("span",{className:"text-xs opacity-75",children:"(varies)"})]}),a.jsxs("button",{onClick:()=>b("ability"),disabled:m<1,className:"flex items-center gap-2 px-4 py-2 rounded bg-purple-700 hover:bg-purple-600 disabled:bg-slate-700 disabled:text-slate-500 text-purple-100 transition-colors",children:[a.jsx("span",{children:""}),a.jsx("span",{children:"Ability"})]}),a.jsxs("button",{onClick:()=>b("channel"),disabled:m<1||y<1,className:"flex items-center gap-2 px-4 py-2 rounded bg-violet-700 hover:bg-violet-600 disabled:bg-slate-700 disabled:text-slate-500 text-violet-100 transition-colors",children:[a.jsx("span",{children:""}),a.jsx("span",{children:"Channel"})]}),d.channeling&&a.jsxs(a.Fragment,{children:[a.jsxs("button",{onClick:()=>{d.channeling.progress>=1?b("channel"):n.continueChanneling(d.id,Math.min(y,10),Math.min(m,2))},className:"flex items-center gap-2 px-4 py-2 rounded bg-green-700 hover:bg-green-600 text-green-100 transition-colors",children:[a.jsx("span",{children:""}),a.jsx("span",{children:d.channeling.progress>=1?"Release Spell":"Continue Channeling"})]}),a.jsxs("button",{onClick:()=>n.abortChanneling(d.id),className:"flex items-center gap-2 px-4 py-2 rounded bg-slate-600 hover:bg-slate-500 text-slate-100 transition-colors",children:[a.jsx("span",{children:""}),a.jsx("span",{children:"Abort"})]})]})]}):a.jsxs("div",{className:"space-y-3",children:[a.jsx("button",{onClick:_,className:"flex items-center gap-2 px-3 py-1 text-sm rounded bg-slate-600 hover:bg-slate-500 text-slate-100 transition-colors",children:" Back"}),o==="move"&&a.jsx(NP,{entityId:d.id,availableAP:m,physicalAttribute:3,onComplete:_}),o==="attack"&&a.jsx(SP,{entityId:d.id,availableAP:m,availableEnergy:y,selectedWeapon:c,onWeaponChange:u,onComplete:_}),o==="ability"&&a.jsx("div",{className:"text-slate-400 text-sm",children:"Ability selection coming soon..."}),o==="channel"&&a.jsx("div",{className:"text-slate-400 text-sm",children:"Channeling UI coming soon..."})]})}),t.lastError&&a.jsxs("div",{className:"px-4 py-2 bg-red-900/50 border-t border-red-700 text-red-300 text-sm",children:[t.lastError,a.jsx("button",{onClick:()=>n.clearError(),className:"ml-2 text-red-400 hover:text-red-300",children:""})]})]}):a.jsx("div",{className:"bg-slate-800/80 border border-slate-700 rounded-lg p-4",children:a.jsx("div",{className:"text-center text-slate-400",children:s?d!=null&&d.unconscious?a.jsx("span",{children:"Entity is unconscious"}):(d==null?void 0:d.alive)===!1?a.jsx("span",{children:"Entity is dead"}):a.jsx("span",{children:"Select an entity to act"}):a.jsx("span",{children:"Waiting for your turn..."})})})}const eg=[1,9,27,57,99,153],CP=[{value:"burn",label:"Fire (Burn)",icon:""},{value:"freeze",label:"Ice (Freeze)",icon:""},{value:"mental",label:"Mental",icon:""},{value:"necrosis",label:"Necrotic",icon:""},{value:"holy_spiritual",label:"Holy",icon:""},{value:"unholy_spiritual",label:"Unholy",icon:""}];function Ob({entityId:e,onStartChanneling:t,onReleaseSpell:n}){var X,re,I,$,L,D,F,q;const{state:s,actions:r,getEntity:i,canControlEntity:o}=ra(),l=i(e),[c,u]=T.useState("Fireball"),[d,h]=T.useState("burn"),[m,y]=T.useState(1),[b,_]=T.useState(5),[w,f]=T.useState(2),[p,g]=T.useState(null),j=o(e),A=l==null?void 0:l.channeling,R=!!A,S=T.useMemo(()=>eg[m-1]||eg[0],[m]),k=T.useMemo(()=>Object.entries(s.entities).filter(([V,Q])=>V!==e&&Q.alive!==!1).map(([V,Q])=>({...Q,id:V})),[s.entities,e]),N=T.useCallback(()=>{var ae,le;if(!l)return;const V=((ae=l.energy)==null?void 0:ae.current)??0,Q=((le=l.ap)==null?void 0:le.current)??0,te=Math.min(b,V),B=Math.min(w,Q);r.startChanneling({entityId:e,spellName:c,totalCost:S,damageType:d,intensity:m,initialEnergy:te,initialAP:B}),t==null||t()},[r,e,l,c,S,d,m,b,w,t]),E=T.useCallback((V,Q)=>{var he,ue;if(!l)return;const te=((he=l.energy)==null?void 0:he.current)??0,B=((ue=l.ap)==null?void 0:ue.current)??0,ae=Math.min(V,te),le=Math.min(Q,B);r.continueChanneling(e,ae,le)},[r,e,l]),M=T.useCallback(()=>{r.releaseSpell(e,p??void 0),n==null||n(p??"")},[r,e,p,n]),O=T.useCallback(()=>{r.abortChanneling(e)},[r,e]);if(!l||!j)return null;if(R&&A){const{spellName:V,progress:Q,energyChanneled:te,apChanneled:B,totalCost:ae}=A,le=Q>=1,he=Math.min(100,Q*100);return a.jsxs("div",{className:"bg-purple-900/30 border border-purple-700/50 rounded-lg p-4 space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h3",{className:"text-lg font-semibold text-purple-200",children:[" Channeling: ",V]}),le&&a.jsx("span",{className:"px-2 py-1 text-sm font-bold rounded bg-green-600 text-green-100 animate-pulse",children:"READY TO RELEASE"})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{className:"text-purple-300",children:"Progress"}),a.jsxs("span",{className:"text-purple-200",children:[he.toFixed(0),"%"]})]}),a.jsx("div",{className:"h-4 bg-purple-900/50 rounded-full overflow-hidden",children:a.jsx("div",{className:`h-full transition-all duration-500 ${le?"bg-green-500":"bg-purple-500"}`,style:{width:`${he}%`}})})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[a.jsxs("div",{className:"p-2 bg-purple-900/30 rounded",children:[a.jsx("div",{className:"text-purple-400",children:"Energy Channeled"}),a.jsxs("div",{className:"text-xl font-bold text-purple-200",children:[te," / ",ae]})]}),a.jsxs("div",{className:"p-2 bg-purple-900/30 rounded",children:[a.jsx("div",{className:"text-purple-400",children:"AP Channeled"}),a.jsxs("div",{className:"text-xl font-bold text-purple-200",children:[B," / ",ae]})]})]}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[!le&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>E(5,1),disabled:(((X=l.energy)==null?void 0:X.current)??0)<1||(((re=l.ap)==null?void 0:re.current)??0)<1,className:"px-4 py-2 rounded bg-purple-600 hover:bg-purple-500 disabled:bg-slate-700 disabled:text-slate-500 text-purple-100 transition-colors",children:"Channel +5 Energy, +1 AP"}),a.jsx("button",{onClick:()=>E(10,2),disabled:(((I=l.energy)==null?void 0:I.current)??0)<1||((($=l.ap)==null?void 0:$.current)??0)<1,className:"px-4 py-2 rounded bg-purple-600 hover:bg-purple-500 disabled:bg-slate-700 disabled:text-slate-500 text-purple-100 transition-colors",children:"Channel +10 Energy, +2 AP"})]}),le&&a.jsxs("div",{className:"w-full space-y-2",children:[a.jsx("label",{className:"text-sm text-purple-300",children:"Select Target"}),a.jsxs("select",{value:p??"",onChange:ue=>g(ue.target.value||null),className:"w-full px-3 py-2 rounded bg-slate-700 border border-purple-600 text-slate-200",children:[a.jsx("option",{value:"",children:"No target (area effect)"}),k.map(ue=>a.jsxs("option",{value:ue.id,children:[ue.displayName||ue.name," (",ue.faction,")"]},ue.id))]}),a.jsx("button",{onClick:M,className:"w-full px-4 py-3 rounded bg-green-600 hover:bg-green-500 text-green-100 font-bold text-lg transition-colors",children:" RELEASE SPELL"})]}),a.jsx("button",{onClick:O,className:"px-4 py-2 rounded bg-slate-600 hover:bg-slate-500 text-slate-200 transition-colors",children:"Abort (Lose Progress)"})]}),a.jsx("div",{className:"text-xs text-amber-400 bg-amber-900/30 p-2 rounded",children:" Interruption (damage/stun) causes blowback: you take spell damage!"})]})}return a.jsxs("div",{className:"bg-slate-800/80 border border-slate-700 rounded-lg p-4 space-y-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-200",children:" Start Ildakar Channeling"}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm text-slate-400",children:"Spell Name"}),a.jsx("input",{type:"text",value:c,onChange:V=>u(V.target.value),className:"w-full px-3 py-2 rounded bg-slate-700 border border-slate-600 text-slate-200",placeholder:"Enter spell name..."})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm text-slate-400",children:"Damage Type"}),a.jsx("select",{value:d,onChange:V=>h(V.target.value),className:"w-full px-3 py-2 rounded bg-slate-700 border border-slate-600 text-slate-200",children:CP.map(V=>a.jsxs("option",{value:V.value,children:[V.icon," ",V.label]},V.value))})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm text-slate-400",children:"Intensity Tier (determines total cost)"}),a.jsx("div",{className:"flex items-center gap-2",children:[1,2,3,4,5,6].map(V=>a.jsx("button",{onClick:()=>y(V),className:`w-10 h-10 rounded font-bold transition-colors ${m===V?"bg-purple-600 text-purple-100":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:V},V))}),a.jsxs("div",{className:"text-sm text-purple-400",children:["Total Cost: ",S," Energy & ",S," AP"]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm text-slate-400",children:"Initial Energy"}),a.jsx("input",{type:"number",value:b,onChange:V=>_(Math.max(1,parseInt(V.target.value)||1)),min:1,max:((L=l.energy)==null?void 0:L.current)??1,className:"w-full px-3 py-2 rounded bg-slate-700 border border-slate-600 text-slate-200"})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm text-slate-400",children:"Initial AP"}),a.jsx("input",{type:"number",value:w,onChange:V=>f(Math.max(1,parseInt(V.target.value)||1)),min:1,max:((D=l.ap)==null?void 0:D.current)??1,className:"w-full px-3 py-2 rounded bg-slate-700 border border-slate-600 text-slate-200"})]})]}),a.jsx("button",{onClick:N,disabled:(((F=l.energy)==null?void 0:F.current)??0)<b||(((q=l.ap)==null?void 0:q.current)??0)<w,className:"w-full px-4 py-3 rounded bg-purple-600 hover:bg-purple-500 disabled:bg-slate-700 disabled:text-slate-500 text-purple-100 font-bold transition-colors",children:"Begin Channeling"}),a.jsxs("div",{className:"text-xs text-slate-400 space-y-1",children:[a.jsx("p",{children:" Channeling takes multiple turns to reach full power"}),a.jsx("p",{children:" You must channel both Energy AND AP equal to the total cost"}),a.jsx("p",{children:" Spell is ready when both reach the threshold"}),a.jsx("p",{children:" Damage dealt = Energy channeled  Intensity"})]})]})}function AP(){var k,N;const{state:e,actions:t,isMyTurn:n,canControlEntity:s,getInitiativeOrder:r}=ra(),[i,o]=T.useState("none"),[l,c]=T.useState(null),{connectionStatus:u,phase:d,round:h,entities:m,initiative:y,selectedEntityId:b,currentEntityId:_,controlledEntityIds:w,pendingEndureRoll:f,pendingDeathCheck:p}=e,g=T.useMemo(()=>Object.values(m).filter(E=>w.includes(E.id)),[m,w]),j=r(),A=b?m[b]:null,R=T.useCallback(E=>{i==="move"&&b&&(t.declareMovement(b,E.q,E.r),o("none"))},[i,b,t]),S=T.useCallback(E=>{t.selectEntity(E===b?null:E)},[t,b]);return T.useCallback(E=>{t.setTarget(E)},[t]),u==="connecting"?a.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-900",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),a.jsx("p",{className:"text-slate-300",children:"Connecting to combat..."})]})}):u==="disconnected"?a.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-900",children:a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-red-400 text-lg mb-2",children:"Disconnected from combat"}),a.jsx("p",{className:"text-slate-400",children:"Attempting to reconnect..."})]})}):a.jsxs("div",{className:"min-h-screen bg-slate-900 text-slate-100",children:[a.jsx("header",{className:"bg-slate-800 border-b border-slate-700 px-4 py-3",children:a.jsxs("div",{className:"flex items-center justify-between max-w-7xl mx-auto",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("h1",{className:"text-xl font-bold",children:"Combat"}),d&&a.jsx("span",{className:"px-2 py-1 text-sm rounded bg-slate-700 capitalize",children:d}),h>0&&a.jsxs("span",{className:"text-slate-400",children:["Round ",h]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[u==="reconnecting"&&a.jsx("span",{className:"px-2 py-1 text-xs rounded bg-amber-700 text-amber-100",children:"Reconnecting..."}),a.jsx("span",{className:`w-2 h-2 rounded-full ${u==="connected"?"bg-green-500":"bg-red-500"}`})]})]})}),a.jsx("div",{className:"max-w-7xl mx-auto p-4",children:a.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[a.jsxs("div",{className:"col-span-3 space-y-4",children:[a.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-3",children:[a.jsx("h2",{className:"text-sm font-semibold text-slate-400 mb-2",children:"Initiative Order"}),a.jsx("div",{className:"space-y-1",children:j.map((E,M)=>a.jsxs("div",{className:`flex items-center gap-2 px-2 py-1 rounded text-sm ${E.id===_?"bg-green-900/50 text-green-200":w.includes(E.id)?"bg-blue-900/30 text-blue-200":"text-slate-400"}`,children:[a.jsx("span",{className:"w-5 text-center font-mono",children:M+1}),a.jsx("span",{className:`w-2 h-2 rounded-full ${E.faction==="ally"?"bg-green-500":"bg-red-500"}`}),a.jsx("span",{className:"flex-1 truncate",children:E.displayName||E.name}),a.jsx("span",{className:"text-xs text-slate-500",children:E.initiativeRoll})]},E.id))})]}),a.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-3",children:[a.jsx("h2",{className:"text-sm font-semibold text-slate-400 mb-2",children:"My Entities"}),a.jsxs("div",{className:"space-y-2",children:[g.map(E=>a.jsx(zd,{entity:E,isSelected:E.id===b,isCurrentTurn:E.id===_,isControlled:!0,onClick:()=>S(E.id)},E.id)),g.length===0&&a.jsx("p",{className:"text-sm text-slate-500 italic",children:"No entities under your control"})]})]})]}),a.jsxs("div",{className:"col-span-6",children:[a.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-lg overflow-hidden",children:a.jsx(Mb,{width:15,height:10,onHexClick:R,onHexHover:c,onEntityClick:S,className:"h-[500px]"})}),l&&a.jsxs("div",{className:"mt-2 text-sm text-slate-400",children:["Hex: (",l.q,", ",l.r,")"]})]}),a.jsxs("div",{className:"col-span-3 space-y-4",children:[A&&a.jsx(zd,{entity:A,isSelected:!0,isCurrentTurn:A.id===_,isControlled:s(A.id),showDetails:!0}),(A==null?void 0:A.channeling)&&s(A.id)&&a.jsx(Ob,{entityId:A.id}),n&&a.jsx(EP,{onModeChange:o}),!n&&d==="active"&&a.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-4 text-center",children:[a.jsx("p",{className:"text-slate-400",children:"Waiting for your turn..."}),_&&m[_]&&a.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:["Current turn: ",m[_].displayName||m[_].name]})]})]})]})}),f&&s(f.entityId)&&a.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-slate-800 border border-amber-600 rounded-lg p-6 max-w-md",children:[a.jsx("h2",{className:"text-xl font-bold text-amber-400 mb-4",children:"Endure Roll Required!"}),a.jsxs("p",{className:"text-slate-300 mb-4",children:[((k=m[f.entityId])==null?void 0:k.displayName)||"Entity"," took"," ",f.damage," damage and is at 0 Energy!"]}),a.jsx("p",{className:"text-slate-400 mb-6",children:"Make an Endure roll to stay conscious."}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:()=>t.submitEndureRoll(f.entityId,15,!0),className:"flex-1 px-4 py-2 rounded bg-green-600 hover:bg-green-500 text-green-100",children:"Success (Endure)"}),a.jsx("button",{onClick:()=>t.submitEndureRoll(f.entityId,5,!1),className:"flex-1 px-4 py-2 rounded bg-red-600 hover:bg-red-500 text-red-100",children:"Failure (Unconscious)"})]})]})}),p&&s(p.entityId)&&a.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-slate-800 border border-red-600 rounded-lg p-6 max-w-md",children:[a.jsx("h2",{className:"text-xl font-bold text-red-400 mb-4",children:" Feat of Defiance!"}),a.jsxs("p",{className:"text-slate-300 mb-4",children:[((N=m[p.entityId])==null?void 0:N.displayName)||"Entity"," took damage while unconscious!"]}),a.jsx("p",{className:"text-slate-400 mb-6",children:"Make a Feat of Defiance roll to survive!"}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:()=>t.submitDeathCheck(p.entityId,18,!0),className:"flex-1 px-4 py-2 rounded bg-green-600 hover:bg-green-500 text-green-100",children:"Defy Death!"}),a.jsx("button",{onClick:()=>t.submitDeathCheck(p.entityId,3,!1),className:"flex-1 px-4 py-2 rounded bg-slate-600 hover:bg-slate-500 text-slate-100",children:"Accept Fate..."})]})]})})]})}function IP(){const{campaignId:e}=Tn(),t="player-1",n=["char-1","char-2"];return e?a.jsx(um,{combatId:e,playerId:t,isGM:!1,controlledCharacterIds:n,children:a.jsx(AP,{})}):a.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-900",children:a.jsx("p",{className:"text-red-400",children:"No campaign ID provided"})})}function PP({onAddEntity:e}){var b,_,w,f;const{state:t,actions:n}=ra(),{phase:s,round:r,currentEntityId:i,entities:o}=t,[l,c]=T.useState(!1),u=i?o[i]:null,d=T.useCallback(()=>{n.startCombat()},[n]),h=T.useCallback(()=>{if(!l){c(!0);return}n.endCombat(),c(!1)},[n,l]),m=T.useCallback(()=>{i&&n.endTurn(i)},[n,i]),y=T.useCallback(()=>{c(!1)},[]);return a.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-4 space-y-4",children:[a.jsx("h2",{className:"text-lg font-semibold text-amber-400 flex items-center gap-2",children:a.jsx("span",{children:"GM Controls"})}),a.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-700/50 rounded",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-slate-400",children:"Combat Status"}),a.jsx("div",{className:"text-lg font-bold text-slate-200 capitalize",children:s||"Not Started"})]}),r>0&&a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"text-sm text-slate-400",children:"Round"}),a.jsx("div",{className:"text-2xl font-bold text-amber-400",children:r})]})]}),s==="setup"&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("button",{onClick:d,className:"w-full px-4 py-3 rounded bg-green-600 hover:bg-green-500 text-green-100 font-bold transition-colors",children:"Start Combat"}),a.jsx("p",{className:"text-xs text-slate-500 text-center",children:"All players must have rolled initiative before starting"})]}),s==="initiative"&&a.jsxs("div",{className:"p-3 bg-amber-900/30 border border-amber-700/50 rounded",children:[a.jsx("div",{className:"text-amber-400 font-medium",children:"Rolling Initiative"}),a.jsx("p",{className:"text-sm text-amber-200/70 mt-1",children:"Waiting for all players to submit initiative rolls..."})]}),s==="active"&&a.jsxs("div",{className:"space-y-3",children:[u&&a.jsxs("div",{className:"p-3 bg-slate-700/50 rounded",children:[a.jsx("div",{className:"text-sm text-slate-400",children:"Current Turn"}),a.jsx("div",{className:"text-lg font-medium text-slate-200",children:u.displayName||u.name}),a.jsxs("div",{className:"flex gap-4 mt-2 text-sm",children:[a.jsxs("span",{className:"text-blue-400",children:["AP: ",((b=u.ap)==null?void 0:b.current)??0,"/",((_=u.ap)==null?void 0:_.max)??6]}),a.jsxs("span",{className:"text-green-400",children:["Energy: ",((w=u.energy)==null?void 0:w.current)??0,"/",((f=u.energy)==null?void 0:f.max)??100]})]})]}),a.jsx("button",{onClick:m,disabled:!i,className:"w-full px-4 py-2 rounded bg-blue-600 hover:bg-blue-500 disabled:bg-slate-700 disabled:text-slate-500 text-blue-100 font-medium transition-colors",children:"Advance Turn (Force End)"})]}),(s==="active"||s==="setup"||s==="initiative")&&a.jsx("div",{className:"pt-3 border-t border-slate-600",children:l?a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"text-sm text-red-400 text-center",children:"Are you sure you want to end combat?"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:h,className:"flex-1 px-4 py-2 rounded bg-red-600 hover:bg-red-500 text-red-100 font-medium transition-colors",children:"Confirm End"}),a.jsx("button",{onClick:y,className:"flex-1 px-4 py-2 rounded bg-slate-600 hover:bg-slate-500 text-slate-200 transition-colors",children:"Cancel"})]})]}):a.jsx("button",{onClick:h,className:"w-full px-4 py-2 rounded bg-red-900/50 hover:bg-red-800/50 border border-red-700/50 text-red-300 transition-colors",children:"End Combat"})}),e&&s!=="completed"&&a.jsx("button",{onClick:e,className:"w-full px-4 py-2 rounded bg-purple-600 hover:bg-purple-500 text-purple-100 font-medium transition-colors",children:"+ Add Entity"}),s==="completed"&&a.jsxs("div",{className:"p-4 bg-slate-700/50 rounded text-center",children:[a.jsx("div",{className:"text-xl font-bold text-slate-300",children:"Combat Ended"}),a.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Results have been saved. Wounds persist until healed."})]})]})}const TP=[{value:"blunt",label:"Blunt",icon:"hammer"},{value:"burn",label:"Burn",icon:"fire"},{value:"freeze",label:"Freeze",icon:"snowflake"},{value:"laceration",label:"Laceration",icon:"scissors"},{value:"mental",label:"Mental",icon:"brain"},{value:"necrosis",label:"Necrosis",icon:"skull"},{value:"holy_spiritual",label:"Holy",icon:"sun"},{value:"unholy_spiritual",label:"Unholy",icon:"eye"}];function RP({entityId:e,onClose:t}){var M,O,X,re;const{state:n,actions:s,getEntity:r}=ra(),i=r(e),[o,l]=T.useState(0),[c,u]=T.useState(0),[d,h]=T.useState(10),[m,y]=T.useState("blunt"),[b,_]=T.useState(10),[w,f]=T.useState(0),[p,g]=T.useState(0);if(!i)return a.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-4",children:a.jsx("p",{className:"text-slate-500",children:"Entity not found"})});const j=()=>{s.gmApplyDamage(e,d,m)},A=()=>{s.gmApplyDamage(e,-b,m)},R=()=>{var I,$;o!==0&&(s.gmOverride(e,{energy:{current:Math.max(0,(((I=i.energy)==null?void 0:I.current)??0)+o),max:(($=i.energy)==null?void 0:$.max)??100}}),l(0))},S=()=>{var I,$;c!==0&&(s.gmOverride(e,{ap:{current:Math.max(0,(((I=i.ap)==null?void 0:I.current)??0)+c),max:(($=i.ap)==null?void 0:$.max)??6}}),u(0))},k=()=>{s.gmMoveEntity(e,w,p)},N=()=>{s.gmOverride(e,{unconscious:!i.unconscious})},E=()=>{s.gmOverride(e,{alive:!i.alive})};return a.jsxs("div",{className:"bg-slate-800 border border-amber-700/50 rounded-lg p-4 space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h3",{className:"text-lg font-semibold text-amber-400",children:["Override: ",i.displayName||i.name]}),t&&a.jsx("button",{onClick:t,className:"text-slate-400 hover:text-slate-200 transition-colors",children:"Close"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 p-3 bg-slate-700/50 rounded text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-slate-400",children:"Energy: "}),a.jsxs("span",{className:"text-green-400",children:[((M=i.energy)==null?void 0:M.current)??0,"/",((O=i.energy)==null?void 0:O.max)??100]})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-slate-400",children:"AP: "}),a.jsxs("span",{className:"text-blue-400",children:[((X=i.ap)==null?void 0:X.current)??0,"/",((re=i.ap)==null?void 0:re.max)??6]})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-slate-400",children:"Status: "}),a.jsx("span",{className:i.alive===!1?"text-red-400":i.unconscious?"text-amber-400":"text-green-400",children:i.alive===!1?"Dead":i.unconscious?"Unconscious":"Active"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-slate-400",children:"Tier: "}),a.jsx("span",{className:"text-purple-400 capitalize",children:i.tier})]})]}),a.jsxs("div",{className:"space-y-2 p-3 bg-red-900/20 border border-red-700/30 rounded",children:[a.jsx("h4",{className:"text-sm font-medium text-red-400",children:"Apply Damage"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"number",value:d,onChange:I=>h(parseInt(I.target.value)||0),min:0,className:"w-20 px-2 py-1 rounded bg-slate-700 border border-slate-600 text-slate-200 text-center"}),a.jsx("select",{value:m,onChange:I=>y(I.target.value),className:"flex-1 px-2 py-1 rounded bg-slate-700 border border-slate-600 text-slate-200",children:TP.map(I=>a.jsx("option",{value:I.value,children:I.label},I.value))}),a.jsx("button",{onClick:j,disabled:d<=0,className:"px-3 py-1 rounded bg-red-600 hover:bg-red-500 disabled:bg-slate-700 text-red-100 text-sm transition-colors",children:"Damage"})]})]}),a.jsxs("div",{className:"space-y-2 p-3 bg-green-900/20 border border-green-700/30 rounded",children:[a.jsx("h4",{className:"text-sm font-medium text-green-400",children:"Apply Healing"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"number",value:b,onChange:I=>_(parseInt(I.target.value)||0),min:0,className:"w-20 px-2 py-1 rounded bg-slate-700 border border-slate-600 text-slate-200 text-center"}),a.jsx("button",{onClick:A,disabled:b<=0,className:"flex-1 px-3 py-1 rounded bg-green-600 hover:bg-green-500 disabled:bg-slate-700 text-green-100 text-sm transition-colors",children:"Heal Energy"})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{className:"space-y-1 p-2 bg-slate-700/30 rounded",children:[a.jsx("div",{className:"text-xs text-slate-400",children:"Modify Energy"}),a.jsxs("div",{className:"flex gap-1",children:[a.jsx("input",{type:"number",value:o,onChange:I=>l(parseInt(I.target.value)||0),className:"w-16 px-2 py-1 rounded bg-slate-700 border border-slate-600 text-slate-200 text-center text-sm"}),a.jsx("button",{onClick:R,disabled:o===0,className:"px-2 py-1 rounded bg-slate-600 hover:bg-slate-500 disabled:bg-slate-700 disabled:text-slate-500 text-slate-200 text-xs transition-colors",children:"Apply"})]})]}),a.jsxs("div",{className:"space-y-1 p-2 bg-slate-700/30 rounded",children:[a.jsx("div",{className:"text-xs text-slate-400",children:"Modify AP"}),a.jsxs("div",{className:"flex gap-1",children:[a.jsx("input",{type:"number",value:c,onChange:I=>u(parseInt(I.target.value)||0),className:"w-16 px-2 py-1 rounded bg-slate-700 border border-slate-600 text-slate-200 text-center text-sm"}),a.jsx("button",{onClick:S,disabled:c===0,className:"px-2 py-1 rounded bg-slate-600 hover:bg-slate-500 disabled:bg-slate-700 disabled:text-slate-500 text-slate-200 text-xs transition-colors",children:"Apply"})]})]})]}),a.jsxs("div",{className:"space-y-2 p-3 bg-cyan-900/20 border border-cyan-700/30 rounded",children:[a.jsx("h4",{className:"text-sm font-medium text-cyan-400",children:"Move to Hex"}),a.jsxs("div",{className:"flex gap-2 items-center",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs text-slate-400",children:"Q:"}),a.jsx("input",{type:"number",value:w,onChange:I=>f(parseInt(I.target.value)||0),className:"w-14 px-2 py-1 rounded bg-slate-700 border border-slate-600 text-slate-200 text-center text-sm"})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs text-slate-400",children:"R:"}),a.jsx("input",{type:"number",value:p,onChange:I=>g(parseInt(I.target.value)||0),className:"w-14 px-2 py-1 rounded bg-slate-700 border border-slate-600 text-slate-200 text-center text-sm"})]}),a.jsx("button",{onClick:k,className:"flex-1 px-3 py-1 rounded bg-cyan-600 hover:bg-cyan-500 text-cyan-100 text-sm transition-colors",children:"Teleport"})]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:N,className:`flex-1 px-3 py-2 rounded text-sm font-medium transition-colors ${i.unconscious?"bg-amber-600 hover:bg-amber-500 text-amber-100":"bg-slate-600 hover:bg-slate-500 text-slate-200"}`,children:i.unconscious?"Wake Up":"Knock Out"}),a.jsx("button",{onClick:E,className:`flex-1 px-3 py-2 rounded text-sm font-medium transition-colors ${i.alive===!1?"bg-green-600 hover:bg-green-500 text-green-100":"bg-red-900/50 hover:bg-red-800/50 border border-red-700/50 text-red-300"}`,children:i.alive===!1?"Revive":"Kill"})]})]})}function DP({onAdd:e,onCancel:t}){const[n,s]=T.useState("New Entity"),[r,i]=T.useState(""),[o,l]=T.useState("enemy"),[c,u]=T.useState("minion"),[d,h]=T.useState(1),[m,y]=T.useState(0),[b,_]=T.useState(0),w=T.useCallback(()=>{e({name:n,displayName:r||n,faction:o,tier:c,level:d,position:{q:m,r:b}})},[e,n,r,o,c,d,m,b]);return a.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-6 w-full max-w-md space-y-4",children:[a.jsx("h2",{className:"text-xl font-bold text-amber-400",children:"Add Entity"}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm text-slate-400",children:"Name (Internal)"}),a.jsx("input",{type:"text",value:n,onChange:f=>s(f.target.value),className:"w-full px-3 py-2 rounded bg-slate-700 border border-slate-600 text-slate-200",placeholder:"Entity name..."})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm text-slate-400",children:"Display Name (Optional)"}),a.jsx("input",{type:"text",value:r,onChange:f=>i(f.target.value),className:"w-full px-3 py-2 rounded bg-slate-700 border border-slate-600 text-slate-200",placeholder:"Name shown to players..."})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm text-slate-400",children:"Faction"}),a.jsxs("select",{value:o,onChange:f=>l(f.target.value),className:"w-full px-3 py-2 rounded bg-slate-700 border border-slate-600 text-slate-200",children:[a.jsx("option",{value:"ally",children:"Ally"}),a.jsx("option",{value:"enemy",children:"Enemy"}),a.jsx("option",{value:"neutral",children:"Neutral"})]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm text-slate-400",children:"Tier"}),a.jsxs("select",{value:c,onChange:f=>u(f.target.value),className:"w-full px-3 py-2 rounded bg-slate-700 border border-slate-600 text-slate-200",children:[a.jsx("option",{value:"minion",children:"Minion (1-hit)"}),a.jsx("option",{value:"full",children:"Full"}),a.jsx("option",{value:"lieutenant",children:"Lieutenant"}),a.jsx("option",{value:"hero",children:"Hero"})]})]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm text-slate-400",children:"Level"}),a.jsx("input",{type:"number",value:d,onChange:f=>h(parseInt(f.target.value)||1),min:1,max:30,className:"w-full px-3 py-2 rounded bg-slate-700 border border-slate-600 text-slate-200"})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm text-slate-400",children:"Starting Position (Hex)"}),a.jsxs("div",{className:"flex gap-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-slate-500",children:"Q:"}),a.jsx("input",{type:"number",value:m,onChange:f=>y(parseInt(f.target.value)||0),className:"w-20 px-3 py-2 rounded bg-slate-700 border border-slate-600 text-slate-200 text-center"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-slate-500",children:"R:"}),a.jsx("input",{type:"number",value:b,onChange:f=>_(parseInt(f.target.value)||0),className:"w-20 px-3 py-2 rounded bg-slate-700 border border-slate-600 text-slate-200 text-center"})]})]})]}),a.jsxs("div",{className:"flex gap-3 pt-2",children:[a.jsx("button",{onClick:w,className:"flex-1 px-4 py-2 rounded bg-green-600 hover:bg-green-500 text-green-100 font-medium transition-colors",children:"Add Entity"}),a.jsx("button",{onClick:t,className:"flex-1 px-4 py-2 rounded bg-slate-600 hover:bg-slate-500 text-slate-200 transition-colors",children:"Cancel"})]})]})})}function MP(){var S;const{state:e,actions:t,getInitiativeOrder:n,getEntity:s}=ra(),[r,i]=T.useState(null),[o,l]=T.useState(!1),[c,u]=T.useState(null),{connectionStatus:d,phase:h,round:m,entities:y,initiative:b,selectedEntityId:_,currentEntityId:w}=e,f=T.useMemo(()=>{const k=Object.values(y);return{allies:k.filter(N=>N.faction==="ally"),enemies:k.filter(N=>N.faction==="enemy"),neutrals:k.filter(N=>N.faction==="neutral")}},[y]),p=n(),g=_?y[_]:null,j=T.useCallback(k=>{console.log("GM hex click:",k)},[]),A=T.useCallback(k=>{t.selectEntity(k===_?null:k)},[t,_]),R=T.useCallback(k=>{console.log("Add entity:",k),l(!1)},[]);return d==="connecting"?a.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-900",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-amber-500 border-t-transparent rounded-full mx-auto mb-4"}),a.jsx("p",{className:"text-slate-300",children:"Connecting to combat..."})]})}):d==="disconnected"?a.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-900",children:a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-red-400 text-lg mb-2",children:"Disconnected from combat"}),a.jsx("p",{className:"text-slate-400",children:"Attempting to reconnect..."})]})}):a.jsxs("div",{className:"min-h-screen bg-slate-900 text-slate-100",children:[a.jsx("header",{className:"bg-amber-900/30 border-b border-amber-700/50 px-4 py-3",children:a.jsxs("div",{className:"flex items-center justify-between max-w-7xl mx-auto",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("h1",{className:"text-xl font-bold text-amber-400",children:"GM Combat Control"}),h&&a.jsx("span",{className:"px-2 py-1 text-sm rounded bg-amber-800/50 text-amber-200 capitalize",children:h}),m>0&&a.jsxs("span",{className:"text-amber-300",children:["Round ",m]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("span",{className:"text-sm text-slate-400",children:[Object.keys(y).length," entities"]}),d==="reconnecting"&&a.jsx("span",{className:"px-2 py-1 text-xs rounded bg-amber-700 text-amber-100",children:"Reconnecting..."}),a.jsx("span",{className:`w-2 h-2 rounded-full ${d==="connected"?"bg-green-500":"bg-red-500"}`})]})]})}),a.jsx("div",{className:"max-w-7xl mx-auto p-4",children:a.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[a.jsxs("div",{className:"col-span-3 space-y-4",children:[a.jsx(PP,{onAddEntity:()=>l(!0)}),a.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-3",children:[a.jsx("h2",{className:"text-sm font-semibold text-slate-400 mb-2",children:"Initiative Order"}),a.jsxs("div",{className:"space-y-1 max-h-60 overflow-y-auto",children:[p.map((k,N)=>a.jsxs("div",{onClick:()=>A(k.id),className:`flex items-center gap-2 px-2 py-1 rounded text-sm cursor-pointer transition-colors ${k.id===w?"bg-green-900/50 text-green-200":k.id===_?"bg-blue-900/50 text-blue-200":"hover:bg-slate-700 text-slate-400"}`,children:[a.jsx("span",{className:"w-5 text-center font-mono",children:N+1}),a.jsx("span",{className:`w-2 h-2 rounded-full ${k.faction==="ally"?"bg-green-500":k.faction==="enemy"?"bg-red-500":"bg-yellow-500"}`}),a.jsx("span",{className:"flex-1 truncate",children:k.displayName||k.name}),a.jsx("span",{className:"text-xs text-slate-500",children:k.initiativeRoll??""})]},k.id)),p.length===0&&a.jsx("p",{className:"text-sm text-slate-500 italic",children:"No initiative set"})]})]}),a.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-3",children:[a.jsx("h2",{className:"text-sm font-semibold text-slate-400 mb-2",children:"Combat Info"}),a.jsxs("div",{className:"space-y-1 text-xs text-slate-500",children:[a.jsxs("p",{children:["Initiative entries: ",b.length]}),a.jsxs("p",{children:["Current turn: ",w?((S=y[w])==null?void 0:S.name)??"Unknown":"None"]})]})]})]}),a.jsxs("div",{className:"col-span-6",children:[a.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-lg overflow-hidden",children:a.jsx(Mb,{width:15,height:10,onHexClick:j,onHexHover:i,onEntityClick:A,className:"h-[500px]"})}),r&&a.jsxs("div",{className:"mt-2 text-sm text-slate-400",children:["Hex: (",r.q,", ",r.r,")"]}),a.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-3",children:[a.jsxs("div",{className:"bg-green-900/20 border border-green-700/30 rounded-lg p-2",children:[a.jsxs("h3",{className:"text-sm font-semibold text-green-400 mb-2",children:["Allies (",f.allies.length,")"]}),a.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:f.allies.map(k=>{var N,E;return a.jsxs("div",{onClick:()=>A(k.id),className:`text-xs px-2 py-1 rounded cursor-pointer transition-colors ${k.id===_?"bg-green-800/50 text-green-200":"hover:bg-green-900/50 text-green-300"}`,children:[k.displayName||k.name,a.jsxs("span",{className:"text-green-500/60 ml-1",children:[((N=k.energy)==null?void 0:N.current)??0,"/",((E=k.energy)==null?void 0:E.max)??100]})]},k.id)})})]}),a.jsxs("div",{className:"bg-red-900/20 border border-red-700/30 rounded-lg p-2",children:[a.jsxs("h3",{className:"text-sm font-semibold text-red-400 mb-2",children:["Enemies (",f.enemies.length,")"]}),a.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:f.enemies.map(k=>{var N,E;return a.jsxs("div",{onClick:()=>A(k.id),className:`text-xs px-2 py-1 rounded cursor-pointer transition-colors ${k.id===_?"bg-red-800/50 text-red-200":"hover:bg-red-900/50 text-red-300"}`,children:[k.displayName||k.name,a.jsxs("span",{className:"text-red-500/60 ml-1",children:[((N=k.energy)==null?void 0:N.current)??0,"/",((E=k.energy)==null?void 0:E.max)??100]})]},k.id)})})]}),a.jsxs("div",{className:"bg-yellow-900/20 border border-yellow-700/30 rounded-lg p-2",children:[a.jsxs("h3",{className:"text-sm font-semibold text-yellow-400 mb-2",children:["Neutral (",f.neutrals.length,")"]}),a.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:f.neutrals.map(k=>a.jsx("div",{onClick:()=>A(k.id),className:`text-xs px-2 py-1 rounded cursor-pointer transition-colors ${k.id===_?"bg-yellow-800/50 text-yellow-200":"hover:bg-yellow-900/50 text-yellow-300"}`,children:k.displayName||k.name},k.id))})]})]})]}),a.jsxs("div",{className:"col-span-3 space-y-4",children:[g?a.jsxs(a.Fragment,{children:[a.jsx(zd,{entity:g,isSelected:!0,isCurrentTurn:g.id===w,isControlled:!0,showDetails:!0}),g.tier!=="minion"&&g.wounds&&a.jsx(Lb,{wounds:g.wounds,showPenalties:!0}),g.channeling&&a.jsx(Ob,{entityId:g.id}),a.jsx("button",{onClick:()=>u(g.id),className:"w-full px-4 py-2 rounded bg-amber-600 hover:bg-amber-500 text-amber-100 font-medium transition-colors",children:"GM Overrides"})]}):a.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-4 text-center",children:a.jsx("p",{className:"text-slate-500",children:"Select an entity to view details"})}),a.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-3",children:[a.jsx("h3",{className:"text-sm font-semibold text-slate-400 mb-2",children:"Combat Summary"}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[a.jsxs("div",{className:"p-2 bg-slate-700/30 rounded",children:[a.jsx("div",{className:"text-xs text-slate-500",children:"Total Entities"}),a.jsx("div",{className:"text-lg font-bold text-slate-200",children:Object.keys(y).length})]}),a.jsxs("div",{className:"p-2 bg-slate-700/30 rounded",children:[a.jsx("div",{className:"text-xs text-slate-500",children:"Alive"}),a.jsx("div",{className:"text-lg font-bold text-green-400",children:Object.values(y).filter(k=>k.alive!==!1).length})]}),a.jsxs("div",{className:"p-2 bg-slate-700/30 rounded",children:[a.jsx("div",{className:"text-xs text-slate-500",children:"Unconscious"}),a.jsx("div",{className:"text-lg font-bold text-amber-400",children:Object.values(y).filter(k=>k.unconscious).length})]}),a.jsxs("div",{className:"p-2 bg-slate-700/30 rounded",children:[a.jsx("div",{className:"text-xs text-slate-500",children:"Dead"}),a.jsx("div",{className:"text-lg font-bold text-red-400",children:Object.values(y).filter(k=>k.alive===!1).length})]})]})]})]})]})}),o&&a.jsx(DP,{onAdd:R,onCancel:()=>l(!1)}),c&&a.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",children:a.jsx("div",{className:"w-full max-w-md",children:a.jsx(RP,{entityId:c,onClose:()=>u(null)})})})]})}function LP(){const{campaignId:e}=Tn(),t="gm-1";return e?a.jsx(um,{combatId:e,playerId:t,isGM:!0,children:a.jsx(MP,{})}):a.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-900",children:a.jsx("p",{className:"text-red-400",children:"No campaign ID provided"})})}function OP(){const e=Ea(),{state:t,actions:n,isGM:s}=ra(),[r,i]=T.useState(10),[o,l]=T.useState(null),{connectionStatus:c,phase:u,entities:d,initiative:h,controlledEntityIds:m,combatId:y}=t,b=T.useMemo(()=>h.map(j=>j.entityId),[h]),_=T.useMemo(()=>{const j=Object.values(d);return{withInitiative:j.filter(A=>b.includes(A.id)),withoutInitiative:j.filter(A=>!b.includes(A.id)),controlled:j.filter(A=>m.includes(A.id))}},[d,b,m]),w=T.useMemo(()=>Object.keys(d).length>0&&Object.keys(d).every(j=>b.includes(j)),[d,b]),f=T.useCallback(()=>{o&&(n.submitInitiativeRoll(o,r,Math.random()),l(null),i(10))},[n,o,r]),p=T.useCallback(()=>{n.startCombat()},[n]),g=T.useCallback(()=>{const j=Math.floor(Math.random()*20)+1;i(j)},[]);return c==="connecting"?a.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-900",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),a.jsx("p",{className:"text-slate-300",children:"Joining combat lobby..."})]})}):c==="disconnected"?a.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-900",children:a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-red-400 text-lg mb-2",children:"Disconnected from combat"}),a.jsx("p",{className:"text-slate-400",children:"Attempting to reconnect..."})]})}):u==="active"?a.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-900",children:a.jsxs("div",{className:"text-center space-y-4",children:[a.jsx("p",{className:"text-amber-400 text-lg",children:"Combat has started!"}),a.jsx("button",{onClick:()=>e(s?`/gm/campaigns/${y}/combat`:`/player/campaigns/${y}/combat`),className:"px-6 py-3 rounded bg-blue-600 hover:bg-blue-500 text-blue-100 font-medium transition-colors",children:"Join Combat"})]})}):a.jsxs("div",{className:"min-h-screen bg-slate-900 text-slate-100",children:[a.jsx("header",{className:"bg-slate-800 border-b border-slate-700 px-4 py-3",children:a.jsxs("div",{className:"flex items-center justify-between max-w-4xl mx-auto",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("h1",{className:"text-xl font-bold",children:"Combat Lobby"}),a.jsx("span",{className:"px-2 py-1 text-sm rounded bg-slate-700 text-slate-300",children:"Waiting for players..."})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[c==="reconnecting"&&a.jsx("span",{className:"px-2 py-1 text-xs rounded bg-amber-700 text-amber-100",children:"Reconnecting..."}),a.jsx("span",{className:`w-2 h-2 rounded-full ${c==="connected"?"bg-green-500":"bg-red-500"}`})]})]})}),a.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[a.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-slate-200 mb-4",children:"Initiative Rolls"}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex justify-between text-sm text-slate-400 mb-2",children:[a.jsx("span",{children:"Progress"}),a.jsxs("span",{children:[h.length," / ",Object.keys(d).length," rolled"]})]}),a.jsx("div",{className:"h-3 bg-slate-700 rounded-full overflow-hidden",children:a.jsx("div",{className:`h-full transition-all duration-300 ${w?"bg-green-500":"bg-blue-500"}`,style:{width:`${Object.keys(d).length>0?h.length/Object.keys(d).length*100:0}%`}})})]}),a.jsxs("div",{className:"space-y-2",children:[h.map((j,A)=>{const R=d[j.entityId];return R?a.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-slate-700/50 rounded",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:"w-6 h-6 rounded-full bg-slate-600 flex items-center justify-center text-sm font-mono",children:A+1}),a.jsx("span",{className:`w-2 h-2 rounded-full ${R.faction==="ally"?"bg-green-500":R.faction==="enemy"?"bg-red-500":"bg-yellow-500"}`}),a.jsx("span",{className:"text-slate-200",children:R.displayName||R.name})]}),a.jsx("span",{className:"text-lg font-mono text-blue-400",children:j.roll})]},j.entityId):null}),_.withoutInitiative.map(j=>a.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-slate-700/30 rounded border border-dashed border-slate-600",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:"w-6 h-6 rounded-full bg-slate-700 flex items-center justify-center text-sm text-slate-500",children:""}),a.jsx("span",{className:`w-2 h-2 rounded-full opacity-50 ${j.faction==="ally"?"bg-green-500":j.faction==="enemy"?"bg-red-500":"bg-yellow-500"}`}),a.jsx("span",{className:"text-slate-400",children:j.displayName||j.name})]}),a.jsx("span",{className:"text-sm text-slate-500 italic",children:"Waiting..."})]},j.id))]})]}),_.controlled.some(j=>!b.includes(j.id))&&a.jsxs("div",{className:"bg-blue-900/30 border border-blue-700/50 rounded-lg p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-blue-200 mb-4",children:"Roll Initiative for Your Entities"}),a.jsx("div",{className:"space-y-2 mb-4",children:_.controlled.filter(j=>!b.includes(j.id)).map(j=>a.jsxs("button",{onClick:()=>l(j.id),className:`w-full flex items-center justify-between px-4 py-3 rounded transition-colors ${o===j.id?"bg-blue-700 text-blue-100":"bg-slate-700 hover:bg-slate-600 text-slate-200"}`,children:[a.jsx("span",{children:j.displayName||j.name}),a.jsx("span",{className:"text-sm text-slate-400 capitalize",children:j.tier})]},j.id))}),o&&a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("label",{className:"text-sm text-slate-400",children:"Roll:"}),a.jsx("input",{type:"number",value:r,onChange:j=>i(parseInt(j.target.value)||0),min:1,max:100,className:"w-20 px-3 py-2 rounded bg-slate-700 border border-slate-600 text-slate-200 text-center"})]}),a.jsx("button",{onClick:g,className:"px-4 py-2 rounded bg-slate-600 hover:bg-slate-500 text-slate-200 transition-colors",children:"Roll d20"}),a.jsx("button",{onClick:f,className:"flex-1 px-4 py-2 rounded bg-blue-600 hover:bg-blue-500 text-blue-100 font-medium transition-colors",children:"Submit Initiative"})]})]}),s&&a.jsxs("div",{className:"bg-amber-900/30 border border-amber-700/50 rounded-lg p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-amber-200 mb-4",children:"GM Controls"}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("button",{onClick:p,disabled:!w,className:`w-full px-6 py-4 rounded font-bold text-lg transition-colors ${w?"bg-green-600 hover:bg-green-500 text-green-100":"bg-slate-700 text-slate-500 cursor-not-allowed"}`,children:w?"Start Combat":"Waiting for all initiative rolls..."}),!w&&a.jsxs("p",{className:"text-sm text-amber-300/70 text-center",children:[_.withoutInitiative.length," entity(ies) still need to roll initiative"]}),_.withoutInitiative.filter(j=>j.faction==="enemy"||j.faction==="neutral").length>0&&a.jsx("div",{className:"pt-4 border-t border-amber-700/30",children:a.jsx("button",{onClick:()=>{_.withoutInitiative.filter(j=>j.faction==="enemy"||j.faction==="neutral").forEach(j=>{const A=Math.floor(Math.random()*20)+1;n.submitInitiativeRoll(j.id,A,Math.random())})},className:"w-full px-4 py-2 rounded bg-amber-600 hover:bg-amber-500 text-amber-100 font-medium transition-colors",children:"Roll Initiative for All NPCs"})})]})]}),a.jsxs("div",{className:"text-center text-sm text-slate-500",children:[Object.keys(d).length," entities in combat "," ",_.controlled.length," under your control"]})]})]})}function $b(){const{campaignId:e}=Tn(),[t]=Kh(),n=t.get("gm")==="true",s=n?"gm-1":"player-1",r=n?[]:["char-1","char-2"];return e?a.jsx(um,{combatId:e,playerId:s,isGM:n,controlledCharacterIds:r,children:a.jsx(OP,{})}):a.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-900",children:a.jsx("p",{className:"text-red-400",children:"No campaign ID provided"})})}const $P=()=>{const{campaignId:e}=Tn(),[t,n]=v.useState(null),[s,r]=v.useState(!0),[i,o]=v.useState(null);return v.useEffect(()=>{if(!e){o("Campaign ID is missing."),r(!1);return}let l=!0;return(async()=>{r(!0),o(null);try{const u=await tt.listCampaigns();if(!l)return;const d=u.find(h=>h.id===e)??null;n(d),d||o("Campaign not found.")}catch(u){if(!l)return;o(u instanceof Error?u.message:"Failed to load campaign.")}finally{l&&r(!1)}})(),()=>{l=!1}},[e]),e?a.jsxs("div",{className:"gm-campaign",children:[a.jsxs("header",{className:"gm-campaign__header",children:[a.jsx("h2",{className:"gm-campaign__title h2",children:"GM Campaign"}),a.jsx("p",{className:"gm-campaign__subtitle subtitle muted",children:s?"Loading campaign...":(t==null?void 0:t.name)||"Unnamed campaign"}),i&&a.jsx("p",{className:"gm-campaign__error body",children:i})]}),a.jsx(jv,{})]}):a.jsx("div",{children:"Campaign not found."})},BP=()=>a.jsxs("div",{children:[a.jsx("h2",{children:"GM page not found"}),a.jsx("p",{children:"The GM page you are looking for does not exist."})]}),tg=()=>{const e=ze(),t=sa(),[n,s]=v.useState(null),[r,i]=v.useState(!0),[o,l]=v.useState("sign-in"),[c,u]=v.useState(""),[d,h]=v.useState(""),[m,y]=v.useState(null),[b,_]=v.useState(null),w=t.pathname.match(/^\/gm\/campaigns\/([^/]+)/),f=(w==null?void 0:w[1])??null;v.useEffect(()=>{let j=!0;e.auth.getUser().then(({data:R,error:S})=>{j&&(S&&y(`Auth check failed: ${S.message}`),s((R==null?void 0:R.user)??null),i(!1))});const{data:A}=e.auth.onAuthStateChange((R,S)=>{s((S==null?void 0:S.user)??null)});return()=>{j=!1,A.subscription.unsubscribe()}},[e]);const p=async j=>{if(j.preventDefault(),y(null),_(null),!c.trim()||!d){y("Email and password are required.");return}if(o==="sign-in"){const{error:R}=await e.auth.signInWithPassword({email:c.trim(),password:d});R&&y(R.message);return}const{error:A}=await e.auth.signUp({email:c.trim(),password:d});if(A){y(A.message);return}_("Check your email to confirm the account, then sign in.")},g=async()=>{y(null);const{error:j}=await e.auth.signOut();j&&y(j.message)};return r?a.jsx("div",{className:"gm-app__center",children:a.jsx("div",{className:"gm-app__muted",children:"Checking session..."})}):n?a.jsxs("div",{className:"gm-app",children:[a.jsxs("nav",{className:"gm-app__nav",children:[a.jsx("h1",{className:"gm-app__title h2",children:"GM Console"}),a.jsxs("div",{className:"gm-app__meta caption muted",children:[n.email??"Signed in",a.jsx("button",{type:"button",onClick:g,className:"gm-app__button gm-app__button--compact",children:"Sign Out"})]}),a.jsx(bt,{to:"/gm",className:({isActive:j})=>j?"gm-app__link gm-app__link--active":"gm-app__link",children:"Campaigns"}),f&&a.jsxs(a.Fragment,{children:[a.jsx(bt,{to:`/gm/campaigns/${f}/bestiary`,className:({isActive:j})=>j?"gm-app__link gm-app__link--active":"gm-app__link",children:"Bestiary"}),a.jsx(bt,{to:`/gm/campaigns/${f}/combat`,className:({isActive:j})=>j?"gm-app__link gm-app__link--active":"gm-app__link",children:"Combat"}),a.jsx(bt,{to:`/gm/campaigns/${f}/npc-hub`,className:({isActive:j})=>j?"gm-app__link gm-app__link--active":"gm-app__link",children:"NPC Hub"}),a.jsx(bt,{to:`/gm/campaigns/${f}/setting-info`,className:({isActive:j})=>j?"gm-app__link gm-app__link--active":"gm-app__link",children:"Setting Info"}),a.jsx("div",{className:"gm-app__section-label caption muted",children:"Player Views"}),a.jsx(bt,{to:`/gm/campaigns/${f}/player-characters`,className:({isActive:j})=>j?"gm-app__link gm-app__link--active":"gm-app__link",children:"Player Characters"})]})]}),a.jsx("main",{className:"gm-app__main",children:a.jsxs(zh,{children:[a.jsx(Xe,{index:!0,element:a.jsx(hA,{})}),a.jsxs(Xe,{path:"campaigns/:campaignId",element:a.jsx($P,{}),children:[a.jsx(Xe,{index:!0,element:a.jsx(dd,{to:"bestiary",replace:!0})}),a.jsx(Xe,{path:"bestiary",element:a.jsx(MI,{})}),a.jsx(Xe,{path:"combat",element:a.jsx(LP,{})}),a.jsx(Xe,{path:"combat/lobby",element:a.jsx($b,{})}),a.jsx(Xe,{path:"combat-legacy",element:a.jsx(q1,{})}),a.jsx(Xe,{path:"npc-hub",element:a.jsx(OI,{})}),a.jsx(Xe,{path:"setting-info",element:a.jsx(BI,{})}),a.jsx(Xe,{path:"player-characters",element:a.jsx(WI,{})})]}),a.jsx(Xe,{path:"*",element:a.jsx(BP,{})})]})})]}):a.jsx("div",{className:"gm-app__center",children:a.jsx("form",{onSubmit:p,className:"gm-app__auth",children:a.jsxs("div",{className:"gm-app__card",children:[a.jsx("h2",{className:"gm-app__card-title h2",children:o==="sign-in"?"GM Sign In":"Create GM Account"}),a.jsx("p",{className:"gm-app__subtitle subtitle muted",children:"You must be signed in for GM actions (campaigns, invites, bestiary, settings)."}),m&&a.jsx("div",{className:"gm-app__message gm-app__message--error",children:m}),b&&a.jsx("div",{className:"gm-app__message gm-app__message--success",children:b}),a.jsxs("label",{className:"gm-app__field",children:[a.jsx("span",{className:"gm-app__label",children:"Email"}),a.jsx("input",{type:"email",value:c,onChange:j=>u(j.target.value),className:"gm-app__input",autoComplete:"email"})]}),a.jsxs("label",{className:"gm-app__field gm-app__field--spaced",children:[a.jsx("span",{className:"gm-app__label",children:"Password"}),a.jsx("input",{type:"password",value:d,onChange:j=>h(j.target.value),className:"gm-app__input",autoComplete:o==="sign-in"?"current-password":"new-password"})]}),a.jsx("button",{type:"submit",className:"gm-app__button",children:o==="sign-in"?"Sign In":"Create Account"}),a.jsx("button",{type:"button",onClick:()=>{l(o==="sign-in"?"sign-up":"sign-in"),y(null),_(null)},className:"gm-app__button gm-app__button--secondary",children:o==="sign-in"?"Need an account? Sign up":"Already have an account? Sign in"})]})})})},Bb="active_campaign_id",FP=()=>{const{token:e}=Tn(),t=Ea(),n=ze(),{selectedId:s,setSelectedId:r}=Is(),[i,o]=v.useState(!0),[l,c]=v.useState(!1),[u,d]=v.useState([]),[h,m]=v.useState(null),[y,b]=v.useState(null),[_,w]=v.useState(null),[f,p]=v.useState(null),[g,j]=v.useState(s),[A,R]=v.useState("sign-in"),[S,k]=v.useState(""),[N,E]=v.useState(""),[M,O]=v.useState(null),[X,re]=v.useState(null),[I,$]=v.useState(!1);v.useEffect(()=>{j(s)},[s]),v.useEffect(()=>{let q=!0;const{data:V}=n.auth.onAuthStateChange((te,B)=>{b((B==null?void 0:B.user)??null)});return(async()=>{if(o(!0),w(null),p(null),!e){w("Invite token missing."),o(!1);return}try{const[{data:te,error:B},{data:ae,error:le}]=await Promise.all([n.from("campaign_invites").select("token, campaign_id, expires_at").eq("token",e).maybeSingle(),n.auth.getUser()]);if(!q)return;if(B||!te){w((B==null?void 0:B.message)??"Invite link is invalid."),m(null),o(!1);return}if(te.expires_at){const he=new Date(te.expires_at).getTime();if(!Number.isNaN(he)&&he<Date.now()){w("Invite link has expired."),m(null),o(!1);return}}le&&w(`Auth check failed: ${le.message}`),b((ae==null?void 0:ae.user)??null),m(te)}catch(te){if(!q)return;w(te instanceof Error?te.message:"Failed to load invite.")}try{const te=await Ct.listCharacters();if(!q)return;d(te)}catch(te){if(!q)return;w(te instanceof Error?te.message:"Failed to load characters.")}finally{q&&o(!1)}})(),()=>{q=!1,V.subscription.unsubscribe()}},[n,e]);const L=async q=>{if(q.preventDefault(),O(null),re(null),!S.trim()||!N){O("Email and password are required.");return}if(A==="sign-in"){const{error:Q}=await n.auth.signInWithPassword({email:S.trim(),password:N});Q&&O(Q.message);return}const{error:V}=await n.auth.signUp({email:S.trim(),password:N});if(V){O(V.message);return}re("Check your email to confirm the account, then sign in.")},D=async()=>{O(null),re(null),$(!0);try{const{error:q}=await n.auth.signInAnonymously();if(q){O(q.message);return}re("Signed in anonymously.")}finally{$(!1)}},F=async()=>{if(!h){w("Invite data is missing.");return}c(!0),w(null),p(null);try{const{data:q,error:V}=await n.auth.getUser();if(V)throw new Error(V.message);const Q=q==null?void 0:q.user;if(!Q){w("You must be signed in before joining a campaign."),c(!1);return}const te=await n.from("campaign_members").select("campaign_id, player_user_id").eq("campaign_id",h.campaign_id).eq("player_user_id",Q.id).maybeSingle();if(te.error)throw new Error(te.error.message);if(te.data){const{error:B}=await n.from("campaign_members").update({character_id:g??null}).eq("campaign_id",h.campaign_id).eq("player_user_id",Q.id);if(B)throw new Error(B.message)}else{const{error:B}=await n.from("campaign_members").insert({campaign_id:h.campaign_id,player_user_id:Q.id,character_id:g??null,role:"player"});if(B)throw new Error(B.message)}r(g??null),typeof window<"u"&&window.localStorage.setItem(Bb,h.campaign_id),p("Joined campaign successfully."),t(`/player/campaigns/${h.campaign_id}`)}catch(q){w(q instanceof Error?q.message:"Failed to join campaign.")}finally{c(!1)}};return i?a.jsx("div",{className:"join-campaign",children:a.jsx("div",{className:"join-campaign__loading caption muted",children:"Loading invite..."})}):a.jsx("div",{className:"join-campaign",children:a.jsxs("div",{className:"join-campaign__card",children:[a.jsx("h1",{className:"join-campaign__title h1",children:"Join Campaign"}),a.jsx("p",{className:"join-campaign__subtitle subtitle muted",children:"Use this invite link to join a campaign with one of your characters."}),_&&a.jsx("div",{className:"join-campaign__message join-campaign__message--error",children:_}),f&&a.jsx("div",{className:"join-campaign__message join-campaign__message--success",children:f}),!y&&a.jsxs("form",{onSubmit:L,className:"join-campaign__auth",children:[a.jsx("div",{className:"join-campaign__auth-title h3",children:A==="sign-in"?"Sign in to join":"Create an account to join"}),M&&a.jsx("div",{className:"join-campaign__message join-campaign__message--error",children:M}),X&&a.jsx("div",{className:"join-campaign__message join-campaign__message--success",children:X}),a.jsxs("label",{className:"join-campaign__field",children:[a.jsx("span",{className:"join-campaign__label",children:"Email"}),a.jsx("input",{type:"email",value:S,onChange:q=>k(q.target.value),className:"join-campaign__input",autoComplete:"email"})]}),a.jsxs("label",{className:"join-campaign__field join-campaign__field--spaced",children:[a.jsx("span",{className:"join-campaign__label",children:"Password"}),a.jsx("input",{type:"password",value:N,onChange:q=>E(q.target.value),className:"join-campaign__input",autoComplete:A==="sign-in"?"current-password":"new-password"})]}),a.jsxs("div",{className:"join-campaign__button-row",children:[a.jsx("button",{type:"submit",className:"join-campaign__button",children:A==="sign-in"?"Sign In":"Create Account"}),a.jsx("button",{type:"button",className:"join-campaign__button join-campaign__button--secondary",onClick:D,disabled:I,children:I?"Signing in...":"Continue as Guest"}),a.jsx("button",{type:"button",onClick:()=>{R(A==="sign-in"?"sign-up":"sign-in"),O(null),re(null)},className:"join-campaign__button join-campaign__button--secondary",children:A==="sign-in"?"Need an account? Sign up":"Already have an account? Sign in"})]})]}),a.jsxs("div",{className:"join-campaign__characters",children:[a.jsx("div",{className:"join-campaign__characters-title h3",children:"Choose a character (optional)"}),u.length===0?a.jsx("div",{className:"join-campaign__muted body muted",children:"No characters found yet. You can join and create one later."}):a.jsx("div",{className:"join-campaign__character-list",children:u.map(q=>a.jsxs("label",{className:`join-campaign__character${g===q.id?" join-campaign__character--selected":""}`,children:[a.jsx("input",{type:"radio",name:"join-character",value:q.id,checked:g===q.id,onChange:()=>{j(q.id),r(q.id)}}),a.jsxs("div",{children:[a.jsx("div",{className:"join-campaign__character-name body",children:q.name}),a.jsxs("div",{className:"join-campaign__character-meta caption muted",children:["Level ",q.level]})]})]},q.id))})]}),a.jsxs("div",{className:"join-campaign__button-row",children:[a.jsx("button",{type:"button",className:"join-campaign__button",onClick:F,disabled:l,children:l?"Joining...":"Join Campaign"}),a.jsx("button",{type:"button",className:"join-campaign__button join-campaign__button--secondary",onClick:()=>t("/player/characters"),children:"Back to Characters"})]})]})})},qP={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:"sb_publishable_9AUU36J3CW2PWPdk3nqrtA_RwBAnQqk",VITE_SUPABASE_URL:"https://ebiskijxrorazuroljxt.supabase.co",VITE_WORKER_URL:"https://adurun-campaigns.larhackman.workers.dev"},UP=["VITE_SUPABASE_URL","VITE_SUPABASE_ANON_KEY"];function WP(){const e=qP??{},t=globalThis.__SUPABASE_ENV__??{};return{...e,...t}}function Fb(){const e=WP(),t=UP.filter(n=>!e[n]);if(t.length)throw new Te(0,`Missing env vars: ${t.join(", ")}`)}function zP(e){return{id:e.id,name:e.name,gmUserId:e.gm_user_id,createdAt:e.created_at??void 0}}function HP(e){return{id:e.id,campaignId:e.campaign_id,title:e.title,body:e.body??void 0,tags:e.tags??void 0}}async function YP(e){Fb();const t=ze(),{data:n,error:s}=await t.from("campaigns").select("id, name, gm_user_id, created_at").eq("id",e).maybeSingle();if(s)throw new Te(0,`Failed to load campaign: ${s.message}`);if(!n)throw new Te(0,"Campaign not found.");return zP(n)}async function VP(e){Fb();const t=ze(),{data:n,error:s}=await t.from("setting_entries").select("id, campaign_id, title, body, tags, is_player_visible").eq("campaign_id",e).eq("is_player_visible",!0).order("title",{ascending:!0});if(s)throw new Te(0,`Failed to load setting notes: ${s.message}`);return(n??[]).map(HP)}const KP=()=>{const{campaignId:e}=Tn(),[t,n]=v.useState(""),[s,r]=v.useState(!0),[i,o]=v.useState(null);return v.useEffect(()=>{if(!e){o("Campaign ID is missing."),r(!1);return}let l=!0;return(async()=>{r(!0),o(null);try{const u=await YP(e);if(!l)return;n(u.name)}catch(u){if(!l)return;o(u instanceof Error?u.message:"Failed to load campaign.")}finally{l&&r(!1)}})(),()=>{l=!1}},[e]),e?a.jsxs("div",{className:"campaign-hub",children:[a.jsxs("header",{className:"campaign-hub__header",children:[a.jsx("h2",{className:"campaign-hub__title h2",children:"Campaign Hub"}),a.jsx("p",{className:"campaign-hub__subtitle subtitle muted",children:s?"Loading campaign...":t||"Unnamed campaign"}),i&&a.jsx("p",{className:"campaign-hub__error body",children:i})]}),a.jsxs("nav",{className:"campaign-hub__nav",children:[a.jsx(bt,{to:"characters",className:({isActive:l})=>l?"campaign-hub__link campaign-hub__link--active":"campaign-hub__link",children:"Characters"}),a.jsx(bt,{to:"combat",className:({isActive:l})=>l?"campaign-hub__link campaign-hub__link--active":"campaign-hub__link",children:"Combat"}),a.jsx(bt,{to:"settings",className:({isActive:l})=>l?"campaign-hub__link campaign-hub__link--active":"campaign-hub__link",children:"Setting Info"})]}),a.jsx(jv,{})]}):a.jsx("div",{children:"Campaign not found."})},GP=()=>{const{campaignId:e}=Tn(),t=Ea();return e?a.jsxs("div",{className:"campaign-characters",children:[a.jsxs("div",{className:"campaign-characters__header",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"campaign-characters__title h2",children:"Campaign Characters"}),a.jsx("p",{className:"campaign-characters__subtitle subtitle muted",children:"Create and manage characters tied to this campaign only."})]}),a.jsx("button",{type:"button",onClick:()=>t(`/player/character-creation?campaignId=${e}`),className:"campaign-characters__button",children:"Create Character"})]}),a.jsx(cb,{campaignId:e})]}):a.jsx("div",{className:"campaign-characters__error body",children:"Campaign ID missing."})},JP=()=>{const{campaignId:e}=Tn(),[t,n]=v.useState([]),[s,r]=v.useState(!0),[i,o]=v.useState(null);return v.useEffect(()=>{if(!e){o("Campaign ID missing."),r(!1);return}let l=!0;return(async()=>{r(!0),o(null);try{const u=await VP(e);if(!l)return;n(u)}catch(u){if(!l)return;o(u instanceof Error?u.message:"Failed to load setting info.")}finally{l&&r(!1)}})(),()=>{l=!1}},[e]),a.jsxs("div",{className:"campaign-settings",children:[a.jsxs("header",{children:[a.jsx("h3",{className:"campaign-settings__title h2",children:"Setting Info"}),a.jsx("p",{className:"campaign-settings__subtitle subtitle muted",children:"Notes your GM has shared for this campaign."})]}),i&&a.jsx("div",{className:"campaign-settings__error body",children:i}),s?a.jsx("div",{className:"campaign-settings__status body muted",children:"Loading setting notes..."}):t.length===0?a.jsx("div",{className:"campaign-settings__status body muted",children:"No shared setting notes yet."}):a.jsx("div",{className:"campaign-settings__list",children:t.map(l=>a.jsxs("div",{className:"campaign-settings__card",children:[a.jsx("div",{className:"campaign-settings__card-title h3",children:l.title}),l.tags&&l.tags.length>0&&a.jsx("div",{className:"campaign-settings__tags caption muted",children:l.tags.join("  ")}),l.body?a.jsx("p",{className:"campaign-settings__body body",children:l.body}):a.jsx("p",{className:"campaign-settings__empty body muted",children:"No details provided."})]},l.id))})]})};function QP(){const[e,t]=T.useState([]),n=T.useRef(0),s=T.useCallback(h=>{const m=`notification-${++n.current}`,y={id:m,...h};return t(b=>[...b,y]),m},[]),r=T.useCallback(h=>{t(m=>m.filter(y=>y.id!==h))},[]),i=T.useCallback(()=>{t([])},[]),o=T.useCallback((h,m)=>s({type:"gm-request",title:"GM Request",message:h,action:{label:"Respond",onClick:m},duration:null}),[s]),l=T.useCallback((h,m)=>s({type:"attack-incoming",title:"Under Attack!",message:`${h} is attacking you!`,action:{label:"Defend",onClick:m},duration:null}),[s]),c=T.useCallback(h=>s({type:"turn-warning",title:"Turn Timer",message:`${h} seconds remaining!`,duration:5e3}),[s]),u=T.useCallback((h,m)=>s({type:"combat-event",title:h,message:m,duration:5e3}),[s]),d=T.useCallback((h,m=5e3)=>s({type:"system",title:"System",message:h,duration:m}),[s]);return{notifications:e,addNotification:s,dismissNotification:r,clearAll:i,notifyGMRequest:o,notifyAttackIncoming:l,notifyTurnWarning:c,notifyCombatEvent:u,notifySystem:d}}const XP=({campaignId:e,userId:t})=>{const{state:n,lobbyState:s,connectionStatus:r,error:i,clearError:o,declareAction:l,declareReaction:c,endTurn:u,initiateSkillContest:d,respondToSkillContest:h,submitSkillCheck:m,submitInitiativeRoll:y,myPendingDefense:b,myPendingSkillChecks:_,myPendingInitiativeRolls:w,joinLobby:f,leaveLobby:p,toggleReady:g}=Ui(),{phase:j,round:A,activeEntity:R,isMyTurn:S}=jb(),{getEntitiesByFaction:k,getEntitiesInInitiativeOrder:N,myControlledEntities:E}=Sb(),{canDeclareReaction:M}=m1(),[O,X]=v.useState(null),[re,I]=v.useState(null),[$,L]=v.useState(null),[D,F]=v.useState([]),[q,V]=v.useState(!0),[Q,te]=v.useState(!1),[B,ae]=v.useState(null),[le,he]=v.useState(null),ue=v.useRef(null),xe=v.useRef(!1),{notifications:Ne,dismissNotification:je,notifyGMRequest:Ce,notifyAttackIncoming:Ke,notifyCombatEvent:Me}=QP(),oe=n?k("ally"):[],pe=n?k("enemy"):[];n&&N();const ve=n!==null&&j!=="completed",be=i||O;v.useEffect(()=>{async function z(){try{V(!0);const U=(await tt.listCampaigns()).find(H=>H.id===e),P=await tt.listCampaignMembers(e);L(U||null),F(P)}catch(de){X("Failed to load campaign data"),console.error(de)}finally{V(!1)}}z()},[e]),v.useEffect(()=>{if(!ve&&!q){const z=D.find(de=>de.playerUserId===t);return f(z==null?void 0:z.characterId),()=>{p()}}},[ve,q,t,D,f,p]),v.useEffect(()=>{!re&&E.length>0&&I(E[0].id)},[E,re]),v.useEffect(()=>{if(!R||!S)return;R.id!==B&&(te(!0),ae(R.id))},[R,S,B]),v.useEffect(()=>{if(_.length===0)return;const z=_[0];Ce(`Roll a ${z.skill} check${z.targetNumber?` (DC ${z.targetNumber})`:""}`,()=>{})},[_,Ce]),v.useEffect(()=>{if(!b)return;const z=n==null?void 0:n.entities[b.initiatorId];z&&Ke(z.name,()=>{})},[b,n,Ke]),v.useEffect(()=>{var z,de;if(!(n!=null&&n.activeEntityId)){ue.current=null,xe.current=!1;return}if(!xe.current){xe.current=!0,ue.current=n.activeEntityId;return}if(ue.current&&ue.current!==n.activeEntityId){const U=((z=n.entities[ue.current])==null?void 0:z.name)||"Unknown";Me("Turn Ended",`${U} ended their turn.`)}if(ue.current!==n.activeEntityId){const U=((de=n.entities[n.activeEntityId])==null?void 0:de.name)||"Unknown";Me("Turn Started",`${U} is now acting.`)}ue.current=n.activeEntityId},[n==null?void 0:n.activeEntityId,n==null?void 0:n.entities,Me]),v.useEffect(()=>{if(!(n!=null&&n.log)||n.log.length===0)return;const z=n.log[n.log.length-1];if((z==null?void 0:z.type)==="skill-contest-resolved"&&z.data){const de=E.map(P=>P.id);(de.includes(z.data.winnerId)||de.includes(z.data.loserId))&&he({contestId:z.data.contestId||"",winnerId:z.data.winnerId||null,loserId:z.data.loserId||null,winnerTotal:z.data.winnerTotal||0,loserTotal:z.data.loserTotal||0,criticalTier:z.data.criticalTier||"normal",isTie:z.data.isTie||!1})}},[n==null?void 0:n.log,E]);const ke=async(z,de,U)=>{if(R)try{await l({entityId:R.id,type:z,targetEntityId:U,apCost:de,energyCost:0,interruptible:z==="attack"||z==="spell"})}catch(P){X(P instanceof Error?P.message:"Failed to declare action")}},Ie=async()=>{if(R)try{await u({entityId:R.id,voluntary:!0})}catch(z){X(z instanceof Error?z.message:"Failed to end turn")}},Be=()=>{!M||E.find(de=>de.reaction.available)},_e=z=>{I(z)},He=z=>{z.sourceEntityId&&I(z.sourceEntityId)},De=async(z,de)=>{try{await y({entityId:z,roll:de})}catch(U){X(U instanceof Error?U.message:"Failed to submit initiative roll")}},ne=async(z,de,U)=>{if(R)try{await d({initiatorEntityId:R.id,targetEntityId:z,skill:de,roll:U})}catch(P){X(P instanceof Error?P.message:"Failed to initiate skill contest")}},me=async(z,de)=>{try{await m({checkId:z,roll:de})}catch(U){X(U instanceof Error?U.message:"Failed to submit skill check")}},we=async z=>{if(z.variant==="initiative")w.length>0&&await De(w[0].id,z.roll);else if(z.variant==="skill-check")await me(z.checkId,z.roll);else if(z.variant==="contest"&&b&&E.length>0)try{await h({contestId:z.contestId,entityId:E[0].id,skill:z.skill,roll:z.roll})}catch(de){X(de instanceof Error?de.message:"Failed to submit defense")}},Ye=!1,Fe=E.some(z=>z.reaction.available);if(q)return a.jsx("div",{className:"war-page","data-theme":"dark-fantasy",children:a.jsx("div",{className:"war-page__empty",children:a.jsx("h2",{className:"war-page__empty-title",children:"Loading..."})})});if(!ve){const z=D.find(P=>P.playerUserId===t),de=s==null?void 0:s.players[t],U=D.filter(P=>P.playerUserId!==t).map(P=>{const H=s==null?void 0:s.players[P.playerUserId];return{id:P.playerUserId,name:P.playerUserId.substring(0,8),characterName:P.characterId||void 0,isReady:(H==null?void 0:H.isReady)??!1,isConnected:!!H}});return a.jsx(O1,{campaignName:($==null?void 0:$.name)||"Campaign",playerName:t.substring(0,8),characterName:z==null?void 0:z.characterId,isReady:(de==null?void 0:de.isReady)??!1,onToggleReady:P=>g(P,z==null?void 0:z.characterId),otherPlayers:U})}return a.jsxs("div",{className:"war-page","data-theme":"dark-fantasy",children:[a.jsxs("header",{className:"war-page__header",children:[a.jsxs("div",{className:"war-page__header-content",children:[a.jsx("h1",{className:"war-page__title war-text-display",children:" War Chronicle"}),j&&a.jsx("div",{className:"war-page__phase-dial",children:a.jsx(Eb,{phase:j,round:A})}),a.jsxs("div",{className:"war-page__header-status",children:[a.jsxs("div",{className:`war-page__connection war-page__connection--${r}`,children:[a.jsx("span",{className:"war-page__connection-dot"}),a.jsx("span",{className:"war-page__connection-label",children:r})]}),S&&R&&a.jsxs("div",{className:"war-page__your-turn",children:[a.jsx("span",{className:"war-page__your-turn-icon",children:""}),"Your Turn: ",R.name]}),!S&&R&&a.jsxs("div",{className:"war-page__current-turn",children:[a.jsx("span",{className:"war-page__current-turn-icon",children:""}),"Current Turn: ",R.name]}),!R&&j==="initiative-rolling"&&a.jsxs("div",{className:"war-page__current-turn war-page__current-turn--waiting",children:[a.jsx("span",{className:"war-page__current-turn-icon",children:""}),"Rolling initiative..."]})]})]}),be&&a.jsxs("div",{className:"war-page__error",children:[a.jsx("span",{children:be}),a.jsx("button",{onClick:()=>{o(),X(null)},children:""})]})]}),a.jsxs("main",{className:"war-page__main",children:[a.jsx("aside",{className:"war-page__sidebar war-page__sidebar--left",children:a.jsx(Cb,{entities:n!=null&&n.entities?Object.values(n.entities):[],initiativeOrder:(n==null?void 0:n.initiativeOrder)??[],activeEntityId:(n==null?void 0:n.activeEntityId)??null,onEntityClick:_e})}),a.jsxs("section",{className:"war-page__battlefield",children:[a.jsxs("div",{className:"war-page__zone war-page__zone--allies",children:[a.jsx("h2",{className:"war-page__zone-title war-text-display",children:" Your Forces"}),a.jsx("div",{className:"war-page__token-grid",children:oe.length===0?a.jsx("div",{className:"war-page__zone-empty",children:"No allies"}):oe.map(z=>a.jsx($l,{entity:z,isActive:z.id===(n==null?void 0:n.activeEntityId),isSelected:z.id===re,onClick:()=>_e(z.id)},z.id))})]}),a.jsxs("div",{className:"war-page__zone war-page__zone--enemies",children:[a.jsx("h2",{className:"war-page__zone-title war-text-display",children:" Enemy Forces"}),a.jsx("div",{className:"war-page__token-grid",children:pe.length===0?a.jsx("div",{className:"war-page__zone-empty",children:"No enemies"}):pe.map(z=>a.jsx($l,{entity:z,isActive:z.id===(n==null?void 0:n.activeEntityId),isSelected:z.id===re,onClick:()=>_e(z.id)},z.id))})]}),j==="initiative-rolling"&&w.length>0&&a.jsx("div",{className:"war-page__initiative-panel",children:w.map(z=>a.jsx(k1,{entity:z,onRoll:de=>De(z.id,de)},z.id))}),S&&R&&j==="active-turn"&&a.jsx("div",{className:"war-page__action-panel",children:a.jsx(x1,{entity:R,enemies:pe,onDeclareAction:ke,onInitiateSkillContest:ne,onEndTurn:Ie,disabled:!1})})]}),a.jsx("aside",{className:"war-page__sidebar war-page__sidebar--right",children:a.jsx(Ab,{log:(n==null?void 0:n.log)??[],entities:n!=null&&n.entities?Object.values(n.entities):[],onEntryClick:He,maxEntries:100})})]}),a.jsx(w1,{available:Fe,pulsing:Ye,onClick:Be,label:"Reaction"}),b&&E.length>0&&a.jsx(Td,{isOpen:!0,variant:"contest",entity:E[0],contest:b,entities:n!=null&&n.entities?Object.values(n.entities):[],contestMode:"defender",onSubmit:we,onClose:()=>{}}),_.length>0&&E.length>0&&a.jsx(Td,{isOpen:!0,variant:"skill-check",entity:E[0],checkRequest:_[0],onSubmit:we,onClose:()=>{}}),a.jsx(N1,{notifications:Ne,onDismiss:je}),Q&&R&&a.jsx(S1,{isVisible:Q,entityName:R.name,ap:R.ap,energy:R.energy,onDismiss:()=>te(!1)}),le&&(n==null?void 0:n.entities)&&a.jsx(D1,{result:le,entities:n.entities,onDismiss:()=>he(null),autoDismissMs:5e3})]})},ZP=()=>{const{campaignId:e}=Tn(),[t,n]=v.useState(null),[s,r]=v.useState(!0),[i,o]=v.useState(null);return v.useEffect(()=>{async function l(){try{const c=ze(),{data:u,error:d}=await c.auth.getUser();if(d||!u.user){o("Not authenticated");return}n(u.user.id)}catch(c){o("Failed to load user data"),console.error(c)}finally{r(!1)}}l()},[]),e?s?a.jsx("div",{className:"war-page","data-theme":"dark-fantasy",children:a.jsx("div",{className:"war-page__empty",children:a.jsx("h2",{children:"Loading..."})})}):i||!t?a.jsxs("div",{className:"war-page__error-state",children:[a.jsxs("h2",{children:["Error: ",i||"Not authenticated"]}),a.jsx("p",{children:"Please log in to access combat."})]}):a.jsx(Nb,{campaignId:e,userId:t,isGm:!1,children:a.jsx(XP,{campaignId:e,userId:t})}):a.jsxs("div",{className:"war-page__error-state",children:[a.jsx("h2",{children:"Error: No Campaign ID"}),a.jsx("p",{children:"Cannot load combat without a campaign ID."})]})},qb=v.createContext(void 0),Ub="theme",eT=()=>typeof window>"u"?"parchment":window.localStorage.getItem(Ub)==="dark-fantasy"?"dark-fantasy":"parchment",tT=({children:e})=>{const[t,n]=v.useState(()=>eT());v.useEffect(()=>{typeof document>"u"||(document.documentElement.dataset.theme=t,window.localStorage.setItem(Ub,t))},[t]);const s=v.useCallback(r=>{n(r)},[]);return a.jsx(qb.Provider,{value:{theme:t,setTheme:s},children:e})},nT=()=>{const e=v.useContext(qb);if(!e)throw new Error("useTheme must be used within a ThemeProvider");return e},Wb=()=>a.jsxs("div",{children:[a.jsx("h2",{children:"Page not found"}),a.jsx("p",{children:"The page you are looking for does not exist."})]}),aT=()=>{const{theme:e,setTheme:t}=nT();return a.jsxs("div",{className:"app-theme-toggle",children:[a.jsx("label",{htmlFor:"theme-toggle",className:"app-theme-toggle__label caption",children:"Theme"}),a.jsxs("select",{id:"theme-toggle",value:e,onChange:n=>t(n.target.value),className:"select app-theme-toggle__select caption",children:[a.jsx("option",{value:"parchment",children:"Parchment"}),a.jsx("option",{value:"dark-fantasy",children:"Dark Fantasy"})]})]})},sT=()=>a.jsx("div",{className:"app-start",children:a.jsxs("div",{className:"app-start__content",children:[a.jsx("h1",{className:"app-start__title h1",children:"Adrun Builder"}),a.jsx("p",{className:"app-start__subtitle subtitle muted",children:"Choose your role to launch the correct workspace."}),a.jsxs("div",{className:"app-start__actions",children:[a.jsx(bt,{to:"/player/characters",className:"btn btn--primary app-start__link app-start__link--player",children:"I am a Player"}),a.jsx(bt,{to:"/gm/campaigns",className:"btn app-start__link app-start__link--gm",children:"I am the GM"})]})]})}),rT=()=>{const[e,t]=v.useState(null);return v.useEffect(()=>{if(typeof window>"u")return;const n=()=>{t(window.localStorage.getItem(Bb))};return n(),window.addEventListener("storage",n),()=>window.removeEventListener("storage",n)},[]),a.jsxs("div",{className:"app-shell",children:[a.jsxs("nav",{className:"app-shell__nav",children:[a.jsx("h1",{className:"app-shell__title h2",children:"Adrun Builder"}),a.jsx(bt,{to:"/player/characters",className:({isActive:n})=>n?"app-shell__link app-shell__link--active":"app-shell__link",children:"Characters"}),e&&a.jsxs(a.Fragment,{children:[a.jsx(bt,{to:`/player/campaigns/${e}`,className:({isActive:n})=>n?"app-shell__link app-shell__link--active":"app-shell__link",children:"Campaign Hub"}),a.jsx(bt,{to:`/player/campaigns/${e}/combat`,className:({isActive:n})=>n?"app-shell__link app-shell__link--active":"app-shell__link",children:"Combat"})]}),a.jsx(bt,{to:"/player/character-creation",className:({isActive:n})=>n?"app-shell__link app-shell__link--active":"app-shell__link",children:"Character Creation"}),a.jsx(bt,{to:"/player/ancillaries",className:({isActive:n})=>n?"app-shell__link app-shell__link--active":"app-shell__link",children:"Ancillaries"}),a.jsx(bt,{to:"/player/martial",className:({isActive:n})=>n?"app-shell__link app-shell__link--active":"app-shell__link",children:"Martial Prowess"}),a.jsx(bt,{to:"/player/psionics",className:({isActive:n})=>n?"app-shell__link app-shell__link--active":"app-shell__link",children:"Psionics"}),a.jsx(bt,{to:"/player/magic-faculties",className:({isActive:n})=>n?"app-shell__link app-shell__link--active":"app-shell__link",children:"Magic Faculties"}),a.jsx(bt,{to:"/player/spell-creation",className:({isActive:n})=>n?"app-shell__link app-shell__link--active":"app-shell__link",children:"Spell Creation"}),a.jsx(bt,{to:"/player/deity-relationship",className:({isActive:n})=>n?"app-shell__link app-shell__link--active":"app-shell__link",children:"Deity Relationship"})]}),a.jsx("main",{className:"app-shell__main",children:a.jsxs(zh,{children:[a.jsx(Xe,{path:"/",element:a.jsx(dd,{to:"characters",replace:!0})}),a.jsxs(Xe,{path:"campaigns/:campaignId",element:a.jsx(KP,{}),children:[a.jsx(Xe,{index:!0,element:a.jsx(dd,{to:"characters",replace:!0})}),a.jsx(Xe,{path:"characters",element:a.jsx(GP,{})}),a.jsx(Xe,{path:"settings",element:a.jsx(JP,{})}),a.jsx(Xe,{path:"combat",element:a.jsx(IP,{})}),a.jsx(Xe,{path:"combat/lobby",element:a.jsx($b,{})}),a.jsx(Xe,{path:"combat-legacy",element:a.jsx(ZP,{})})]}),a.jsx(Xe,{path:"characters",element:a.jsx(cb,{})}),a.jsx(Xe,{path:"character-creation",element:a.jsx(sE,{})}),a.jsx(Xe,{path:"ancillaries",element:a.jsx($E,{})}),a.jsx(Xe,{path:"martial",element:a.jsx(UE,{})}),a.jsx(Xe,{path:"psionics",element:a.jsx(GE,{})}),a.jsx(Xe,{path:"magic-faculties",element:a.jsx(XE,{})}),a.jsx(Xe,{path:"spell-creation",element:a.jsx(uC,{})}),a.jsx(Xe,{path:"deity-relationship",element:a.jsx(yC,{})}),a.jsx(Xe,{path:"*",element:a.jsx(Wb,{})})]})})]})},iT=()=>a.jsx(oS,{children:a.jsxs(cS,{children:[a.jsx(aT,{}),a.jsxs(zh,{children:[a.jsx(Xe,{path:"/",element:a.jsx(sT,{})}),a.jsx(Xe,{path:"/join/:token",element:a.jsx(FP,{})}),a.jsx(Xe,{path:"/gm/combat",element:a.jsx(tg,{})}),a.jsx(Xe,{path:"/gm/*",element:a.jsx(tg,{})}),a.jsx(Xe,{path:"/player/*",element:a.jsx(rT,{})}),a.jsx(Xe,{path:"*",element:a.jsx(Wb,{})})]})]})});yu.createRoot(document.getElementById("root")).render(a.jsx(v.StrictMode,{children:a.jsx(tT,{children:a.jsx(Vw,{children:a.jsx(iT,{})})})}));
